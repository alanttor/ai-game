<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äººä½“ç”Ÿç†ç³»ç»Ÿæ¨¡æ‹Ÿå™¨</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ«€</text></svg>">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #0a1628 0%, #1a0a28 100%);
            min-height: 100vh;
            color: #a0c0e0;
            overflow: hidden;
        }
        .container { display: flex; height: 100vh; }
        .body-area {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .body-model {
            width: 300px;
            height: 500px;
            position: relative;
        }
        .right-panel {
            width: 350px;
            background: rgba(10,20,40,0.95);
            border-left: 2px solid #2a4a6a;
            padding: 15px;
            overflow-y: auto;
        }
        .bottom-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 350px;
            height: 120px;
            background: rgba(10,20,40,0.95);
            border-top: 2px solid #2a4a6a;
            display: flex;
            padding: 10px;
            gap: 10px;
        }
        .vital-card {
            flex: 1;
            background: rgba(255,255,255,0.03);
            border: 1px solid #2a4a6a;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
        }
        .vital-icon { font-size: 1.5em; margin-bottom: 5px; }
        .vital-value { font-size: 1.8em; font-weight: bold; }
        .vital-label { font-size: 0.75em; color: #6080a0; }
</style>
</head>
<body>
<div class="container">
    <div class="body-area">
        <canvas id="bodyCanvas" width="400" height="550"></canvas>
    </div>
    <div class="right-panel" id="rightPanel"></div>
</div>
<div class="bottom-panel" id="bottomPanel"></div>
<script>
const canvas = document.getElementById('bodyCanvas');
const ctx = canvas.getContext('2d');

// ç”Ÿç†å‚æ•°
let physiology = {
    heartRate: 72,
    bloodPressure: { systolic: 120, diastolic: 80 },
    temperature: 36.6,
    oxygenSat: 98,
    bloodSugar: 90,
    respirationRate: 16,
    metabolicRate: 1800
};

// æ§åˆ¶å‚æ•°
let controls = {
    activity: 0.2,      // 0=ç¡çœ , 0.5=é™æ¯, 1=æé™è¿åŠ¨
    stress: 0.3,        // 0=æ”¾æ¾, 1=æåº¦å‹åŠ›
    temperature: 22,    // ç¯å¢ƒæ¸©åº¦
    hydration: 0.7,     // 0=è„±æ°´, 1=è¿‡åº¦æ°´åˆ
    food: { carbs: 50, protein: 30, fat: 20 }
};

let selectedSystem = 'circulatory';
let time = 0;
let particles = [];

const systems = {
    circulatory: { name: 'å¾ªç¯ç³»ç»Ÿ', color: '#ff4444', icon: 'â¤ï¸' },
    respiratory: { name: 'å‘¼å¸ç³»ç»Ÿ', color: '#44aaff', icon: 'ğŸ«' },
    digestive: { name: 'æ¶ˆåŒ–ç³»ç»Ÿ', color: '#ffaa44', icon: 'ğŸ½ï¸' },
    nervous: { name: 'ç¥ç»ç³»ç»Ÿ', color: '#aa44ff', icon: 'ğŸ§ ' }
};

function init() {
    renderRightPanel();
    renderBottomPanel();
    
    // åˆå§‹åŒ–è¡€æ¶²ç²’å­
    for (let i = 0; i < 100; i++) {
        particles.push(createBloodParticle());
    }
    
    setInterval(simulate, 100);
    animate();
}

function createBloodParticle() {
    const angle = Math.random() * Math.PI * 2;
    const radius = 50 + Math.random() * 80;
    return {
        x: 200 + Math.cos(angle) * radius,
        y: 180 + Math.sin(angle) * radius * 0.6,
        vx: 0,
        vy: 0,
        phase: Math.random() * Math.PI * 2,
        type: Math.random() > 0.3 ? 'red' : 'blue'
    };
}

function simulate() {
    time += 0.1;
    
    // æ´»åŠ¨å½±å“
    const activityEffect = controls.activity * 2;
    const stressEffect = controls.stress * 1.5;
    
    // å¿ƒç‡è®¡ç®—
    const baseHR = 60;
    physiology.heartRate = baseHR + activityEffect * 80 + stressEffect * 30;
    physiology.heartRate += Math.sin(time * 0.5) * 3; // è‡ªç„¶æ³¢åŠ¨
    
    // è¡€å‹
    physiology.bloodPressure.systolic = 110 + activityEffect * 40 + stressEffect * 20;
    physiology.bloodPressure.diastolic = 70 + activityEffect * 20 + stressEffect * 10;
    
    // å‘¼å¸ç‡
    physiology.respirationRate = 12 + activityEffect * 20;
    
    // ä½“æ¸©
    const envTempEffect = (controls.temperature - 22) * 0.02;
    physiology.temperature = 36.5 + activityEffect * 1.5 + envTempEffect;
    
    // è¡€æ°§
    physiology.oxygenSat = 98 - activityEffect * 3;
    if (controls.activity > 0.8) physiology.oxygenSat -= 2;
    
    // è¡€ç³–
    const carbEffect = controls.food.carbs / 100;
    physiology.bloodSugar = 80 + carbEffect * 40 - activityEffect * 20;
    
    // ä»£è°¢ç‡
    physiology.metabolicRate = 1500 + activityEffect * 3000 + stressEffect * 500;
    
    // é™åˆ¶èŒƒå›´
    physiology.heartRate = Math.max(40, Math.min(200, physiology.heartRate));
    physiology.oxygenSat = Math.max(85, Math.min(100, physiology.oxygenSat));
    physiology.bloodSugar = Math.max(50, Math.min(200, physiology.bloodSugar));
    physiology.temperature = Math.max(35, Math.min(42, physiology.temperature));
    
    renderBottomPanel();
}

function renderRightPanel() {
    const panel = document.getElementById('rightPanel');
    panel.innerHTML = `
        <style>
            .panel-title { font-size: 1em; color: #4a8ac0; border-bottom: 1px solid #2a4a6a; padding-bottom: 8px; margin-bottom: 12px; }
            .panel-section { background: rgba(255,255,255,0.03); border-radius: 6px; padding: 12px; margin-bottom: 12px; border: 1px solid #2a4a6a; }
            .system-btn { display: flex; align-items: center; gap: 10px; width: 100%; padding: 10px; margin: 4px 0; background: rgba(255,255,255,0.03); border: 1px solid #2a4a6a; border-radius: 6px; color: #a0c0e0; cursor: pointer; }
            .system-btn:hover { background: rgba(255,255,255,0.08); }
            .system-btn.active { border-color: #4a8ac0; background: rgba(74,138,192,0.2); }
            .slider-group { margin: 12px 0; }
            .slider-label { display: flex; justify-content: space-between; font-size: 0.8em; color: #6080a0; margin-bottom: 4px; }
            input[type="range"] { width: 100%; height: 4px; border-radius: 2px; background: #2a4a6a; -webkit-appearance: none; }
            input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 14px; height: 14px; border-radius: 50%; background: #4a8ac0; cursor: pointer; }
        </style>
        
        <div style="text-align:center;margin-bottom:15px;">
            <h2 style="color:#4a8ac0;font-size:1.2em;">ğŸ«€ äººä½“ç”Ÿç†æ¨¡æ‹Ÿå™¨</h2>
            <p style="color:#4a6080;font-size:0.75em;">å¤šç³»ç»Ÿåè°ƒä»¿çœŸ</p>
        </div>
        
        <div class="panel-section">
            <div class="panel-title">ğŸ”¬ ç³»ç»Ÿé€‰æ‹©</div>
            ${Object.entries(systems).map(([k, s]) => `
                <button class="system-btn ${selectedSystem === k ? 'active' : ''}" onclick="selectSystem('${k}')">
                    <span style="font-size:1.5em">${s.icon}</span>
                    <span>${s.name}</span>
                </button>
            `).join('')}
        </div>
        
        <div class="panel-section">
            <div class="panel-title">âš™ï¸ ç”Ÿç†æ§åˆ¶</div>
            <div class="slider-group">
                <div class="slider-label"><span>ğŸƒ æ´»åŠ¨æ°´å¹³</span><span>${getActivityLabel()}</span></div>
                <input type="range" min="0" max="100" value="${controls.activity * 100}" 
                       oninput="controls.activity=this.value/100;renderRightPanel()">
            </div>
            <div class="slider-group">
                <div class="slider-label"><span>ğŸ˜° å‹åŠ›æ°´å¹³</span><span>${getStressLabel()}</span></div>
                <input type="range" min="0" max="100" value="${controls.stress * 100}"
                       oninput="controls.stress=this.value/100;renderRightPanel()">
            </div>
            <div class="slider-group">
                <div class="slider-label"><span>ğŸŒ¡ï¸ ç¯å¢ƒæ¸©åº¦</span><span>${controls.temperature}Â°C</span></div>
                <input type="range" min="0" max="45" value="${controls.temperature}"
                       oninput="controls.temperature=parseInt(this.value);renderRightPanel()">
            </div>
            <div class="slider-group">
                <div class="slider-label"><span>ğŸ’§ æ°´åˆ†çŠ¶æ€</span><span>${getHydrationLabel()}</span></div>
                <input type="range" min="0" max="100" value="${controls.hydration * 100}"
                       oninput="controls.hydration=this.value/100;renderRightPanel()">
            </div>
        </div>
        
        <div class="panel-section">
            <div class="panel-title">ğŸ½ï¸ è¥å…»æ‘„å…¥</div>
            <div class="slider-group">
                <div class="slider-label"><span>ğŸ ç¢³æ°´åŒ–åˆç‰©</span><span>${controls.food.carbs}%</span></div>
                <input type="range" min="0" max="100" value="${controls.food.carbs}"
                       oninput="controls.food.carbs=parseInt(this.value);renderRightPanel()">
            </div>
            <div class="slider-group">
                <div class="slider-label"><span>ğŸ¥© è›‹ç™½è´¨</span><span>${controls.food.protein}%</span></div>
                <input type="range" min="0" max="100" value="${controls.food.protein}"
                       oninput="controls.food.protein=parseInt(this.value);renderRightPanel()">
            </div>
            <div class="slider-group">
                <div class="slider-label"><span>ğŸ¥‘ è„‚è‚ª</span><span>${controls.food.fat}%</span></div>
                <input type="range" min="0" max="100" value="${controls.food.fat}"
                       oninput="controls.food.fat=parseInt(this.value);renderRightPanel()">
            </div>
        </div>
        
        <div class="panel-section">
            <div class="panel-title">ğŸ“Š ç³»ç»ŸçŠ¶æ€</div>
            <div style="font-size:0.8em;color:#6080a0;line-height:1.8;">
                ${getSystemInfo()}
            </div>
        </div>
    `;
}

function getActivityLabel() {
    if (controls.activity < 0.1) return 'ç¡çœ ';
    if (controls.activity < 0.3) return 'é™æ¯';
    if (controls.activity < 0.5) return 'è½»åº¦æ´»åŠ¨';
    if (controls.activity < 0.7) return 'ä¸­åº¦è¿åŠ¨';
    if (controls.activity < 0.9) return 'å‰§çƒˆè¿åŠ¨';
    return 'æé™è¿åŠ¨';
}

function getStressLabel() {
    if (controls.stress < 0.2) return 'æ”¾æ¾';
    if (controls.stress < 0.4) return 'è½»åº¦';
    if (controls.stress < 0.6) return 'ä¸­åº¦';
    if (controls.stress < 0.8) return 'é«˜åº¦';
    return 'æåº¦å‹åŠ›';
}

function getHydrationLabel() {
    if (controls.hydration < 0.3) return 'è„±æ°´';
    if (controls.hydration < 0.5) return 'è½»åº¦ç¼ºæ°´';
    if (controls.hydration < 0.7) return 'æ­£å¸¸';
    if (controls.hydration < 0.9) return 'å……è¶³';
    return 'è¿‡åº¦æ°´åˆ';
}

function getSystemInfo() {
    const info = {
        circulatory: `å¿ƒè„æ¯åˆ†é’Ÿæ³µè¡€çº¦${(physiology.heartRate * 70 / 1000).toFixed(1)}å‡<br>è¡€æ¶²å¾ªç¯ä¸€å‘¨çº¦éœ€60ç§’<br>å½“å‰å¿ƒè¾“å‡ºé‡: ${(physiology.heartRate * 70 / 1000 * 60).toFixed(0)} L/min`,
        respiratory: `æ¯åˆ†é’Ÿå‘¼å¸${physiology.respirationRate.toFixed(0)}æ¬¡<br>æ½®æ°”é‡çº¦500ml<br>æ¯åˆ†é’Ÿé€šæ°”é‡: ${(physiology.respirationRate * 0.5).toFixed(1)} L`,
        digestive: `åŸºç¡€ä»£è°¢ç‡: ${physiology.metabolicRate.toFixed(0)} kcal/å¤©<br>ç¢³æ°´æä¾›${controls.food.carbs}%èƒ½é‡<br>æ¶ˆåŒ–ä¸€é¤çº¦éœ€4-6å°æ—¶`,
        nervous: `ç¥ç»ä¿¡å·ä¼ å¯¼é€Ÿåº¦: 120m/s<br>å¤§è„‘æ¶ˆè€—çº¦20%èƒ½é‡<br>å‹åŠ›æ¿€æ´»äº¤æ„Ÿç¥ç»ç³»ç»Ÿ`
    };
    return info[selectedSystem];
}

function selectSystem(sys) {
    selectedSystem = sys;
    renderRightPanel();
}

function renderBottomPanel() {
    const panel = document.getElementById('bottomPanel');
    
    const vitals = [
        { icon: 'â¤ï¸', label: 'å¿ƒç‡', value: physiology.heartRate.toFixed(0), unit: 'BPM', color: getVitalColor('hr', physiology.heartRate) },
        { icon: 'ğŸ©¸', label: 'è¡€å‹', value: `${physiology.bloodPressure.systolic.toFixed(0)}/${physiology.bloodPressure.diastolic.toFixed(0)}`, unit: 'mmHg', color: getVitalColor('bp', physiology.bloodPressure.systolic) },
        { icon: 'ğŸŒ¡ï¸', label: 'ä½“æ¸©', value: physiology.temperature.toFixed(1), unit: 'Â°C', color: getVitalColor('temp', physiology.temperature) },
        { icon: 'ğŸ’¨', label: 'è¡€æ°§', value: physiology.oxygenSat.toFixed(0), unit: '%', color: getVitalColor('o2', physiology.oxygenSat) },
        { icon: 'ğŸ¬', label: 'è¡€ç³–', value: physiology.bloodSugar.toFixed(0), unit: 'mg/dL', color: getVitalColor('sugar', physiology.bloodSugar) },
        { icon: 'ğŸ«', label: 'å‘¼å¸', value: physiology.respirationRate.toFixed(0), unit: 'æ¬¡/åˆ†', color: '#44aaff' },
        { icon: 'ğŸ”¥', label: 'ä»£è°¢', value: physiology.metabolicRate.toFixed(0), unit: 'kcal', color: '#ffaa44' }
    ];
    
    panel.innerHTML = vitals.map(v => `
        <div class="vital-card">
            <div class="vital-icon">${v.icon}</div>
            <div class="vital-value" style="color:${v.color}">${v.value}</div>
            <div class="vital-label">${v.label} (${v.unit})</div>
        </div>
    `).join('');
}

function getVitalColor(type, value) {
    switch(type) {
        case 'hr':
            if (value < 60 || value > 100) return '#ffaa44';
            if (value > 150) return '#ff4444';
            return '#44ff88';
        case 'bp':
            if (value > 140) return '#ff4444';
            if (value > 130) return '#ffaa44';
            return '#44ff88';
        case 'temp':
            if (value < 36 || value > 37.5) return '#ffaa44';
            if (value > 38) return '#ff4444';
            return '#44ff88';
        case 'o2':
            if (value < 95) return '#ffaa44';
            if (value < 90) return '#ff4444';
            return '#44ff88';
        case 'sugar':
            if (value < 70 || value > 140) return '#ffaa44';
            if (value < 50 || value > 180) return '#ff4444';
            return '#44ff88';
        default:
            return '#44aaff';
    }
}

function animate() {
    draw();
    requestAnimationFrame(animate);
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // ç»˜åˆ¶äººä½“è½®å»“
    drawBody();
    
    // ç»˜åˆ¶é€‰ä¸­çš„ç³»ç»Ÿ
    if (selectedSystem === 'circulatory') drawCirculatorySystem();
    else if (selectedSystem === 'respiratory') drawRespiratorySystem();
    else if (selectedSystem === 'digestive') drawDigestiveSystem();
    else if (selectedSystem === 'nervous') drawNervousSystem();
    
    // æ›´æ–°ç²’å­
    updateParticles();
}

function drawBody() {
    ctx.strokeStyle = 'rgba(74,138,192,0.3)';
    ctx.lineWidth = 2;
    
    // å¤´
    ctx.beginPath();
    ctx.ellipse(200, 60, 35, 45, 0, 0, Math.PI * 2);
    ctx.stroke();
    
    // èº¯å¹²
    ctx.beginPath();
    ctx.moveTo(165, 100);
    ctx.lineTo(150, 280);
    ctx.lineTo(170, 280);
    ctx.lineTo(200, 320);
    ctx.lineTo(230, 280);
    ctx.lineTo(250, 280);
    ctx.lineTo(235, 100);
    ctx.closePath();
    ctx.stroke();
    
    // æ‰‹è‡‚
    ctx.beginPath();
    ctx.moveTo(150, 110);
    ctx.lineTo(100, 220);
    ctx.moveTo(250, 110);
    ctx.lineTo(300, 220);
    ctx.stroke();
    
    // è…¿
    ctx.beginPath();
    ctx.moveTo(170, 280);
    ctx.lineTo(160, 450);
    ctx.moveTo(230, 280);
    ctx.lineTo(240, 450);
    ctx.stroke();
}

function drawCirculatorySystem() {
    const heartBeat = Math.sin(time * physiology.heartRate / 30) * 0.1 + 1;
    
    // å¿ƒè„
    ctx.save();
    ctx.translate(200, 180);
    ctx.scale(heartBeat, heartBeat);
    ctx.fillStyle = '#ff4444';
    ctx.beginPath();
    ctx.moveTo(0, -15);
    ctx.bezierCurveTo(-20, -30, -30, 0, 0, 20);
    ctx.bezierCurveTo(30, 0, 20, -30, 0, -15);
    ctx.fill();
    ctx.restore();
    
    // ä¸»è¦è¡€ç®¡
    ctx.strokeStyle = '#ff6666';
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(200, 165);
    ctx.lineTo(200, 100);
    ctx.lineTo(200, 60);
    ctx.stroke();
    
    ctx.strokeStyle = '#6666ff';
    ctx.beginPath();
    ctx.moveTo(200, 195);
    ctx.lineTo(200, 280);
    ctx.stroke();
    
    // ç»˜åˆ¶è¡€æ¶²ç²’å­
    particles.forEach(p => {
        ctx.fillStyle = p.type === 'red' ? '#ff4444' : '#4444ff';
        ctx.beginPath();
        ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
        ctx.fill();
    });
}

function drawRespiratorySystem() {
    const breathPhase = Math.sin(time * physiology.respirationRate / 30);
    const lungSize = 1 + breathPhase * 0.1;
    
    // æ°”ç®¡
    ctx.strokeStyle = '#44aaff';
    ctx.lineWidth = 8;
    ctx.beginPath();
    ctx.moveTo(200, 100);
    ctx.lineTo(200, 150);
    ctx.stroke();
    
    // å·¦è‚º
    ctx.save();
    ctx.translate(160, 200);
    ctx.scale(lungSize, lungSize);
    ctx.fillStyle = 'rgba(68,170,255,0.3)';
    ctx.strokeStyle = '#44aaff';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.ellipse(0, 0, 30, 50, 0, 0, Math.PI * 2);
    ctx.fill();
    ctx.stroke();
    ctx.restore();
    
    // å³è‚º
    ctx.save();
    ctx.translate(240, 200);
    ctx.scale(lungSize, lungSize);
    ctx.fillStyle = 'rgba(68,170,255,0.3)';
    ctx.beginPath();
    ctx.ellipse(0, 0, 30, 50, 0, 0, Math.PI * 2);
    ctx.fill();
    ctx.stroke();
    ctx.restore();
    
    // O2/CO2 æ ‡ç­¾
    ctx.fillStyle = '#44ff88';
    ctx.font = '12px Arial';
    ctx.fillText('Oâ‚‚ â†“', 180, 130);
    ctx.fillStyle = '#ff8844';
    ctx.fillText('COâ‚‚ â†‘', 200, 130);
}

function drawDigestiveSystem() {
    // èƒƒ
    ctx.fillStyle = 'rgba(255,170,68,0.3)';
    ctx.strokeStyle = '#ffaa44';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.ellipse(180, 220, 25, 35, -0.3, 0, Math.PI * 2);
    ctx.fill();
    ctx.stroke();
    
    // å°è‚ 
    ctx.strokeStyle = '#ffaa44';
    ctx.lineWidth = 4;
    ctx.beginPath();
    for (let i = 0; i < 5; i++) {
        const y = 270 + i * 15;
        ctx.moveTo(160, y);
        ctx.bezierCurveTo(180, y - 10, 220, y + 10, 240, y);
    }
    ctx.stroke();
    
    // è‚è„
    ctx.fillStyle = 'rgba(139,69,19,0.4)';
    ctx.beginPath();
    ctx.ellipse(230, 200, 30, 20, 0.3, 0, Math.PI * 2);
    ctx.fill();
    ctx.strokeStyle = '#8b4513';
    ctx.stroke();
}

function drawNervousSystem() {
    // å¤§è„‘
    ctx.fillStyle = 'rgba(170,68,255,0.3)';
    ctx.strokeStyle = '#aa44ff';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.ellipse(200, 55, 30, 25, 0, 0, Math.PI * 2);
    ctx.fill();
    ctx.stroke();
    
    // è„Šé«“
    ctx.strokeStyle = '#aa44ff';
    ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.moveTo(200, 80);
    ctx.lineTo(200, 280);
    ctx.stroke();
    
    // ç¥ç»ä¿¡å·
    const signalY = 80 + ((time * 50) % 200);
    ctx.fillStyle = '#ffff00';
    ctx.beginPath();
    ctx.arc(200, signalY, 5, 0, Math.PI * 2);
    ctx.fill();
    
    // ç¥ç»åˆ†æ”¯
    ctx.strokeStyle = 'rgba(170,68,255,0.5)';
    ctx.lineWidth = 1;
    for (let y = 120; y < 280; y += 30) {
        ctx.beginPath();
        ctx.moveTo(200, y);
        ctx.lineTo(150, y + 20);
        ctx.moveTo(200, y);
        ctx.lineTo(250, y + 20);
        ctx.stroke();
    }
}

function updateParticles() {
    const speed = physiology.heartRate / 72;
    
    particles.forEach(p => {
        p.phase += 0.02 * speed;
        const angle = p.phase;
        const radius = 50 + Math.sin(p.phase * 0.5) * 30;
        
        p.x = 200 + Math.cos(angle) * radius;
        p.y = 180 + Math.sin(angle) * radius * 0.6;
    });
}

window.onload = init;
</script>
</body>
</html>