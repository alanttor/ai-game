<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æç«¯ç¯å¢ƒç”Ÿå­˜æŒ‘æˆ˜</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ”ï¸</text></svg>">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #0a0a15;
            min-height: 100vh;
            color: #c0c0c0;
            overflow: hidden;
        }
        .container { display: flex; height: 100vh; }
        .env-area { flex: 1; position: relative; overflow: hidden; }
        .env-bg { position: absolute; top: 0; left: 0; right: 0; bottom: 0; transition: all 1s; }
        .hud-top { position: absolute; top: 10px; left: 10px; right: 10px; display: flex; gap: 10px; }
        .hud-bottom { position: absolute; bottom: 10px; left: 10px; right: 320px; display: flex; gap: 10px; }
        .right-panel {
            width: 320px;
            background: rgba(10,10,20,0.95);
            border-left: 2px solid #3a3a5a;
            padding: 15px;
            overflow-y: auto;
        }
        .vital-bar {
            flex: 1;
            background: rgba(0,0,0,0.5);
            border: 1px solid #3a3a5a;
            border-radius: 8px;
            padding: 8px 12px;
        }
        .vital-label { font-size: 0.7em; color: #808090; margin-bottom: 3px; }
        .vital-value { font-size: 1.1em; font-weight: bold; }
        .vital-meter { height: 6px; background: #1a1a2a; border-radius: 3px; margin-top: 4px; overflow: hidden; }
        .vital-fill { height: 100%; border-radius: 3px; transition: width 0.3s; }
</style>
</head>
<body>
<div class="container">
    <div class="env-area" id="envArea">
        <div class="env-bg" id="envBg"></div>
        <canvas id="envCanvas"></canvas>
        <div class="hud-top" id="hudTop"></div>
        <div class="hud-bottom" id="hudBottom"></div>
    </div>
    <div class="right-panel" id="rightPanel"></div>
</div>
<script>
const canvas = document.getElementById('envCanvas');
const ctx = canvas.getContext('2d');

// ç¯å¢ƒç±»å‹
const environments = {
    everest: {
        name: 'ç ç©†æœ—ç›å³°',
        icon: 'ğŸ”ï¸',
        altitude: 8848,
        bgGradient: ['#1a2a4a', '#4a6a8a', '#8aaaca'],
        challenges: ['ç¼ºæ°§', 'ä½æ¸©', 'æš´é£é›ª'],
        oxygenRate: -2,
        hydrationRate: -0.2,
        baseTemp: -30
    },
    mariana: {
        name: 'é©¬é‡Œäºšçº³æµ·æ²Ÿ',
        icon: 'ğŸŒŠ',
        altitude: -10994,
        bgGradient: ['#001020', '#002040', '#003060'],
        challenges: ['é«˜å‹', 'é»‘æš—', 'æ°®é†‰'],
        oxygenRate: -1.5,
        hydrationRate: -0.1,
        baseTemp: 4
    },
    sahara: {
        name: 'æ’’å“ˆæ‹‰æ²™æ¼ ',
        icon: 'ğŸœï¸',
        altitude: 500,
        bgGradient: ['#4a3020', '#8a6040', '#caaa80'],
        challenges: ['é«˜æ¸©', 'è„±æ°´', 'æ²™æš´'],
        oxygenRate: -0.3,
        hydrationRate: -0.8,
        baseTemp: 45
    },
    space: {
        name: 'å›½é™…ç©ºé—´ç«™',
        icon: 'ğŸš€',
        altitude: 408000,
        bgGradient: ['#000010', '#000020', '#000030'],
        challenges: ['å¾®é‡åŠ›', 'è¾å°„', 'éš”ç¦»'],
        oxygenRate: -1,
        hydrationRate: -0.3,
        baseTemp: 20
    }
};

let currentEnv = 'everest';
let gameRunning = false;
let gameTime = 0;
let survived = 0;

// ç”Ÿç†çŠ¶æ€
let vitals = {
    oxygen: 100,
    temperature: 37,
    hydration: 100,
    energy: 100,
    health: 100
};

// è£…å¤‡
let equipment = {
    oxygenTank: 3,
    waterBottle: 3,
    foodRation: 3,
    heatPack: 2,
    medicine: 1
};

// é€‚åº”åº¦
let adaptation = 0;

// äº‹ä»¶
let currentEvent = null;
const events = {
    everest: [
        { name: 'æš´é£é›ªæ¥è¢­', effect: { temperature: -10 }, duration: 30 },
        { name: 'å‘ç°é¿éš¾æ‰€', effect: { temperature: 5, energy: 10 }, duration: 20 },
        { name: 'æ°§æ°”æ³„æ¼', effect: { oxygen: -20 }, duration: 0 }
    ],
    mariana: [
        { name: 'å‹åŠ›èˆ±æ•…éšœ', effect: { health: -15 }, duration: 0 },
        { name: 'å‘ç°çƒ­æ³‰', effect: { temperature: 5 }, duration: 30 },
        { name: 'æ°®é†‰ç—‡çŠ¶', effect: { health: -10, energy: -20 }, duration: 0 }
    ],
    sahara: [
        { name: 'æ²™å°˜æš´', effect: { health: -10, hydration: -10 }, duration: 40 },
        { name: 'å‘ç°ç»¿æ´²', effect: { hydration: 30, energy: 20 }, duration: 0 },
        { name: 'ä¸­æš‘è­¦å‘Š', effect: { health: -20 }, duration: 0 }
    ],
    space: [
        { name: 'å¤ªé˜³è€€æ–‘', effect: { health: -15 }, duration: 20 },
        { name: 'è¡¥ç»™èˆ±åˆ°è¾¾', effect: { energy: 30, hydration: 20 }, duration: 0 },
        { name: 'ç©ºé—´çœ©æ™•', effect: { health: -10 }, duration: 30 }
    ]
};

function init() {
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);
    
    renderHUD();
    renderRightPanel();
    updateBackground();
    
    setInterval(simulate, 100);
    animate();
}

function resizeCanvas() {
    canvas.width = canvas.parentElement.clientWidth;
    canvas.height = canvas.parentElement.clientHeight;
}

function startGame() {
    gameRunning = true;
    gameTime = 0;
    survived = 0;
    adaptation = 0;
    vitals = { oxygen: 100, temperature: 37, hydration: 100, energy: 100, health: 100 };
    equipment = { oxygenTank: 3, waterBottle: 3, foodRation: 3, heatPack: 2, medicine: 1 };
    currentEvent = null;
    renderRightPanel();
}

function simulate() {
    if (!gameRunning) return;
    
    gameTime += 0.1;
    survived += 0.1;
    
    const env = environments[currentEnv];
    
    // ç¯å¢ƒå½±å“ - æ°§æ°”æ¶ˆè€—
    vitals.oxygen += env.oxygenRate * 0.1 * (1 - adaptation * 0.3);
    
    // ä½“æ¸©è°ƒèŠ‚ - ç¯å¢ƒæ¸©åº¦å½±å“ä½“æ¸©
    const targetTemp = env.baseTemp;
    const tempDiff = targetTemp - vitals.temperature;
    // ä½“æ¸©è°ƒèŠ‚é€Ÿåº¦ï¼šæç«¯æ¸©åº¦å½±å“æ›´å¿«
    const tempChangeRate = Math.abs(tempDiff) > 20 ? 0.02 : 0.01;
    vitals.temperature += tempDiff * tempChangeRate;
    
    // ä½“æ¸©è¿‡é«˜æˆ–è¿‡ä½å½±å“å¥åº·
    if (vitals.temperature < 35 || vitals.temperature > 39) {
        vitals.health -= 0.5;
    }
    if (vitals.temperature < 32 || vitals.temperature > 40) {
        vitals.health -= 1; // æç«¯ä½“æ¸©æ›´å±é™©
    }
    
    // æ°´åˆ†æ¶ˆè€— - æ ¹æ®ç¯å¢ƒè°ƒæ•´
    vitals.hydration -= env.hydrationRate * 0.1;
    
    // ä½“åŠ›æ¶ˆè€—
    vitals.energy -= 0.2;
    
    // é€‚åº”
    adaptation = Math.min(1, adaptation + 0.001);
    
    // éšæœºäº‹ä»¶
    if (Math.random() < 0.002 && !currentEvent) {
        const envEvents = events[currentEnv];
        currentEvent = { ...envEvents[Math.floor(Math.random() * envEvents.length)], timeLeft: 50 };
        
        // ç«‹å³æ•ˆæœ
        Object.entries(currentEvent.effect).forEach(([k, v]) => {
            if (vitals[k] !== undefined) vitals[k] += v;
        });
    }
    
    // äº‹ä»¶æŒç»­
    if (currentEvent) {
        currentEvent.timeLeft -= 0.1;
        if (currentEvent.timeLeft <= 0) {
            currentEvent = null;
        }
    }
    
    // é™åˆ¶èŒƒå›´
    vitals.oxygen = Math.max(0, Math.min(100, vitals.oxygen));
    vitals.hydration = Math.max(0, Math.min(100, vitals.hydration));
    vitals.energy = Math.max(0, Math.min(100, vitals.energy));
    vitals.health = Math.max(0, Math.min(100, vitals.health));
    vitals.temperature = Math.max(30, Math.min(42, vitals.temperature));
    
    // æ­»äº¡æ£€æµ‹
    if (vitals.health <= 0 || vitals.oxygen <= 0) {
        gameRunning = false;
        alert(`ç”Ÿå­˜å¤±è´¥ï¼å­˜æ´»æ—¶é—´: ${survived.toFixed(1)} ç§’`);
    }
    
    renderHUD();
    renderRightPanel();
}

function useItem(item) {
    if (!gameRunning || equipment[item] <= 0) return;
    
    equipment[item]--;
    
    switch(item) {
        case 'oxygenTank':
            vitals.oxygen = Math.min(100, vitals.oxygen + 40);
            break;
        case 'waterBottle':
            vitals.hydration = Math.min(100, vitals.hydration + 35);
            break;
        case 'foodRation':
            vitals.energy = Math.min(100, vitals.energy + 30);
            break;
        case 'heatPack':
            vitals.temperature = Math.min(38, vitals.temperature + 3);
            break;
        case 'medicine':
            vitals.health = Math.min(100, vitals.health + 25);
            break;
    }
    
    renderRightPanel();
}

function changeEnvironment(env) {
    currentEnv = env;
    adaptation = 0;
    updateBackground();
    renderRightPanel();
}

function updateBackground() {
    const env = environments[currentEnv];
    const bg = document.getElementById('envBg');
    bg.style.background = `linear-gradient(to bottom, ${env.bgGradient.join(', ')})`;
}

function renderHUD() {
    const hudTop = document.getElementById('hudTop');
    const env = environments[currentEnv];
    
    const vitalConfigs = [
        { key: 'oxygen', label: 'æ°§æ°”', color: '#4af', icon: 'ğŸ’¨' },
        { key: 'temperature', label: 'ä½“æ¸©', color: '#f84', icon: 'ğŸŒ¡ï¸', isTemp: true },
        { key: 'hydration', label: 'æ°´åˆ†', color: '#48f', icon: 'ğŸ’§' },
        { key: 'energy', label: 'ä½“åŠ›', color: '#fa4', icon: 'âš¡' },
        { key: 'health', label: 'å¥åº·', color: '#4f8', icon: 'â¤ï¸' }
    ];
    
    hudTop.innerHTML = vitalConfigs.map(v => {
        const value = vitals[v.key];
        const displayValue = v.isTemp ? `${value.toFixed(1)}Â°C` : `${value.toFixed(0)}%`;
        const fillWidth = v.isTemp ? Math.max(0, Math.min(100, (value - 30) / 12 * 100)) : value;
        const fillColor = v.isTemp ? (value < 35 || value > 39 ? '#f44' : v.color) : (value < 30 ? '#f44' : v.color);
        
        return `
            <div class="vital-bar">
                <div class="vital-label">${v.icon} ${v.label}</div>
                <div class="vital-value" style="color:${fillColor}">${displayValue}</div>
                <div class="vital-meter">
                    <div class="vital-fill" style="width:${fillWidth}%;background:${fillColor}"></div>
                </div>
            </div>
        `;
    }).join('');
}

function renderRightPanel() {
    const panel = document.getElementById('rightPanel');
    const env = environments[currentEnv];
    
    const itemConfigs = {
        oxygenTank: { name: 'æ°§æ°”ç“¶', icon: 'ğŸ«', effect: '+40% æ°§æ°”' },
        waterBottle: { name: 'æ°´å£¶', icon: 'ğŸ¥¤', effect: '+35% æ°´åˆ†' },
        foodRation: { name: 'å£ç²®', icon: 'ğŸ«', effect: '+30% ä½“åŠ›' },
        heatPack: { name: 'æš–å®å®', icon: 'ğŸ”¥', effect: '+3Â°C ä½“æ¸©' },
        medicine: { name: 'æ€¥æ•‘åŒ…', icon: 'ğŸ’Š', effect: '+25% å¥åº·' }
    };
    
    panel.innerHTML = `
        <div style="margin-bottom:20px;">
            <div style="font-size:1.5em;margin-bottom:5px;">${env.icon} ${env.name}</div>
            <div style="color:#808090;font-size:0.85em;">æµ·æ‹”: ${env.altitude > 0 ? '+' : ''}${env.altitude}m</div>
            <div style="color:#808090;font-size:0.85em;margin-top:5px;">æŒ‘æˆ˜: ${env.challenges.join('ã€')}</div>
        </div>
        
        <div style="margin-bottom:20px;">
            <div style="color:#808090;font-size:0.85em;margin-bottom:8px;">é€‰æ‹©ç¯å¢ƒ</div>
            <div style="display:flex;flex-wrap:wrap;gap:8px;">
                ${Object.entries(environments).map(([key, e]) => `
                    <button onclick="changeEnvironment('${key}')" style="
                        padding:8px 12px;
                        background:${key === currentEnv ? 'rgba(0,212,255,0.3)' : 'rgba(255,255,255,0.05)'};
                        border:1px solid ${key === currentEnv ? '#0af' : '#3a3a5a'};
                        border-radius:6px;
                        color:#fff;
                        cursor:pointer;
                        font-size:0.9em;
                    ">${e.icon} ${e.name}</button>
                `).join('')}
            </div>
        </div>
        
        <div style="margin-bottom:20px;">
            <div style="color:#808090;font-size:0.85em;margin-bottom:8px;">ç”Ÿå­˜æ—¶é—´</div>
            <div style="font-size:1.8em;color:#0af;">${survived.toFixed(1)}s</div>
            <div style="color:#808090;font-size:0.8em;">é€‚åº”åº¦: ${(adaptation * 100).toFixed(0)}%</div>
        </div>
        
        ${currentEvent ? `
            <div style="background:rgba(255,100,100,0.2);border:1px solid #f66;border-radius:8px;padding:12px;margin-bottom:20px;">
                <div style="color:#f88;font-weight:bold;">âš ï¸ ${currentEvent.name}</div>
                <div style="color:#808090;font-size:0.85em;margin-top:5px;">å‰©ä½™: ${currentEvent.timeLeft.toFixed(1)}s</div>
            </div>
        ` : ''}
        
        <div style="margin-bottom:20px;">
            <div style="color:#808090;font-size:0.85em;margin-bottom:10px;">è£…å¤‡ç‰©èµ„</div>
            ${Object.entries(equipment).map(([key, count]) => {
                const item = itemConfigs[key];
                return `
                    <div style="display:flex;align-items:center;justify-content:space-between;padding:10px;background:rgba(255,255,255,0.03);border-radius:6px;margin-bottom:8px;">
                        <div>
                            <span style="font-size:1.2em;">${item.icon}</span>
                            <span style="margin-left:8px;">${item.name}</span>
                            <span style="color:#808090;font-size:0.8em;margin-left:5px;">(${item.effect})</span>
                        </div>
                        <div style="display:flex;align-items:center;gap:10px;">
                            <span style="color:#0af;">Ã—${count}</span>
                            <button onclick="useItem('${key}')" ${!gameRunning || count <= 0 ? 'disabled' : ''} style="
                                padding:5px 12px;
                                background:${count > 0 && gameRunning ? 'rgba(0,212,255,0.3)' : 'rgba(100,100,100,0.2)'};
                                border:1px solid ${count > 0 && gameRunning ? '#0af' : '#555'};
                                border-radius:4px;
                                color:${count > 0 && gameRunning ? '#fff' : '#666'};
                                cursor:${count > 0 && gameRunning ? 'pointer' : 'not-allowed'};
                                font-size:0.85em;
                            ">ä½¿ç”¨</button>
                        </div>
                    </div>
                `;
            }).join('')}
        </div>
        
        <button onclick="${gameRunning ? 'gameRunning=false' : 'startGame()'}" style="
            width:100%;
            padding:15px;
            background:linear-gradient(135deg, ${gameRunning ? '#f44' : '#0af'}, ${gameRunning ? '#c33' : '#08c'});
            border:none;
            border-radius:8px;
            color:#fff;
            font-size:1.1em;
            cursor:pointer;
            font-weight:bold;
        ">${gameRunning ? 'â¹ï¸ åœæ­¢æŒ‘æˆ˜' : 'â–¶ï¸ å¼€å§‹æŒ‘æˆ˜'}</button>
    `;
}

// ç¯å¢ƒç²’å­
let particles = [];

function createParticles() {
    particles = [];
    const count = currentEnv === 'space' ? 100 : 50;
    
    for (let i = 0; i < count; i++) {
        particles.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            size: Math.random() * 3 + 1,
            speedX: (Math.random() - 0.5) * 2,
            speedY: currentEnv === 'everest' ? Math.random() * 3 + 1 : 
                    currentEnv === 'mariana' ? Math.random() * 0.5 : 
                    currentEnv === 'sahara' ? Math.random() * 4 + 2 :
                    (Math.random() - 0.5) * 0.5,
            alpha: Math.random() * 0.5 + 0.3
        });
    }
}

function updateParticles() {
    particles.forEach(p => {
        p.x += p.speedX;
        p.y += p.speedY;
        
        if (p.x < 0) p.x = canvas.width;
        if (p.x > canvas.width) p.x = 0;
        if (p.y < 0) p.y = canvas.height;
        if (p.y > canvas.height) p.y = 0;
    });
}

function drawParticles() {
    particles.forEach(p => {
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
        
        let color;
        switch(currentEnv) {
            case 'everest': color = `rgba(255,255,255,${p.alpha})`; break;
            case 'mariana': color = `rgba(100,150,200,${p.alpha * 0.5})`; break;
            case 'sahara': color = `rgba(200,180,150,${p.alpha})`; break;
            case 'space': color = `rgba(255,255,255,${p.alpha})`; break;
        }
        
        ctx.fillStyle = color;
        ctx.fill();
    });
}

function drawEnvironmentEffects() {
    switch(currentEnv) {
        case 'everest':
            ctx.fillStyle = 'rgba(255,255,255,0.1)';
            ctx.beginPath();
            ctx.moveTo(0, canvas.height);
            ctx.lineTo(canvas.width * 0.3, canvas.height * 0.4);
            ctx.lineTo(canvas.width * 0.5, canvas.height * 0.6);
            ctx.lineTo(canvas.width * 0.7, canvas.height * 0.3);
            ctx.lineTo(canvas.width, canvas.height * 0.5);
            ctx.lineTo(canvas.width, canvas.height);
            ctx.fill();
            break;
            
        case 'mariana':
            for (let i = 0; i < 5; i++) {
                const x = canvas.width * (0.2 + i * 0.15);
                ctx.strokeStyle = `rgba(100,150,200,${0.1 - i * 0.015})`;
                ctx.lineWidth = 20 + i * 10;
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x + 50, canvas.height);
                ctx.stroke();
            }
            break;
            
        case 'sahara':
            ctx.fillStyle = 'rgba(200,160,100,0.3)';
            ctx.beginPath();
            ctx.moveTo(0, canvas.height);
            for (let x = 0; x <= canvas.width; x += 100) {
                ctx.quadraticCurveTo(
                    x + 50, canvas.height - 50 - Math.sin(x * 0.01 + gameTime) * 30,
                    x + 100, canvas.height
                );
            }
            ctx.fill();
            break;
            
        case 'space':
            const earthX = canvas.width * 0.7;
            const earthY = canvas.height * 0.8;
            const earthR = 150;
            
            const gradient = ctx.createRadialGradient(earthX, earthY, 0, earthX, earthY, earthR);
            gradient.addColorStop(0, 'rgba(50,100,200,0.8)');
            gradient.addColorStop(0.7, 'rgba(30,80,150,0.6)');
            gradient.addColorStop(1, 'rgba(20,60,100,0)');
            
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(earthX, earthY, earthR, 0, Math.PI * 2);
            ctx.fill();
            break;
    }
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    drawEnvironmentEffects();
    updateParticles();
    drawParticles();
    
    if (!gameRunning) {
        ctx.fillStyle = 'rgba(255,255,255,0.5)';
        ctx.font = '24px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('ç‚¹å‡»"å¼€å§‹æŒ‘æˆ˜"è¿›å…¥ç”Ÿå­˜æ¨¡å¼', canvas.width / 2, canvas.height / 2);
    }
}

function animate() {
    draw();
    requestAnimationFrame(animate);
}

createParticles();
init();
</script>
</body>
</html>