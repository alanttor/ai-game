<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¿åŠ¨ç”Ÿç‰©åŠ›å­¦åˆ†æå™¨</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸƒ</text></svg>">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2a 0%, #0a0a1a 100%);
            min-height: 100vh;
            color: #a0b0c0;
            overflow: hidden;
        }
        .container { display: flex; height: 100vh; }
        .main-area { flex: 1; display: flex; flex-direction: column; }
        .motion-area { flex: 1; display: flex; align-items: center; justify-content: center; position: relative; background: #0a0a15; }
        .analysis-bar {
            height: 150px;
            background: rgba(20,20,35,0.95);
            border-top: 1px solid #2a3a5a;
            display: flex;
            padding: 10px;
            gap: 10px;
        }
        .right-panel {
            width: 300px;
            background: rgba(20,20,35,0.95);
            border-left: 2px solid #2a3a5a;
            padding: 15px;
            overflow-y: auto;
        }
        .chart-box { flex: 1; background: rgba(0,0,0,0.3); border-radius: 6px; padding: 10px; }
        .chart-title { font-size: 0.75em; color: #6080a0; margin-bottom: 5px; }
</style>
</head>
<body>
<div class="container">
    <div class="main-area">
        <div class="motion-area">
            <canvas id="motionCanvas"></canvas>
        </div>
        <div class="analysis-bar" id="analysisBar"></div>
    </div>
    <div class="right-panel" id="rightPanel"></div>
</div>
<script>
const canvas = document.getElementById('motionCanvas');
const ctx = canvas.getContext('2d');

// è¿åŠ¨ç±»å‹
const motionTypes = {
    walk: { name: 'è¡Œèµ°', speed: 1.4, cycle: 1.0 },
    run: { name: 'è·‘æ­¥', speed: 3.5, cycle: 0.7 },
    jump: { name: 'è·³è·ƒ', speed: 0, cycle: 1.5 },
    squat: { name: 'æ·±è¹²', speed: 0, cycle: 2.0 }
};

let currentMotion = 'walk';
let time = 0;
let simRunning = true;

// èº«ä½“å‚æ•°
let body = {
    height: 1.75,
    weight: 70,
    legLength: 0.9,
    armLength: 0.6
};

// éª¨éª¼å…³èŠ‚ä½ç½®
let skeleton = {
    head: { x: 0, y: 0 },
    neck: { x: 0, y: 0 },
    shoulder_l: { x: 0, y: 0 },
    shoulder_r: { x: 0, y: 0 },
    elbow_l: { x: 0, y: 0 },
    elbow_r: { x: 0, y: 0 },
    wrist_l: { x: 0, y: 0 },
    wrist_r: { x: 0, y: 0 },
    hip: { x: 0, y: 0 },
    hip_l: { x: 0, y: 0 },
    hip_r: { x: 0, y: 0 },
    knee_l: { x: 0, y: 0 },
    knee_r: { x: 0, y: 0 },
    ankle_l: { x: 0, y: 0 },
    ankle_r: { x: 0, y: 0 }
};

// åˆ†ææ•°æ®
let analysis = {
    groundForce: 0,
    jointAngles: { hip: 0, knee: 0, ankle: 0 },
    muscleActivation: { quad: 0, hamstring: 0, calf: 0, glute: 0 },
    energy: 0,
    efficiency: 0
};

// å†å²æ•°æ®
let forceHistory = [];
let angleHistory = [];

function init() {
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);
    
    renderAnalysisBar();
    renderRightPanel();
    
    setInterval(simulate, 16);
    animate();
}

function resizeCanvas() {
    const area = canvas.parentElement;
    canvas.width = area.clientWidth;
    canvas.height = area.clientHeight;
}

function simulate() {
    if (!simRunning) return;
    
    const motion = motionTypes[currentMotion];
    time += 0.016 / motion.cycle;
    
    const phase = time % 1;
    
    // æ›´æ–°éª¨éª¼ä½ç½®
    updateSkeleton(phase);
    
    // è®¡ç®—ç”Ÿç‰©åŠ›å­¦å‚æ•°
    calculateBiomechanics(phase);
    
    // è®°å½•å†å²
    forceHistory.push(analysis.groundForce);
    if (forceHistory.length > 100) forceHistory.shift();
    
    angleHistory.push({ ...analysis.jointAngles });
    if (angleHistory.length > 100) angleHistory.shift();
}

function updateSkeleton(phase) {
    const cx = canvas.width / 2;
    const cy = canvas.height / 2;
    const scale = 150;
    
    if (currentMotion === 'walk' || currentMotion === 'run') {
        const isRun = currentMotion === 'run';
        const amplitude = isRun ? 0.4 : 0.25;
        const bounce = isRun ? 15 : 5;
        
        // èº¯å¹²ä¸Šä¸‹è¿åŠ¨
        const bodyY = cy + Math.abs(Math.sin(phase * Math.PI * 2)) * bounce;
        
        // å¤´éƒ¨
        skeleton.head = { x: cx, y: bodyY - scale * 0.9 };
        skeleton.neck = { x: cx, y: bodyY - scale * 0.75 };
        
        // è‚©è†€
        skeleton.shoulder_l = { x: cx - 25, y: bodyY - scale * 0.7 };
        skeleton.shoulder_r = { x: cx + 25, y: bodyY - scale * 0.7 };
        
        // æ‰‹è‡‚æ‘†åŠ¨ï¼ˆä¸è…¿ç›¸åï¼‰
        const armSwing = Math.sin(phase * Math.PI * 2) * amplitude;
        skeleton.elbow_l = { x: cx - 30 + armSwing * 20, y: bodyY - scale * 0.5 };
        skeleton.elbow_r = { x: cx + 30 - armSwing * 20, y: bodyY - scale * 0.5 };
        skeleton.wrist_l = { x: cx - 35 + armSwing * 40, y: bodyY - scale * 0.35 };
        skeleton.wrist_r = { x: cx + 35 - armSwing * 40, y: bodyY - scale * 0.35 };
        
        // é«‹éƒ¨
        skeleton.hip = { x: cx, y: bodyY - scale * 0.4 };
        skeleton.hip_l = { x: cx - 15, y: bodyY - scale * 0.38 };
        skeleton.hip_r = { x: cx + 15, y: bodyY - scale * 0.38 };
        
        // è…¿éƒ¨è¿åŠ¨
        const legSwing = Math.sin(phase * Math.PI * 2) * amplitude;
        const kneeAngle_l = Math.max(0, Math.sin((phase + 0.25) * Math.PI * 2) * 0.5);
        const kneeAngle_r = Math.max(0, Math.sin((phase + 0.75) * Math.PI * 2) * 0.5);
        
        skeleton.knee_l = { 
            x: cx - 15 - legSwing * 50, 
            y: bodyY - scale * 0.15 + kneeAngle_l * 30 
        };
        skeleton.knee_r = { 
            x: cx + 15 + legSwing * 50, 
            y: bodyY - scale * 0.15 + kneeAngle_r * 30 
        };
        
        skeleton.ankle_l = { 
            x: cx - 15 - legSwing * 80, 
            y: bodyY + scale * 0.1 
        };
        skeleton.ankle_r = { 
            x: cx + 15 + legSwing * 80, 
            y: bodyY + scale * 0.1 
        };
        
    } else if (currentMotion === 'jump') {
        const jumpPhase = phase < 0.3 ? phase / 0.3 : (phase < 0.7 ? 1 : (1 - phase) / 0.3);
        const jumpHeight = Math.sin(jumpPhase * Math.PI) * 100;
        const squat = phase < 0.3 ? (0.3 - phase) / 0.3 * 30 : 0;
        
        const bodyY = cy - jumpHeight + squat;
        
        skeleton.head = { x: cx, y: bodyY - scale * 0.9 };
        skeleton.neck = { x: cx, y: bodyY - scale * 0.75 };
        skeleton.shoulder_l = { x: cx - 25, y: bodyY - scale * 0.7 };
        skeleton.shoulder_r = { x: cx + 25, y: bodyY - scale * 0.7 };
        skeleton.elbow_l = { x: cx - 40, y: bodyY - scale * 0.8 - jumpHeight * 0.3 };
        skeleton.elbow_r = { x: cx + 40, y: bodyY - scale * 0.8 - jumpHeight * 0.3 };
        skeleton.wrist_l = { x: cx - 50, y: bodyY - scale * 0.9 - jumpHeight * 0.5 };
        skeleton.wrist_r = { x: cx + 50, y: bodyY - scale * 0.9 - jumpHeight * 0.5 };
        skeleton.hip = { x: cx, y: bodyY - scale * 0.4 };
        skeleton.hip_l = { x: cx - 15, y: bodyY - scale * 0.38 };
        skeleton.hip_r = { x: cx + 15, y: bodyY - scale * 0.38 };
        skeleton.knee_l = { x: cx - 15, y: bodyY - scale * 0.15 + squat };
        skeleton.knee_r = { x: cx + 15, y: bodyY - scale * 0.15 + squat };
        skeleton.ankle_l = { x: cx - 15, y: bodyY + scale * 0.1 + squat * 0.5 };
        skeleton.ankle_r = { x: cx + 15, y: bodyY + scale * 0.1 + squat * 0.5 };
        
    } else if (currentMotion === 'squat') {
        const squatDepth = Math.sin(phase * Math.PI * 2) * 0.5 + 0.5;
        const drop = squatDepth * 80;
        
        const bodyY = cy + drop * 0.5;
        
        skeleton.head = { x: cx, y: bodyY - scale * 0.9 + drop * 0.3 };
        skeleton.neck = { x: cx, y: bodyY - scale * 0.75 + drop * 0.3 };
        skeleton.shoulder_l = { x: cx - 25, y: bodyY - scale * 0.7 + drop * 0.3 };
        skeleton.shoulder_r = { x: cx + 25, y: bodyY - scale * 0.7 + drop * 0.3 };
        skeleton.elbow_l = { x: cx - 40, y: bodyY - scale * 0.5 + drop * 0.3 };
        skeleton.elbow_r = { x: cx + 40, y: bodyY - scale * 0.5 + drop * 0.3 };
        skeleton.wrist_l = { x: cx - 30, y: bodyY - scale * 0.35 + drop * 0.3 };
        skeleton.wrist_r = { x: cx + 30, y: bodyY - scale * 0.35 + drop * 0.3 };
        skeleton.hip = { x: cx, y: bodyY - scale * 0.4 + drop * 0.5 };
        skeleton.hip_l = { x: cx - 20 - squatDepth * 10, y: bodyY - scale * 0.38 + drop * 0.5 };
        skeleton.hip_r = { x: cx + 20 + squatDepth * 10, y: bodyY - scale * 0.38 + drop * 0.5 };
        skeleton.knee_l = { x: cx - 30 - squatDepth * 20, y: bodyY + drop * 0.3 };
        skeleton.knee_r = { x: cx + 30 + squatDepth * 20, y: bodyY + drop * 0.3 };
        skeleton.ankle_l = { x: cx - 20, y: bodyY + scale * 0.1 };
        skeleton.ankle_r = { x: cx + 20, y: bodyY + scale * 0.1 };
    }
}

function calculateBiomechanics(phase) {
    const motion = motionTypes[currentMotion];
    
    // åœ°é¢åä½œç”¨åŠ›
    if (currentMotion === 'walk') {
        analysis.groundForce = body.weight * 9.8 * (1 + 0.3 * Math.abs(Math.sin(phase * Math.PI * 2)));
    } else if (currentMotion === 'run') {
        analysis.groundForce = body.weight * 9.8 * (1 + 1.5 * Math.abs(Math.sin(phase * Math.PI * 2)));
    } else if (currentMotion === 'jump') {
        analysis.groundForce = phase < 0.3 ? body.weight * 9.8 * 3 : (phase > 0.7 ? body.weight * 9.8 * 2 : 0);
    } else {
        analysis.groundForce = body.weight * 9.8 * (1 + 0.5 * Math.sin(phase * Math.PI * 2));
    }
    
    // å…³èŠ‚è§’åº¦
    const hipAngle = Math.atan2(skeleton.knee_l.y - skeleton.hip_l.y, skeleton.knee_l.x - skeleton.hip_l.x);
    const kneeAngle = Math.atan2(skeleton.ankle_l.y - skeleton.knee_l.y, skeleton.ankle_l.x - skeleton.knee_l.x) - hipAngle;
    
    analysis.jointAngles.hip = (hipAngle * 180 / Math.PI + 90) % 180;
    analysis.jointAngles.knee = Math.abs(kneeAngle * 180 / Math.PI);
    analysis.jointAngles.ankle = 90 + Math.sin(phase * Math.PI * 2) * 20;
    
    // è‚Œè‚‰æ¿€æ´»
    analysis.muscleActivation.quad = Math.max(0, Math.sin(phase * Math.PI * 2 + 0.5)) * 100;
    analysis.muscleActivation.hamstring = Math.max(0, Math.sin(phase * Math.PI * 2 + 1.5)) * 80;
    analysis.muscleActivation.calf = Math.max(0, Math.sin(phase * Math.PI * 2)) * 70;
    analysis.muscleActivation.glute = Math.max(0, Math.sin(phase * Math.PI * 2 + 1)) * 60;
    
    // èƒ½é‡æ¶ˆè€—
    analysis.energy = motion.speed * body.weight * 0.8;
    analysis.efficiency = 25 + Math.random() * 5;
}

function renderAnalysisBar() {
    const bar = document.getElementById('analysisBar');
    bar.innerHTML = `
        <div class="chart-box">
            <div class="chart-title">åœ°é¢åä½œç”¨åŠ› (N)</div>
            <canvas id="forceChart" width="200" height="100"></canvas>
        </div>
        <div class="chart-box">
            <div class="chart-title">å…³èŠ‚è§’åº¦ (Â°)</div>
            <canvas id="angleChart" width="200" height="100"></canvas>
        </div>
        <div class="chart-box">
            <div class="chart-title">è‚Œè‚‰æ¿€æ´» (%)</div>
            <canvas id="muscleChart" width="200" height="100"></canvas>
        </div>
    `;
}

function renderRightPanel() {
    const panel = document.getElementById('rightPanel');
    panel.innerHTML = `
        <style>
            .panel-title { font-size: 0.9em; color: #4a8ac0; border-bottom: 1px solid #2a3a5a; padding-bottom: 8px; margin-bottom: 10px; }
            .panel-section { background: rgba(255,255,255,0.03); border-radius: 6px; padding: 10px; margin-bottom: 10px; border: 1px solid #2a3a5a; }
            .motion-btn { display: block; width: 100%; padding: 10px; margin: 4px 0; background: rgba(255,255,255,0.03); border: 1px solid #2a3a5a; border-radius: 4px; color: #a0b0c0; cursor: pointer; text-align: left; }
            .motion-btn:hover { background: rgba(255,255,255,0.08); }
            .motion-btn.active { border-color: #4a8ac0; background: rgba(74,138,192,0.2); }
            .stat-row { display: flex; justify-content: space-between; margin: 6px 0; font-size: 0.8em; }
            .slider-group { margin: 8px 0; }
            .slider-label { display: flex; justify-content: space-between; font-size: 0.75em; color: #6080a0; margin-bottom: 3px; }
            input[type="range"] { width: 100%; }
            .muscle-bar { height: 8px; background: #1a1a2a; border-radius: 4px; margin-top: 3px; overflow: hidden; }
            .muscle-fill { height: 100%; border-radius: 4px; transition: width 0.1s; }
        </style>
        
        <div style="text-align:center;margin-bottom:12px;">
            <h2 style="color:#4a8ac0;font-size:1.1em;">ğŸƒ è¿åŠ¨ç”Ÿç‰©åŠ›å­¦</h2>
            <p style="color:#4a5a6a;font-size:0.7em;">éª¨éª¼è‚Œè‚‰ç³»ç»Ÿåˆ†æ</p>
        </div>
        
        <div class="panel-section">
            <div class="panel-title">ğŸ¬ è¿åŠ¨ç±»å‹</div>
            ${Object.entries(motionTypes).map(([k, m]) => `
                <button class="motion-btn ${currentMotion === k ? 'active' : ''}" onclick="currentMotion='${k}';time=0;renderRightPanel()">
                    ${m.name} (${m.speed > 0 ? m.speed + ' m/s' : 'åŸåœ°'})
                </button>
            `).join('')}
            <div style="margin-top:10px;">
                <button class="motion-btn" onclick="simRunning=!simRunning;renderRightPanel()" style="text-align:center">
                    ${simRunning ? 'â¸ æš‚åœ' : 'â–¶ æ’­æ”¾'}
                </button>
            </div>
        </div>
        
        <div class="panel-section">
            <div class="panel-title">ğŸ“ èº«ä½“å‚æ•°</div>
            <div class="slider-group">
                <div class="slider-label"><span>èº«é«˜</span><span>${body.height.toFixed(2)} m</span></div>
                <input type="range" min="1.5" max="2.0" step="0.01" value="${body.height}" 
                       oninput="body.height=parseFloat(this.value);renderRightPanel()">
            </div>
            <div class="slider-group">
                <div class="slider-label"><span>ä½“é‡</span><span>${body.weight} kg</span></div>
                <input type="range" min="40" max="120" value="${body.weight}" 
                       oninput="body.weight=parseInt(this.value);renderRightPanel()">
            </div>
        </div>
        
        <div class="panel-section">
            <div class="panel-title">ğŸ“Š å®æ—¶æ•°æ®</div>
            <div class="stat-row"><span>åœ°é¢åä½œç”¨åŠ›</span><span style="color:#ff8844">${analysis.groundForce.toFixed(0)} N</span></div>
            <div class="stat-row"><span>é«‹å…³èŠ‚è§’åº¦</span><span style="color:#44aaff">${analysis.jointAngles.hip.toFixed(1)}Â°</span></div>
            <div class="stat-row"><span>è†å…³èŠ‚è§’åº¦</span><span style="color:#44ff88">${analysis.jointAngles.knee.toFixed(1)}Â°</span></div>
            <div class="stat-row"><span>èƒ½é‡æ¶ˆè€—</span><span style="color:#ffaa44">${analysis.energy.toFixed(1)} W</span></div>
            <div class="stat-row"><span>æœºæ¢°æ•ˆç‡</span><span style="color:#aa88ff">${analysis.efficiency.toFixed(1)}%</span></div>
        </div>
        
        <div class="panel-section">
            <div class="panel-title">ğŸ’ª è‚Œè‚‰æ¿€æ´»</div>
            <div class="slider-group">
                <div class="slider-label"><span>è‚¡å››å¤´è‚Œ</span><span>${analysis.muscleActivation.quad.toFixed(0)}%</span></div>
                <div class="muscle-bar"><div class="muscle-fill" style="width:${analysis.muscleActivation.quad}%;background:#ff6644"></div></div>
            </div>
            <div class="slider-group">
                <div class="slider-label"><span>è…˜ç»³è‚Œ</span><span>${analysis.muscleActivation.hamstring.toFixed(0)}%</span></div>
                <div class="muscle-bar"><div class="muscle-fill" style="width:${analysis.muscleActivation.hamstring}%;background:#44aaff"></div></div>
            </div>
            <div class="slider-group">
                <div class="slider-label"><span>å°è…¿è‚Œ</span><span>${analysis.muscleActivation.calf.toFixed(0)}%</span></div>
                <div class="muscle-bar"><div class="muscle-fill" style="width:${analysis.muscleActivation.calf}%;background:#44ff88"></div></div>
            </div>
            <div class="slider-group">
                <div class="slider-label"><span>è‡€å¤§è‚Œ</span><span>${analysis.muscleActivation.glute.toFixed(0)}%</span></div>
                <div class="muscle-bar"><div class="muscle-fill" style="width:${analysis.muscleActivation.glute}%;background:#ffaa44"></div></div>
            </div>
        </div>
    `;
}

function animate() {
    draw();
    drawCharts();
    requestAnimationFrame(animate);
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // åœ°é¢
    ctx.fillStyle = '#1a2a3a';
    ctx.fillRect(0, canvas.height * 0.7, canvas.width, canvas.height * 0.3);
    
    // ç»˜åˆ¶éª¨éª¼
    drawSkeleton();
    
    // ç»˜åˆ¶åŠ›çŸ¢é‡
    drawForceVectors();
    
    // ä¿¡æ¯
    ctx.fillStyle = '#6080a0';
    ctx.font = '12px Segoe UI';
    ctx.fillText(`${motionTypes[currentMotion].name} | é€Ÿåº¦: ${motionTypes[currentMotion].speed} m/s`, 10, 20);
}

function drawSkeleton() {
    // éª¨éª¼è¿æ¥
    const bones = [
        ['head', 'neck'],
        ['neck', 'shoulder_l'], ['neck', 'shoulder_r'],
        ['shoulder_l', 'elbow_l'], ['shoulder_r', 'elbow_r'],
        ['elbow_l', 'wrist_l'], ['elbow_r', 'wrist_r'],
        ['neck', 'hip'],
        ['hip', 'hip_l'], ['hip', 'hip_r'],
        ['hip_l', 'knee_l'], ['hip_r', 'knee_r'],
        ['knee_l', 'ankle_l'], ['knee_r', 'ankle_r']
    ];
    
    // ç»˜åˆ¶éª¨éª¼çº¿
    ctx.strokeStyle = '#4a8ac0';
    ctx.lineWidth = 4;
    bones.forEach(([a, b]) => {
        ctx.beginPath();
        ctx.moveTo(skeleton[a].x, skeleton[a].y);
        ctx.lineTo(skeleton[b].x, skeleton[b].y);
        ctx.stroke();
    });
    
    // ç»˜åˆ¶å…³èŠ‚
    ctx.fillStyle = '#80c0e0';
    Object.values(skeleton).forEach(joint => {
        ctx.beginPath();
        ctx.arc(joint.x, joint.y, 6, 0, Math.PI * 2);
        ctx.fill();
    });
    
    // å¤´éƒ¨
    ctx.fillStyle = '#4a8ac0';
    ctx.beginPath();
    ctx.arc(skeleton.head.x, skeleton.head.y, 20, 0, Math.PI * 2);
    ctx.fill();
}

function drawForceVectors() {
    // åœ°é¢åä½œç”¨åŠ›
    const footY = Math.max(skeleton.ankle_l.y, skeleton.ankle_r.y);
    const forceScale = analysis.groundForce / 2000;
    
    ctx.strokeStyle = '#ff6644';
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(canvas.width / 2, footY);
    ctx.lineTo(canvas.width / 2, footY - forceScale * 100);
    ctx.stroke();
    
    // ç®­å¤´
    ctx.fillStyle = '#ff6644';
    ctx.beginPath();
    ctx.moveTo(canvas.width / 2, footY - forceScale * 100 - 10);
    ctx.lineTo(canvas.width / 2 - 8, footY - forceScale * 100 + 5);
    ctx.lineTo(canvas.width / 2 + 8, footY - forceScale * 100 + 5);
    ctx.fill();
}

function drawCharts() {
    // åŠ›æ›²çº¿
    const forceCanvas = document.getElementById('forceChart');
    if (forceCanvas) {
        const fctx = forceCanvas.getContext('2d');
        fctx.clearRect(0, 0, 200, 100);
        fctx.strokeStyle = '#ff6644';
        fctx.lineWidth = 2;
        fctx.beginPath();
        forceHistory.forEach((f, i) => {
            const x = i * 2;
            const y = 90 - (f / 3000) * 80;
            if (i === 0) fctx.moveTo(x, y);
            else fctx.lineTo(x, y);
        });
        fctx.stroke();
    }
    
    // è‚Œè‚‰å›¾
    const muscleCanvas = document.getElementById('muscleChart');
    if (muscleCanvas) {
        const mctx = muscleCanvas.getContext('2d');
        mctx.clearRect(0, 0, 200, 100);
        const muscles = ['quad', 'hamstring', 'calf', 'glute'];
        const colors = ['#ff6644', '#44aaff', '#44ff88', '#ffaa44'];
        muscles.forEach((m, i) => {
            const h = analysis.muscleActivation[m] * 0.8;
            mctx.fillStyle = colors[i];
            mctx.fillRect(10 + i * 45, 90 - h, 35, h);
        });
    }
}

window.onload = init;
</script>
</body>
</html>