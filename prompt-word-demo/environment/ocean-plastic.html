<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ·æ´‹å¡‘æ–™æ±¡æŸ“è¿½è¸ªå™¨</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸŒŠ</text></svg>">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #001830 0%, #002040 100%);
            min-height: 100vh;
            color: #80c0e0;
            overflow: hidden;
        }
        .container { display: flex; height: 100vh; }
        .main-area { flex: 1; display: flex; flex-direction: column; }
        .map-area { flex: 1; position: relative; }
        #mapCanvas { display: block; }
        .timeline-bar {
            height: 60px;
            background: rgba(0,20,40,0.95);
            border-top: 1px solid #1a4a6a;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .right-panel {
            width: 300px;
            background: rgba(0,20,40,0.95);
            border-left: 2px solid #1a4a6a;
            padding: 15px;
            overflow-y: auto;
        }
</style>
</head>
<body>
<div class="container">
    <div class="main-area">
        <div class="map-area">
            <canvas id="mapCanvas"></canvas>
        </div>
        <div class="timeline-bar" id="timelineBar"></div>
    </div>
    <div class="right-panel" id="rightPanel"></div>
</div>
<script>
const canvas = document.getElementById('mapCanvas');
const ctx = canvas.getContext('2d');

// å¡‘æ–™ç²’å­
let plastics = [];
let simRunning = true;
let simDay = 0;
let simSpeed = 1;

// åƒåœ¾å¸¦ä½ç½®
const garbagePatches = [
    { name: 'åŒ—å¤ªå¹³æ´‹åƒåœ¾å¸¦', x: 0.25, y: 0.35, radius: 0.08 },
    { name: 'å—å¤ªå¹³æ´‹åƒåœ¾å¸¦', x: 0.22, y: 0.65, radius: 0.05 },
    { name: 'åŒ—å¤§è¥¿æ´‹åƒåœ¾å¸¦', x: 0.6, y: 0.38, radius: 0.05 },
    { name: 'å—å¤§è¥¿æ´‹åƒåœ¾å¸¦', x: 0.55, y: 0.62, radius: 0.04 },
    { name: 'å°åº¦æ´‹åƒåœ¾å¸¦', x: 0.75, y: 0.58, radius: 0.05 }
];

// ä¸»è¦æ²³æµæ’æ”¾æº
const riverSources = [
    { name: 'é•¿æ±Ÿ', x: 0.15, y: 0.4, rate: 100 },
    { name: 'æ’æ²³', x: 0.78, y: 0.42, rate: 80 },
    { name: 'æ¹„å…¬æ²³', x: 0.82, y: 0.48, rate: 60 },
    { name: 'å°¼ç½—æ²³', x: 0.58, y: 0.45, rate: 30 },
    { name: 'äºšé©¬é€Šæ²³', x: 0.42, y: 0.55, rate: 40 },
    { name: 'å¯†è¥¿è¥¿æ¯”æ²³', x: 0.32, y: 0.38, rate: 35 }
];

// æ´‹æµåœº
function getOceanCurrent(x, y) {
    // ç®€åŒ–çš„æ´‹æµæ¨¡å‹
    let vx = 0, vy = 0;
    
    // åŒ—å¤ªå¹³æ´‹ç¯æµ
    if (x < 0.4 && y > 0.25 && y < 0.5) {
        const cx = 0.25, cy = 0.38;
        const dx = x - cx, dy = y - cy;
        vx = -dy * 0.02;
        vy = dx * 0.02;
    }
    
    // åŒ—å¤§è¥¿æ´‹ç¯æµ
    if (x > 0.45 && x < 0.7 && y > 0.3 && y < 0.5) {
        const cx = 0.58, cy = 0.4;
        const dx = x - cx, dy = y - cy;
        vx = -dy * 0.015;
        vy = dx * 0.015;
    }
    
    // èµ¤é“æµ
    if (y > 0.45 && y < 0.55) {
        vx = -0.005;
    }
    
    return { vx, vy };
}

// å¡‘æ–™ç±»å‹
const plasticTypes = {
    bottle: { name: 'PETç“¶', color: '#44aaff', density: 1.38, degradeYears: 450 },
    bag: { name: 'å¡‘æ–™è¢‹', color: '#88ff88', density: 0.92, degradeYears: 20 },
    foam: { name: 'æ³¡æ²«å¡‘æ–™', color: '#ffffff', density: 0.03, degradeYears: 500 },
    fishing: { name: 'æ¸”ç½‘', color: '#ffaa44', density: 1.15, degradeYears: 600 },
    micro: { name: 'å¾®å¡‘æ–™', color: '#ff4488', density: 1.0, degradeYears: 1000 }
};

let selectedType = 'bottle';
let stats = { total: 0, inOcean: 0, inPatches: 0, degraded: 0 };

function init() {
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);
    
    canvas.addEventListener('click', handleClick);
    
    renderTimelineBar();
    renderRightPanel();
    
    // åˆå§‹æ’æ”¾
    for (let i = 0; i < 50; i++) {
        emitFromRiver(riverSources[Math.floor(Math.random() * riverSources.length)]);
    }
    
    setInterval(simulate, 50);
    animate();
}

function resizeCanvas() {
    const area = canvas.parentElement;
    canvas.width = area.clientWidth;
    canvas.height = area.clientHeight;
}

function handleClick(e) {
    const rect = canvas.getBoundingClientRect();
    const x = (e.clientX - rect.left) / canvas.width;
    const y = (e.clientY - rect.top) / canvas.height;
    
    // åœ¨ç‚¹å‡»ä½ç½®é‡Šæ”¾å¡‘æ–™
    for (let i = 0; i < 10; i++) {
        createPlastic(x + (Math.random() - 0.5) * 0.02, y + (Math.random() - 0.5) * 0.02, selectedType);
    }
}

function createPlastic(x, y, type) {
    const info = plasticTypes[type];
    plastics.push({
        x, y,
        vx: (Math.random() - 0.5) * 0.001,
        vy: (Math.random() - 0.5) * 0.001,
        type,
        age: 0,
        size: 1,
        inPatch: false
    });
    stats.total++;
    stats.inOcean++;
}

function emitFromRiver(river) {
    const types = Object.keys(plasticTypes);
    const type = types[Math.floor(Math.random() * types.length)];
    createPlastic(
        river.x + (Math.random() - 0.5) * 0.02,
        river.y + (Math.random() - 0.5) * 0.02,
        type
    );
}

function simulate() {
    if (!simRunning) return;
    
    simDay += simSpeed;
    
    // æ²³æµæŒç»­æ’æ”¾
    if (Math.random() < 0.1 * simSpeed) {
        const river = riverSources[Math.floor(Math.random() * riverSources.length)];
        emitFromRiver(river);
    }
    
    // æ›´æ–°å¡‘æ–™ç²’å­
    plastics.forEach(p => {
        // æ´‹æµå½±å“
        const current = getOceanCurrent(p.x, p.y);
        p.vx += current.vx * 0.1;
        p.vy += current.vy * 0.1;
        
        // éšæœºæ‰©æ•£
        p.vx += (Math.random() - 0.5) * 0.0005;
        p.vy += (Math.random() - 0.5) * 0.0005;
        
        // é˜»å°¼
        p.vx *= 0.99;
        p.vy *= 0.99;
        
        // ç§»åŠ¨
        p.x += p.vx;
        p.y += p.vy;
        
        // è¾¹ç•Œ
        p.x = Math.max(0.05, Math.min(0.95, p.x));
        p.y = Math.max(0.15, Math.min(0.85, p.y));
        
        // è€åŒ–
        p.age += simSpeed / 365;
        
        // æ£€æŸ¥æ˜¯å¦åœ¨åƒåœ¾å¸¦
        p.inPatch = false;
        garbagePatches.forEach(patch => {
            const dist = Math.hypot(p.x - patch.x, p.y - patch.y);
            if (dist < patch.radius) {
                p.inPatch = true;
                // åƒåœ¾å¸¦å¸å¼•æ•ˆåº”
                p.vx += (patch.x - p.x) * 0.001;
                p.vy += (patch.y - p.y) * 0.001;
            }
        });
        
        // é™è§£
        const info = plasticTypes[p.type];
        if (p.age > info.degradeYears * 0.1) {
            p.size *= 0.999;
        }
    });
    
    // ç§»é™¤å®Œå…¨é™è§£çš„
    const before = plastics.length;
    plastics = plastics.filter(p => p.size > 0.1);
    stats.degraded += before - plastics.length;
    
    // æ›´æ–°ç»Ÿè®¡
    stats.inOcean = plastics.length;
    stats.inPatches = plastics.filter(p => p.inPatch).length;
    
    renderRightPanel();
}

function renderTimelineBar() {
    const bar = document.getElementById('timelineBar');
    bar.innerHTML = `
        <style>
            .time-btn { padding: 6px 12px; background: rgba(26,74,106,0.5); border: 1px solid #1a4a6a; border-radius: 4px; color: #80c0e0; cursor: pointer; }
            .time-btn:hover { background: rgba(26,74,106,0.8); }
            .time-btn.active { background: #1a4a6a; }
            .time-display { font-size: 1.2em; color: #44aaff; }
        </style>
        <button class="time-btn ${simRunning ? 'active' : ''}" onclick="simRunning=!simRunning;renderTimelineBar()">
            ${simRunning ? 'â¸ æš‚åœ' : 'â–¶ å¼€å§‹'}
        </button>
        <button class="time-btn" onclick="resetSim()">ğŸ”„ é‡ç½®</button>
        <div style="display:flex;align-items:center;gap:10px;">
            <span style="font-size:0.8em;">é€Ÿåº¦:</span>
            <input type="range" min="1" max="30" value="${simSpeed}" style="width:100px" 
                   oninput="simSpeed=parseInt(this.value)">
            <span>${simSpeed}x</span>
        </div>
        <div style="flex:1"></div>
        <div class="time-display">ğŸ“… ç¬¬ ${Math.floor(simDay)} å¤© (${(simDay/365).toFixed(1)} å¹´)</div>
    `;
}

function renderRightPanel() {
    const panel = document.getElementById('rightPanel');
    panel.innerHTML = `
        <style>
            .panel-title { font-size: 0.9em; color: #44aaff; border-bottom: 1px solid #1a4a6a; padding-bottom: 8px; margin-bottom: 10px; }
            .panel-section { background: rgba(255,255,255,0.03); border-radius: 6px; padding: 10px; margin-bottom: 10px; border: 1px solid #1a4a6a; }
            .stat-row { display: flex; justify-content: space-between; margin: 6px 0; font-size: 0.85em; }
            .type-btn { display: flex; align-items: center; gap: 8px; width: 100%; padding: 8px; margin: 4px 0; background: rgba(255,255,255,0.03); border: 1px solid #1a4a6a; border-radius: 4px; color: #80c0e0; cursor: pointer; font-size: 0.8em; }
            .type-btn:hover { background: rgba(255,255,255,0.08); }
            .type-btn.active { border-color: #44aaff; background: rgba(68,170,255,0.2); }
            .type-dot { width: 12px; height: 12px; border-radius: 50%; }
            .river-item { padding: 6px; margin: 3px 0; background: rgba(255,255,255,0.03); border-radius: 4px; font-size: 0.75em; display: flex; justify-content: space-between; }
        </style>
        
        <div style="text-align:center;margin-bottom:12px;">
            <h2 style="color:#44aaff;font-size:1.1em;">ğŸŒŠ æµ·æ´‹å¡‘æ–™è¿½è¸ª</h2>
            <p style="color:#4a6a8a;font-size:0.7em;">ä»æ²³æµåˆ°åƒåœ¾å¸¦</p>
        </div>
        
        <div class="panel-section">
            <div class="panel-title">ğŸ“Š æ±¡æŸ“ç»Ÿè®¡</div>
            <div class="stat-row"><span>æ€»æ’æ”¾é‡</span><span style="color:#ff8844">${stats.total}</span></div>
            <div class="stat-row"><span>æµ·æ´‹ä¸­</span><span style="color:#44aaff">${stats.inOcean}</span></div>
            <div class="stat-row"><span>åƒåœ¾å¸¦å†…</span><span style="color:#ff4488">${stats.inPatches}</span></div>
            <div class="stat-row"><span>å·²é™è§£</span><span style="color:#44ff88">${stats.degraded}</span></div>
        </div>
        
        <div class="panel-section">
            <div class="panel-title">ğŸ—‘ï¸ å¡‘æ–™ç±»å‹ (ç‚¹å‡»åœ°å›¾é‡Šæ”¾)</div>
            ${Object.entries(plasticTypes).map(([k, t]) => `
                <button class="type-btn ${selectedType === k ? 'active' : ''}" onclick="selectedType='${k}';renderRightPanel()">
                    <div class="type-dot" style="background:${t.color}"></div>
                    <span>${t.name}</span>
                    <span style="margin-left:auto;color:#6a8aa0">${t.degradeYears}å¹´</span>
                </button>
            `).join('')}
        </div>
        
        <div class="panel-section">
            <div class="panel-title">ğŸï¸ ä¸»è¦æ²³æµæ’æ”¾æº</div>
            ${riverSources.map(r => `
                <div class="river-item">
                    <span>${r.name}</span>
                    <span style="color:#ff8844">${r.rate} å¨/å¤©</span>
                </div>
            `).join('')}
        </div>
        
        <div class="panel-section">
            <div class="panel-title">ğŸŒ€ åƒåœ¾å¸¦</div>
            ${garbagePatches.map(p => `
                <div class="river-item">
                    <span>${p.name}</span>
                    <span style="color:#ff4488">${plastics.filter(pl => Math.hypot(pl.x - p.x, pl.y - p.y) < p.radius).length}</span>
                </div>
            `).join('')}
        </div>
        
        <div class="panel-section">
            <div class="panel-title">ğŸ’¡ çŸ¥è¯†</div>
            <div style="font-size:0.7em;color:#6a8aa0;line-height:1.5;">
                æ¯å¹´çº¦800ä¸‡å¨å¡‘æ–™è¿›å…¥æµ·æ´‹ã€‚å¡‘æ–™å¯åœ¨æµ·æ´‹ä¸­æ¼‚æµæ•°åå¹´ï¼Œæœ€ç»ˆèšé›†åœ¨äº”å¤§åƒåœ¾å¸¦ã€‚
            </div>
        </div>
    `;
}

function resetSim() {
    plastics = [];
    simDay = 0;
    stats = { total: 0, inOcean: 0, inPatches: 0, degraded: 0 };
    renderTimelineBar();
    renderRightPanel();
}

function animate() {
    draw();
    renderTimelineBar();
    requestAnimationFrame(animate);
}

function draw() {
    const w = canvas.width, h = canvas.height;
    ctx.clearRect(0, 0, w, h);
    
    // æµ·æ´‹èƒŒæ™¯
    const oceanGrad = ctx.createLinearGradient(0, 0, 0, h);
    oceanGrad.addColorStop(0, '#001830');
    oceanGrad.addColorStop(1, '#002850');
    ctx.fillStyle = oceanGrad;
    ctx.fillRect(0, 0, w, h);
    
    // ç®€åŒ–å¤§é™†
    ctx.fillStyle = '#1a3a2a';
    drawContinents();
    
    // æ´‹æµæŒ‡ç¤º
    drawCurrents();
    
    // åƒåœ¾å¸¦
    garbagePatches.forEach(patch => {
        const x = patch.x * w, y = patch.y * h, r = patch.radius * w;
        const grad = ctx.createRadialGradient(x, y, 0, x, y, r);
        grad.addColorStop(0, 'rgba(255,68,136,0.3)');
        grad.addColorStop(1, 'rgba(255,68,136,0)');
        ctx.fillStyle = grad;
        ctx.beginPath();
        ctx.arc(x, y, r, 0, Math.PI * 2);
        ctx.fill();
    });
    
    // æ²³æµæ’æ”¾ç‚¹
    riverSources.forEach(river => {
        ctx.fillStyle = '#ffaa44';
        ctx.beginPath();
        ctx.arc(river.x * w, river.y * h, 5, 0, Math.PI * 2);
        ctx.fill();
    });
    
    // å¡‘æ–™ç²’å­
    plastics.forEach(p => {
        const info = plasticTypes[p.type];
        ctx.fillStyle = p.inPatch ? '#ff4488' : info.color;
        ctx.globalAlpha = Math.min(1, p.size);
        ctx.beginPath();
        ctx.arc(p.x * w, p.y * h, 2 + p.size * 2, 0, Math.PI * 2);
        ctx.fill();
    });
    ctx.globalAlpha = 1;
    
    // å›¾ä¾‹
    ctx.fillStyle = '#6a8aa0';
    ctx.font = '11px Segoe UI';
    ctx.fillText('ğŸ”´ åƒåœ¾å¸¦  ğŸŸ  æ²³æµæ’æ”¾ç‚¹  ç‚¹å‡»é‡Šæ”¾å¡‘æ–™', 10, h - 10);
}

function drawContinents() {
    const w = canvas.width, h = canvas.height;
    // ç®€åŒ–å¤§é™†è½®å»“
    ctx.beginPath();
    // åŒ—ç¾
    ctx.ellipse(w * 0.28, h * 0.3, w * 0.08, h * 0.12, 0, 0, Math.PI * 2);
    // å—ç¾
    ctx.ellipse(w * 0.38, h * 0.6, w * 0.04, h * 0.15, 0, 0, Math.PI * 2);
    // æ¬§æ´²
    ctx.ellipse(w * 0.52, h * 0.28, w * 0.05, h * 0.08, 0, 0, Math.PI * 2);
    // éæ´²
    ctx.ellipse(w * 0.55, h * 0.5, w * 0.06, h * 0.15, 0, 0, Math.PI * 2);
    // äºšæ´²
    ctx.ellipse(w * 0.75, h * 0.32, w * 0.12, h * 0.12, 0, 0, Math.PI * 2);
    // æ¾³æ´²
    ctx.ellipse(w * 0.85, h * 0.65, w * 0.05, h * 0.06, 0, 0, Math.PI * 2);
    ctx.fill();
}

function drawCurrents() {
    ctx.strokeStyle = 'rgba(68,170,255,0.2)';
    ctx.lineWidth = 1;
    
    // åŒ—å¤ªå¹³æ´‹ç¯æµ
    ctx.beginPath();
    ctx.arc(canvas.width * 0.25, canvas.height * 0.38, canvas.width * 0.12, 0, Math.PI * 2);
    ctx.stroke();
    
    // åŒ—å¤§è¥¿æ´‹ç¯æµ
    ctx.beginPath();
    ctx.arc(canvas.width * 0.58, canvas.height * 0.4, canvas.width * 0.08, 0, Math.PI * 2);
    ctx.stroke();
}

window.onload = init;
</script>
</body>
</html>