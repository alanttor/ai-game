<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¿åŠ¨æŸä¼¤ä¸åº·å¤è§„åˆ’</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ©¹</text></svg>">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #0a192f 0%, #112240 100%);
            min-height: 100vh;
            color: #e0e0e0;
        }
        .container { display: flex; height: 100vh; }
        .left-panel {
            width: 300px;
            background: rgba(0,0,0,0.3);
            border-right: 1px solid #233554;
            display: flex;
            flex-direction: column;
        }
        .center-panel { flex: 1; display: flex; flex-direction: column; }
        .right-panel {
            width: 320px;
            background: rgba(0,0,0,0.3);
            border-left: 1px solid #233554;
            padding: 15px;
            overflow-y: auto;
        }
        .panel-title {
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid #233554;
            font-weight: bold;
            color: #64ffda;
        }
        .body-view { flex: 1; position: relative; display: flex; align-items: center; justify-content: center; }
        .timeline-area {
            height: 200px;
            background: rgba(0,0,0,0.4);
            border-top: 1px solid #233554;
            padding: 15px;
        }
        .injury-list { flex: 1; overflow-y: auto; padding: 10px; }
        .injury-item {
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .injury-item:hover { background: rgba(255,255,255,0.1); }
        .injury-item.active { background: rgba(100,255,218,0.15); border: 1px solid #64ffda; }
</style>
</head>
<body>
<div class="container">
    <div class="left-panel">
        <div class="panel-title">ğŸ©¹ æŸä¼¤ç±»å‹</div>
        <div class="injury-list" id="injuryList"></div>
    </div>
    <div class="center-panel">
        <div class="body-view">
            <canvas id="bodyCanvas"></canvas>
        </div>
        <div class="timeline-area">
            <canvas id="timelineCanvas"></canvas>
        </div>
    </div>
    <div class="right-panel">
        <div class="panel-title">ğŸ“‹ åº·å¤æ–¹æ¡ˆ</div>
        <div id="rehabPlan"></div>
    </div>
</div>
<script>
const bodyCanvas = document.getElementById('bodyCanvas');
const bodyCtx = bodyCanvas.getContext('2d');
const timelineCanvas = document.getElementById('timelineCanvas');
const timelineCtx = timelineCanvas.getContext('2d');

// æŸä¼¤æ•°æ®åº“
const injuries = {
    muscle: [
        { id: 'hamstring', name: 'è…˜ç»³è‚Œæ‹‰ä¼¤', location: { x: 0.5, y: 0.55 }, severity: [1,2,3], healTime: [14, 42, 90] },
        { id: 'quadriceps', name: 'è‚¡å››å¤´è‚Œæ‹‰ä¼¤', location: { x: 0.5, y: 0.48 }, severity: [1,2,3], healTime: [10, 35, 70] },
        { id: 'calf', name: 'å°è…¿è‚Œè‚‰æ‹‰ä¼¤', location: { x: 0.5, y: 0.72 }, severity: [1,2,3], healTime: [7, 28, 56] }
    ],
    ligament: [
        { id: 'acl', name: 'å‰äº¤å‰éŸ§å¸¦æŸä¼¤', location: { x: 0.5, y: 0.58 }, severity: [1,2,3], healTime: [30, 180, 365] },
        { id: 'ankle', name: 'è¸å…³èŠ‚æ‰­ä¼¤', location: { x: 0.5, y: 0.85 }, severity: [1,2,3], healTime: [7, 21, 60] },
        { id: 'mcl', name: 'å†…ä¾§å‰¯éŸ§å¸¦æŸä¼¤', location: { x: 0.48, y: 0.58 }, severity: [1,2,3], healTime: [14, 42, 90] }
    ],
    tendon: [
        { id: 'achilles', name: 'è·Ÿè…±æŸä¼¤', location: { x: 0.5, y: 0.82 }, severity: [1,2,3], healTime: [21, 90, 270] },
        { id: 'patellar', name: 'é«Œè…±ç‚', location: { x: 0.5, y: 0.56 }, severity: [1,2,3], healTime: [30, 60, 120] },
        { id: 'rotator', name: 'è‚©è¢–æŸä¼¤', location: { x: 0.35, y: 0.22 }, severity: [1,2,3], healTime: [30, 90, 180] }
    ],
    bone: [
        { id: 'stress', name: 'åº”åŠ›æ€§éª¨æŠ˜', location: { x: 0.5, y: 0.75 }, severity: [1,2,3], healTime: [42, 84, 180] },
        { id: 'wrist', name: 'è…•éª¨éª¨æŠ˜', location: { x: 0.28, y: 0.42 }, severity: [1,2,3], healTime: [42, 70, 120] }
    ]
};

// ä¿®å¤é˜¶æ®µ
const healingPhases = [
    { name: 'ç‚ç—‡æœŸ', duration: 3, color: '#ff6b6b', desc: 'å‡ºè¡€ã€è‚¿èƒ€ã€ç–¼ç—›ï¼Œå…ç–«ç»†èƒæ¸…é™¤æŸä¼¤ç»„ç»‡' },
    { name: 'å¢æ®–æœŸ', duration: 21, color: '#ffd93d', desc: 'æ–°è¡€ç®¡å½¢æˆï¼Œèƒ¶åŸè›‹ç™½æ²‰ç§¯ï¼Œè‚‰èŠ½ç»„ç»‡ç”Ÿé•¿' },
    { name: 'é‡å¡‘æœŸ', duration: 365, color: '#6bcb77', desc: 'ç»„ç»‡å¼ºåŒ–ï¼Œèƒ¶åŸé‡æ’ï¼ŒåŠŸèƒ½æ¢å¤' }
];

// æ²»ç–—æ–¹æ³•
const treatments = {
    acute: ['PRICEåŸåˆ™', 'å†°æ•·', 'åŠ å‹åŒ…æ‰', 'æŠ¬é«˜æ‚£è‚¢', 'ä¼‘æ¯'],
    physio: ['å…³èŠ‚æ´»åŠ¨åº¦è®­ç»ƒ', 'åŠ›é‡è®­ç»ƒ', 'å¹³è¡¡è®­ç»ƒ', 'åŠŸèƒ½æ€§è®­ç»ƒ', 'æœ¬ä½“æ„Ÿè§‰è®­ç»ƒ'],
    medication: ['éç”¾ä½“æŠ—ç‚è¯', 'æ­¢ç—›è¯', 'è‚Œè‚‰æ¾å¼›å‰‚'],
    advanced: ['PRPæ³¨å°„', 'å†²å‡»æ³¢æ²»ç–—', 'é’ˆç¸', 'æ‰‹æœ¯ä¿®å¤']
};

let currentInjury = null;
let currentSeverity = 2;
let currentDay = 0;
let simulating = false;

function init() {
    resizeCanvases();
    window.addEventListener('resize', resizeCanvases);
    renderInjuryList();
    selectInjury(injuries.muscle[0]);
    animate();
}

function resizeCanvases() {
    bodyCanvas.width = bodyCanvas.parentElement.clientWidth;
    bodyCanvas.height = bodyCanvas.parentElement.clientHeight;
    timelineCanvas.width = timelineCanvas.parentElement.clientWidth;
    timelineCanvas.height = timelineCanvas.parentElement.clientHeight - 30;
}

function renderInjuryList() {
    const list = document.getElementById('injuryList');
    const categories = { muscle: 'è‚Œè‚‰æŸä¼¤', ligament: 'éŸ§å¸¦æŸä¼¤', tendon: 'è‚Œè…±æŸä¼¤', bone: 'éª¨éª¼æŸä¼¤' };
    
    let html = '';
    Object.entries(categories).forEach(([key, name]) => {
        html += `<div style="color:#64ffda;font-size:0.85em;padding:8px 5px;margin-top:10px;">${name}</div>`;
        injuries[key].forEach(inj => {
            html += `
                <div class="injury-item ${currentInjury?.id === inj.id ? 'active' : ''}" 
                     onclick="selectInjury(injuries['${key}'].find(i=>i.id==='${inj.id}'))">
                    <div style="font-weight:bold;">${inj.name}</div>
                    <div style="font-size:0.8em;color:#888;">æ¢å¤å‘¨æœŸ: ${inj.healTime[0]}-${inj.healTime[2]}å¤©</div>
                </div>
            `;
        });
    });
    list.innerHTML = html;
}

function selectInjury(injury) {
    currentInjury = injury;
    currentDay = 0;
    renderInjuryList();
    renderRehabPlan();
}

function renderRehabPlan() {
    const container = document.getElementById('rehabPlan');
    if (!currentInjury) {
        container.innerHTML = '<p style="color:#888;text-align:center;padding:20px;">é€‰æ‹©æŸä¼¤ç±»å‹</p>';
        return;
    }
    
    const healDays = currentInjury.healTime[currentSeverity - 1];
    const progress = Math.min(100, (currentDay / healDays) * 100);
    
    let currentPhase = healingPhases[0];
    let phaseDay = currentDay;
    if (currentDay > 3) {
        currentPhase = healingPhases[1];
        phaseDay = currentDay - 3;
        if (currentDay > 24) {
            currentPhase = healingPhases[2];
            phaseDay = currentDay - 24;
        }
    }
    
    container.innerHTML = `
        <div style="background:rgba(100,255,218,0.1);border-radius:10px;padding:15px;margin-bottom:15px;">
            <h3 style="color:#64ffda;margin-bottom:10px;">ğŸ©¹ ${currentInjury.name}</h3>
            <div style="margin-bottom:10px;">
                <span style="color:#888;">ä¸¥é‡ç¨‹åº¦ï¼š</span>
                ${[1,2,3].map(s => `
                    <button onclick="setSeverity(${s})" style="
                        padding:5px 12px;
                        margin:0 3px;
                        background:${currentSeverity === s ? '#64ffda' : 'rgba(255,255,255,0.1)'};
                        border:none;
                        border-radius:4px;
                        color:${currentSeverity === s ? '#000' : '#fff'};
                        cursor:pointer;
                    ">${s}çº§</button>
                `).join('')}
            </div>
            <div style="color:#888;font-size:0.9em;">é¢„è®¡æ¢å¤: ${healDays} å¤©</div>
        </div>
        
        <div style="background:rgba(255,255,255,0.05);border-radius:10px;padding:15px;margin-bottom:15px;">
            <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
                <span>åº·å¤è¿›åº¦</span>
                <span style="color:#64ffda;">${progress.toFixed(1)}%</span>
            </div>
            <div style="height:8px;background:rgba(255,255,255,0.1);border-radius:4px;overflow:hidden;">
                <div style="height:100%;width:${progress}%;background:linear-gradient(90deg,#64ffda,#4af);border-radius:4px;"></div>
            </div>
            <div style="margin-top:10px;font-size:0.9em;">
                <span style="color:${currentPhase.color};">â— ${currentPhase.name}</span>
                <span style="color:#888;margin-left:10px;">ç¬¬ ${phaseDay} å¤©</span>
            </div>
            <div style="color:#888;font-size:0.85em;margin-top:5px;">${currentPhase.desc}</div>
        </div>
        
        <div style="background:rgba(255,255,255,0.05);border-radius:10px;padding:15px;margin-bottom:15px;">
            <div style="color:#64ffda;margin-bottom:10px;">ğŸ“‹ å½“å‰é˜¶æ®µæ²»ç–—å»ºè®®</div>
            ${getCurrentTreatments().map(t => `
                <div style="padding:8px;background:rgba(255,255,255,0.03);border-radius:5px;margin-bottom:5px;font-size:0.9em;">
                    âœ“ ${t}
                </div>
            `).join('')}
        </div>
        
        <div style="display:flex;gap:10px;">
            <button onclick="startSimulation()" style="
                flex:1;padding:12px;
                background:${simulating ? '#ff6b6b' : 'linear-gradient(135deg,#64ffda,#4af)'};
                border:none;border-radius:8px;color:${simulating ? '#fff' : '#000'};
                cursor:pointer;font-weight:bold;
            ">${simulating ? 'â¹ åœæ­¢' : 'â–¶ å¼€å§‹æ¨¡æ‹Ÿ'}</button>
            <button onclick="resetSimulation()" style="
                padding:12px 20px;background:rgba(255,255,255,0.1);
                border:none;border-radius:8px;color:#fff;cursor:pointer;
            ">é‡ç½®</button>
        </div>
    `;
}

function getCurrentTreatments() {
    if (currentDay <= 3) return treatments.acute;
    if (currentDay <= 14) return [...treatments.physio.slice(0,2), ...treatments.medication.slice(0,1)];
    if (currentDay <= 42) return treatments.physio.slice(0,4);
    return treatments.physio;
}

function setSeverity(s) {
    currentSeverity = s;
    currentDay = 0;
    renderRehabPlan();
}

function startSimulation() {
    simulating = !simulating;
    renderRehabPlan();
}

function resetSimulation() {
    currentDay = 0;
    simulating = false;
    renderRehabPlan();
}

function drawBody() {
    bodyCtx.clearRect(0, 0, bodyCanvas.width, bodyCanvas.height);
    
    const cx = bodyCanvas.width / 2;
    const cy = bodyCanvas.height / 2;
    const scale = Math.min(bodyCanvas.width, bodyCanvas.height) * 0.4;
    
    bodyCtx.strokeStyle = 'rgba(100,255,218,0.5)';
    bodyCtx.lineWidth = 3;
    bodyCtx.lineCap = 'round';
    
    // å¤´
    bodyCtx.beginPath();
    bodyCtx.arc(cx, cy - scale * 0.35, scale * 0.12, 0, Math.PI * 2);
    bodyCtx.stroke();
    
    // èº¯å¹²
    bodyCtx.beginPath();
    bodyCtx.moveTo(cx, cy - scale * 0.23);
    bodyCtx.lineTo(cx, cy + scale * 0.15);
    bodyCtx.stroke();
    
    // è‚©è†€
    bodyCtx.beginPath();
    bodyCtx.moveTo(cx - scale * 0.2, cy - scale * 0.18);
    bodyCtx.lineTo(cx + scale * 0.2, cy - scale * 0.18);
    bodyCtx.stroke();
    
    // æ‰‹è‡‚
    bodyCtx.beginPath();
    bodyCtx.moveTo(cx - scale * 0.2, cy - scale * 0.18);
    bodyCtx.lineTo(cx - scale * 0.3, cy + scale * 0.1);
    bodyCtx.moveTo(cx + scale * 0.2, cy - scale * 0.18);
    bodyCtx.lineTo(cx + scale * 0.3, cy + scale * 0.1);
    bodyCtx.stroke();
    
    // è…¿
    bodyCtx.beginPath();
    bodyCtx.moveTo(cx, cy + scale * 0.15);
    bodyCtx.lineTo(cx - scale * 0.12, cy + scale * 0.5);
    bodyCtx.lineTo(cx - scale * 0.12, cy + scale * 0.8);
    bodyCtx.moveTo(cx, cy + scale * 0.15);
    bodyCtx.lineTo(cx + scale * 0.12, cy + scale * 0.5);
    bodyCtx.lineTo(cx + scale * 0.12, cy + scale * 0.8);
    bodyCtx.stroke();
    
    // ç»˜åˆ¶æŸä¼¤ä½ç½®
    if (currentInjury) {
        const ix = cx + (currentInjury.location.x - 0.5) * scale * 2;
        const iy = cy + (currentInjury.location.y - 0.5) * scale * 2;
        
        const healDays = currentInjury.healTime[currentSeverity - 1];
        const progress = Math.min(1, currentDay / healDays);
        
        // æŸä¼¤æŒ‡ç¤º
        const pulseSize = 15 + Math.sin(Date.now() / 200) * 5;
        const gradient = bodyCtx.createRadialGradient(ix, iy, 0, ix, iy, pulseSize * 2);
        
        const color = progress < 0.3 ? 'rgba(255,100,100,' : 
                      progress < 0.7 ? 'rgba(255,200,100,' : 'rgba(100,255,150,';
        gradient.addColorStop(0, color + '0.8)');
        gradient.addColorStop(1, color + '0)');
        
        bodyCtx.fillStyle = gradient;
        bodyCtx.beginPath();
        bodyCtx.arc(ix, iy, pulseSize * 2, 0, Math.PI * 2);
        bodyCtx.fill();
        
        bodyCtx.fillStyle = color + '1)';
        bodyCtx.beginPath();
        bodyCtx.arc(ix, iy, 8, 0, Math.PI * 2);
        bodyCtx.fill();
        
        // æ ‡ç­¾
        bodyCtx.fillStyle = '#fff';
        bodyCtx.font = '14px Arial';
        bodyCtx.textAlign = 'center';
        bodyCtx.fillText(currentInjury.name, ix, iy - 25);
    }
}

function drawTimeline() {
    timelineCtx.clearRect(0, 0, timelineCanvas.width, timelineCanvas.height);
    
    if (!currentInjury) return;
    
    const healDays = currentInjury.healTime[currentSeverity - 1];
    const padding = 50;
    const width = timelineCanvas.width - padding * 2;
    const height = timelineCanvas.height;
    
    // èƒŒæ™¯
    timelineCtx.fillStyle = 'rgba(255,255,255,0.05)';
    timelineCtx.fillRect(padding, 20, width, height - 40);
    
    // é˜¶æ®µåŒºåŸŸ
    let phaseX = padding;
    healingPhases.forEach((phase, i) => {
        const phaseDays = i === 0 ? 3 : i === 1 ? 21 : healDays - 24;
        const phaseWidth = (phaseDays / healDays) * width;
        
        timelineCtx.fillStyle = phase.color + '33';
        timelineCtx.fillRect(phaseX, 20, phaseWidth, height - 40);
        
        timelineCtx.fillStyle = phase.color;
        timelineCtx.font = '12px Arial';
        timelineCtx.textAlign = 'center';
        timelineCtx.fillText(phase.name, phaseX + phaseWidth / 2, height - 10);
        
        phaseX += phaseWidth;
    });
    
    // æ¢å¤æ›²çº¿
    timelineCtx.strokeStyle = '#64ffda';
    timelineCtx.lineWidth = 2;
    timelineCtx.beginPath();
    
    for (let d = 0; d <= healDays; d++) {
        const x = padding + (d / healDays) * width;
        const progress = Math.min(1, d / healDays);
        const recovery = 1 - Math.pow(1 - progress, 2); // éçº¿æ€§æ¢å¤æ›²çº¿
        const y = height - 30 - recovery * (height - 60);
        
        if (d === 0) timelineCtx.moveTo(x, y);
        else timelineCtx.lineTo(x, y);
    }
    timelineCtx.stroke();
    
    // å½“å‰ä½ç½®
    const currentX = padding + (currentDay / healDays) * width;
    const currentProgress = Math.min(1, currentDay / healDays);
    const currentRecovery = 1 - Math.pow(1 - currentProgress, 2);
    const currentY = height - 30 - currentRecovery * (height - 60);
    
    timelineCtx.fillStyle = '#64ffda';
    timelineCtx.beginPath();
    timelineCtx.arc(currentX, currentY, 8, 0, Math.PI * 2);
    timelineCtx.fill();
    
    // æ ‡ç­¾
    timelineCtx.fillStyle = '#fff';
    timelineCtx.font = '12px Arial';
    timelineCtx.textAlign = 'center';
    timelineCtx.fillText(`ç¬¬ ${currentDay} å¤©`, currentX, currentY - 15);
    
    // è½´æ ‡ç­¾
    timelineCtx.fillStyle = '#888';
    timelineCtx.textAlign = 'left';
    timelineCtx.fillText('0å¤©', padding, height - 5);
    timelineCtx.textAlign = 'right';
    timelineCtx.fillText(healDays + 'å¤©', padding + width, height - 5);
}

function animate() {
    if (simulating && currentInjury) {
        const healDays = currentInjury.healTime[currentSeverity - 1];
        if (currentDay < healDays) {
            currentDay += 0.5;
            renderRehabPlan();
        } else {
            simulating = false;
            renderRehabPlan();
        }
    }
    
    drawBody();
    drawTimeline();
    requestAnimationFrame(animate);
}

init();
</script>
</body>
</html>