import{d as T,r as g,h as w,j as v,o as l,l as e,C as P,k as y,w as $,v as E,n as x,t as u,D as C,u as b,p as M,E as I,T as N,g as z,c as F}from"./vue-vendor-CeuWReVY.js";import{a as V,u as R}from"./client-CIWp8brx.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";const U={async login(h){return(await V.post("/auth/login",h)).data},async register(h){return(await V.post("/auth/register",h)).data},async refreshToken(h){return(await V.post("/auth/refresh",null,{headers:{Authorization:`Bearer ${h}`}})).data},async logout(){try{await V.post("/auth/logout")}catch{}}},j={class:"login-form"},q={class:"form-group"},G={key:0,class:"error-text"},H={class:"form-group"},J={class:"password-input"},K=["type"],O={key:0,class:"error-text"},Q={key:0,class:"form-error"},W=["disabled"],X={class:"form-footer"},Y=T({__name:"LoginForm",emits:["success","switch-to-register"],setup(h,{emit:c}){const m=c,t=R(),r=g(""),a=g(""),n=g(!1),i=w(()=>r.value&&r.value.length<3?"用户名至少3个字符":""),d=w(()=>a.value&&a.value.length<8?"密码至少8个字符":""),L=w(()=>r.value.length>=3&&a.value.length>=8&&!i.value&&!d.value),k=async()=>{if(L.value){t.setLoading(!0),t.setError(null);try{const _=await U.login({username:r.value,password:a.value});t.setAuth(_),m("success")}catch{t.setError("用户名或密码错误")}finally{t.setLoading(!1)}}};return(_,o)=>(l(),v("div",j,[o[7]||(o[7]=e("h2",{class:"form-title"},"登录",-1)),e("form",{onSubmit:P(k,["prevent"])},[e("div",q,[o[4]||(o[4]=e("label",{for:"username"},"用户名",-1)),$(e("input",{id:"username","onUpdate:modelValue":o[0]||(o[0]=p=>r.value=p),type:"text",placeholder:"请输入用户名",class:x({"has-error":i.value})},null,2),[[E,r.value]]),i.value?(l(),v("span",G,u(i.value),1)):y("",!0)]),e("div",H,[o[5]||(o[5]=e("label",{for:"password"},"密码",-1)),e("div",J,[$(e("input",{id:"password","onUpdate:modelValue":o[1]||(o[1]=p=>a.value=p),type:n.value?"text":"password",placeholder:"请输入密码",class:x({"has-error":d.value})},null,10,K),[[C,a.value]]),e("button",{type:"button",class:"toggle-password",onClick:o[2]||(o[2]=p=>n.value=!n.value)},u(n.value?"隐藏":"显示"),1)]),d.value?(l(),v("span",O,u(d.value),1)):y("",!0)]),b(t).error?(l(),v("div",Q,u(b(t).error),1)):y("",!0),e("button",{type:"submit",class:"submit-btn",disabled:!L.value||b(t).isLoading},u(b(t).isLoading?"登录中...":"登录"),9,W)],32),e("div",X,[o[6]||(o[6]=e("span",null,"还没有账号？",-1)),e("button",{type:"button",class:"link-btn",onClick:o[3]||(o[3]=p=>m("switch-to-register"))}," 立即注册 ")])]))}}),Z=A(Y,[["__scopeId","data-v-79d8d097"]]),ee={class:"register-form"},se={class:"form-group"},te={key:0,class:"error-text"},oe={class:"form-group"},re={key:0,class:"error-text"},ae={class:"form-group"},ne={class:"password-input"},le=["type"],ue={key:0,class:"error-text"},ie={class:"form-group"},de=["type"],ve={key:0,class:"error-text"},pe={key:0,class:"form-error"},ce=["disabled"],me={class:"form-footer"},fe=T({__name:"RegisterForm",emits:["success","switch-to-login"],setup(h,{emit:c}){const m=c,t=R(),r=g(""),a=g(""),n=g(""),i=g(""),d=g(!1),L=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,k=w(()=>r.value?r.value.length<3?"用户名至少3个字符":r.value.length>50?"用户名最多50个字符":"":""),_=w(()=>a.value?L.test(a.value)?"":"请输入有效的邮箱地址":""),o=w(()=>n.value&&n.value.length<8?"密码至少8个字符":""),p=w(()=>i.value&&i.value!==n.value?"两次输入的密码不一致":""),B=w(()=>r.value.length>=3&&L.test(a.value)&&n.value.length>=8&&i.value===n.value&&!k.value&&!_.value&&!o.value&&!p.value),D=async()=>{if(B.value){t.setLoading(!0),t.setError(null);try{const S=await U.register({username:r.value,email:a.value,password:n.value});t.setAuth(S),m("success")}catch(S){const s=S.response?.data?.message||"注册失败，请稍后重试";t.setError(s)}finally{t.setLoading(!1)}}};return(S,s)=>(l(),v("div",ee,[s[11]||(s[11]=e("h2",{class:"form-title"},"注册",-1)),e("form",{onSubmit:P(D,["prevent"])},[e("div",se,[s[6]||(s[6]=e("label",{for:"username"},"用户名",-1)),$(e("input",{id:"username","onUpdate:modelValue":s[0]||(s[0]=f=>r.value=f),type:"text",placeholder:"请输入用户名",class:x({"has-error":k.value})},null,2),[[E,r.value]]),k.value?(l(),v("span",te,u(k.value),1)):y("",!0)]),e("div",oe,[s[7]||(s[7]=e("label",{for:"email"},"邮箱",-1)),$(e("input",{id:"email","onUpdate:modelValue":s[1]||(s[1]=f=>a.value=f),type:"email",placeholder:"请输入邮箱地址",class:x({"has-error":_.value})},null,2),[[E,a.value]]),_.value?(l(),v("span",re,u(_.value),1)):y("",!0)]),e("div",ae,[s[8]||(s[8]=e("label",{for:"password"},"密码",-1)),e("div",ne,[$(e("input",{id:"password","onUpdate:modelValue":s[2]||(s[2]=f=>n.value=f),type:d.value?"text":"password",placeholder:"请输入密码（至少8个字符）",class:x({"has-error":o.value})},null,10,le),[[C,n.value]]),e("button",{type:"button",class:"toggle-password",onClick:s[3]||(s[3]=f=>d.value=!d.value)},u(d.value?"隐藏":"显示"),1)]),o.value?(l(),v("span",ue,u(o.value),1)):y("",!0)]),e("div",ie,[s[9]||(s[9]=e("label",{for:"confirmPassword"},"确认密码",-1)),$(e("input",{id:"confirmPassword","onUpdate:modelValue":s[4]||(s[4]=f=>i.value=f),type:d.value?"text":"password",placeholder:"请再次输入密码",class:x({"has-error":p.value})},null,10,de),[[C,i.value]]),p.value?(l(),v("span",ve,u(p.value),1)):y("",!0)]),b(t).error?(l(),v("div",pe,u(b(t).error),1)):y("",!0),e("button",{type:"submit",class:"submit-btn",disabled:!B.value||b(t).isLoading},u(b(t).isLoading?"注册中...":"注册"),9,ce)],32),e("div",me,[s[10]||(s[10]=e("span",null,"已有账号？",-1)),e("button",{type:"button",class:"link-btn",onClick:s[5]||(s[5]=f=>m("switch-to-login"))}," 立即登录 ")])]))}}),ge=A(fe,[["__scopeId","data-v-165856f0"]]),he={class:"auth-view"},_e={class:"auth-container"},we=T({__name:"AuthView",setup(h){const c=z(),m=g(!0),t=()=>{c.push("/")},r=()=>{m.value=!1},a=()=>{m.value=!0},n=()=>{c.push("/")};return(i,d)=>(l(),v("div",he,[e("button",{class:"back-btn",onClick:n},"← 返回"),e("div",_e,[M(N,{name:"fade",mode:"out-in"},{default:I(()=>[m.value?(l(),F(Z,{key:0,onSuccess:t,onSwitchToRegister:r})):(l(),F(ge,{key:1,onSuccess:t,onSwitchToLogin:a}))]),_:1})])]))}}),$e=A(we,[["__scopeId","data-v-3b4dd8a9"]]);export{$e as default};
//# sourceMappingURL=AuthView-C4DO11Hg.js.map
