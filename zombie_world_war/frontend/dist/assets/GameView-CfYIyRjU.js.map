{"version":3,"file":"GameView-CfYIyRjU.js","sources":["../../src/engine/InputManager.ts","../../src/engine/scene/CitySceneBuilder.ts","../../src/engine/SceneManager.ts","../../src/engine/GameEngine.ts","../../src/engine/Player.ts","../../src/engine/weapons/Weapon.ts","../../src/engine/weapons/Pistol.ts","../../src/engine/weapons/Rifle.ts","../../src/engine/weapons/Shotgun.ts","../../src/engine/weapons/MeleeWeapon.ts","../../src/engine/weapons/WeaponManager.ts","../../src/engine/zombies/Zombie.ts","../../src/engine/zombies/ZombieVisuals.ts","../../src/engine/zombies/ZombieManager.ts","../../src/engine/waves/GameOverManager.ts","../../src/engine/waves/WaveManager.ts","../../src/engine/audio/AudioManager.ts","../../src/engine/audio/GameAudioController.ts","../../src/engine/FirstPersonCamera.ts","../../src/engine/scene/LODManager.ts","../../src/engine/performance/PerformanceMonitor.ts","../../src/engine/GameController.ts","../../src/components/GameHUD.vue","../../src/components/DamageOverlay.vue","../../src/components/PauseMenu.vue","../../src/components/PerformanceStats.vue","../../src/views/GameView.vue"],"sourcesContent":["import type { EventCallback } from './types'\r\n\r\n/**\r\n * Input key codes for game controls\r\n */\r\nexport enum InputKey {\r\n  // Movement\r\n  FORWARD = 'KeyW',\r\n  LEFT = 'KeyA',\r\n  BACKWARD = 'KeyS',\r\n  RIGHT = 'KeyD',\r\n  JUMP = 'Space',\r\n  SPRINT = 'ShiftLeft',\r\n  \r\n  // Weapons\r\n  RELOAD = 'KeyR',\r\n  WEAPON_1 = 'Digit1',\r\n  WEAPON_2 = 'Digit2',\r\n  WEAPON_3 = 'Digit3',\r\n  WEAPON_4 = 'Digit4',\r\n  \r\n  // Game controls\r\n  PAUSE = 'Escape',\r\n  INVENTORY = 'Tab',\r\n}\r\n\r\n/**\r\n * Mouse button codes\r\n */\r\nexport enum MouseButton {\r\n  LEFT = 0,\r\n  MIDDLE = 1,\r\n  RIGHT = 2,\r\n}\r\n\r\n/**\r\n * Input events emitted by InputManager\r\n */\r\nexport enum InputEvent {\r\n  KEY_DOWN = 'input:keydown',\r\n  KEY_UP = 'input:keyup',\r\n  MOUSE_DOWN = 'input:mousedown',\r\n  MOUSE_UP = 'input:mouseup',\r\n  MOUSE_MOVE = 'input:mousemove',\r\n  MOUSE_WHEEL = 'input:mousewheel',\r\n  POINTER_LOCK_CHANGE = 'input:pointerlockchange',\r\n}\r\n\r\n/**\r\n * Mouse movement data\r\n */\r\nexport interface MouseMovement {\r\n  movementX: number\r\n  movementY: number\r\n  clientX: number\r\n  clientY: number\r\n}\r\n\r\n/**\r\n * Mouse wheel data\r\n */\r\nexport interface MouseWheelData {\r\n  deltaY: number\r\n  direction: 'up' | 'down'\r\n}\r\n\r\n/**\r\n * InputManager - Handles all keyboard and mouse input for the game\r\n * Requirements: 1.1, 1.2, 2.1, 2.3, 2.4\r\n */\r\nexport class InputManager {\r\n  // Key states\r\n  private keysPressed: Set<string> = new Set()\r\n  private keysJustPressed: Set<string> = new Set()\r\n  private keysJustReleased: Set<string> = new Set()\r\n  \r\n  // Mouse states\r\n  private mouseButtonsPressed: Set<number> = new Set()\r\n  private mouseButtonsJustPressed: Set<number> = new Set()\r\n  private mouseButtonsJustReleased: Set<number> = new Set()\r\n  private mouseMovement: MouseMovement = { movementX: 0, movementY: 0, clientX: 0, clientY: 0 }\r\n  private mouseWheelDelta: number = 0\r\n  \r\n  // Pointer lock state\r\n  private isPointerLocked: boolean = false\r\n  private targetElement: HTMLElement | null = null\r\n  \r\n  // Mouse sensitivity\r\n  private mouseSensitivity: number = 0.002\r\n  \r\n  // Event listeners\r\n  private eventListeners: Map<string, Set<EventCallback>> = new Map()\r\n  \r\n  // Bound event handlers (for cleanup)\r\n  private boundKeyDown: (e: KeyboardEvent) => void\r\n  private boundKeyUp: (e: KeyboardEvent) => void\r\n  private boundMouseDown: (e: MouseEvent) => void\r\n  private boundMouseUp: (e: MouseEvent) => void\r\n  private boundMouseMove: (e: MouseEvent) => void\r\n  private boundMouseWheel: (e: WheelEvent) => void\r\n  private boundPointerLockChange: () => void\r\n  private boundContextMenu: (e: Event) => void\r\n\r\n  constructor() {\r\n    // Bind event handlers\r\n    this.boundKeyDown = this.handleKeyDown.bind(this)\r\n    this.boundKeyUp = this.handleKeyUp.bind(this)\r\n    this.boundMouseDown = this.handleMouseDown.bind(this)\r\n    this.boundMouseUp = this.handleMouseUp.bind(this)\r\n    this.boundMouseMove = this.handleMouseMove.bind(this)\r\n    this.boundMouseWheel = this.handleMouseWheel.bind(this)\r\n    this.boundPointerLockChange = this.handlePointerLockChange.bind(this)\r\n    this.boundContextMenu = (e: Event) => e.preventDefault()\r\n  }\r\n\r\n  /**\r\n   * Initialize input listeners\r\n   * @param element Target element for pointer lock\r\n   */\r\n  init(element: HTMLElement): void {\r\n    this.targetElement = element\r\n    \r\n    // Keyboard events\r\n    window.addEventListener('keydown', this.boundKeyDown)\r\n    window.addEventListener('keyup', this.boundKeyUp)\r\n    \r\n    // Mouse events\r\n    element.addEventListener('mousedown', this.boundMouseDown)\r\n    window.addEventListener('mouseup', this.boundMouseUp)\r\n    window.addEventListener('mousemove', this.boundMouseMove)\r\n    element.addEventListener('wheel', this.boundMouseWheel, { passive: false })\r\n    \r\n    // Pointer lock events\r\n    document.addEventListener('pointerlockchange', this.boundPointerLockChange)\r\n    \r\n    // Prevent context menu on right click\r\n    element.addEventListener('contextmenu', this.boundContextMenu)\r\n  }\r\n\r\n  /**\r\n   * Cleanup input listeners\r\n   */\r\n  dispose(): void {\r\n    window.removeEventListener('keydown', this.boundKeyDown)\r\n    window.removeEventListener('keyup', this.boundKeyUp)\r\n    \r\n    if (this.targetElement) {\r\n      this.targetElement.removeEventListener('mousedown', this.boundMouseDown)\r\n      this.targetElement.removeEventListener('wheel', this.boundMouseWheel)\r\n      this.targetElement.removeEventListener('contextmenu', this.boundContextMenu)\r\n    }\r\n    \r\n    window.removeEventListener('mouseup', this.boundMouseUp)\r\n    window.removeEventListener('mousemove', this.boundMouseMove)\r\n    document.removeEventListener('pointerlockchange', this.boundPointerLockChange)\r\n    \r\n    this.exitPointerLock()\r\n    this.clearState()\r\n  }\r\n\r\n\r\n  /**\r\n   * Clear all input state\r\n   */\r\n  private clearState(): void {\r\n    this.keysPressed.clear()\r\n    this.keysJustPressed.clear()\r\n    this.keysJustReleased.clear()\r\n    this.mouseButtonsPressed.clear()\r\n    this.mouseButtonsJustPressed.clear()\r\n    this.mouseButtonsJustReleased.clear()\r\n    this.mouseMovement = { movementX: 0, movementY: 0, clientX: 0, clientY: 0 }\r\n    this.mouseWheelDelta = 0\r\n  }\r\n\r\n  /**\r\n   * Update input state - call at end of each frame\r\n   */\r\n  update(): void {\r\n    // Clear \"just\" states\r\n    this.keysJustPressed.clear()\r\n    this.keysJustReleased.clear()\r\n    this.mouseButtonsJustPressed.clear()\r\n    this.mouseButtonsJustReleased.clear()\r\n    \r\n    // Reset mouse movement accumulator\r\n    this.mouseMovement.movementX = 0\r\n    this.mouseMovement.movementY = 0\r\n    this.mouseWheelDelta = 0\r\n  }\r\n\r\n  // ==================== Keyboard Input ====================\r\n\r\n  private handleKeyDown(event: KeyboardEvent): void {\r\n    // Prevent default for game keys\r\n    if (this.isGameKey(event.code)) {\r\n      event.preventDefault()\r\n    }\r\n    \r\n    if (!this.keysPressed.has(event.code)) {\r\n      this.keysPressed.add(event.code)\r\n      this.keysJustPressed.add(event.code)\r\n      this.emit(InputEvent.KEY_DOWN, { code: event.code, key: event.key })\r\n    }\r\n  }\r\n\r\n  private handleKeyUp(event: KeyboardEvent): void {\r\n    if (this.keysPressed.has(event.code)) {\r\n      this.keysPressed.delete(event.code)\r\n      this.keysJustReleased.add(event.code)\r\n      this.emit(InputEvent.KEY_UP, { code: event.code, key: event.key })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if a key is currently pressed\r\n   */\r\n  isKeyPressed(key: string | InputKey): boolean {\r\n    return this.keysPressed.has(key)\r\n  }\r\n\r\n  /**\r\n   * Check if a key was just pressed this frame\r\n   */\r\n  isKeyJustPressed(key: string | InputKey): boolean {\r\n    return this.keysJustPressed.has(key)\r\n  }\r\n\r\n  /**\r\n   * Check if a key was just released this frame\r\n   */\r\n  isKeyJustReleased(key: string | InputKey): boolean {\r\n    return this.keysJustReleased.has(key)\r\n  }\r\n\r\n  /**\r\n   * Check if key is a game control key\r\n   */\r\n  private isGameKey(code: string): boolean {\r\n    return Object.values(InputKey).includes(code as InputKey)\r\n  }\r\n\r\n  // ==================== Mouse Input ====================\r\n\r\n  private handleMouseDown(event: MouseEvent): void {\r\n    if (!this.mouseButtonsPressed.has(event.button)) {\r\n      this.mouseButtonsPressed.add(event.button)\r\n      this.mouseButtonsJustPressed.add(event.button)\r\n      this.emit(InputEvent.MOUSE_DOWN, { button: event.button })\r\n    }\r\n    \r\n    // Request pointer lock on left click if not already locked\r\n    if (event.button === MouseButton.LEFT && !this.isPointerLocked) {\r\n      this.requestPointerLock()\r\n    }\r\n  }\r\n\r\n  private handleMouseUp(event: MouseEvent): void {\r\n    if (this.mouseButtonsPressed.has(event.button)) {\r\n      this.mouseButtonsPressed.delete(event.button)\r\n      this.mouseButtonsJustReleased.add(event.button)\r\n      this.emit(InputEvent.MOUSE_UP, { button: event.button })\r\n    }\r\n  }\r\n\r\n  private handleMouseMove(event: MouseEvent): void {\r\n    if (this.isPointerLocked) {\r\n      // Accumulate movement for this frame\r\n      this.mouseMovement.movementX += event.movementX\r\n      this.mouseMovement.movementY += event.movementY\r\n    }\r\n    \r\n    this.mouseMovement.clientX = event.clientX\r\n    this.mouseMovement.clientY = event.clientY\r\n    \r\n    this.emit(InputEvent.MOUSE_MOVE, {\r\n      movementX: event.movementX * this.mouseSensitivity,\r\n      movementY: event.movementY * this.mouseSensitivity,\r\n      clientX: event.clientX,\r\n      clientY: event.clientY,\r\n    })\r\n  }\r\n\r\n  private handleMouseWheel(event: WheelEvent): void {\r\n    event.preventDefault()\r\n    this.mouseWheelDelta = event.deltaY\r\n    \r\n    const direction = event.deltaY > 0 ? 'down' : 'up'\r\n    this.emit(InputEvent.MOUSE_WHEEL, { deltaY: event.deltaY, direction })\r\n  }\r\n\r\n  /**\r\n   * Check if a mouse button is currently pressed\r\n   */\r\n  isMouseButtonPressed(button: MouseButton): boolean {\r\n    return this.mouseButtonsPressed.has(button)\r\n  }\r\n\r\n  /**\r\n   * Check if a mouse button was just pressed this frame\r\n   */\r\n  isMouseButtonJustPressed(button: MouseButton): boolean {\r\n    return this.mouseButtonsJustPressed.has(button)\r\n  }\r\n\r\n  /**\r\n   * Check if a mouse button was just released this frame\r\n   */\r\n  isMouseButtonJustReleased(button: MouseButton): boolean {\r\n    return this.mouseButtonsJustReleased.has(button)\r\n  }\r\n\r\n  /**\r\n   * Get accumulated mouse movement for this frame\r\n   */\r\n  getMouseMovement(): MouseMovement {\r\n    return {\r\n      movementX: this.mouseMovement.movementX * this.mouseSensitivity,\r\n      movementY: this.mouseMovement.movementY * this.mouseSensitivity,\r\n      clientX: this.mouseMovement.clientX,\r\n      clientY: this.mouseMovement.clientY,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get mouse wheel delta for this frame\r\n   */\r\n  getMouseWheelDelta(): number {\r\n    return this.mouseWheelDelta\r\n  }\r\n\r\n  /**\r\n   * Get mouse wheel direction (-1 for up, 1 for down, 0 for none)\r\n   */\r\n  getMouseWheelDirection(): number {\r\n    if (this.mouseWheelDelta === 0) return 0\r\n    return this.mouseWheelDelta > 0 ? 1 : -1\r\n  }\r\n\r\n  // ==================== Pointer Lock ====================\r\n\r\n  private handlePointerLockChange(): void {\r\n    this.isPointerLocked = document.pointerLockElement === this.targetElement\r\n    this.emit(InputEvent.POINTER_LOCK_CHANGE, { locked: this.isPointerLocked })\r\n  }\r\n\r\n  /**\r\n   * Request pointer lock on target element\r\n   */\r\n  requestPointerLock(): void {\r\n    if (this.targetElement && !this.isPointerLocked) {\r\n      this.targetElement.requestPointerLock()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Exit pointer lock\r\n   */\r\n  exitPointerLock(): void {\r\n    if (this.isPointerLocked) {\r\n      document.exitPointerLock()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if pointer is locked\r\n   */\r\n  hasPointerLock(): boolean {\r\n    return this.isPointerLocked\r\n  }\r\n\r\n  // ==================== Settings ====================\r\n\r\n  /**\r\n   * Set mouse sensitivity\r\n   */\r\n  setMouseSensitivity(sensitivity: number): void {\r\n    this.mouseSensitivity = Math.max(0.0001, Math.min(0.01, sensitivity))\r\n  }\r\n\r\n  /**\r\n   * Get mouse sensitivity\r\n   */\r\n  getMouseSensitivity(): number {\r\n    return this.mouseSensitivity\r\n  }\r\n\r\n  // ==================== Event System ====================\r\n\r\n  /**\r\n   * Subscribe to input events\r\n   */\r\n  on(event: string, callback: EventCallback): void {\r\n    if (!this.eventListeners.has(event)) {\r\n      this.eventListeners.set(event, new Set())\r\n    }\r\n    this.eventListeners.get(event)!.add(callback)\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe from input events\r\n   */\r\n  off(event: string, callback: EventCallback): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.delete(callback)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Emit an input event\r\n   */\r\n  private emit(event: string, data?: unknown): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.forEach((callback) => callback(data))\r\n    }\r\n  }\r\n\r\n  // ==================== Helper Methods ====================\r\n\r\n  /**\r\n   * Get movement input as a normalized vector\r\n   * Returns { x, z } where x is left/right and z is forward/backward\r\n   */\r\n  getMovementInput(): { x: number; z: number } {\r\n    let x = 0\r\n    let z = 0\r\n    \r\n    if (this.isKeyPressed(InputKey.FORWARD)) z -= 1\r\n    if (this.isKeyPressed(InputKey.BACKWARD)) z += 1\r\n    if (this.isKeyPressed(InputKey.LEFT)) x -= 1\r\n    if (this.isKeyPressed(InputKey.RIGHT)) x += 1\r\n    \r\n    // Normalize diagonal movement\r\n    const length = Math.sqrt(x * x + z * z)\r\n    if (length > 0) {\r\n      x /= length\r\n      z /= length\r\n    }\r\n    \r\n    return { x, z }\r\n  }\r\n\r\n  /**\r\n   * Check if player wants to jump\r\n   */\r\n  wantsToJump(): boolean {\r\n    return this.isKeyJustPressed(InputKey.JUMP)\r\n  }\r\n\r\n  /**\r\n   * Check if player wants to sprint\r\n   */\r\n  wantsToSprint(): boolean {\r\n    return this.isKeyPressed(InputKey.SPRINT)\r\n  }\r\n\r\n  /**\r\n   * Check if player wants to reload\r\n   */\r\n  wantsToReload(): boolean {\r\n    return this.isKeyJustPressed(InputKey.RELOAD)\r\n  }\r\n\r\n  /**\r\n   * Check if player wants to fire\r\n   */\r\n  wantsToFire(): boolean {\r\n    return this.isMouseButtonPressed(MouseButton.LEFT)\r\n  }\r\n\r\n  /**\r\n   * Get weapon slot from number key press (1-4)\r\n   * Returns -1 if no weapon key pressed\r\n   */\r\n  getWeaponSlotPressed(): number {\r\n    if (this.isKeyJustPressed(InputKey.WEAPON_1)) return 0\r\n    if (this.isKeyJustPressed(InputKey.WEAPON_2)) return 1\r\n    if (this.isKeyJustPressed(InputKey.WEAPON_3)) return 2\r\n    if (this.isKeyJustPressed(InputKey.WEAPON_4)) return 3\r\n    return -1\r\n  }\r\n}\r\n","import * as THREE from 'three'\r\n\r\n/**\r\n * Building configuration for procedural generation\r\n */\r\nexport interface BuildingConfig {\r\n  width: number\r\n  depth: number\r\n  height: number\r\n  floors: number\r\n  hasWindows: boolean\r\n  isDamaged: boolean\r\n  position: THREE.Vector3\r\n}\r\n\r\n/**\r\n * Street configuration\r\n */\r\nexport interface StreetConfig {\r\n  width: number\r\n  length: number\r\n  position: THREE.Vector3\r\n  rotation: number\r\n}\r\n\r\n/**\r\n * Obstacle types for the scene\r\n */\r\nexport enum ObstacleType {\r\n  CAR = 'car',\r\n  BARRIER = 'barrier',\r\n  DEBRIS = 'debris',\r\n  DUMPSTER = 'dumpster',\r\n  CRATE = 'crate',\r\n}\r\n\r\n/**\r\n * CitySceneBuilder - Creates procedural apocalyptic city environment\r\n * Requirements: 5.1, 5.2\r\n */\r\nexport class CitySceneBuilder {\r\n  private scene: THREE.Scene\r\n  private buildings: THREE.Group\r\n  private streets: THREE.Group\r\n  private obstacles: THREE.Group\r\n  private decorations: THREE.Group\r\n\r\n  // Materials cache for reuse\r\n  private materials: Map<string, THREE.Material> = new Map()\r\n\r\n  // Collision meshes for physics\r\n  private collisionMeshes: THREE.Mesh[] = []\r\n\r\n  constructor(scene: THREE.Scene) {\r\n    this.scene = scene\r\n    this.buildings = new THREE.Group()\r\n    this.buildings.name = 'buildings'\r\n    this.streets = new THREE.Group()\r\n    this.streets.name = 'streets'\r\n    this.obstacles = new THREE.Group()\r\n    this.obstacles.name = 'obstacles'\r\n    this.decorations = new THREE.Group()\r\n    this.decorations.name = 'decorations'\r\n\r\n    this.initMaterials()\r\n  }\r\n\r\n  /**\r\n   * Initialize reusable materials\r\n   */\r\n  private initMaterials(): void {\r\n    // Building materials\r\n    this.materials.set('building_concrete', new THREE.MeshStandardMaterial({\r\n      color: 0x555555,\r\n      roughness: 0.9,\r\n      metalness: 0.1,\r\n    }))\r\n\r\n    this.materials.set('building_brick', new THREE.MeshStandardMaterial({\r\n      color: 0x8b4513,\r\n      roughness: 0.85,\r\n      metalness: 0.05,\r\n    }))\r\n\r\n    this.materials.set('building_damaged', new THREE.MeshStandardMaterial({\r\n      color: 0x3a3a3a,\r\n      roughness: 0.95,\r\n      metalness: 0.05,\r\n    }))\r\n\r\n    // Window material (emissive for some lit windows)\r\n    this.materials.set('window_dark', new THREE.MeshStandardMaterial({\r\n      color: 0x111122,\r\n      roughness: 0.1,\r\n      metalness: 0.8,\r\n    }))\r\n\r\n    this.materials.set('window_lit', new THREE.MeshStandardMaterial({\r\n      color: 0xffcc66,\r\n      emissive: 0xffcc66,\r\n      emissiveIntensity: 0.3,\r\n      roughness: 0.1,\r\n      metalness: 0.5,\r\n    }))\r\n\r\n    // Street materials\r\n    this.materials.set('asphalt', new THREE.MeshStandardMaterial({\r\n      color: 0x222222,\r\n      roughness: 0.95,\r\n      metalness: 0.0,\r\n    }))\r\n\r\n    this.materials.set('sidewalk', new THREE.MeshStandardMaterial({\r\n      color: 0x666666,\r\n      roughness: 0.9,\r\n      metalness: 0.0,\r\n    }))\r\n\r\n    // Obstacle materials\r\n    this.materials.set('metal_rusty', new THREE.MeshStandardMaterial({\r\n      color: 0x8b4513,\r\n      roughness: 0.8,\r\n      metalness: 0.6,\r\n    }))\r\n\r\n    this.materials.set('car_body', new THREE.MeshStandardMaterial({\r\n      color: 0x333344,\r\n      roughness: 0.4,\r\n      metalness: 0.7,\r\n    }))\r\n\r\n    this.materials.set('wood', new THREE.MeshStandardMaterial({\r\n      color: 0x654321,\r\n      roughness: 0.9,\r\n      metalness: 0.0,\r\n    }))\r\n  }\r\n\r\n  /**\r\n   * Build the complete city scene\r\n   */\r\n  build(): void {\r\n    this.createStreets()\r\n    this.createBuildings()\r\n    this.createObstacles()\r\n    this.createDecorations()\r\n\r\n    // Add all groups to scene\r\n    this.scene.add(this.buildings)\r\n    this.scene.add(this.streets)\r\n    this.scene.add(this.obstacles)\r\n    this.scene.add(this.decorations)\r\n  }\r\n\r\n  /**\r\n   * Create street network\r\n   */\r\n  private createStreets(): void {\r\n    const streetMaterial = this.materials.get('asphalt')!\r\n    const sidewalkMaterial = this.materials.get('sidewalk')!\r\n\r\n    // Main street (north-south)\r\n    const mainStreet = this.createStreet(20, 200, streetMaterial)\r\n    mainStreet.position.set(0, 0.01, 0)\r\n    this.streets.add(mainStreet)\r\n\r\n    // Cross streets (east-west)\r\n    for (let z = -80; z <= 80; z += 40) {\r\n      const crossStreet = this.createStreet(15, 100, streetMaterial)\r\n      crossStreet.rotation.y = Math.PI / 2\r\n      crossStreet.position.set(0, 0.01, z)\r\n      this.streets.add(crossStreet)\r\n    }\r\n\r\n    // Sidewalks along main street\r\n    const leftSidewalk = this.createSidewalk(4, 200, sidewalkMaterial)\r\n    leftSidewalk.position.set(-12, 0.02, 0)\r\n    this.streets.add(leftSidewalk)\r\n\r\n    const rightSidewalk = this.createSidewalk(4, 200, sidewalkMaterial)\r\n    rightSidewalk.position.set(12, 0.02, 0)\r\n    this.streets.add(rightSidewalk)\r\n  }\r\n\r\n  /**\r\n   * Create a street segment\r\n   */\r\n  private createStreet(width: number, length: number, material: THREE.Material): THREE.Mesh {\r\n    const geometry = new THREE.PlaneGeometry(width, length)\r\n    const mesh = new THREE.Mesh(geometry, material)\r\n    mesh.rotation.x = -Math.PI / 2\r\n    mesh.receiveShadow = true\r\n    mesh.name = 'street'\r\n    return mesh\r\n  }\r\n\r\n  /**\r\n   * Create a sidewalk segment\r\n   */\r\n  private createSidewalk(width: number, length: number, material: THREE.Material): THREE.Mesh {\r\n    const geometry = new THREE.BoxGeometry(width, 0.15, length)\r\n    const mesh = new THREE.Mesh(geometry, material)\r\n    mesh.receiveShadow = true\r\n    mesh.castShadow = true\r\n    mesh.name = 'sidewalk'\r\n    return mesh\r\n  }\r\n\r\n  /**\r\n   * Create buildings along the streets\r\n   */\r\n  private createBuildings(): void {\r\n    // Building configurations for left side of main street\r\n    const leftBuildings: BuildingConfig[] = [\r\n      { width: 15, depth: 20, height: 25, floors: 5, hasWindows: true, isDamaged: false, position: new THREE.Vector3(-25, 0, -70) },\r\n      { width: 20, depth: 25, height: 35, floors: 7, hasWindows: true, isDamaged: true, position: new THREE.Vector3(-30, 0, -35) },\r\n      { width: 18, depth: 18, height: 20, floors: 4, hasWindows: true, isDamaged: false, position: new THREE.Vector3(-25, 0, 10) },\r\n      { width: 22, depth: 22, height: 40, floors: 8, hasWindows: true, isDamaged: true, position: new THREE.Vector3(-28, 0, 50) },\r\n      { width: 16, depth: 20, height: 30, floors: 6, hasWindows: true, isDamaged: false, position: new THREE.Vector3(-25, 0, 85) },\r\n    ]\r\n\r\n    // Building configurations for right side of main street\r\n    const rightBuildings: BuildingConfig[] = [\r\n      { width: 18, depth: 22, height: 30, floors: 6, hasWindows: true, isDamaged: true, position: new THREE.Vector3(25, 0, -75) },\r\n      { width: 15, depth: 18, height: 22, floors: 4, hasWindows: true, isDamaged: false, position: new THREE.Vector3(22, 0, -40) },\r\n      { width: 25, depth: 25, height: 45, floors: 9, hasWindows: true, isDamaged: false, position: new THREE.Vector3(30, 0, 5) },\r\n      { width: 20, depth: 20, height: 28, floors: 5, hasWindows: true, isDamaged: true, position: new THREE.Vector3(25, 0, 45) },\r\n      { width: 17, depth: 22, height: 32, floors: 6, hasWindows: true, isDamaged: false, position: new THREE.Vector3(24, 0, 80) },\r\n    ]\r\n\r\n    // Create all buildings\r\n    const allBuildings = [...leftBuildings, ...rightBuildings]\r\n    allBuildings.forEach((config, index) => {\r\n      const building = this.createBuilding(config)\r\n      building.name = `building_${index}`\r\n      this.buildings.add(building)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Create a single building with windows\r\n   */\r\n  private createBuilding(config: BuildingConfig): THREE.Group {\r\n    const building = new THREE.Group()\r\n    const materialKey = config.isDamaged ? 'building_damaged' : \r\n      (Math.random() > 0.5 ? 'building_concrete' : 'building_brick')\r\n    const material = this.materials.get(materialKey)!\r\n\r\n    // Main building body\r\n    const bodyGeometry = new THREE.BoxGeometry(config.width, config.height, config.depth)\r\n    const body = new THREE.Mesh(bodyGeometry, material)\r\n    body.position.y = config.height / 2\r\n    body.castShadow = true\r\n    body.receiveShadow = true\r\n    body.name = 'building_body'\r\n    building.add(body)\r\n\r\n    // Add collision mesh\r\n    this.collisionMeshes.push(body)\r\n\r\n    // Add windows if enabled\r\n    if (config.hasWindows) {\r\n      this.addWindowsToBuilding(building, config)\r\n    }\r\n\r\n    // Add damage effects if damaged\r\n    if (config.isDamaged) {\r\n      this.addDamageEffects(building, config)\r\n    }\r\n\r\n    // Add roof details\r\n    this.addRoofDetails(building, config)\r\n\r\n    building.position.copy(config.position)\r\n    return building\r\n  }\r\n\r\n  /**\r\n   * Add windows to a building\r\n   */\r\n  private addWindowsToBuilding(building: THREE.Group, config: BuildingConfig): void {\r\n    const windowWidth = 1.5\r\n    const windowHeight = 2\r\n    const windowDepth = 0.1\r\n    const floorHeight = config.height / config.floors\r\n\r\n    const windowGeometry = new THREE.BoxGeometry(windowWidth, windowHeight, windowDepth)\r\n\r\n    // Add windows to front and back faces\r\n    for (let floor = 0; floor < config.floors; floor++) {\r\n      const windowsPerFloor = Math.floor(config.width / 4)\r\n      const startX = -(windowsPerFloor - 1) * 2\r\n\r\n      for (let w = 0; w < windowsPerFloor; w++) {\r\n        const isLit = Math.random() > 0.7\r\n        const material = this.materials.get(isLit ? 'window_lit' : 'window_dark')!\r\n\r\n        // Front window\r\n        const frontWindow = new THREE.Mesh(windowGeometry, material)\r\n        frontWindow.position.set(\r\n          startX + w * 4,\r\n          floorHeight * (floor + 0.5),\r\n          config.depth / 2 + 0.05\r\n        )\r\n        building.add(frontWindow)\r\n\r\n        // Back window\r\n        const backWindow = new THREE.Mesh(windowGeometry, material)\r\n        backWindow.position.set(\r\n          startX + w * 4,\r\n          floorHeight * (floor + 0.5),\r\n          -config.depth / 2 - 0.05\r\n        )\r\n        building.add(backWindow)\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add damage effects to building (holes, debris)\r\n   */\r\n  private addDamageEffects(building: THREE.Group, config: BuildingConfig): void {\r\n    // Add some \"damage holes\" using dark boxes\r\n    const holeMaterial = new THREE.MeshBasicMaterial({ color: 0x000000 })\r\n    const numHoles = Math.floor(Math.random() * 3) + 1\r\n\r\n    for (let i = 0; i < numHoles; i++) {\r\n      const holeWidth = 2 + Math.random() * 3\r\n      const holeHeight = 2 + Math.random() * 4\r\n      const holeGeometry = new THREE.BoxGeometry(holeWidth, holeHeight, 0.5)\r\n      const hole = new THREE.Mesh(holeGeometry, holeMaterial)\r\n\r\n      const side = Math.random() > 0.5 ? 1 : -1\r\n      hole.position.set(\r\n        (Math.random() - 0.5) * config.width * 0.6,\r\n        Math.random() * config.height * 0.7 + config.height * 0.2,\r\n        side * (config.depth / 2 + 0.1)\r\n      )\r\n      building.add(hole)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add roof details (AC units, water tanks, etc.)\r\n   */\r\n  private addRoofDetails(building: THREE.Group, config: BuildingConfig): void {\r\n    const metalMaterial = this.materials.get('metal_rusty')!\r\n\r\n    // AC unit\r\n    if (Math.random() > 0.3) {\r\n      const acGeometry = new THREE.BoxGeometry(3, 1.5, 2)\r\n      const ac = new THREE.Mesh(acGeometry, metalMaterial)\r\n      ac.position.set(\r\n        (Math.random() - 0.5) * config.width * 0.5,\r\n        config.height + 0.75,\r\n        (Math.random() - 0.5) * config.depth * 0.5\r\n      )\r\n      ac.castShadow = true\r\n      building.add(ac)\r\n    }\r\n\r\n    // Water tank\r\n    if (Math.random() > 0.5) {\r\n      const tankGeometry = new THREE.CylinderGeometry(1.5, 1.5, 3, 8)\r\n      const tank = new THREE.Mesh(tankGeometry, metalMaterial)\r\n      tank.position.set(\r\n        (Math.random() - 0.5) * config.width * 0.4,\r\n        config.height + 1.5,\r\n        (Math.random() - 0.5) * config.depth * 0.4\r\n      )\r\n      tank.castShadow = true\r\n      building.add(tank)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create obstacles (cars, barriers, debris)\r\n   */\r\n  private createObstacles(): void {\r\n    // Abandoned cars\r\n    const carPositions = [\r\n      new THREE.Vector3(-5, 0, -50),\r\n      new THREE.Vector3(6, 0, -20),\r\n      new THREE.Vector3(-7, 0, 30),\r\n      new THREE.Vector3(4, 0, 60),\r\n      new THREE.Vector3(-3, 0, -80),\r\n      new THREE.Vector3(8, 0, 90),\r\n    ]\r\n\r\n    carPositions.forEach((pos, index) => {\r\n      const car = this.createCar()\r\n      car.position.copy(pos)\r\n      car.rotation.y = Math.random() * Math.PI * 2\r\n      car.name = `car_${index}`\r\n      this.obstacles.add(car)\r\n    })\r\n\r\n    // Barriers\r\n    const barrierPositions = [\r\n      new THREE.Vector3(-8, 0, 0),\r\n      new THREE.Vector3(8, 0, 0),\r\n      new THREE.Vector3(0, 0, -60),\r\n    ]\r\n\r\n    barrierPositions.forEach((pos, index) => {\r\n      const barrier = this.createBarrier()\r\n      barrier.position.copy(pos)\r\n      barrier.name = `barrier_${index}`\r\n      this.obstacles.add(barrier)\r\n    })\r\n\r\n    // Debris piles\r\n    const debrisPositions = [\r\n      new THREE.Vector3(-15, 0, -45),\r\n      new THREE.Vector3(15, 0, 25),\r\n      new THREE.Vector3(-12, 0, 70),\r\n      new THREE.Vector3(18, 0, -70),\r\n    ]\r\n\r\n    debrisPositions.forEach((pos, index) => {\r\n      const debris = this.createDebrisPile()\r\n      debris.position.copy(pos)\r\n      debris.name = `debris_${index}`\r\n      this.obstacles.add(debris)\r\n    })\r\n\r\n    // Crates\r\n    const cratePositions = [\r\n      new THREE.Vector3(-14, 0, 15),\r\n      new THREE.Vector3(16, 0, -30),\r\n      new THREE.Vector3(-16, 0, 55),\r\n    ]\r\n\r\n    cratePositions.forEach((pos, index) => {\r\n      const crateGroup = this.createCrateStack()\r\n      crateGroup.position.copy(pos)\r\n      crateGroup.name = `crates_${index}`\r\n      this.obstacles.add(crateGroup)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Create an abandoned car\r\n   */\r\n  private createCar(): THREE.Group {\r\n    const car = new THREE.Group()\r\n    const bodyMaterial = this.materials.get('car_body')!\r\n    const metalMaterial = this.materials.get('metal_rusty')!\r\n\r\n    // Car body\r\n    const bodyGeometry = new THREE.BoxGeometry(4, 1.2, 2)\r\n    const body = new THREE.Mesh(bodyGeometry, bodyMaterial)\r\n    body.position.y = 0.8\r\n    body.castShadow = true\r\n    body.receiveShadow = true\r\n    car.add(body)\r\n    this.collisionMeshes.push(body)\r\n\r\n    // Car roof/cabin\r\n    const cabinGeometry = new THREE.BoxGeometry(2.5, 1, 1.8)\r\n    const cabin = new THREE.Mesh(cabinGeometry, bodyMaterial)\r\n    cabin.position.set(-0.3, 1.9, 0)\r\n    cabin.castShadow = true\r\n    car.add(cabin)\r\n\r\n    // Wheels\r\n    const wheelGeometry = new THREE.CylinderGeometry(0.4, 0.4, 0.3, 16)\r\n    const wheelPositions = [\r\n      new THREE.Vector3(1.2, 0.4, 1.1),\r\n      new THREE.Vector3(1.2, 0.4, -1.1),\r\n      new THREE.Vector3(-1.2, 0.4, 1.1),\r\n      new THREE.Vector3(-1.2, 0.4, -1.1),\r\n    ]\r\n\r\n    wheelPositions.forEach(pos => {\r\n      const wheel = new THREE.Mesh(wheelGeometry, metalMaterial)\r\n      wheel.position.copy(pos)\r\n      wheel.rotation.x = Math.PI / 2\r\n      wheel.castShadow = true\r\n      car.add(wheel)\r\n    })\r\n\r\n    return car\r\n  }\r\n\r\n  /**\r\n   * Create a barrier\r\n   */\r\n  private createBarrier(): THREE.Group {\r\n    const barrier = new THREE.Group()\r\n    const metalMaterial = this.materials.get('metal_rusty')!\r\n\r\n    // Main barrier body\r\n    const bodyGeometry = new THREE.BoxGeometry(3, 1, 0.5)\r\n    const body = new THREE.Mesh(bodyGeometry, metalMaterial)\r\n    body.position.y = 0.5\r\n    body.castShadow = true\r\n    body.receiveShadow = true\r\n    barrier.add(body)\r\n    this.collisionMeshes.push(body)\r\n\r\n    // Support legs\r\n    const legGeometry = new THREE.BoxGeometry(0.2, 1, 0.8)\r\n    const leftLeg = new THREE.Mesh(legGeometry, metalMaterial)\r\n    leftLeg.position.set(-1.2, 0.5, 0)\r\n    leftLeg.castShadow = true\r\n    barrier.add(leftLeg)\r\n\r\n    const rightLeg = new THREE.Mesh(legGeometry, metalMaterial)\r\n    rightLeg.position.set(1.2, 0.5, 0)\r\n    rightLeg.castShadow = true\r\n    barrier.add(rightLeg)\r\n\r\n    return barrier\r\n  }\r\n\r\n  /**\r\n   * Create a debris pile\r\n   */\r\n  private createDebrisPile(): THREE.Group {\r\n    const debris = new THREE.Group()\r\n    const concreteMaterial = this.materials.get('building_damaged')!\r\n    const metalMaterial = this.materials.get('metal_rusty')!\r\n\r\n    // Random debris pieces\r\n    const numPieces = 5 + Math.floor(Math.random() * 5)\r\n    for (let i = 0; i < numPieces; i++) {\r\n      const size = 0.3 + Math.random() * 1.5\r\n      const geometry = new THREE.BoxGeometry(size, size * 0.5, size * 0.8)\r\n      const material = Math.random() > 0.3 ? concreteMaterial : metalMaterial\r\n      const piece = new THREE.Mesh(geometry, material)\r\n\r\n      piece.position.set(\r\n        (Math.random() - 0.5) * 4,\r\n        size * 0.25,\r\n        (Math.random() - 0.5) * 4\r\n      )\r\n      piece.rotation.set(\r\n        Math.random() * 0.5,\r\n        Math.random() * Math.PI,\r\n        Math.random() * 0.5\r\n      )\r\n      piece.castShadow = true\r\n      piece.receiveShadow = true\r\n      debris.add(piece)\r\n    }\r\n\r\n    return debris\r\n  }\r\n\r\n  /**\r\n   * Create a stack of crates\r\n   */\r\n  private createCrateStack(): THREE.Group {\r\n    const stack = new THREE.Group()\r\n    const woodMaterial = this.materials.get('wood')!\r\n\r\n    const crateSize = 1.2\r\n    const crateGeometry = new THREE.BoxGeometry(crateSize, crateSize, crateSize)\r\n\r\n    // Bottom layer (2-3 crates)\r\n    const bottomCount = 2 + Math.floor(Math.random() * 2)\r\n    for (let i = 0; i < bottomCount; i++) {\r\n      const crate = new THREE.Mesh(crateGeometry, woodMaterial)\r\n      crate.position.set(i * crateSize * 1.1 - (bottomCount - 1) * crateSize * 0.55, crateSize / 2, 0)\r\n      crate.castShadow = true\r\n      crate.receiveShadow = true\r\n      stack.add(crate)\r\n      this.collisionMeshes.push(crate)\r\n    }\r\n\r\n    // Top layer (1-2 crates)\r\n    if (Math.random() > 0.3) {\r\n      const topCrate = new THREE.Mesh(crateGeometry, woodMaterial)\r\n      topCrate.position.set(0, crateSize * 1.5, 0)\r\n      topCrate.rotation.y = Math.random() * 0.3\r\n      topCrate.castShadow = true\r\n      topCrate.receiveShadow = true\r\n      stack.add(topCrate)\r\n    }\r\n\r\n    return stack\r\n  }\r\n\r\n  /**\r\n   * Create decorative elements (street lights, signs, etc.)\r\n   */\r\n  private createDecorations(): void {\r\n    // Street lights along main street\r\n    for (let z = -90; z <= 90; z += 20) {\r\n      // Left side\r\n      const leftLight = this.createStreetLight()\r\n      leftLight.position.set(-11, 0, z)\r\n      this.decorations.add(leftLight)\r\n\r\n      // Right side\r\n      const rightLight = this.createStreetLight()\r\n      rightLight.position.set(11, 0, z)\r\n      rightLight.rotation.y = Math.PI\r\n      this.decorations.add(rightLight)\r\n    }\r\n\r\n    // Fire barrels for atmosphere\r\n    const barrelPositions = [\r\n      new THREE.Vector3(-14, 0, -25),\r\n      new THREE.Vector3(14, 0, 40),\r\n      new THREE.Vector3(-13, 0, 65),\r\n    ]\r\n\r\n    barrelPositions.forEach((pos, index) => {\r\n      const barrel = this.createFireBarrel()\r\n      barrel.position.copy(pos)\r\n      barrel.name = `fire_barrel_${index}`\r\n      this.decorations.add(barrel)\r\n    })\r\n\r\n    // Trash and litter\r\n    this.addTrashDecoration()\r\n  }\r\n\r\n  /**\r\n   * Create a street light\r\n   */\r\n  private createStreetLight(): THREE.Group {\r\n    const light = new THREE.Group()\r\n    const metalMaterial = this.materials.get('metal_rusty')!\r\n\r\n    // Pole\r\n    const poleGeometry = new THREE.CylinderGeometry(0.1, 0.15, 5, 8)\r\n    const pole = new THREE.Mesh(poleGeometry, metalMaterial)\r\n    pole.position.y = 2.5\r\n    pole.castShadow = true\r\n    light.add(pole)\r\n\r\n    // Arm\r\n    const armGeometry = new THREE.BoxGeometry(1.5, 0.1, 0.1)\r\n    const arm = new THREE.Mesh(armGeometry, metalMaterial)\r\n    arm.position.set(0.75, 5, 0)\r\n    arm.castShadow = true\r\n    light.add(arm)\r\n\r\n    // Light fixture\r\n    const fixtureGeometry = new THREE.BoxGeometry(0.4, 0.2, 0.3)\r\n    const fixtureMaterial = new THREE.MeshStandardMaterial({\r\n      color: 0x333333,\r\n      roughness: 0.5,\r\n      metalness: 0.8,\r\n    })\r\n    const fixture = new THREE.Mesh(fixtureGeometry, fixtureMaterial)\r\n    fixture.position.set(1.5, 4.9, 0)\r\n    light.add(fixture)\r\n\r\n    // Add point light (dim, flickering effect can be added later)\r\n    const pointLight = new THREE.PointLight(0xffaa55, 0.5, 15)\r\n    pointLight.position.set(1.5, 4.8, 0)\r\n    pointLight.castShadow = true\r\n    pointLight.shadow.mapSize.width = 512\r\n    pointLight.shadow.mapSize.height = 512\r\n    light.add(pointLight)\r\n\r\n    return light\r\n  }\r\n\r\n  /**\r\n   * Create a fire barrel\r\n   */\r\n  private createFireBarrel(): THREE.Group {\r\n    const barrel = new THREE.Group()\r\n    const metalMaterial = this.materials.get('metal_rusty')!\r\n\r\n    // Barrel body\r\n    const barrelGeometry = new THREE.CylinderGeometry(0.4, 0.35, 1, 12)\r\n    const barrelMesh = new THREE.Mesh(barrelGeometry, metalMaterial)\r\n    barrelMesh.position.y = 0.5\r\n    barrelMesh.castShadow = true\r\n    barrelMesh.receiveShadow = true\r\n    barrel.add(barrelMesh)\r\n\r\n    // Fire light\r\n    const fireLight = new THREE.PointLight(0xff6600, 1, 8)\r\n    fireLight.position.y = 1.2\r\n    fireLight.castShadow = false\r\n    barrel.add(fireLight)\r\n\r\n    // Fire glow (simple emissive sphere)\r\n    const glowGeometry = new THREE.SphereGeometry(0.3, 8, 8)\r\n    const glowMaterial = new THREE.MeshBasicMaterial({\r\n      color: 0xff4400,\r\n      transparent: true,\r\n      opacity: 0.6,\r\n    })\r\n    const glow = new THREE.Mesh(glowGeometry, glowMaterial)\r\n    glow.position.y = 1\r\n    barrel.add(glow)\r\n\r\n    return barrel\r\n  }\r\n\r\n  /**\r\n   * Add scattered trash decoration\r\n   */\r\n  private addTrashDecoration(): void {\r\n    const trashMaterial = new THREE.MeshStandardMaterial({\r\n      color: 0x444444,\r\n      roughness: 0.9,\r\n    })\r\n\r\n    // Scatter small debris\r\n    for (let i = 0; i < 50; i++) {\r\n      const size = 0.1 + Math.random() * 0.3\r\n      const geometry = new THREE.BoxGeometry(size, size * 0.3, size * 0.8)\r\n      const trash = new THREE.Mesh(geometry, trashMaterial)\r\n\r\n      trash.position.set(\r\n        (Math.random() - 0.5) * 180,\r\n        size * 0.15,\r\n        (Math.random() - 0.5) * 180\r\n      )\r\n      trash.rotation.y = Math.random() * Math.PI * 2\r\n      trash.receiveShadow = true\r\n      this.decorations.add(trash)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get all collision meshes for physics\r\n   */\r\n  getCollisionMeshes(): THREE.Mesh[] {\r\n    return this.collisionMeshes\r\n  }\r\n\r\n  /**\r\n   * Get spawn points for zombies (positions away from player start)\r\n   */\r\n  getZombieSpawnPoints(): THREE.Vector3[] {\r\n    const spawnPoints: THREE.Vector3[] = []\r\n\r\n    // Spawn points along the streets, away from center\r\n    const distances = [40, 60, 80]\r\n    const angles = [0, Math.PI / 4, Math.PI / 2, (3 * Math.PI) / 4, Math.PI, \r\n                   (5 * Math.PI) / 4, (3 * Math.PI) / 2, (7 * Math.PI) / 4]\r\n\r\n    distances.forEach(dist => {\r\n      angles.forEach(angle => {\r\n        spawnPoints.push(new THREE.Vector3(\r\n          Math.cos(angle) * dist,\r\n          0,\r\n          Math.sin(angle) * dist\r\n        ))\r\n      })\r\n    })\r\n\r\n    return spawnPoints\r\n  }\r\n\r\n  /**\r\n   * Dispose of all resources\r\n   */\r\n  dispose(): void {\r\n    // Dispose materials\r\n    this.materials.forEach(material => material.dispose())\r\n    this.materials.clear()\r\n\r\n    // Dispose geometries in all groups\r\n    const disposeGroup = (group: THREE.Group) => {\r\n      group.traverse((object) => {\r\n        if (object instanceof THREE.Mesh) {\r\n          object.geometry.dispose()\r\n        }\r\n      })\r\n    }\r\n\r\n    disposeGroup(this.buildings)\r\n    disposeGroup(this.streets)\r\n    disposeGroup(this.obstacles)\r\n    disposeGroup(this.decorations)\r\n\r\n    // Clear collision meshes\r\n    this.collisionMeshes = []\r\n  }\r\n}\r\n","import * as THREE from 'three'\r\nimport type { EventCallback } from './types'\r\nimport { CitySceneBuilder } from './scene/CitySceneBuilder'\r\n\r\n/**\r\n * Scene events emitted by SceneManager\r\n */\r\nexport enum SceneEvent {\r\n  SCENE_LOADED = 'scene:loaded',\r\n  OBJECT_ADDED = 'scene:objectadded',\r\n  OBJECT_REMOVED = 'scene:objectremoved',\r\n  LIGHTING_CHANGED = 'scene:lightingchanged',\r\n}\r\n\r\n/**\r\n * Lighting preset configurations\r\n */\r\nexport interface LightingPreset {\r\n  ambientColor: number\r\n  ambientIntensity: number\r\n  directionalColor: number\r\n  directionalIntensity: number\r\n  directionalPosition: THREE.Vector3\r\n  hemisphereTopColor: number\r\n  hemisphereBottomColor: number\r\n  hemisphereIntensity: number\r\n}\r\n\r\n/**\r\n * Default lighting presets\r\n */\r\nexport const LightingPresets: Record<string, LightingPreset> = {\r\n  exterior: {\r\n    ambientColor: 0x404040,\r\n    ambientIntensity: 0.5,\r\n    directionalColor: 0xffffff,\r\n    directionalIntensity: 1.0,\r\n    directionalPosition: new THREE.Vector3(50, 100, 50),\r\n    hemisphereTopColor: 0x87ceeb,\r\n    hemisphereBottomColor: 0x362d26,\r\n    hemisphereIntensity: 0.3,\r\n  },\r\n  interior: {\r\n    ambientColor: 0x303030,\r\n    ambientIntensity: 0.8,\r\n    directionalColor: 0xfff5e6,\r\n    directionalIntensity: 0.3,\r\n    directionalPosition: new THREE.Vector3(0, 10, 0),\r\n    hemisphereTopColor: 0x444444,\r\n    hemisphereBottomColor: 0x222222,\r\n    hemisphereIntensity: 0.2,\r\n  },\r\n  night: {\r\n    ambientColor: 0x101020,\r\n    ambientIntensity: 0.3,\r\n    directionalColor: 0x8888ff,\r\n    directionalIntensity: 0.2,\r\n    directionalPosition: new THREE.Vector3(-50, 80, -50),\r\n    hemisphereTopColor: 0x0a0a20,\r\n    hemisphereBottomColor: 0x000000,\r\n    hemisphereIntensity: 0.1,\r\n  },\r\n}\r\n\r\n/**\r\n * SceneManager - Manages Three.js scene, camera, renderer, and lighting\r\n * Requirements: 5.1, 5.2\r\n */\r\nexport class SceneManager {\r\n  // Three.js core components\r\n  private scene: THREE.Scene\r\n  private camera: THREE.PerspectiveCamera\r\n  private renderer: THREE.WebGLRenderer\r\n  private container: HTMLElement\r\n\r\n  // Lighting components\r\n  private ambientLight: THREE.AmbientLight\r\n  private directionalLight: THREE.DirectionalLight\r\n  private hemisphereLight: THREE.HemisphereLight\r\n\r\n  // Current lighting preset\r\n  private currentPreset: string = 'exterior'\r\n\r\n  // Raycaster for collision detection\r\n  private raycaster: THREE.Raycaster\r\n\r\n  // Event listeners\r\n  private eventListeners: Map<string, Set<EventCallback>> = new Map()\r\n\r\n  // Object tracking\r\n  private gameObjects: Map<string, THREE.Object3D> = new Map()\r\n\r\n  // City scene builder\r\n  private citySceneBuilder: CitySceneBuilder | null = null\r\n\r\n  // Store bound resize handler for proper cleanup (initialized in init)\r\n  private boundHandleResize!: () => void\r\n\r\n  constructor(container: HTMLElement) {\r\n    this.container = container\r\n\r\n    // Initialize scene\r\n    this.scene = new THREE.Scene()\r\n    this.scene.background = new THREE.Color(0x1a1a2e)\r\n    this.scene.fog = new THREE.Fog(0x1a1a2e, 50, 200)\r\n\r\n    // Initialize camera\r\n    this.camera = new THREE.PerspectiveCamera(\r\n      75,\r\n      container.clientWidth / container.clientHeight,\r\n      0.1,\r\n      1000\r\n    )\r\n    this.camera.position.set(0, 1.7, 0) // Eye height\r\n\r\n    // Initialize renderer\r\n    this.renderer = new THREE.WebGLRenderer({ antialias: true })\r\n    this.renderer.setSize(container.clientWidth, container.clientHeight)\r\n    this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2))\r\n    this.renderer.shadowMap.enabled = true\r\n    this.renderer.shadowMap.type = THREE.PCFSoftShadowMap\r\n    this.renderer.outputColorSpace = THREE.SRGBColorSpace\r\n    this.renderer.toneMapping = THREE.ACESFilmicToneMapping\r\n    this.renderer.toneMappingExposure = 1.0\r\n\r\n    // Initialize lighting\r\n    this.ambientLight = new THREE.AmbientLight(0x404040, 0.5)\r\n    this.directionalLight = new THREE.DirectionalLight(0xffffff, 1)\r\n    this.hemisphereLight = new THREE.HemisphereLight(0x87ceeb, 0x362d26, 0.3)\r\n\r\n    // Initialize raycaster\r\n    this.raycaster = new THREE.Raycaster()\r\n  }\r\n\r\n\r\n  /**\r\n   * Initialize the scene manager\r\n   */\r\n  async init(): Promise<void> {\r\n    // Append renderer to container\r\n    this.container.appendChild(this.renderer.domElement)\r\n\r\n    // Setup lighting\r\n    this.setupLighting()\r\n\r\n    // Setup default scene\r\n    this.setupDefaultScene()\r\n\r\n    // Handle window resize - store bound reference for cleanup\r\n    this.boundHandleResize = this.handleResize.bind(this)\r\n    window.addEventListener('resize', this.boundHandleResize)\r\n\r\n    this.emit(SceneEvent.SCENE_LOADED, { preset: this.currentPreset })\r\n  }\r\n\r\n  /**\r\n   * Setup scene lighting\r\n   */\r\n  private setupLighting(): void {\r\n    // Add ambient light\r\n    this.scene.add(this.ambientLight)\r\n\r\n    // Configure directional light (sun)\r\n    this.directionalLight.position.set(50, 100, 50)\r\n    this.directionalLight.castShadow = true\r\n    this.directionalLight.shadow.mapSize.width = 2048\r\n    this.directionalLight.shadow.mapSize.height = 2048\r\n    this.directionalLight.shadow.camera.near = 0.5\r\n    this.directionalLight.shadow.camera.far = 500\r\n    this.directionalLight.shadow.camera.left = -100\r\n    this.directionalLight.shadow.camera.right = 100\r\n    this.directionalLight.shadow.camera.top = 100\r\n    this.directionalLight.shadow.camera.bottom = -100\r\n    this.directionalLight.shadow.bias = -0.0001\r\n    this.scene.add(this.directionalLight)\r\n\r\n    // Add hemisphere light\r\n    this.scene.add(this.hemisphereLight)\r\n\r\n    // Apply default preset\r\n    this.applyLightingPreset('exterior')\r\n  }\r\n\r\n  /**\r\n   * Setup default scene with ground plane and city\r\n   */\r\n  private setupDefaultScene(): void {\r\n    // Ground plane\r\n    const groundGeometry = new THREE.PlaneGeometry(200, 200)\r\n    const groundMaterial = new THREE.MeshStandardMaterial({\r\n      color: 0x333333,\r\n      roughness: 0.9,\r\n      metalness: 0.1,\r\n    })\r\n    const ground = new THREE.Mesh(groundGeometry, groundMaterial)\r\n    ground.rotation.x = -Math.PI / 2\r\n    ground.receiveShadow = true\r\n    ground.name = 'ground'\r\n    this.scene.add(ground)\r\n    this.gameObjects.set('ground', ground)\r\n\r\n    // Build the apocalyptic city scene\r\n    this.citySceneBuilder = new CitySceneBuilder(this.scene)\r\n    this.citySceneBuilder.build()\r\n  }\r\n\r\n  /**\r\n   * Load a specific scene by name\r\n   */\r\n  async loadScene(sceneName: string): Promise<void> {\r\n    // Clear existing scene objects (except lights)\r\n    this.clearScene()\r\n\r\n    switch (sceneName) {\r\n      case 'city':\r\n      default:\r\n        this.setupDefaultScene()\r\n        break\r\n    }\r\n\r\n    this.emit(SceneEvent.SCENE_LOADED, { scene: sceneName })\r\n  }\r\n\r\n  /**\r\n   * Clear all scene objects except lights\r\n   */\r\n  private clearScene(): void {\r\n    // Dispose city scene builder if exists\r\n    if (this.citySceneBuilder) {\r\n      this.citySceneBuilder.dispose()\r\n      this.citySceneBuilder = null\r\n    }\r\n\r\n    // Remove all objects except lights\r\n    const objectsToRemove: THREE.Object3D[] = []\r\n    this.scene.traverse((object) => {\r\n      if (!(object instanceof THREE.Light) && object !== this.scene) {\r\n        objectsToRemove.push(object)\r\n      }\r\n    })\r\n\r\n    objectsToRemove.forEach((obj) => {\r\n      if (obj.parent === this.scene) {\r\n        this.scene.remove(obj)\r\n      }\r\n    })\r\n\r\n    this.gameObjects.clear()\r\n  }\r\n\r\n  /**\r\n   * Get zombie spawn points from city scene\r\n   */\r\n  getZombieSpawnPoints(): THREE.Vector3[] {\r\n    if (this.citySceneBuilder) {\r\n      return this.citySceneBuilder.getZombieSpawnPoints()\r\n    }\r\n    // Default spawn points if no city scene\r\n    return [\r\n      new THREE.Vector3(50, 0, 0),\r\n      new THREE.Vector3(-50, 0, 0),\r\n      new THREE.Vector3(0, 0, 50),\r\n      new THREE.Vector3(0, 0, -50),\r\n    ]\r\n  }\r\n\r\n  /**\r\n   * Get collision meshes for physics\r\n   */\r\n  getCollisionMeshes(): THREE.Mesh[] {\r\n    if (this.citySceneBuilder) {\r\n      return this.citySceneBuilder.getCollisionMeshes()\r\n    }\r\n    return []\r\n  }\r\n\r\n  /**\r\n   * Apply a lighting preset\r\n   */\r\n  applyLightingPreset(presetName: string): void {\r\n    const preset = LightingPresets[presetName]\r\n    if (!preset) {\r\n      console.warn(`Lighting preset \"${presetName}\" not found`)\r\n      return\r\n    }\r\n\r\n    this.currentPreset = presetName\r\n\r\n    // Apply ambient light settings\r\n    this.ambientLight.color.setHex(preset.ambientColor)\r\n    this.ambientLight.intensity = preset.ambientIntensity\r\n\r\n    // Apply directional light settings\r\n    this.directionalLight.color.setHex(preset.directionalColor)\r\n    this.directionalLight.intensity = preset.directionalIntensity\r\n    this.directionalLight.position.copy(preset.directionalPosition)\r\n\r\n    // Apply hemisphere light settings\r\n    this.hemisphereLight.color.setHex(preset.hemisphereTopColor)\r\n    this.hemisphereLight.groundColor.setHex(preset.hemisphereBottomColor)\r\n    this.hemisphereLight.intensity = preset.hemisphereIntensity\r\n\r\n    // Update fog color based on preset\r\n    if (presetName === 'night') {\r\n      this.scene.fog = new THREE.Fog(0x0a0a20, 30, 150)\r\n      this.scene.background = new THREE.Color(0x0a0a20)\r\n    } else if (presetName === 'interior') {\r\n      this.scene.fog = new THREE.Fog(0x222222, 20, 100)\r\n      this.scene.background = new THREE.Color(0x222222)\r\n    } else {\r\n      this.scene.fog = new THREE.Fog(0x1a1a2e, 50, 200)\r\n      this.scene.background = new THREE.Color(0x1a1a2e)\r\n    }\r\n\r\n    this.emit(SceneEvent.LIGHTING_CHANGED, { preset: presetName })\r\n  }\r\n\r\n  /**\r\n   * Update lighting based on player position (interior/exterior detection)\r\n   */\r\n  updateLighting(playerPosition: THREE.Vector3): void {\r\n    // Simple interior detection - check if player is inside a building\r\n    // This can be expanded with actual building bounds checking\r\n    const isInterior = this.checkIfInterior(playerPosition)\r\n    \r\n    const targetPreset = isInterior ? 'interior' : 'exterior'\r\n    if (targetPreset !== this.currentPreset) {\r\n      this.applyLightingPreset(targetPreset)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if position is inside a building\r\n   */\r\n  private checkIfInterior(position: THREE.Vector3): boolean {\r\n    // Cast ray upward to check for ceiling\r\n    this.raycaster.set(position, new THREE.Vector3(0, 1, 0))\r\n    const intersects = this.raycaster.intersectObjects(this.scene.children, true)\r\n    \r\n    // If there's something above within 10 units, consider it interior\r\n    return intersects.some(hit => hit.distance < 10 && hit.object.name.includes('ceiling'))\r\n  }\r\n\r\n  // ==================== Object Management ====================\r\n\r\n  /**\r\n   * Add an object to the scene\r\n   */\r\n  addObject(object: THREE.Object3D, id?: string): void {\r\n    this.scene.add(object)\r\n    \r\n    if (id) {\r\n      this.gameObjects.set(id, object)\r\n    }\r\n    \r\n    this.emit(SceneEvent.OBJECT_ADDED, { object, id })\r\n  }\r\n\r\n  /**\r\n   * Remove an object from the scene\r\n   */\r\n  removeObject(object: THREE.Object3D): void {\r\n    this.scene.remove(object)\r\n    \r\n    // Remove from tracking map\r\n    for (const [id, obj] of this.gameObjects) {\r\n      if (obj === object) {\r\n        this.gameObjects.delete(id)\r\n        break\r\n      }\r\n    }\r\n    \r\n    this.emit(SceneEvent.OBJECT_REMOVED, { object })\r\n  }\r\n\r\n  /**\r\n   * Remove an object by ID\r\n   */\r\n  removeObjectById(id: string): void {\r\n    const object = this.gameObjects.get(id)\r\n    if (object) {\r\n      this.scene.remove(object)\r\n      this.gameObjects.delete(id)\r\n      this.emit(SceneEvent.OBJECT_REMOVED, { object, id })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get an object by ID\r\n   */\r\n  getObjectById(id: string): THREE.Object3D | undefined {\r\n    return this.gameObjects.get(id)\r\n  }\r\n\r\n  // ==================== Collision Detection ====================\r\n\r\n  /**\r\n   * Check for collisions using raycaster\r\n   */\r\n  checkCollision(origin: THREE.Vector3, direction: THREE.Vector3, maxDistance: number = Infinity): THREE.Intersection[] {\r\n    this.raycaster.set(origin, direction.normalize())\r\n    this.raycaster.far = maxDistance\r\n    return this.raycaster.intersectObjects(this.scene.children, true)\r\n  }\r\n\r\n  /**\r\n   * Check collision from camera center (for shooting)\r\n   */\r\n  checkCameraCollision(maxDistance: number = Infinity): THREE.Intersection[] {\r\n    this.raycaster.setFromCamera(new THREE.Vector2(0, 0), this.camera)\r\n    this.raycaster.far = maxDistance\r\n    return this.raycaster.intersectObjects(this.scene.children, true)\r\n  }\r\n\r\n  // ==================== Rendering ====================\r\n\r\n  /**\r\n   * Render the scene\r\n   */\r\n  render(): void {\r\n    this.renderer.render(this.scene, this.camera)\r\n  }\r\n\r\n  /**\r\n   * Handle window resize\r\n   */\r\n  private handleResize(): void {\r\n    const width = this.container.clientWidth\r\n    const height = this.container.clientHeight\r\n\r\n    this.camera.aspect = width / height\r\n    this.camera.updateProjectionMatrix()\r\n    this.renderer.setSize(width, height)\r\n  }\r\n\r\n  // ==================== Cleanup ====================\r\n\r\n  /**\r\n   * Dispose of all resources\r\n   */\r\n  dispose(): void {\r\n    // Remove resize listener with bound reference\r\n    if (this.boundHandleResize) {\r\n      window.removeEventListener('resize', this.boundHandleResize)\r\n    }\r\n\r\n    // Dispose city scene builder\r\n    if (this.citySceneBuilder) {\r\n      this.citySceneBuilder.dispose()\r\n      this.citySceneBuilder = null\r\n    }\r\n\r\n    // Dispose of all objects with proper cleanup\r\n    const objectsToDispose: THREE.Object3D[] = []\r\n    this.scene.traverse((object: THREE.Object3D) => {\r\n      objectsToDispose.push(object)\r\n    })\r\n    \r\n    for (const object of objectsToDispose) {\r\n      if (object instanceof THREE.Mesh) {\r\n        if (object.geometry) {\r\n          object.geometry.dispose()\r\n        }\r\n        if (object.material) {\r\n          if (Array.isArray(object.material)) {\r\n            object.material.forEach((material: THREE.Material) => {\r\n              this.disposeMaterial(material)\r\n            })\r\n          } else {\r\n            this.disposeMaterial(object.material)\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // Clear scene\r\n    while (this.scene.children.length > 0) {\r\n      this.scene.remove(this.scene.children[0])\r\n    }\r\n\r\n    // Dispose renderer\r\n    this.renderer.dispose()\r\n    this.renderer.forceContextLoss()\r\n\r\n    // Remove canvas from DOM\r\n    if (this.renderer.domElement.parentNode) {\r\n      this.renderer.domElement.parentNode.removeChild(this.renderer.domElement)\r\n    }\r\n\r\n    this.gameObjects.clear()\r\n    this.eventListeners.clear()\r\n  }\r\n\r\n  /**\r\n   * Dispose a material and its textures\r\n   */\r\n  private disposeMaterial(material: THREE.Material): void {\r\n    material.dispose()\r\n    \r\n    // Dispose textures if present\r\n    const mat = material as THREE.MeshStandardMaterial\r\n    if (mat.map) mat.map.dispose()\r\n    if (mat.normalMap) mat.normalMap.dispose()\r\n    if (mat.roughnessMap) mat.roughnessMap.dispose()\r\n    if (mat.metalnessMap) mat.metalnessMap.dispose()\r\n    if (mat.aoMap) mat.aoMap.dispose()\r\n    if (mat.emissiveMap) mat.emissiveMap.dispose()\r\n  }\r\n\r\n  // ==================== Getters ====================\r\n\r\n  getScene(): THREE.Scene {\r\n    return this.scene\r\n  }\r\n\r\n  getCamera(): THREE.PerspectiveCamera {\r\n    return this.camera\r\n  }\r\n\r\n  getRenderer(): THREE.WebGLRenderer {\r\n    return this.renderer\r\n  }\r\n\r\n  getCurrentPreset(): string {\r\n    return this.currentPreset\r\n  }\r\n\r\n  // ==================== Event System ====================\r\n\r\n  on(event: string, callback: EventCallback): void {\r\n    if (!this.eventListeners.has(event)) {\r\n      this.eventListeners.set(event, new Set())\r\n    }\r\n    this.eventListeners.get(event)!.add(callback)\r\n  }\r\n\r\n  off(event: string, callback: EventCallback): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.delete(callback)\r\n    }\r\n  }\r\n\r\n  private emit(event: string, data?: unknown): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.forEach((callback) => callback(data))\r\n    }\r\n  }\r\n}\r\n","import * as THREE from 'three'\r\nimport type { GameState, EventCallback } from './types'\r\nimport { GameEvent } from './types'\r\nimport { InputManager, InputKey, InputEvent } from './InputManager'\r\nimport { SceneManager } from './SceneManager'\r\n\r\n/**\r\n * GameEngine - Core game engine class\r\n * Manages the game loop, rendering, and coordinates all game systems\r\n * Requirements: 5.1, 5.2\r\n */\r\nexport class GameEngine {\r\n  // Managers\r\n  private sceneManager: SceneManager\r\n  private inputManager: InputManager\r\n\r\n  // Game loop state\r\n  private isRunning: boolean = false\r\n  private isPaused: boolean = false\r\n  private lastTime: number = 0\r\n  private animationFrameId: number | null = null\r\n\r\n  // Frame timing\r\n  private targetFPS: number = 60\r\n  private frameTime: number = 1000 / 60\r\n  private accumulator: number = 0\r\n\r\n  // Event system\r\n  private eventListeners: Map<string, Set<EventCallback>> = new Map()\r\n\r\n  // Game state\r\n  private gameState: GameState | null = null\r\n\r\n  constructor(container: HTMLElement) {\r\n    this.sceneManager = new SceneManager(container)\r\n    this.inputManager = new InputManager()\r\n  }\r\n\r\n  /**\r\n   * Initialize the game engine\r\n   * Sets up Three.js renderer, scene, and initial game state\r\n   */\r\n  async init(): Promise<void> {\r\n    // Initialize scene manager\r\n    await this.sceneManager.init()\r\n\r\n    // Initialize input manager\r\n    this.inputManager.init(this.sceneManager.getRenderer().domElement)\r\n\r\n    // Setup input event handlers\r\n    this.setupInputHandlers()\r\n\r\n    // Initialize game state\r\n    this.initializeGameState()\r\n\r\n    // Emit initialization complete event\r\n    this.emit(GameEvent.GAME_START, { initialized: true })\r\n  }\r\n\r\n  /**\r\n   * Setup input event handlers\r\n   */\r\n  private setupInputHandlers(): void {\r\n    // Handle pause key\r\n    this.inputManager.on(InputEvent.KEY_DOWN, (data: unknown) => {\r\n      const keyData = data as { code: string }\r\n      if (keyData.code === InputKey.PAUSE) {\r\n        if (this.isPaused) {\r\n          this.resume()\r\n        } else {\r\n          this.pause()\r\n        }\r\n      }\r\n    })\r\n\r\n    // Handle pointer lock change\r\n    this.inputManager.on(InputEvent.POINTER_LOCK_CHANGE, (data: unknown) => {\r\n      const lockData = data as { locked: boolean }\r\n      if (!lockData.locked && this.isRunning && !this.isPaused) {\r\n        // Pause game when pointer lock is lost\r\n        this.pause()\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Initialize default game state\r\n   */\r\n  private initializeGameState(): void {\r\n    this.gameState = {\r\n      player: {\r\n        position: { x: 0, y: 0, z: 0 },\r\n        rotation: { x: 0, y: 0, z: 0 },\r\n        health: 100,\r\n        stamina: 100,\r\n        weapons: [],\r\n        currentWeaponIndex: 0,\r\n      },\r\n      wave: {\r\n        currentWave: 1,\r\n        zombiesKilled: 0,\r\n        totalZombiesInWave: 0,\r\n        isPreparationPhase: true,\r\n      },\r\n      zombies: [],\r\n      score: 0,\r\n      playTime: 0,\r\n      timestamp: Date.now(),\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start the game loop\r\n   */\r\n  start(): void {\r\n    if (this.isRunning) return\r\n\r\n    this.isRunning = true\r\n    this.isPaused = false\r\n    this.lastTime = performance.now()\r\n    this.emit(GameEvent.GAME_START)\r\n    this.gameLoop()\r\n  }\r\n\r\n  /**\r\n   * Pause the game\r\n   */\r\n  pause(): void {\r\n    if (!this.isRunning || this.isPaused) return\r\n\r\n    this.isPaused = true\r\n    this.emit(GameEvent.GAME_PAUSE)\r\n  }\r\n\r\n  /**\r\n   * Resume the game from pause\r\n   */\r\n  resume(): void {\r\n    if (!this.isRunning || !this.isPaused) return\r\n\r\n    this.isPaused = false\r\n    this.lastTime = performance.now()\r\n    this.emit(GameEvent.GAME_RESUME)\r\n    this.gameLoop()\r\n  }\r\n\r\n  /**\r\n   * Stop the game completely\r\n   */\r\n  stop(): void {\r\n    this.isRunning = false\r\n    this.isPaused = false\r\n\r\n    if (this.animationFrameId !== null) {\r\n      cancelAnimationFrame(this.animationFrameId)\r\n      this.animationFrameId = null\r\n    }\r\n\r\n    this.emit(GameEvent.GAME_STOP)\r\n    this.cleanup()\r\n  }\r\n\r\n  /**\r\n   * Main game loop using requestAnimationFrame\r\n   */\r\n  private gameLoop(): void {\r\n    if (!this.isRunning || this.isPaused) return\r\n\r\n    const currentTime = performance.now()\r\n    const frameTime = currentTime - this.lastTime\r\n    this.lastTime = currentTime\r\n\r\n    // Fixed timestep with accumulator for physics stability\r\n    this.accumulator += frameTime\r\n\r\n    // Prevent spiral of death - cap accumulator to prevent freeze\r\n    if (this.accumulator > 200) {\r\n      this.accumulator = 200\r\n    }\r\n\r\n    // Fixed update at target FPS with max iterations to prevent freeze\r\n    let iterations = 0\r\n    const maxIterations = 5\r\n    while (this.accumulator >= this.frameTime && iterations < maxIterations) {\r\n      this.fixedUpdate(this.frameTime / 1000)\r\n      this.accumulator -= this.frameTime\r\n      iterations++\r\n    }\r\n    \r\n    // If we hit max iterations, discard remaining time\r\n    if (iterations >= maxIterations) {\r\n      this.accumulator = 0\r\n    }\r\n\r\n    // Variable update for rendering interpolation\r\n    const alpha = this.accumulator / this.frameTime\r\n    this.update(frameTime / 1000, alpha)\r\n\r\n    // Render\r\n    this.render()\r\n\r\n    // Clear per-frame input state\r\n    this.inputManager.update()\r\n\r\n    this.animationFrameId = requestAnimationFrame(() => this.gameLoop())\r\n  }\r\n\r\n  /**\r\n   * Fixed timestep update for physics and game logic\r\n   * @param deltaTime Fixed time step in seconds\r\n   */\r\n  fixedUpdate(deltaTime: number): void {\r\n    if (this.gameState) {\r\n      this.gameState.playTime += deltaTime\r\n    }\r\n\r\n    // Process input\r\n    this.processInput(deltaTime)\r\n\r\n    // TODO: Update physics, AI, etc.\r\n  }\r\n\r\n  /**\r\n   * Variable update for rendering and interpolation\r\n   * @param _deltaTime Time elapsed since last frame in seconds (unused, reserved for future interpolation)\r\n   * @param _alpha Interpolation factor (0-1) (unused, reserved for future interpolation)\r\n   */\r\n  update(_deltaTime: number, _alpha: number): void {\r\n    // Update lighting based on player position\r\n    if (this.gameState) {\r\n      const playerPos = new THREE.Vector3(\r\n        this.gameState.player.position.x,\r\n        this.gameState.player.position.y,\r\n        this.gameState.player.position.z\r\n      )\r\n      this.sceneManager.updateLighting(playerPos)\r\n    }\r\n\r\n    // TODO: Interpolate visual positions, update animations, etc.\r\n  }\r\n\r\n  /**\r\n   * Process player input\r\n   */\r\n  private processInput(deltaTime: number): void {\r\n    if (!this.gameState) return\r\n\r\n    // Get movement input\r\n    const movement = this.inputManager.getMovementInput()\r\n    \r\n    // Get mouse look\r\n    const mouseMovement = this.inputManager.getMouseMovement()\r\n\r\n    // Check for weapon switching via scroll wheel\r\n    const wheelDirection = this.inputManager.getMouseWheelDirection()\r\n    if (wheelDirection !== 0) {\r\n      this.emit('weapon:cycle', { direction: wheelDirection })\r\n    }\r\n\r\n    // Check for weapon slot selection\r\n    const weaponSlot = this.inputManager.getWeaponSlotPressed()\r\n    if (weaponSlot >= 0) {\r\n      this.emit('weapon:select', { slot: weaponSlot })\r\n    }\r\n\r\n    // Check for reload\r\n    if (this.inputManager.wantsToReload()) {\r\n      this.emit('weapon:reload', {})\r\n    }\r\n\r\n    // Check for fire\r\n    if (this.inputManager.wantsToFire()) {\r\n      this.emit('weapon:fire', {})\r\n    }\r\n\r\n    // Check for jump\r\n    if (this.inputManager.wantsToJump()) {\r\n      this.emit('player:jump', {})\r\n    }\r\n\r\n    // Emit movement update\r\n    this.emit('player:move', {\r\n      movement,\r\n      mouseMovement,\r\n      sprint: this.inputManager.wantsToSprint(),\r\n      deltaTime,\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Render the scene\r\n   */\r\n  render(): void {\r\n    this.sceneManager.render()\r\n  }\r\n\r\n  /**\r\n   * Get current game state\r\n   */\r\n  getState(): GameState | null {\r\n    return this.gameState\r\n  }\r\n\r\n  /**\r\n   * Set game state (for loading saves)\r\n   */\r\n  setState(state: GameState): void {\r\n    this.gameState = state\r\n  }\r\n\r\n  /**\r\n   * Subscribe to game events\r\n   */\r\n  on(event: string, callback: EventCallback): void {\r\n    if (!this.eventListeners.has(event)) {\r\n      this.eventListeners.set(event, new Set())\r\n    }\r\n    this.eventListeners.get(event)!.add(callback)\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe from game events\r\n   */\r\n  off(event: string, callback: EventCallback): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.delete(callback)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Emit a game event\r\n   */\r\n  emit(event: string, data?: unknown): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.forEach((callback) => callback(data))\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Cleanup resources\r\n   */\r\n  private cleanup(): void {\r\n    // Dispose input manager\r\n    this.inputManager.dispose()\r\n\r\n    // Dispose scene manager\r\n    this.sceneManager.dispose()\r\n\r\n    // Clear event listeners\r\n    this.eventListeners.clear()\r\n  }\r\n\r\n  // ==================== Getters ====================\r\n\r\n  /**\r\n   * Get the scene manager\r\n   */\r\n  getSceneManager(): SceneManager {\r\n    return this.sceneManager\r\n  }\r\n\r\n  /**\r\n   * Get the input manager\r\n   */\r\n  getInputManager(): InputManager {\r\n    return this.inputManager\r\n  }\r\n\r\n  /**\r\n   * Get Three.js scene (convenience method)\r\n   */\r\n  getScene(): THREE.Scene {\r\n    return this.sceneManager.getScene()\r\n  }\r\n\r\n  /**\r\n   * Get Three.js camera (convenience method)\r\n   */\r\n  getCamera(): THREE.PerspectiveCamera {\r\n    return this.sceneManager.getCamera()\r\n  }\r\n\r\n  /**\r\n   * Get Three.js renderer (convenience method)\r\n   */\r\n  getRenderer(): THREE.WebGLRenderer {\r\n    return this.sceneManager.getRenderer()\r\n  }\r\n\r\n  /**\r\n   * Check if game is running\r\n   */\r\n  isGameRunning(): boolean {\r\n    return this.isRunning\r\n  }\r\n\r\n  /**\r\n   * Check if game is paused\r\n   */\r\n  isGamePaused(): boolean {\r\n    return this.isPaused\r\n  }\r\n\r\n  /**\r\n   * Get target FPS\r\n   */\r\n  getTargetFPS(): number {\r\n    return this.targetFPS\r\n  }\r\n\r\n  /**\r\n   * Set target FPS\r\n   */\r\n  setTargetFPS(fps: number): void {\r\n    this.targetFPS = Math.max(30, Math.min(144, fps))\r\n    this.frameTime = 1000 / this.targetFPS\r\n  }\r\n\r\n  /**\r\n   * Set mouse sensitivity\r\n   */\r\n  setMouseSensitivity(sensitivity: number): void {\r\n    this.inputManager.setMouseSensitivity(sensitivity)\r\n  }\r\n\r\n  /**\r\n   * Get mouse sensitivity\r\n   */\r\n  getMouseSensitivity(): number {\r\n    return this.inputManager.getMouseSensitivity()\r\n  }\r\n}\r\n","import * as THREE from 'three'\r\nimport type { Vector3, Euler, EventCallback } from './types'\r\n\r\n/**\r\n * Player configuration constants\r\n */\r\nexport const PlayerConfig = {\r\n  // Movement\r\n  WALK_SPEED: 5.0,           // Units per second\r\n  SPRINT_MULTIPLIER: 1.5,    // Sprint speed = walk speed * 1.5\r\n  \r\n  // Jump\r\n  JUMP_HEIGHT: 2.0,          // Fixed jump height in units\r\n  GRAVITY: 20.0,             // Gravity acceleration\r\n  \r\n  // Stamina\r\n  MAX_STAMINA: 100,\r\n  STAMINA_DRAIN_RATE: 20,    // Per second while sprinting\r\n  STAMINA_REGEN_RATE: 15,    // Per second while not sprinting\r\n  STAMINA_THRESHOLD: 20,     // Minimum stamina to start sprinting (20%)\r\n  \r\n  // Health\r\n  MAX_HEALTH: 100,\r\n  \r\n  // Camera\r\n  EYE_HEIGHT: 1.7,           // Camera height from ground\r\n  MIN_PITCH: -Math.PI / 2 + 0.1,  // Look down limit\r\n  MAX_PITCH: Math.PI / 2 - 0.1,   // Look up limit\r\n}\r\n\r\n/**\r\n * Player events\r\n */\r\nexport enum PlayerEvent {\r\n  HEALTH_CHANGED = 'player:healthChanged',\r\n  STAMINA_CHANGED = 'player:staminaChanged',\r\n  DEATH = 'player:death',\r\n  JUMP = 'player:jumped',\r\n  LAND = 'player:landed',\r\n}\r\n\r\n/**\r\n * Player class - Handles player movement, health, stamina, and camera control\r\n * Requirements: 1.1, 1.2, 1.3, 1.4, 1.5\r\n */\r\nexport class Player {\r\n  // Position and rotation\r\n  private _position: THREE.Vector3\r\n  private _rotation: THREE.Euler\r\n  \r\n  // Velocity for physics\r\n  private velocity: THREE.Vector3\r\n  \r\n  // Health and stamina\r\n  private _health: number\r\n  private _maxHealth: number\r\n  private _stamina: number\r\n  private _maxStamina: number\r\n\r\n  \r\n  // Sprint state\r\n  private _isSprinting: boolean = false\r\n  private _canSprint: boolean = true  // Blocked when stamina < threshold\r\n  \r\n  // Jump/ground state\r\n  private _isOnGround: boolean = true\r\n  private _isJumping: boolean = false\r\n  \r\n  // Camera reference (for first-person view)\r\n  private camera: THREE.PerspectiveCamera | null = null\r\n  \r\n  // Event listeners\r\n  private eventListeners: Map<string, Set<EventCallback>> = new Map()\r\n\r\n  constructor(\r\n    position: Vector3 = { x: 0, y: 0, z: 0 },\r\n    rotation: Euler = { x: 0, y: 0, z: 0 }\r\n  ) {\r\n    this._position = new THREE.Vector3(position.x, position.y, position.z)\r\n    this._rotation = new THREE.Euler(rotation.x, rotation.y, rotation.z, 'YXZ')\r\n    this.velocity = new THREE.Vector3(0, 0, 0)\r\n    \r\n    this._health = PlayerConfig.MAX_HEALTH\r\n    this._maxHealth = PlayerConfig.MAX_HEALTH\r\n    this._stamina = PlayerConfig.MAX_STAMINA\r\n    this._maxStamina = PlayerConfig.MAX_STAMINA\r\n  }\r\n\r\n  /**\r\n   * Attach camera for first-person view\r\n   */\r\n  attachCamera(camera: THREE.PerspectiveCamera): void {\r\n    this.camera = camera\r\n    this.updateCameraPosition()\r\n  }\r\n\r\n  /**\r\n   * Update camera position to follow player\r\n   */\r\n  private updateCameraPosition(): void {\r\n    if (this.camera) {\r\n      this.camera.position.set(\r\n        this._position.x,\r\n        this._position.y + PlayerConfig.EYE_HEIGHT,\r\n        this._position.z\r\n      )\r\n      this.camera.rotation.copy(this._rotation)\r\n    }\r\n  }\r\n\r\n  // ==================== Movement ====================\r\n\r\n  /**\r\n   * Move the player based on input direction\r\n   * Direction is relative to camera facing (WASD movement)\r\n   * Requirements: 1.1\r\n   * \r\n   * @param inputX - Left/right input (-1 to 1)\r\n   * @param inputZ - Forward/backward input (-1 to 1)\r\n   * @param deltaTime - Time elapsed since last frame\r\n   */\r\n  move(inputX: number, inputZ: number, deltaTime: number): void {\r\n    if (inputX === 0 && inputZ === 0) return\r\n    \r\n    // Calculate movement speed\r\n    let speed = PlayerConfig.WALK_SPEED\r\n    if (this._isSprinting && this._canSprint) {\r\n      speed *= PlayerConfig.SPRINT_MULTIPLIER\r\n    }\r\n    \r\n    // Get forward and right vectors from camera rotation (Y-axis only)\r\n    const forward = new THREE.Vector3(0, 0, -1)\r\n    const right = new THREE.Vector3(1, 0, 0)\r\n    \r\n    // Apply Y rotation only (horizontal movement)\r\n    const yRotation = new THREE.Euler(0, this._rotation.y, 0)\r\n    forward.applyEuler(yRotation)\r\n    right.applyEuler(yRotation)\r\n    \r\n    // Calculate movement direction\r\n    const moveDirection = new THREE.Vector3()\r\n    moveDirection.addScaledVector(forward, -inputZ)  // Forward is -Z\r\n    moveDirection.addScaledVector(right, inputX)\r\n    \r\n    // Normalize to prevent faster diagonal movement\r\n    if (moveDirection.length() > 0) {\r\n      moveDirection.normalize()\r\n    }\r\n    \r\n    // Apply movement\r\n    this._position.addScaledVector(moveDirection, speed * deltaTime)\r\n    \r\n    this.updateCameraPosition()\r\n  }\r\n\r\n  /**\r\n   * Rotate camera based on mouse movement\r\n   * Requirements: 1.2\r\n   * \r\n   * @param deltaX - Mouse X movement (already scaled by sensitivity)\r\n   * @param deltaY - Mouse Y movement (already scaled by sensitivity)\r\n   */\r\n  rotate(deltaX: number, deltaY: number): void {\r\n    // Yaw (horizontal rotation)\r\n    this._rotation.y -= deltaX\r\n    \r\n    // Pitch (vertical rotation) with clamping\r\n    this._rotation.x -= deltaY\r\n    this._rotation.x = Math.max(\r\n      PlayerConfig.MIN_PITCH,\r\n      Math.min(PlayerConfig.MAX_PITCH, this._rotation.x)\r\n    )\r\n    \r\n    this.updateCameraPosition()\r\n  }\r\n\r\n  /**\r\n   * Attempt to jump\r\n   * Requirements: 1.3 - Jump only when on ground, fixed height of 2 units\r\n   * \r\n   * @returns true if jump was initiated\r\n   */\r\n  jump(): boolean {\r\n    if (!this._isOnGround) return false\r\n    \r\n    // Calculate initial velocity needed for fixed jump height\r\n    // Using v = 2gh, so v = sqrt(2 * g * h)\r\n    const jumpVelocity = Math.sqrt(2 * PlayerConfig.GRAVITY * PlayerConfig.JUMP_HEIGHT)\r\n    \r\n    this.velocity.y = jumpVelocity\r\n    this._isOnGround = false\r\n    this._isJumping = true\r\n    \r\n    this.emit(PlayerEvent.JUMP)\r\n    return true\r\n  }\r\n\r\n  /**\r\n   * Set sprint state\r\n   * Requirements: 1.4, 1.5\r\n   * \r\n   * @param active - Whether sprint key is held\r\n   */\r\n  sprint(active: boolean): void {\r\n    // Can only start sprinting if stamina is above threshold\r\n    if (active && !this._isSprinting) {\r\n      if (this._stamina >= PlayerConfig.STAMINA_THRESHOLD) {\r\n        this._isSprinting = true\r\n        this._canSprint = true\r\n      }\r\n    } else if (!active) {\r\n      this._isSprinting = false\r\n    }\r\n  }\r\n\r\n  // ==================== Health & Stamina ====================\r\n\r\n  /**\r\n   * Apply damage to player\r\n   * \r\n   * @param amount - Damage amount\r\n   */\r\n  takeDamage(amount: number): void {\r\n    if (amount <= 0) return\r\n    \r\n    const previousHealth = this._health\r\n    this._health = Math.max(0, this._health - amount)\r\n    \r\n    this.emit(PlayerEvent.HEALTH_CHANGED, {\r\n      previous: previousHealth,\r\n      current: this._health,\r\n      damage: amount,\r\n    })\r\n    \r\n    if (this._health <= 0) {\r\n      this.emit(PlayerEvent.DEATH)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Heal the player\r\n   * \r\n   * @param amount - Heal amount\r\n   */\r\n  heal(amount: number): void {\r\n    if (amount <= 0) return\r\n    \r\n    const previousHealth = this._health\r\n    this._health = Math.min(this._maxHealth, this._health + amount)\r\n    \r\n    this.emit(PlayerEvent.HEALTH_CHANGED, {\r\n      previous: previousHealth,\r\n      current: this._health,\r\n      healed: amount,\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Update stamina based on sprint state\r\n   * Requirements: 1.4, 1.5\r\n   * \r\n   * @param deltaTime - Time elapsed since last frame\r\n   */\r\n  updateStamina(deltaTime: number): void {\r\n    const previousStamina = this._stamina\r\n    \r\n    if (this._isSprinting && this._canSprint) {\r\n      // Drain stamina while sprinting\r\n      this._stamina = Math.max(0, this._stamina - PlayerConfig.STAMINA_DRAIN_RATE * deltaTime)\r\n      \r\n      // Check if stamina depleted\r\n      if (this._stamina <= 0) {\r\n        this._canSprint = false\r\n        this._isSprinting = false\r\n      }\r\n    } else {\r\n      // Regenerate stamina when not sprinting\r\n      this._stamina = Math.min(this._maxStamina, this._stamina + PlayerConfig.STAMINA_REGEN_RATE * deltaTime)\r\n      \r\n      // Re-enable sprinting when stamina reaches threshold (20%)\r\n      if (!this._canSprint && this._stamina >= PlayerConfig.STAMINA_THRESHOLD) {\r\n        this._canSprint = true\r\n      }\r\n    }\r\n    \r\n    if (previousStamina !== this._stamina) {\r\n      this.emit(PlayerEvent.STAMINA_CHANGED, {\r\n        previous: previousStamina,\r\n        current: this._stamina,\r\n      })\r\n    }\r\n  }\r\n\r\n\r\n  // ==================== Physics Update ====================\r\n\r\n  /**\r\n   * Update physics (gravity, ground detection)\r\n   * Requirements: 1.3\r\n   * \r\n   * @param deltaTime - Time elapsed since last frame\r\n   * @param groundY - Y position of ground at player's location\r\n   */\r\n  updatePhysics(deltaTime: number, groundY: number = 0): void {\r\n    if (!this._isOnGround) {\r\n      // Apply gravity\r\n      this.velocity.y -= PlayerConfig.GRAVITY * deltaTime\r\n      \r\n      // Update position\r\n      this._position.y += this.velocity.y * deltaTime\r\n      \r\n      // Ground collision\r\n      if (this._position.y <= groundY) {\r\n        this._position.y = groundY\r\n        this.velocity.y = 0\r\n        this._isOnGround = true\r\n        \r\n        if (this._isJumping) {\r\n          this._isJumping = false\r\n          this.emit(PlayerEvent.LAND)\r\n        }\r\n      }\r\n    }\r\n    \r\n    this.updateCameraPosition()\r\n  }\r\n\r\n  /**\r\n   * Full update method - call each frame\r\n   * \r\n   * @param deltaTime - Time elapsed since last frame\r\n   * @param groundY - Y position of ground at player's location\r\n   */\r\n  update(deltaTime: number, groundY: number = 0): void {\r\n    this.updateStamina(deltaTime)\r\n    this.updatePhysics(deltaTime, groundY)\r\n  }\r\n\r\n  // ==================== State Queries ====================\r\n\r\n  /**\r\n   * Check if player is dead\r\n   */\r\n  isDead(): boolean {\r\n    return this._health <= 0\r\n  }\r\n\r\n  /**\r\n   * Check if player is currently sprinting\r\n   */\r\n  isSprinting(): boolean {\r\n    return this._isSprinting && this._canSprint\r\n  }\r\n\r\n  /**\r\n   * Check if player can start sprinting\r\n   */\r\n  canSprint(): boolean {\r\n    return this._canSprint\r\n  }\r\n\r\n  /**\r\n   * Check if player is on ground\r\n   */\r\n  isOnGround(): boolean {\r\n    return this._isOnGround\r\n  }\r\n\r\n  /**\r\n   * Check if player is jumping\r\n   */\r\n  isJumping(): boolean {\r\n    return this._isJumping\r\n  }\r\n\r\n  /**\r\n   * Get current movement speed\r\n   */\r\n  getCurrentSpeed(): number {\r\n    if (this._isSprinting && this._canSprint) {\r\n      return PlayerConfig.WALK_SPEED * PlayerConfig.SPRINT_MULTIPLIER\r\n    }\r\n    return PlayerConfig.WALK_SPEED\r\n  }\r\n\r\n  // ==================== Getters & Setters ====================\r\n\r\n  get position(): Vector3 {\r\n    return { x: this._position.x, y: this._position.y, z: this._position.z }\r\n  }\r\n\r\n  set position(pos: Vector3) {\r\n    this._position.set(pos.x, pos.y, pos.z)\r\n    this.updateCameraPosition()\r\n  }\r\n\r\n  get rotation(): Euler {\r\n    return { x: this._rotation.x, y: this._rotation.y, z: this._rotation.z }\r\n  }\r\n\r\n  set rotation(rot: Euler) {\r\n    this._rotation.set(rot.x, rot.y, rot.z, 'YXZ')\r\n    this.updateCameraPosition()\r\n  }\r\n\r\n  get health(): number {\r\n    return this._health\r\n  }\r\n\r\n  get maxHealth(): number {\r\n    return this._maxHealth\r\n  }\r\n\r\n  get stamina(): number {\r\n    return this._stamina\r\n  }\r\n\r\n  get maxStamina(): number {\r\n    return this._maxStamina\r\n  }\r\n\r\n  /**\r\n   * Get position as THREE.Vector3\r\n   */\r\n  getPosition3(): THREE.Vector3 {\r\n    return this._position.clone()\r\n  }\r\n\r\n  /**\r\n   * Get rotation as THREE.Euler\r\n   */\r\n  getRotation3(): THREE.Euler {\r\n    return this._rotation.clone()\r\n  }\r\n\r\n  /**\r\n   * Set ground state (for external collision detection)\r\n   */\r\n  setOnGround(onGround: boolean): void {\r\n    const wasOnGround = this._isOnGround\r\n    this._isOnGround = onGround\r\n    \r\n    if (!wasOnGround && onGround && this._isJumping) {\r\n      this._isJumping = false\r\n      this.velocity.y = 0\r\n      this.emit(PlayerEvent.LAND)\r\n    }\r\n  }\r\n\r\n  // ==================== Serialization ====================\r\n\r\n  /**\r\n   * Export player state for saving\r\n   */\r\n  toState(): { position: Vector3; rotation: Euler; health: number; stamina: number } {\r\n    return {\r\n      position: this.position,\r\n      rotation: this.rotation,\r\n      health: this._health,\r\n      stamina: this._stamina,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Restore player state from save\r\n   */\r\n  fromState(state: { position: Vector3; rotation: Euler; health: number; stamina: number }): void {\r\n    this.position = state.position\r\n    this.rotation = state.rotation\r\n    this._health = state.health\r\n    this._stamina = state.stamina\r\n    this._isOnGround = true\r\n    this._isJumping = false\r\n    this.velocity.set(0, 0, 0)\r\n  }\r\n\r\n  // ==================== Event System ====================\r\n\r\n  on(event: string, callback: EventCallback): void {\r\n    if (!this.eventListeners.has(event)) {\r\n      this.eventListeners.set(event, new Set())\r\n    }\r\n    this.eventListeners.get(event)!.add(callback)\r\n  }\r\n\r\n  off(event: string, callback: EventCallback): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.delete(callback)\r\n    }\r\n  }\r\n\r\n  private emit(event: string, data?: unknown): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.forEach((callback) => callback(data))\r\n    }\r\n  }\r\n}\r\n","import * as THREE from 'three'\r\nimport { WeaponType } from '../types'\r\nimport type { EventCallback } from '../types'\r\n\r\n/**\r\n * Weapon configuration interface\r\n */\r\nexport interface WeaponConfig {\r\n  id: string\r\n  name: string\r\n  type: WeaponType\r\n  damage: number\r\n  fireRate: number          // Rounds per second\r\n  magazineSize: number\r\n  maxReserveAmmo: number\r\n  reloadTime: number        // Seconds\r\n  range: number             // Units\r\n  spread?: number           // Accuracy spread in radians (for shotguns)\r\n  pelletCount?: number      // Number of pellets (for shotguns)\r\n}\r\n\r\n/**\r\n * Weapon events\r\n */\r\nexport enum WeaponEvent {\r\n  FIRE = 'weapon:fire',\r\n  RELOAD_START = 'weapon:reloadStart',\r\n  RELOAD_END = 'weapon:reloadEnd',\r\n  AMMO_CHANGED = 'weapon:ammoChanged',\r\n  EMPTY = 'weapon:empty',\r\n}\r\n\r\n/**\r\n * Hit information for a single hit\r\n */\r\nexport interface HitInfo {\r\n  point: { x: number; y: number; z: number }\r\n  normal?: { x: number; y: number; z: number }\r\n  object?: THREE.Object3D\r\n  zombieId?: string\r\n}\r\n\r\n/**\r\n * Fire result interface\r\n */\r\nexport interface FireResult {\r\n  success: boolean\r\n  damage: number\r\n  hitPoint?: THREE.Vector3\r\n  hitNormal?: THREE.Vector3\r\n  hitObject?: THREE.Object3D\r\n  hits?: HitInfo[]\r\n}\r\n\r\n/**\r\n * Abstract Weapon base class\r\n * Requirements: 2.1, 2.2\r\n */\r\nexport abstract class Weapon {\r\n  // Configuration\r\n  readonly id: string\r\n  readonly name: string\r\n  readonly type: WeaponType\r\n  readonly damage: number\r\n  readonly fireRate: number\r\n  readonly magazineSize: number\r\n  readonly maxReserveAmmo: number\r\n  readonly reloadTime: number\r\n  readonly range: number\r\n  readonly spread: number\r\n  readonly pelletCount: number\r\n\r\n  // State\r\n  protected _currentAmmo: number\r\n  protected _reserveAmmo: number\r\n  protected _isReloading: boolean = false\r\n  protected _lastFireTime: number = 0\r\n  protected _reloadPromise: Promise<void> | null = null\r\n\r\n  // Event listeners\r\n  private eventListeners: Map<string, Set<EventCallback>> = new Map()\r\n\r\n  constructor(config: WeaponConfig) {\r\n    this.id = config.id\r\n    this.name = config.name\r\n    this.type = config.type\r\n    this.damage = config.damage\r\n    this.fireRate = config.fireRate\r\n    this.magazineSize = config.magazineSize\r\n    this.maxReserveAmmo = config.maxReserveAmmo\r\n    this.reloadTime = config.reloadTime\r\n    this.range = config.range\r\n    this.spread = config.spread ?? 0\r\n    this.pelletCount = config.pelletCount ?? 1\r\n\r\n    this._currentAmmo = this.magazineSize\r\n    this._reserveAmmo = this.maxReserveAmmo\r\n  }\r\n\r\n  // ==================== Getters ====================\r\n\r\n  get currentAmmo(): number {\r\n    return this._currentAmmo\r\n  }\r\n\r\n  get reserveAmmo(): number {\r\n    return this._reserveAmmo\r\n  }\r\n\r\n  get isReloading(): boolean {\r\n    return this._isReloading\r\n  }\r\n\r\n  get totalAmmo(): number {\r\n    return this._currentAmmo + this._reserveAmmo\r\n  }\r\n\r\n  // ==================== Core Methods ====================\r\n\r\n  /**\r\n   * Check if weapon can fire\r\n   * Requirements: 2.6\r\n   */\r\n  canFire(): boolean {\r\n    if (this._currentAmmo <= 0) return false\r\n    if (this._isReloading) return false\r\n\r\n    // Check fire rate\r\n    const now = performance.now()\r\n    const timeSinceLastFire = (now - this._lastFireTime) / 1000\r\n    const fireInterval = 1 / this.fireRate\r\n\r\n    return timeSinceLastFire >= fireInterval\r\n  }\r\n\r\n  /**\r\n   * Check if weapon can reload\r\n   * Requirements: 2.2\r\n   */\r\n  canReload(): boolean {\r\n    if (this._isReloading) return false\r\n    if (this._currentAmmo >= this.magazineSize) return false\r\n    if (this._reserveAmmo <= 0) return false\r\n    return true\r\n  }\r\n\r\n  /**\r\n   * Fire the weapon - abstract method to be implemented by subclasses\r\n   * Requirements: 2.1\r\n   */\r\n  abstract fire(origin: THREE.Vector3, direction: THREE.Vector3, scene?: THREE.Scene): FireResult\r\n\r\n  /**\r\n   * Perform the actual fire action (called by subclasses)\r\n   * Returns true if fire was successful\r\n   */\r\n  protected performFire(): boolean {\r\n    if (!this.canFire()) {\r\n      if (this._currentAmmo <= 0) {\r\n        this.emit(WeaponEvent.EMPTY)\r\n      }\r\n      return false\r\n    }\r\n\r\n    this._currentAmmo--\r\n    this._lastFireTime = performance.now()\r\n\r\n    this.emit(WeaponEvent.AMMO_CHANGED, {\r\n      currentAmmo: this._currentAmmo,\r\n      reserveAmmo: this._reserveAmmo,\r\n    })\r\n\r\n    this.emit(WeaponEvent.FIRE)\r\n\r\n    return true\r\n  }\r\n\r\n  /**\r\n   * Reload the weapon\r\n   * Requirements: 2.2\r\n   */\r\n  async reload(): Promise<void> {\r\n    if (!this.canReload()) return\r\n\r\n    this._isReloading = true\r\n    this.emit(WeaponEvent.RELOAD_START)\r\n\r\n    // Create reload promise\r\n    this._reloadPromise = new Promise<void>((resolve) => {\r\n      setTimeout(() => {\r\n        this.completeReload()\r\n        resolve()\r\n      }, this.reloadTime * 1000)\r\n    })\r\n\r\n    await this._reloadPromise\r\n  }\r\n\r\n  /**\r\n   * Complete the reload process\r\n   */\r\n  protected completeReload(): void {\r\n    if (!this._isReloading) return\r\n\r\n    const ammoNeeded = this.magazineSize - this._currentAmmo\r\n    const ammoToTransfer = Math.min(ammoNeeded, this._reserveAmmo)\r\n\r\n    this._currentAmmo += ammoToTransfer\r\n    this._reserveAmmo -= ammoToTransfer\r\n    this._isReloading = false\r\n    this._reloadPromise = null\r\n\r\n    this.emit(WeaponEvent.RELOAD_END)\r\n    this.emit(WeaponEvent.AMMO_CHANGED, {\r\n      currentAmmo: this._currentAmmo,\r\n      reserveAmmo: this._reserveAmmo,\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Cancel reload (e.g., when switching weapons)\r\n   */\r\n  cancelReload(): void {\r\n    this._isReloading = false\r\n    this._reloadPromise = null\r\n  }\r\n\r\n  /**\r\n   * Add ammo to reserve\r\n   */\r\n  addAmmo(amount: number): void {\r\n    this._reserveAmmo = Math.min(this._reserveAmmo + amount, this.maxReserveAmmo)\r\n    this.emit(WeaponEvent.AMMO_CHANGED, {\r\n      currentAmmo: this._currentAmmo,\r\n      reserveAmmo: this._reserveAmmo,\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Set ammo directly (for loading saved state)\r\n   */\r\n  setAmmo(currentAmmo: number, reserveAmmo: number): void {\r\n    this._currentAmmo = Math.max(0, Math.min(currentAmmo, this.magazineSize))\r\n    this._reserveAmmo = Math.max(0, Math.min(reserveAmmo, this.maxReserveAmmo))\r\n  }\r\n\r\n  // ==================== Event System ====================\r\n\r\n  on(event: string, callback: EventCallback): void {\r\n    if (!this.eventListeners.has(event)) {\r\n      this.eventListeners.set(event, new Set())\r\n    }\r\n    this.eventListeners.get(event)!.add(callback)\r\n  }\r\n\r\n  off(event: string, callback: EventCallback): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.delete(callback)\r\n    }\r\n  }\r\n\r\n  protected emit(event: string, data?: unknown): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.forEach((callback) => callback(data))\r\n    }\r\n  }\r\n\r\n  // ==================== Serialization ====================\r\n\r\n  toState(): { id: string; currentAmmo: number; reserveAmmo: number } {\r\n    return {\r\n      id: this.id,\r\n      currentAmmo: this._currentAmmo,\r\n      reserveAmmo: this._reserveAmmo,\r\n    }\r\n  }\r\n\r\n  fromState(state: { currentAmmo: number; reserveAmmo: number }): void {\r\n    this.setAmmo(state.currentAmmo, state.reserveAmmo)\r\n  }\r\n}\r\n","import * as THREE from 'three'\r\nimport { Weapon, WeaponConfig, FireResult } from './Weapon'\r\nimport { WeaponType } from '../types'\r\n\r\n/**\r\n * Default pistol configuration\r\n */\r\nconst DEFAULT_PISTOL_CONFIG: WeaponConfig = {\r\n  id: 'pistol',\r\n  name: 'Pistol',\r\n  type: WeaponType.PISTOL,\r\n  damage: 25,\r\n  fireRate: 3,           // 3 rounds per second\r\n  magazineSize: 15,\r\n  maxReserveAmmo: 90,\r\n  reloadTime: 1.5,       // 1.5 seconds\r\n  range: 50,             // 50 units\r\n}\r\n\r\n/**\r\n * Pistol weapon class\r\n * A reliable sidearm with moderate damage and fire rate\r\n * Requirements: 2.1, 2.2\r\n */\r\nexport class Pistol extends Weapon {\r\n  constructor(config: Partial<WeaponConfig> = {}) {\r\n    super({ ...DEFAULT_PISTOL_CONFIG, ...config })\r\n  }\r\n\r\n  /**\r\n   * Fire the pistol\r\n   * Performs raycast hit detection\r\n   * Requirements: 2.1\r\n   */\r\n  fire(origin: THREE.Vector3, direction: THREE.Vector3, scene?: THREE.Scene): FireResult {\r\n    if (!this.performFire()) {\r\n      return { success: false, damage: 0 }\r\n    }\r\n\r\n    // Perform raycast if scene is provided\r\n    if (scene) {\r\n      const raycaster = new THREE.Raycaster(origin, direction.normalize(), 0, this.range)\r\n      const intersects = raycaster.intersectObjects(scene.children, true)\r\n\r\n      if (intersects.length > 0) {\r\n        const hit = intersects[0]\r\n        return {\r\n          success: true,\r\n          damage: this.damage,\r\n          hitPoint: hit.point,\r\n          hitNormal: hit.face?.normal,\r\n          hitObject: hit.object,\r\n        }\r\n      }\r\n    }\r\n\r\n    return { success: true, damage: this.damage }\r\n  }\r\n}\r\n","import * as THREE from 'three'\r\nimport { Weapon, WeaponConfig, FireResult } from './Weapon'\r\nimport { WeaponType } from '../types'\r\n\r\n/**\r\n * Default rifle configuration\r\n */\r\nconst DEFAULT_RIFLE_CONFIG: WeaponConfig = {\r\n  id: 'rifle',\r\n  name: 'Assault Rifle',\r\n  type: WeaponType.RIFLE,\r\n  damage: 30,\r\n  fireRate: 10,          // 10 rounds per second (automatic)\r\n  magazineSize: 30,\r\n  maxReserveAmmo: 180,\r\n  reloadTime: 2.5,       // 2.5 seconds\r\n  range: 100,            // 100 units\r\n}\r\n\r\n/**\r\n * Rifle weapon class\r\n * High fire rate automatic weapon with good range\r\n * Requirements: 2.1, 2.2\r\n */\r\nexport class Rifle extends Weapon {\r\n  constructor(config: Partial<WeaponConfig> = {}) {\r\n    super({ ...DEFAULT_RIFLE_CONFIG, ...config })\r\n  }\r\n\r\n  /**\r\n   * Fire the rifle\r\n   * Performs raycast hit detection\r\n   * Requirements: 2.1\r\n   */\r\n  fire(origin: THREE.Vector3, direction: THREE.Vector3, scene?: THREE.Scene): FireResult {\r\n    if (!this.performFire()) {\r\n      return { success: false, damage: 0 }\r\n    }\r\n\r\n    // Perform raycast if scene is provided\r\n    if (scene) {\r\n      const raycaster = new THREE.Raycaster(origin, direction.normalize(), 0, this.range)\r\n      const intersects = raycaster.intersectObjects(scene.children, true)\r\n\r\n      if (intersects.length > 0) {\r\n        const hit = intersects[0]\r\n        return {\r\n          success: true,\r\n          damage: this.damage,\r\n          hitPoint: hit.point,\r\n          hitNormal: hit.face?.normal,\r\n          hitObject: hit.object,\r\n        }\r\n      }\r\n    }\r\n\r\n    return { success: true, damage: this.damage }\r\n  }\r\n}\r\n","import * as THREE from 'three'\r\nimport { Weapon, WeaponConfig, FireResult } from './Weapon'\r\nimport { WeaponType } from '../types'\r\n\r\n/**\r\n * Default shotgun configuration\r\n */\r\nconst DEFAULT_SHOTGUN_CONFIG: WeaponConfig = {\r\n  id: 'shotgun',\r\n  name: 'Shotgun',\r\n  type: WeaponType.SHOTGUN,\r\n  damage: 15,            // Per pellet\r\n  fireRate: 1,           // 1 round per second\r\n  magazineSize: 8,\r\n  maxReserveAmmo: 48,\r\n  reloadTime: 3.0,       // 3 seconds\r\n  range: 25,             // 25 units (short range)\r\n  spread: 0.1,           // Spread in radians\r\n  pelletCount: 8,        // 8 pellets per shot\r\n}\r\n\r\n/**\r\n * Shotgun weapon class\r\n * High damage at close range with multiple pellets\r\n * Requirements: 2.1, 2.2\r\n */\r\nexport class Shotgun extends Weapon {\r\n  constructor(config: Partial<WeaponConfig> = {}) {\r\n    super({ ...DEFAULT_SHOTGUN_CONFIG, ...config })\r\n  }\r\n\r\n  /**\r\n   * Fire the shotgun\r\n   * Fires multiple pellets with spread\r\n   * Requirements: 2.1\r\n   */\r\n  fire(origin: THREE.Vector3, direction: THREE.Vector3, scene?: THREE.Scene): FireResult {\r\n    if (!this.performFire()) {\r\n      return { success: false, damage: 0 }\r\n    }\r\n\r\n    let totalDamage = 0\r\n    let closestHit: { point: THREE.Vector3; normal?: THREE.Vector3; object?: THREE.Object3D } | null = null\r\n    let closestDistance = Infinity\r\n\r\n    // Fire multiple pellets\r\n    for (let i = 0; i < this.pelletCount; i++) {\r\n      // Apply random spread to direction\r\n      const spreadDirection = this.applySpread(direction.clone())\r\n\r\n      if (scene) {\r\n        const raycaster = new THREE.Raycaster(origin, spreadDirection.normalize(), 0, this.range)\r\n        const intersects = raycaster.intersectObjects(scene.children, true)\r\n\r\n        if (intersects.length > 0) {\r\n          const hit = intersects[0]\r\n          totalDamage += this.damage\r\n\r\n          // Track closest hit for return value\r\n          if (hit.distance < closestDistance) {\r\n            closestDistance = hit.distance\r\n            closestHit = {\r\n              point: hit.point,\r\n              normal: hit.face?.normal,\r\n              object: hit.object,\r\n            }\r\n          }\r\n        }\r\n      } else {\r\n        // No scene, assume all pellets hit\r\n        totalDamage += this.damage\r\n      }\r\n    }\r\n\r\n    if (closestHit) {\r\n      return {\r\n        success: true,\r\n        damage: totalDamage,\r\n        hitPoint: closestHit.point,\r\n        hitNormal: closestHit.normal,\r\n        hitObject: closestHit.object,\r\n      }\r\n    }\r\n\r\n    return { success: true, damage: totalDamage }\r\n  }\r\n\r\n  /**\r\n   * Apply random spread to a direction vector\r\n   */\r\n  private applySpread(direction: THREE.Vector3): THREE.Vector3 {\r\n    // Random angle within spread cone\r\n    const spreadAngle = (Math.random() - 0.5) * this.spread * 2\r\n    const spreadAngle2 = (Math.random() - 0.5) * this.spread * 2\r\n\r\n    // Create rotation quaternion for spread\r\n    const spreadQuat = new THREE.Quaternion()\r\n    spreadQuat.setFromEuler(new THREE.Euler(spreadAngle, spreadAngle2, 0))\r\n\r\n    // Apply spread rotation\r\n    direction.applyQuaternion(spreadQuat)\r\n\r\n    return direction\r\n  }\r\n}\r\n","import * as THREE from 'three'\r\nimport { Weapon, WeaponConfig, FireResult } from './Weapon'\r\nimport { WeaponType } from '../types'\r\n\r\n/**\r\n * Default melee weapon configuration\r\n */\r\nconst DEFAULT_MELEE_CONFIG: WeaponConfig = {\r\n  id: 'knife',\r\n  name: 'Combat Knife',\r\n  type: WeaponType.MELEE,\r\n  damage: 50,\r\n  fireRate: 2,           // 2 attacks per second\r\n  magazineSize: 1,       // Melee doesn't use ammo\r\n  maxReserveAmmo: 0,     // No reserve ammo\r\n  reloadTime: 0,         // No reload\r\n  range: 2,              // 2 units (melee range)\r\n}\r\n\r\n/**\r\n * MeleeWeapon class\r\n * Close range weapon with high damage, no ammo required\r\n * Requirements: 2.1, 2.6\r\n */\r\nexport class MeleeWeapon extends Weapon {\r\n  constructor(config: Partial<WeaponConfig> = {}) {\r\n    super({ ...DEFAULT_MELEE_CONFIG, ...config })\r\n    // Melee weapons always have \"ammo\"\r\n    this._currentAmmo = 1\r\n    this._reserveAmmo = 0\r\n  }\r\n\r\n  /**\r\n   * Override canFire - melee weapons always can fire (no ammo check)\r\n   */\r\n  canFire(): boolean {\r\n    if (this._isReloading) return false\r\n\r\n    // Check fire rate\r\n    const now = performance.now()\r\n    const timeSinceLastFire = (now - this._lastFireTime) / 1000\r\n    const fireInterval = 1 / this.fireRate\r\n\r\n    return timeSinceLastFire >= fireInterval\r\n  }\r\n\r\n  /**\r\n   * Override canReload - melee weapons don't reload\r\n   */\r\n  canReload(): boolean {\r\n    return false\r\n  }\r\n\r\n  /**\r\n   * Perform melee attack\r\n   * Checks for objects within melee range\r\n   * Requirements: 2.1\r\n   */\r\n  fire(origin: THREE.Vector3, direction: THREE.Vector3, scene?: THREE.Scene): FireResult {\r\n    // Check fire rate (melee doesn't consume ammo)\r\n    const now = performance.now()\r\n    const timeSinceLastFire = (now - this._lastFireTime) / 1000\r\n    const fireInterval = 1 / this.fireRate\r\n\r\n    if (timeSinceLastFire < fireInterval) {\r\n      return { success: false, damage: 0 }\r\n    }\r\n\r\n    this._lastFireTime = now\r\n    this.emit('weapon:fire')\r\n\r\n    // Perform melee range check\r\n    if (scene) {\r\n      const raycaster = new THREE.Raycaster(origin, direction.normalize(), 0, this.range)\r\n      const intersects = raycaster.intersectObjects(scene.children, true)\r\n\r\n      if (intersects.length > 0) {\r\n        const hit = intersects[0]\r\n        return {\r\n          success: true,\r\n          damage: this.damage,\r\n          hitPoint: hit.point,\r\n          hitNormal: hit.face?.normal,\r\n          hitObject: hit.object,\r\n        }\r\n      }\r\n    }\r\n\r\n    return { success: true, damage: this.damage }\r\n  }\r\n\r\n  /**\r\n   * Override reload - melee weapons don't reload\r\n   */\r\n  async reload(): Promise<void> {\r\n    // Do nothing\r\n  }\r\n\r\n  /**\r\n   * Override toState - melee weapons don't track ammo\r\n   */\r\n  toState(): { id: string; currentAmmo: number; reserveAmmo: number } {\r\n    return {\r\n      id: this.id,\r\n      currentAmmo: 1,\r\n      reserveAmmo: 0,\r\n    }\r\n  }\r\n}\r\n","import * as THREE from 'three'\r\nimport { Weapon, FireResult, WeaponEvent } from './Weapon'\r\nimport { Pistol } from './Pistol'\r\nimport { Rifle } from './Rifle'\r\nimport { Shotgun } from './Shotgun'\r\nimport { MeleeWeapon } from './MeleeWeapon'\r\nimport type { EventCallback, WeaponState } from '../types'\r\n\r\n/**\r\n * WeaponManager events\r\n */\r\nexport enum WeaponManagerEvent {\r\n  WEAPON_SWITCHED = 'weaponManager:switched',\r\n  WEAPON_FIRED = 'weaponManager:fired',\r\n  WEAPON_RELOAD_START = 'weaponManager:reloadStart',\r\n  WEAPON_RELOAD_END = 'weaponManager:reloadEnd',\r\n  AMMO_CHANGED = 'weaponManager:ammoChanged',\r\n  WEAPON_EMPTY = 'weaponManager:empty',\r\n}\r\n\r\n/**\r\n * Maximum number of weapon slots\r\n */\r\nconst MAX_WEAPON_SLOTS = 4\r\n\r\n/**\r\n * WeaponManager - Manages player's weapon inventory and switching\r\n * Requirements: 2.1, 2.2, 2.3, 2.4, 2.6\r\n */\r\nexport class WeaponManager {\r\n  // Weapon inventory (4 slots)\r\n  private weapons: (Weapon | null)[] = [null, null, null, null]\r\n  private currentWeaponIndex: number = 0\r\n\r\n  // Event listeners\r\n  private eventListeners: Map<string, Set<EventCallback>> = new Map()\r\n\r\n  constructor() {\r\n    // Initialize with default weapons\r\n    this.initializeDefaultWeapons()\r\n  }\r\n\r\n  /**\r\n   * Initialize default weapon loadout\r\n   */\r\n  private initializeDefaultWeapons(): void {\r\n    this.weapons[0] = new Pistol()\r\n    this.weapons[1] = new Rifle()\r\n    this.weapons[2] = new Shotgun()\r\n    this.weapons[3] = new MeleeWeapon()\r\n\r\n    // Subscribe to weapon events\r\n    this.weapons.forEach((weapon) => {\r\n      if (weapon) {\r\n        this.subscribeToWeaponEvents(weapon)\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Subscribe to a weapon's events\r\n   */\r\n  private subscribeToWeaponEvents(weapon: Weapon): void {\r\n    weapon.on(WeaponEvent.FIRE, () => {\r\n      if (weapon === this.getCurrentWeapon()) {\r\n        this.emit(WeaponManagerEvent.WEAPON_FIRED, { weapon })\r\n      }\r\n    })\r\n\r\n    weapon.on(WeaponEvent.RELOAD_START, () => {\r\n      if (weapon === this.getCurrentWeapon()) {\r\n        this.emit(WeaponManagerEvent.WEAPON_RELOAD_START, { weapon })\r\n      }\r\n    })\r\n\r\n    weapon.on(WeaponEvent.RELOAD_END, () => {\r\n      if (weapon === this.getCurrentWeapon()) {\r\n        this.emit(WeaponManagerEvent.WEAPON_RELOAD_END, { weapon })\r\n      }\r\n    })\r\n\r\n    weapon.on(WeaponEvent.AMMO_CHANGED, (data) => {\r\n      if (weapon === this.getCurrentWeapon()) {\r\n        this.emit(WeaponManagerEvent.AMMO_CHANGED, { weapon, ...data as object })\r\n      }\r\n    })\r\n\r\n    weapon.on(WeaponEvent.EMPTY, () => {\r\n      if (weapon === this.getCurrentWeapon()) {\r\n        this.emit(WeaponManagerEvent.WEAPON_EMPTY, { weapon })\r\n      }\r\n    })\r\n  }\r\n\r\n  // ==================== Weapon Access ====================\r\n\r\n  /**\r\n   * Get current weapon\r\n   */\r\n  getCurrentWeapon(): Weapon | null {\r\n    return this.weapons[this.currentWeaponIndex]\r\n  }\r\n\r\n  /**\r\n   * Get current weapon index\r\n   */\r\n  getCurrentWeaponIndex(): number {\r\n    return this.currentWeaponIndex\r\n  }\r\n\r\n  /**\r\n   * Get weapon at slot\r\n   */\r\n  getWeaponAtSlot(slot: number): Weapon | null {\r\n    if (slot < 0 || slot >= MAX_WEAPON_SLOTS) return null\r\n    return this.weapons[slot]\r\n  }\r\n\r\n  /**\r\n   * Get all weapons\r\n   */\r\n  getAllWeapons(): (Weapon | null)[] {\r\n    return [...this.weapons]\r\n  }\r\n\r\n  /**\r\n   * Get number of weapons\r\n   */\r\n  getWeaponCount(): number {\r\n    return this.weapons.filter((w) => w !== null).length\r\n  }\r\n\r\n  // ==================== Weapon Switching ====================\r\n\r\n  /**\r\n   * Switch to weapon at specific slot\r\n   * Requirements: 2.4\r\n   * \r\n   * @param slot - Weapon slot (0-3)\r\n   * @returns true if switch was successful\r\n   */\r\n  switchToSlot(slot: number): boolean {\r\n    if (slot < 0 || slot >= MAX_WEAPON_SLOTS) return false\r\n    if (this.weapons[slot] === null) return false\r\n    if (slot === this.currentWeaponIndex) return false\r\n\r\n    // Cancel current weapon's reload\r\n    const currentWeapon = this.getCurrentWeapon()\r\n    if (currentWeapon) {\r\n      currentWeapon.cancelReload()\r\n    }\r\n\r\n    const previousIndex = this.currentWeaponIndex\r\n    this.currentWeaponIndex = slot\r\n\r\n    this.emit(WeaponManagerEvent.WEAPON_SWITCHED, {\r\n      previousIndex,\r\n      currentIndex: slot,\r\n      weapon: this.getCurrentWeapon(),\r\n    })\r\n\r\n    return true\r\n  }\r\n\r\n  /**\r\n   * Cycle to next weapon\r\n   * Requirements: 2.3\r\n   * \r\n   * @returns true if switch was successful\r\n   */\r\n  cycleNext(): boolean {\r\n    const startIndex = this.currentWeaponIndex\r\n    let nextIndex = (this.currentWeaponIndex + 1) % MAX_WEAPON_SLOTS\r\n\r\n    // Find next available weapon\r\n    while (nextIndex !== startIndex) {\r\n      if (this.weapons[nextIndex] !== null) {\r\n        return this.switchToSlot(nextIndex)\r\n      }\r\n      nextIndex = (nextIndex + 1) % MAX_WEAPON_SLOTS\r\n    }\r\n\r\n    return false\r\n  }\r\n\r\n  /**\r\n   * Cycle to previous weapon\r\n   * Requirements: 2.3\r\n   * \r\n   * @returns true if switch was successful\r\n   */\r\n  cyclePrevious(): boolean {\r\n    const startIndex = this.currentWeaponIndex\r\n    let prevIndex = (this.currentWeaponIndex - 1 + MAX_WEAPON_SLOTS) % MAX_WEAPON_SLOTS\r\n\r\n    // Find previous available weapon\r\n    while (prevIndex !== startIndex) {\r\n      if (this.weapons[prevIndex] !== null) {\r\n        return this.switchToSlot(prevIndex)\r\n      }\r\n      prevIndex = (prevIndex - 1 + MAX_WEAPON_SLOTS) % MAX_WEAPON_SLOTS\r\n    }\r\n\r\n    return false\r\n  }\r\n\r\n  // ==================== Weapon Actions ====================\r\n\r\n  /**\r\n   * Fire current weapon\r\n   * Requirements: 2.1, 2.6\r\n   */\r\n  fire(origin: THREE.Vector3, direction: THREE.Vector3, scene?: THREE.Scene): FireResult {\r\n    const weapon = this.getCurrentWeapon()\r\n    if (!weapon) {\r\n      return { success: false, damage: 0 }\r\n    }\r\n\r\n    return weapon.fire(origin, direction, scene)\r\n  }\r\n\r\n  /**\r\n   * Reload current weapon\r\n   * Requirements: 2.2\r\n   */\r\n  async reload(): Promise<void> {\r\n    const weapon = this.getCurrentWeapon()\r\n    if (!weapon) return\r\n\r\n    await weapon.reload()\r\n  }\r\n\r\n  /**\r\n   * Check if current weapon can fire\r\n   */\r\n  canFire(): boolean {\r\n    const weapon = this.getCurrentWeapon()\r\n    return weapon ? weapon.canFire() : false\r\n  }\r\n\r\n  /**\r\n   * Check if current weapon can reload\r\n   */\r\n  canReload(): boolean {\r\n    const weapon = this.getCurrentWeapon()\r\n    return weapon ? weapon.canReload() : false\r\n  }\r\n\r\n  /**\r\n   * Check if current weapon is reloading\r\n   */\r\n  isReloading(): boolean {\r\n    const weapon = this.getCurrentWeapon()\r\n    return weapon ? weapon.isReloading : false\r\n  }\r\n\r\n  // ==================== Weapon Management ====================\r\n\r\n  /**\r\n   * Set weapon at slot\r\n   */\r\n  setWeaponAtSlot(slot: number, weapon: Weapon | null): void {\r\n    if (slot < 0 || slot >= MAX_WEAPON_SLOTS) return\r\n\r\n    // Unsubscribe from old weapon\r\n    const oldWeapon = this.weapons[slot]\r\n    if (oldWeapon) {\r\n      // Note: In a full implementation, we'd properly unsubscribe\r\n    }\r\n\r\n    this.weapons[slot] = weapon\r\n\r\n    // Subscribe to new weapon\r\n    if (weapon) {\r\n      this.subscribeToWeaponEvents(weapon)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add ammo to a specific weapon type\r\n   */\r\n  addAmmoToWeapon(weaponId: string, amount: number): void {\r\n    const weapon = this.weapons.find((w) => w?.id === weaponId)\r\n    if (weapon) {\r\n      weapon.addAmmo(amount)\r\n    }\r\n  }\r\n\r\n  // ==================== Serialization ====================\r\n\r\n  /**\r\n   * Get weapon states for saving\r\n   */\r\n  toState(): { weapons: WeaponState[]; currentWeaponIndex: number } {\r\n    return {\r\n      weapons: this.weapons.map((w) =>\r\n        w ? w.toState() : { id: '', currentAmmo: 0, reserveAmmo: 0 }\r\n      ),\r\n      currentWeaponIndex: this.currentWeaponIndex,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Restore weapon states from save\r\n   */\r\n  fromState(state: { weapons: WeaponState[]; currentWeaponIndex: number }): void {\r\n    state.weapons.forEach((weaponState, index) => {\r\n      const weapon = this.weapons[index]\r\n      if (weapon && weaponState.id === weapon.id) {\r\n        weapon.fromState(weaponState)\r\n      }\r\n    })\r\n\r\n    this.currentWeaponIndex = state.currentWeaponIndex\r\n  }\r\n\r\n  // ==================== Event System ====================\r\n\r\n  on(event: string, callback: EventCallback): void {\r\n    if (!this.eventListeners.has(event)) {\r\n      this.eventListeners.set(event, new Set())\r\n    }\r\n    this.eventListeners.get(event)!.add(callback)\r\n  }\r\n\r\n  off(event: string, callback: EventCallback): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.delete(callback)\r\n    }\r\n  }\r\n\r\n  private emit(event: string, data?: unknown): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.forEach((callback) => callback(data))\r\n    }\r\n  }\r\n}\r\n","import * as THREE from 'three'\r\nimport type { Vector3, EventCallback } from '../types'\r\nimport { ZombieVariant, ZombieStateType } from '../types'\r\n\r\n/**\r\n * Zombie configuration constants per variant\r\n * Requirements: 3.1, 3.6\r\n */\r\nexport const ZombieConfig = {\r\n  // Detection and attack ranges\r\n  DETECTION_RANGE: 30,      // Units - player detection range\r\n  ATTACK_RANGE: 2,          // Units - melee attack range\r\n  \r\n  // Timing\r\n  ATTACK_COOLDOWN: 1.5,     // Seconds between attacks\r\n  DEATH_REMOVE_DELAY: 5,    // Seconds before removing dead zombie\r\n  WANDER_CHANGE_INTERVAL: 3, // Seconds between wander direction changes\r\n  \r\n  // Variant-specific stats\r\n  variants: {\r\n    [ZombieVariant.WALKER]: {\r\n      health: 100,\r\n      damage: 10,\r\n      speed: 2.0,\r\n      name: 'Walker',\r\n    },\r\n    [ZombieVariant.RUNNER]: {\r\n      health: 75,\r\n      damage: 8,\r\n      speed: 5.0,\r\n      name: 'Runner',\r\n    },\r\n    [ZombieVariant.BRUTE]: {\r\n      health: 250,\r\n      damage: 25,\r\n      speed: 1.5,\r\n      name: 'Brute',\r\n    },\r\n    [ZombieVariant.CRAWLER]: {\r\n      health: 50,\r\n      damage: 15,\r\n      speed: 3.0,\r\n      name: 'Crawler',\r\n    },\r\n  },\r\n}\r\n\r\n/**\r\n * Zombie events\r\n */\r\nexport enum ZombieEvent {\r\n  STATE_CHANGED = 'zombie:stateChanged',\r\n  DAMAGE_TAKEN = 'zombie:damageTaken',\r\n  ATTACK = 'zombie:attack',\r\n  DEATH = 'zombie:death',\r\n}\r\n\r\n\r\n/**\r\n * Zombie class - AI-controlled enemy entity\r\n * Implements state machine for behavior (IDLE, WANDERING, CHASING, ATTACKING, DYING)\r\n * Requirements: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6\r\n */\r\nexport class Zombie {\r\n  // Unique identifier\r\n  private _id: string\r\n  \r\n  // Position and movement\r\n  private _position: THREE.Vector3\r\n  private _rotation: THREE.Euler\r\n  \r\n  // Stats based on variant\r\n  private _health: number\r\n  private _maxHealth: number\r\n  private _damage: number\r\n  private _speed: number\r\n  private _variant: ZombieVariant\r\n  \r\n  // State machine\r\n  private _state: ZombieStateType = ZombieStateType.IDLE\r\n  private previousState: ZombieStateType = ZombieStateType.IDLE\r\n  \r\n  // Timers\r\n  private attackCooldown: number = 0\r\n  private deathTimer: number = 0\r\n  private wanderTimer: number = 0\r\n  private wanderDirection: THREE.Vector3 = new THREE.Vector3()\r\n  \r\n  // Spawn area for wandering\r\n  private spawnPosition: THREE.Vector3\r\n  private wanderRadius: number = 10\r\n  \r\n  // 3D model reference\r\n  private mesh: THREE.Object3D | null = null\r\n  \r\n  // Event listeners\r\n  private eventListeners: Map<string, Set<EventCallback>> = new Map()\r\n\r\n  constructor(\r\n    id: string,\r\n    position: Vector3,\r\n    variant: ZombieVariant = ZombieVariant.WALKER\r\n  ) {\r\n    this._id = id\r\n    this._position = new THREE.Vector3(position.x, position.y, position.z)\r\n    this._rotation = new THREE.Euler(0, 0, 0, 'YXZ')\r\n    this.spawnPosition = this._position.clone()\r\n    this._variant = variant\r\n    \r\n    // Initialize stats from variant config\r\n    const variantConfig = ZombieConfig.variants[variant]\r\n    this._health = variantConfig.health\r\n    this._maxHealth = variantConfig.health\r\n    this._damage = variantConfig.damage\r\n    this._speed = variantConfig.speed\r\n    \r\n    // Start in idle state\r\n    this._state = ZombieStateType.IDLE\r\n  }\r\n\r\n  // ==================== State Machine ====================\r\n\r\n  /**\r\n   * Transition to a new state\r\n   */\r\n  private setState(newState: ZombieStateType): void {\r\n    if (this._state === newState) return\r\n    if (this._state === ZombieStateType.DYING) return // Can't leave dying state\r\n    \r\n    this.previousState = this._state\r\n    this._state = newState\r\n    \r\n    this.emit(ZombieEvent.STATE_CHANGED, {\r\n      previous: this.previousState,\r\n      current: this._state,\r\n    })\r\n    \r\n    // State entry actions\r\n    this.onStateEnter(newState)\r\n  }\r\n\r\n  /**\r\n   * Handle state entry actions\r\n   */\r\n  private onStateEnter(state: ZombieStateType): void {\r\n    switch (state) {\r\n      case ZombieStateType.WANDERING:\r\n        this.pickNewWanderDirection()\r\n        this.wanderTimer = ZombieConfig.WANDER_CHANGE_INTERVAL\r\n        break\r\n      case ZombieStateType.DYING:\r\n        this.deathTimer = ZombieConfig.DEATH_REMOVE_DELAY\r\n        this.emit(ZombieEvent.DEATH, { id: this._id })\r\n        break\r\n      case ZombieStateType.ATTACKING:\r\n        this.attackCooldown = 0 // Ready to attack immediately\r\n        break\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Pick a random direction for wandering\r\n   */\r\n  private pickNewWanderDirection(): void {\r\n    const angle = Math.random() * Math.PI * 2\r\n    this.wanderDirection.set(Math.cos(angle), 0, Math.sin(angle))\r\n  }\r\n\r\n\r\n  // ==================== Update Logic ====================\r\n\r\n  /**\r\n   * Main update method - call each frame\r\n   * Requirements: 3.2, 3.3, 3.6\r\n   * \r\n   * @param deltaTime - Time elapsed since last frame\r\n   * @param playerPosition - Current player position for AI decisions\r\n   */\r\n  update(deltaTime: number, playerPosition: THREE.Vector3): void {\r\n    // Update timers\r\n    if (this.attackCooldown > 0) {\r\n      this.attackCooldown -= deltaTime\r\n    }\r\n    \r\n    // Handle dying state separately\r\n    if (this._state === ZombieStateType.DYING) {\r\n      this.updateDying(deltaTime)\r\n      return\r\n    }\r\n    \r\n    // Calculate distance to player\r\n    const distanceToPlayer = this._position.distanceTo(playerPosition)\r\n    \r\n    // State transitions based on player distance\r\n    this.updateStateTransitions(distanceToPlayer, playerPosition)\r\n    \r\n    // Execute current state behavior\r\n    this.executeStateBehavior(deltaTime, playerPosition, distanceToPlayer)\r\n    \r\n    // Update mesh position if attached\r\n    this.updateMeshPosition()\r\n  }\r\n\r\n  /**\r\n   * Update state transitions based on player distance\r\n   * Requirements: 3.2, 3.3, 3.6\r\n   */\r\n  private updateStateTransitions(distanceToPlayer: number, _playerPosition: THREE.Vector3): void {\r\n    switch (this._state) {\r\n      case ZombieStateType.IDLE:\r\n      case ZombieStateType.WANDERING:\r\n        // Transition to chasing if player is within detection range\r\n        if (distanceToPlayer < ZombieConfig.DETECTION_RANGE) {\r\n          this.setState(ZombieStateType.CHASING)\r\n        } else if (this._state === ZombieStateType.IDLE) {\r\n          // Start wandering after being idle\r\n          this.setState(ZombieStateType.WANDERING)\r\n        }\r\n        break\r\n        \r\n      case ZombieStateType.CHASING:\r\n        // Transition to attacking if within attack range\r\n        if (distanceToPlayer < ZombieConfig.ATTACK_RANGE) {\r\n          this.setState(ZombieStateType.ATTACKING)\r\n        }\r\n        // Return to wandering if player escapes detection range\r\n        else if (distanceToPlayer > ZombieConfig.DETECTION_RANGE * 1.5) {\r\n          this.setState(ZombieStateType.WANDERING)\r\n        }\r\n        break\r\n        \r\n      case ZombieStateType.ATTACKING:\r\n        // Return to chasing if player moves out of attack range\r\n        if (distanceToPlayer >= ZombieConfig.ATTACK_RANGE) {\r\n          this.setState(ZombieStateType.CHASING)\r\n        }\r\n        break\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Execute behavior for current state\r\n   */\r\n  private executeStateBehavior(\r\n    deltaTime: number,\r\n    playerPosition: THREE.Vector3,\r\n    _distanceToPlayer: number\r\n  ): void {\r\n    switch (this._state) {\r\n      case ZombieStateType.IDLE:\r\n        // Do nothing, just wait\r\n        break\r\n        \r\n      case ZombieStateType.WANDERING:\r\n        this.updateWandering(deltaTime)\r\n        break\r\n        \r\n      case ZombieStateType.CHASING:\r\n        this.updateChasing(deltaTime, playerPosition)\r\n        break\r\n        \r\n      case ZombieStateType.ATTACKING:\r\n        this.updateAttacking(deltaTime, playerPosition)\r\n        break\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update wandering behavior\r\n   * Requirements: 3.6\r\n   */\r\n  private updateWandering(deltaTime: number): void {\r\n    // Update wander timer\r\n    this.wanderTimer -= deltaTime\r\n    if (this.wanderTimer <= 0) {\r\n      this.pickNewWanderDirection()\r\n      this.wanderTimer = ZombieConfig.WANDER_CHANGE_INTERVAL\r\n    }\r\n    \r\n    // Move in wander direction\r\n    const movement = this.wanderDirection.clone().multiplyScalar(this._speed * 0.5 * deltaTime)\r\n    const newPosition = this._position.clone().add(movement)\r\n    \r\n    // Keep within spawn area\r\n    const distanceFromSpawn = newPosition.distanceTo(this.spawnPosition)\r\n    if (distanceFromSpawn <= this.wanderRadius) {\r\n      this._position.copy(newPosition)\r\n    } else {\r\n      // Turn back towards spawn\r\n      this.wanderDirection.copy(this.spawnPosition).sub(this._position).normalize()\r\n    }\r\n    \r\n    // Face movement direction\r\n    this.faceDirection(this.wanderDirection)\r\n  }\r\n\r\n  /**\r\n   * Update chasing behavior\r\n   * Requirements: 3.2\r\n   */\r\n  private updateChasing(deltaTime: number, playerPosition: THREE.Vector3): void {\r\n    // Calculate direction to player\r\n    const direction = new THREE.Vector3()\r\n      .subVectors(playerPosition, this._position)\r\n      .setY(0) // Keep on ground plane\r\n      .normalize()\r\n    \r\n    // Move towards player\r\n    const movement = direction.multiplyScalar(this._speed * deltaTime)\r\n    this._position.add(movement)\r\n    \r\n    // Face player\r\n    this.faceDirection(direction)\r\n  }\r\n\r\n  /**\r\n   * Update attacking behavior\r\n   * Requirements: 3.3\r\n   */\r\n  private updateAttacking(_deltaTime: number, playerPosition: THREE.Vector3): void {\r\n    // Face player\r\n    const direction = new THREE.Vector3()\r\n      .subVectors(playerPosition, this._position)\r\n      .setY(0)\r\n      .normalize()\r\n    this.faceDirection(direction)\r\n    \r\n    // Attack if cooldown is ready\r\n    if (this.attackCooldown <= 0) {\r\n      this.performAttack()\r\n      this.attackCooldown = ZombieConfig.ATTACK_COOLDOWN\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update dying state\r\n   * Requirements: 3.5\r\n   */\r\n  private updateDying(deltaTime: number): void {\r\n    this.deathTimer -= deltaTime\r\n  }\r\n\r\n  /**\r\n   * Face a direction\r\n   */\r\n  private faceDirection(direction: THREE.Vector3): void {\r\n    if (direction.lengthSq() > 0) {\r\n      this._rotation.y = Math.atan2(direction.x, direction.z)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update mesh position to match zombie position\r\n   */\r\n  private updateMeshPosition(): void {\r\n    if (this.mesh) {\r\n      this.mesh.position.copy(this._position)\r\n      this.mesh.rotation.copy(this._rotation)\r\n    }\r\n  }\r\n\r\n\r\n  // ==================== Combat ====================\r\n\r\n  /**\r\n   * Perform an attack\r\n   * Requirements: 3.3\r\n   */\r\n  private performAttack(): void {\r\n    this.emit(ZombieEvent.ATTACK, {\r\n      id: this._id,\r\n      damage: this._damage,\r\n      position: this.position,\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Apply damage to the zombie\r\n   * Requirements: 3.4, 3.5\r\n   * \r\n   * @param amount - Damage amount\r\n   * @param hitPoint - Optional hit location for effects\r\n   */\r\n  takeDamage(amount: number, hitPoint?: Vector3): void {\r\n    if (this._state === ZombieStateType.DYING) return\r\n    if (amount <= 0) return\r\n    \r\n    const previousHealth = this._health\r\n    this._health = Math.max(0, this._health - amount)\r\n    \r\n    this.emit(ZombieEvent.DAMAGE_TAKEN, {\r\n      id: this._id,\r\n      damage: amount,\r\n      previousHealth,\r\n      currentHealth: this._health,\r\n      hitPoint,\r\n    })\r\n    \r\n    // Check for death\r\n    if (this._health <= 0) {\r\n      this.die()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Trigger death state\r\n   * Requirements: 3.5\r\n   */\r\n  die(): void {\r\n    this.setState(ZombieStateType.DYING)\r\n  }\r\n\r\n  // ==================== State Queries ====================\r\n\r\n  /**\r\n   * Check if zombie should be removed (death animation complete)\r\n   */\r\n  shouldRemove(): boolean {\r\n    return this._state === ZombieStateType.DYING && this.deathTimer <= 0\r\n  }\r\n\r\n  /**\r\n   * Check if zombie is dead\r\n   */\r\n  isDead(): boolean {\r\n    return this._state === ZombieStateType.DYING || this._health <= 0\r\n  }\r\n\r\n  /**\r\n   * Check if zombie is aware of player (chasing or attacking)\r\n   */\r\n  isAwareOfPlayer(): boolean {\r\n    return this._state === ZombieStateType.CHASING || this._state === ZombieStateType.ATTACKING\r\n  }\r\n\r\n  /**\r\n   * Check if zombie can attack (cooldown ready and in attacking state)\r\n   */\r\n  canAttack(): boolean {\r\n    return this._state === ZombieStateType.ATTACKING && this.attackCooldown <= 0\r\n  }\r\n\r\n  /**\r\n   * Get the damage this zombie deals\r\n   */\r\n  getDamage(): number {\r\n    return this._damage\r\n  }\r\n\r\n  /**\r\n   * Get distance to a position\r\n   */\r\n  distanceTo(position: Vector3): number {\r\n    return this._position.distanceTo(new THREE.Vector3(position.x, position.y, position.z))\r\n  }\r\n\r\n  // ==================== Getters & Setters ====================\r\n\r\n  get id(): string {\r\n    return this._id\r\n  }\r\n\r\n  get position(): Vector3 {\r\n    return { x: this._position.x, y: this._position.y, z: this._position.z }\r\n  }\r\n\r\n  set position(pos: Vector3) {\r\n    this._position.set(pos.x, pos.y, pos.z)\r\n    this.updateMeshPosition()\r\n  }\r\n\r\n  get rotation(): { x: number; y: number; z: number } {\r\n    return { x: this._rotation.x, y: this._rotation.y, z: this._rotation.z }\r\n  }\r\n\r\n  get health(): number {\r\n    return this._health\r\n  }\r\n\r\n  get maxHealth(): number {\r\n    return this._maxHealth\r\n  }\r\n\r\n  get damage(): number {\r\n    return this._damage\r\n  }\r\n\r\n  get speed(): number {\r\n    return this._speed\r\n  }\r\n\r\n  get variant(): ZombieVariant {\r\n    return this._variant\r\n  }\r\n\r\n  get state(): ZombieStateType {\r\n    return this._state\r\n  }\r\n\r\n  /**\r\n   * Get position as THREE.Vector3\r\n   */\r\n  getPosition3(): THREE.Vector3 {\r\n    return this._position.clone()\r\n  }\r\n\r\n  /**\r\n   * Set the 3D mesh for this zombie\r\n   */\r\n  setMesh(mesh: THREE.Object3D): void {\r\n    this.mesh = mesh\r\n    this.updateMeshPosition()\r\n  }\r\n\r\n  /**\r\n   * Get the 3D mesh\r\n   */\r\n  getMesh(): THREE.Object3D | null {\r\n    return this.mesh\r\n  }\r\n\r\n  // ==================== Serialization ====================\r\n\r\n  /**\r\n   * Export zombie state for saving\r\n   */\r\n  toState(): { id: string; position: Vector3; health: number; variant: ZombieVariant; state: ZombieStateType } {\r\n    return {\r\n      id: this._id,\r\n      position: this.position,\r\n      health: this._health,\r\n      variant: this._variant,\r\n      state: this._state,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create zombie from saved state\r\n   */\r\n  static fromState(state: { id: string; position: Vector3; health: number; variant: ZombieVariant; state: ZombieStateType }): Zombie {\r\n    const zombie = new Zombie(state.id, state.position, state.variant)\r\n    zombie._health = state.health\r\n    zombie._state = state.state\r\n    return zombie\r\n  }\r\n\r\n  // ==================== Event System ====================\r\n\r\n  on(event: string, callback: EventCallback): void {\r\n    if (!this.eventListeners.has(event)) {\r\n      this.eventListeners.set(event, new Set())\r\n    }\r\n    this.eventListeners.get(event)!.add(callback)\r\n  }\r\n\r\n  off(event: string, callback: EventCallback): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.delete(callback)\r\n    }\r\n  }\r\n\r\n  private emit(event: string, data?: unknown): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.forEach((callback) => callback(data))\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Cleanup resources\r\n   */\r\n  dispose(): void {\r\n    this.eventListeners.clear()\r\n    if (this.mesh) {\r\n      // Remove from parent if attached\r\n      if (this.mesh.parent) {\r\n        this.mesh.parent.remove(this.mesh)\r\n      }\r\n      this.mesh = null\r\n    }\r\n  }\r\n}\r\n","import * as THREE from 'three'\r\nimport { ZombieVariant, ZombieStateType } from '../types'\r\n\r\n/**\r\n * Animation state for zombies\r\n */\r\nexport enum ZombieAnimation {\r\n  IDLE = 'idle',\r\n  WALK = 'walk',\r\n  RUN = 'run',\r\n  ATTACK = 'attack',\r\n  HIT = 'hit',\r\n  DEATH = 'death',\r\n}\r\n\r\n/**\r\n * Zombie visual configuration per variant\r\n */\r\ninterface ZombieVisualConfig {\r\n  bodyColor: number\r\n  skinColor: number\r\n  eyeColor: number\r\n  height: number\r\n  width: number\r\n  walkSpeed: number  // Animation speed multiplier\r\n}\r\n\r\n/**\r\n * Visual configs by variant\r\n */\r\nconst ZOMBIE_VISUAL_CONFIGS: Record<ZombieVariant, ZombieVisualConfig> = {\r\n  [ZombieVariant.WALKER]: {\r\n    bodyColor: 0x4a7c4e,\r\n    skinColor: 0x8b7355,\r\n    eyeColor: 0xff0000,\r\n    height: 1.8,\r\n    width: 0.5,\r\n    walkSpeed: 1.0,\r\n  },\r\n  [ZombieVariant.RUNNER]: {\r\n    bodyColor: 0x7c4a4a,\r\n    skinColor: 0x9b8365,\r\n    eyeColor: 0xff3300,\r\n    height: 1.7,\r\n    width: 0.4,\r\n    walkSpeed: 2.0,\r\n  },\r\n  [ZombieVariant.BRUTE]: {\r\n    bodyColor: 0x4a4a7c,\r\n    skinColor: 0x7b6345,\r\n    eyeColor: 0xff0066,\r\n    height: 2.2,\r\n    width: 0.8,\r\n    walkSpeed: 0.7,\r\n  },\r\n  [ZombieVariant.CRAWLER]: {\r\n    bodyColor: 0x7c7c4a,\r\n    skinColor: 0x6b5335,\r\n    eyeColor: 0xffff00,\r\n    height: 0.8,\r\n    width: 0.6,\r\n    walkSpeed: 1.5,\r\n  },\r\n}\r\n\r\n\r\n/**\r\n * ZombieVisuals - Handles zombie 3D models and animations\r\n * Requirements: 3.1\r\n */\r\nexport class ZombieVisuals {\r\n  private mesh: THREE.Group\r\n  private _variant: ZombieVariant\r\n  private config: ZombieVisualConfig\r\n  \r\n  // Animation state\r\n  private currentAnimation: ZombieAnimation = ZombieAnimation.IDLE\r\n  private animationTime: number = 0\r\n  private animationSpeed: number = 1.0\r\n  \r\n  // Body parts for animation\r\n  private body: THREE.Mesh | null = null\r\n  private head: THREE.Mesh | null = null\r\n  private leftArm: THREE.Group | null = null\r\n  private rightArm: THREE.Group | null = null\r\n  private leftLeg: THREE.Group | null = null\r\n  private rightLeg: THREE.Group | null = null\r\n  \r\n  // Death animation state\r\n  private deathProgress: number = 0\r\n  private isDeathComplete: boolean = false\r\n\r\n  constructor(variant: ZombieVariant) {\r\n    this._variant = variant\r\n    this.config = ZOMBIE_VISUAL_CONFIGS[variant]\r\n    this.mesh = this.createZombieMesh()\r\n  }\r\n\r\n  /**\r\n   * Get the zombie variant\r\n   */\r\n  get variant(): ZombieVariant {\r\n    return this._variant\r\n  }\r\n\r\n  /**\r\n   * Create the zombie 3D mesh with articulated parts\r\n   */\r\n  private createZombieMesh(): THREE.Group {\r\n    const group = new THREE.Group()\r\n    const { bodyColor, skinColor, eyeColor, height, width } = this.config\r\n    \r\n    // Materials\r\n    const bodyMaterial = new THREE.MeshStandardMaterial({ \r\n      color: bodyColor, \r\n      roughness: 0.8,\r\n      metalness: 0.1,\r\n    })\r\n    const skinMaterial = new THREE.MeshStandardMaterial({ \r\n      color: skinColor, \r\n      roughness: 0.7,\r\n      metalness: 0.0,\r\n    })\r\n    const eyeMaterial = new THREE.MeshBasicMaterial({ \r\n      color: eyeColor,\r\n    })\r\n    \r\n    // Torso\r\n    const torsoHeight = height * 0.35\r\n    const torsoGeometry = new THREE.CylinderGeometry(width * 0.45, width * 0.5, torsoHeight, 8)\r\n    this.body = new THREE.Mesh(torsoGeometry, bodyMaterial)\r\n    this.body.position.y = height * 0.5\r\n    this.body.castShadow = true\r\n    this.body.receiveShadow = true\r\n    group.add(this.body)\r\n    \r\n    // Head\r\n    const headRadius = width * 0.35\r\n    const headGeometry = new THREE.SphereGeometry(headRadius, 12, 12)\r\n    this.head = new THREE.Mesh(headGeometry, skinMaterial)\r\n    this.head.position.y = height * 0.75\r\n    this.head.castShadow = true\r\n    group.add(this.head)\r\n    \r\n    // Eyes\r\n    const eyeGeometry = new THREE.SphereGeometry(0.04, 6, 6)\r\n    const leftEye = new THREE.Mesh(eyeGeometry, eyeMaterial)\r\n    leftEye.position.set(-0.07, height * 0.78, headRadius * 0.8)\r\n    group.add(leftEye)\r\n    \r\n    const rightEye = new THREE.Mesh(eyeGeometry, eyeMaterial)\r\n    rightEye.position.set(0.07, height * 0.78, headRadius * 0.8)\r\n    group.add(rightEye)\r\n    \r\n    // Arms\r\n    this.leftArm = this.createArm(skinMaterial, height, width)\r\n    this.leftArm.position.set(-width * 0.55, height * 0.6, 0)\r\n    group.add(this.leftArm)\r\n    \r\n    this.rightArm = this.createArm(skinMaterial, height, width)\r\n    this.rightArm.position.set(width * 0.55, height * 0.6, 0)\r\n    group.add(this.rightArm)\r\n    \r\n    // Legs\r\n    this.leftLeg = this.createLeg(bodyMaterial, height, width)\r\n    this.leftLeg.position.set(-width * 0.2, height * 0.25, 0)\r\n    group.add(this.leftLeg)\r\n    \r\n    this.rightLeg = this.createLeg(bodyMaterial, height, width)\r\n    this.rightLeg.position.set(width * 0.2, height * 0.25, 0)\r\n    group.add(this.rightLeg)\r\n    \r\n    return group\r\n  }\r\n\r\n  /**\r\n   * Create an arm group\r\n   */\r\n  private createArm(material: THREE.Material, height: number, width: number): THREE.Group {\r\n    const arm = new THREE.Group()\r\n    \r\n    const armLength = height * 0.25\r\n    const armGeometry = new THREE.CylinderGeometry(width * 0.1, width * 0.08, armLength, 6)\r\n    const armMesh = new THREE.Mesh(armGeometry, material)\r\n    armMesh.position.y = -armLength / 2\r\n    armMesh.castShadow = true\r\n    arm.add(armMesh)\r\n    \r\n    // Hand\r\n    const handGeometry = new THREE.SphereGeometry(width * 0.1, 6, 6)\r\n    const hand = new THREE.Mesh(handGeometry, material)\r\n    hand.position.y = -armLength\r\n    hand.castShadow = true\r\n    arm.add(hand)\r\n    \r\n    return arm\r\n  }\r\n\r\n  /**\r\n   * Create a leg group\r\n   */\r\n  private createLeg(material: THREE.Material, height: number, width: number): THREE.Group {\r\n    const leg = new THREE.Group()\r\n    \r\n    const legLength = height * 0.3\r\n    const legGeometry = new THREE.CylinderGeometry(width * 0.12, width * 0.1, legLength, 6)\r\n    const legMesh = new THREE.Mesh(legGeometry, material)\r\n    legMesh.position.y = -legLength / 2\r\n    legMesh.castShadow = true\r\n    leg.add(legMesh)\r\n    \r\n    // Foot\r\n    const footGeometry = new THREE.BoxGeometry(width * 0.15, width * 0.08, width * 0.25)\r\n    const foot = new THREE.Mesh(footGeometry, material)\r\n    foot.position.set(0, -legLength, width * 0.05)\r\n    foot.castShadow = true\r\n    leg.add(foot)\r\n    \r\n    return leg\r\n  }\r\n\r\n\r\n  /**\r\n   * Update animation based on zombie state\r\n   */\r\n  update(deltaTime: number, state: ZombieStateType, speed: number): void {\r\n    this.animationTime += deltaTime * this.config.walkSpeed * this.animationSpeed\r\n    \r\n    // Determine animation from state\r\n    const newAnimation = this.getAnimationForState(state, speed)\r\n    if (newAnimation !== this.currentAnimation) {\r\n      this.currentAnimation = newAnimation\r\n      this.animationTime = 0\r\n    }\r\n    \r\n    // Apply animation\r\n    switch (this.currentAnimation) {\r\n      case ZombieAnimation.IDLE:\r\n        this.animateIdle()\r\n        break\r\n      case ZombieAnimation.WALK:\r\n        this.animateWalk()\r\n        break\r\n      case ZombieAnimation.RUN:\r\n        this.animateRun()\r\n        break\r\n      case ZombieAnimation.ATTACK:\r\n        this.animateAttack()\r\n        break\r\n      case ZombieAnimation.DEATH:\r\n        this.animateDeath(deltaTime)\r\n        break\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get animation type from zombie state\r\n   */\r\n  private getAnimationForState(state: ZombieStateType, speed: number): ZombieAnimation {\r\n    switch (state) {\r\n      case ZombieStateType.IDLE:\r\n        return ZombieAnimation.IDLE\r\n      case ZombieStateType.WANDERING:\r\n        return ZombieAnimation.WALK\r\n      case ZombieStateType.CHASING:\r\n        return speed > 3 ? ZombieAnimation.RUN : ZombieAnimation.WALK\r\n      case ZombieStateType.ATTACKING:\r\n        return ZombieAnimation.ATTACK\r\n      case ZombieStateType.DYING:\r\n        return ZombieAnimation.DEATH\r\n      default:\r\n        return ZombieAnimation.IDLE\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Idle animation - subtle breathing/swaying\r\n   */\r\n  private animateIdle(): void {\r\n    const sway = Math.sin(this.animationTime * 2) * 0.02\r\n    \r\n    if (this.body) {\r\n      this.body.rotation.z = sway\r\n    }\r\n    if (this.head) {\r\n      this.head.rotation.z = sway * 0.5\r\n      this.head.rotation.y = Math.sin(this.animationTime * 0.5) * 0.1\r\n    }\r\n    \r\n    // Reset limbs\r\n    this.resetLimbs()\r\n  }\r\n\r\n  /**\r\n   * Walking animation\r\n   */\r\n  private animateWalk(): void {\r\n    const walkCycle = this.animationTime * 4\r\n    const armSwing = Math.sin(walkCycle) * 0.5\r\n    const legSwing = Math.sin(walkCycle) * 0.4\r\n    \r\n    // Arms swing opposite to legs\r\n    if (this.leftArm) {\r\n      this.leftArm.rotation.x = armSwing\r\n      this.leftArm.rotation.z = 0.3 // Zombie arms forward\r\n    }\r\n    if (this.rightArm) {\r\n      this.rightArm.rotation.x = -armSwing\r\n      this.rightArm.rotation.z = -0.3\r\n    }\r\n    \r\n    // Legs\r\n    if (this.leftLeg) {\r\n      this.leftLeg.rotation.x = legSwing\r\n    }\r\n    if (this.rightLeg) {\r\n      this.rightLeg.rotation.x = -legSwing\r\n    }\r\n    \r\n    // Body bob\r\n    if (this.body) {\r\n      this.body.position.y = this.config.height * 0.5 + Math.abs(Math.sin(walkCycle * 2)) * 0.02\r\n    }\r\n    \r\n    // Head sway\r\n    if (this.head) {\r\n      this.head.rotation.z = Math.sin(walkCycle) * 0.05\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Running animation - faster and more exaggerated\r\n   */\r\n  private animateRun(): void {\r\n    const runCycle = this.animationTime * 8\r\n    const armSwing = Math.sin(runCycle) * 0.8\r\n    const legSwing = Math.sin(runCycle) * 0.6\r\n    \r\n    if (this.leftArm) {\r\n      this.leftArm.rotation.x = armSwing\r\n      this.leftArm.rotation.z = 0.4\r\n    }\r\n    if (this.rightArm) {\r\n      this.rightArm.rotation.x = -armSwing\r\n      this.rightArm.rotation.z = -0.4\r\n    }\r\n    \r\n    if (this.leftLeg) {\r\n      this.leftLeg.rotation.x = legSwing\r\n    }\r\n    if (this.rightLeg) {\r\n      this.rightLeg.rotation.x = -legSwing\r\n    }\r\n    \r\n    // More pronounced body movement\r\n    if (this.body) {\r\n      this.body.position.y = this.config.height * 0.5 + Math.abs(Math.sin(runCycle * 2)) * 0.04\r\n      this.body.rotation.x = 0.1 // Lean forward\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Attack animation\r\n   */\r\n  private animateAttack(): void {\r\n    const attackPhase = (this.animationTime % 1.5) / 1.5 // 1.5 second attack cycle\r\n    \r\n    if (attackPhase < 0.3) {\r\n      // Wind up\r\n      const windUp = attackPhase / 0.3\r\n      if (this.leftArm) this.leftArm.rotation.x = -windUp * 1.5\r\n      if (this.rightArm) this.rightArm.rotation.x = -windUp * 1.5\r\n    } else if (attackPhase < 0.5) {\r\n      // Strike\r\n      const strike = (attackPhase - 0.3) / 0.2\r\n      if (this.leftArm) this.leftArm.rotation.x = -1.5 + strike * 2.5\r\n      if (this.rightArm) this.rightArm.rotation.x = -1.5 + strike * 2.5\r\n    } else {\r\n      // Recovery\r\n      const recovery = (attackPhase - 0.5) / 0.5\r\n      if (this.leftArm) this.leftArm.rotation.x = 1.0 - recovery * 1.0\r\n      if (this.rightArm) this.rightArm.rotation.x = 1.0 - recovery * 1.0\r\n    }\r\n    \r\n    // Body lunge\r\n    if (this.body && attackPhase < 0.5) {\r\n      this.body.rotation.x = Math.sin(attackPhase * Math.PI * 2) * 0.2\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Death animation\r\n   */\r\n  private animateDeath(deltaTime: number): void {\r\n    if (this.isDeathComplete) return\r\n    \r\n    this.deathProgress += deltaTime * 0.5 // 2 seconds to fall\r\n    \r\n    if (this.deathProgress >= 1) {\r\n      this.deathProgress = 1\r\n      this.isDeathComplete = true\r\n    }\r\n    \r\n    // Fall backwards\r\n    this.mesh.rotation.x = this.deathProgress * (Math.PI / 2)\r\n    \r\n    // Sink into ground slightly\r\n    this.mesh.position.y = -this.deathProgress * 0.3\r\n    \r\n    // Arms flail\r\n    if (this.leftArm) {\r\n      this.leftArm.rotation.x = -this.deathProgress * 1.5\r\n      this.leftArm.rotation.z = this.deathProgress * 0.5\r\n    }\r\n    if (this.rightArm) {\r\n      this.rightArm.rotation.x = -this.deathProgress * 1.5\r\n      this.rightArm.rotation.z = -this.deathProgress * 0.5\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Reset limbs to default position\r\n   */\r\n  private resetLimbs(): void {\r\n    if (this.leftArm) {\r\n      this.leftArm.rotation.x = 0.3\r\n      this.leftArm.rotation.z = 0.2\r\n    }\r\n    if (this.rightArm) {\r\n      this.rightArm.rotation.x = 0.3\r\n      this.rightArm.rotation.z = -0.2\r\n    }\r\n    if (this.leftLeg) {\r\n      this.leftLeg.rotation.x = 0\r\n    }\r\n    if (this.rightLeg) {\r\n      this.rightLeg.rotation.x = 0\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Play hit reaction\r\n   */\r\n  playHitReaction(): void {\r\n    // Flash red briefly\r\n    if (this.body) {\r\n      const material = this.body.material as THREE.MeshStandardMaterial\r\n      const originalColor = material.color.getHex()\r\n      material.color.setHex(0xff0000)\r\n      \r\n      setTimeout(() => {\r\n        material.color.setHex(originalColor)\r\n      }, 100)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the mesh group\r\n   */\r\n  getMesh(): THREE.Group {\r\n    return this.mesh\r\n  }\r\n\r\n  /**\r\n   * Check if death animation is complete\r\n   */\r\n  isDeathAnimationComplete(): boolean {\r\n    return this.isDeathComplete\r\n  }\r\n\r\n  /**\r\n   * Set animation speed multiplier\r\n   */\r\n  setAnimationSpeed(speed: number): void {\r\n    this.animationSpeed = speed\r\n  }\r\n\r\n  /**\r\n   * Cleanup resources\r\n   */\r\n  dispose(): void {\r\n    this.mesh.traverse((child) => {\r\n      if (child instanceof THREE.Mesh) {\r\n        child.geometry.dispose()\r\n        if (Array.isArray(child.material)) {\r\n          child.material.forEach((m) => m.dispose())\r\n        } else {\r\n          child.material.dispose()\r\n        }\r\n      }\r\n    })\r\n  }\r\n}\r\n","import * as THREE from 'three'\r\nimport type { Vector3, EventCallback, ZombieState } from '../types'\r\nimport { ZombieVariant, GameEvent } from '../types'\r\nimport { Zombie, ZombieEvent } from './Zombie'\r\nimport { ZombieVisuals } from './ZombieVisuals'\r\n\r\n/**\r\n * ZombieManager - Manages all zombie entities in the game\r\n * Handles spawning, updating, and removing zombies\r\n * Requirements: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6\r\n */\r\nexport class ZombieManager {\r\n  // Active zombies\r\n  private zombies: Map<string, Zombie> = new Map()\r\n  \r\n  // Zombie visuals for animations\r\n  private zombieVisuals: Map<string, ZombieVisuals> = new Map()\r\n  \r\n  // Scene reference for adding/removing meshes\r\n  private scene: THREE.Scene\r\n  \r\n  // Zombie ID counter\r\n  private nextZombieId: number = 0\r\n  \r\n  // Event listeners\r\n  private eventListeners: Map<string, Set<EventCallback>> = new Map()\r\n  \r\n  // Statistics\r\n  private totalKilled: number = 0\r\n\r\n  constructor(scene: THREE.Scene) {\r\n    this.scene = scene\r\n  }\r\n\r\n  /**\r\n   * Spawn a new zombie at the given position\r\n   * Requirements: 3.1\r\n   * \r\n   * @param position - Spawn position\r\n   * @param variant - Zombie variant (random if not specified)\r\n   * @returns The spawned zombie\r\n   */\r\n  spawnZombie(position: Vector3, variant?: ZombieVariant): Zombie {\r\n    const id = `zombie_${this.nextZombieId++}`\r\n    const zombieVariant = variant ?? this.getRandomVariant()\r\n    \r\n    const zombie = new Zombie(id, position, zombieVariant)\r\n    \r\n    // Setup event listeners\r\n    this.setupZombieEvents(zombie)\r\n    \r\n    // Create visuals and attach mesh\r\n    const visuals = new ZombieVisuals(zombieVariant)\r\n    const mesh = visuals.getMesh()\r\n    zombie.setMesh(mesh)\r\n    this.scene.add(mesh)\r\n    \r\n    // Store visuals for animation updates\r\n    this.zombieVisuals.set(id, visuals)\r\n    \r\n    // Add to collection\r\n    this.zombies.set(id, zombie)\r\n    \r\n    // Emit spawn event\r\n    this.emit(GameEvent.ZOMBIE_SPAWN, { zombie: zombie.toState() })\r\n    \r\n    return zombie\r\n  }\r\n\r\n\r\n  /**\r\n   * Spawn multiple zombies at random positions around spawn points\r\n   * \r\n   * @param count - Number of zombies to spawn\r\n   * @param spawnPoints - Array of spawn point positions\r\n   * @param radius - Spawn radius around each point\r\n   */\r\n  spawnWave(count: number, spawnPoints: Vector3[], radius: number = 5): Zombie[] {\r\n    const spawned: Zombie[] = []\r\n    \r\n    for (let i = 0; i < count; i++) {\r\n      // Pick random spawn point\r\n      const spawnPoint = spawnPoints[Math.floor(Math.random() * spawnPoints.length)]\r\n      \r\n      // Add random offset within radius\r\n      const angle = Math.random() * Math.PI * 2\r\n      const distance = Math.random() * radius\r\n      const position: Vector3 = {\r\n        x: spawnPoint.x + Math.cos(angle) * distance,\r\n        y: spawnPoint.y,\r\n        z: spawnPoint.z + Math.sin(angle) * distance,\r\n      }\r\n      \r\n      const zombie = this.spawnZombie(position)\r\n      spawned.push(zombie)\r\n    }\r\n    \r\n    return spawned\r\n  }\r\n\r\n  /**\r\n   * Get a random zombie variant with weighted distribution\r\n   * Requirements: 3.1\r\n   */\r\n  private getRandomVariant(): ZombieVariant {\r\n    const roll = Math.random()\r\n    \r\n    // Weighted distribution: Walker 50%, Runner 25%, Crawler 15%, Brute 10%\r\n    if (roll < 0.5) return ZombieVariant.WALKER\r\n    if (roll < 0.75) return ZombieVariant.RUNNER\r\n    if (roll < 0.9) return ZombieVariant.CRAWLER\r\n    return ZombieVariant.BRUTE\r\n  }\r\n\r\n  /**\r\n   * Create zombie visuals with animated mesh\r\n   * Requirements: 3.1\r\n   */\r\n  private createZombieVisuals(variant: ZombieVariant): ZombieVisuals {\r\n    return new ZombieVisuals(variant)\r\n  }\r\n\r\n  /**\r\n   * Setup event listeners for a zombie\r\n   */\r\n  private setupZombieEvents(zombie: Zombie): void {\r\n    zombie.on(ZombieEvent.DEATH, (data) => {\r\n      this.totalKilled++\r\n      this.emit(GameEvent.ZOMBIE_DEATH, data)\r\n    })\r\n    \r\n    zombie.on(ZombieEvent.ATTACK, (data) => {\r\n      this.emit(ZombieEvent.ATTACK, data)\r\n    })\r\n  }\r\n\r\n\r\n  // Cached vector for performance\r\n  private _cachedPlayerPos: THREE.Vector3 = new THREE.Vector3()\r\n\r\n  /**\r\n   * Update all zombies\r\n   * \r\n   * @param deltaTime - Time elapsed since last frame\r\n   * @param playerPosition - Current player position\r\n   */\r\n  update(deltaTime: number, playerPosition: Vector3): void {\r\n    // Reuse cached vector to avoid allocations\r\n    this._cachedPlayerPos.set(playerPosition.x, playerPosition.y, playerPosition.z)\r\n    const toRemove: string[] = []\r\n    \r\n    for (const [id, zombie] of this.zombies) {\r\n      try {\r\n        zombie.update(deltaTime, this._cachedPlayerPos)\r\n        \r\n        // Update visuals/animations\r\n        const visuals = this.zombieVisuals.get(id)\r\n        if (visuals) {\r\n          visuals.update(deltaTime, zombie.state, zombie.speed)\r\n        }\r\n        \r\n        // Mark for removal if death animation complete\r\n        if (zombie.shouldRemove()) {\r\n          toRemove.push(id)\r\n        }\r\n      } catch (error) {\r\n        console.error(`Error updating zombie ${id}:`, error)\r\n        toRemove.push(id) // Remove problematic zombie\r\n      }\r\n    }\r\n    \r\n    // Remove dead zombies\r\n    for (const id of toRemove) {\r\n      this.removeZombie(id)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove a zombie by ID\r\n   */\r\n  removeZombie(id: string): void {\r\n    const zombie = this.zombies.get(id)\r\n    if (zombie) {\r\n      // Remove mesh from scene\r\n      const mesh = zombie.getMesh()\r\n      if (mesh) {\r\n        this.scene.remove(mesh)\r\n      }\r\n      \r\n      // Cleanup visuals\r\n      const visuals = this.zombieVisuals.get(id)\r\n      if (visuals) {\r\n        visuals.dispose()\r\n        this.zombieVisuals.delete(id)\r\n      }\r\n      \r\n      // Cleanup and remove\r\n      zombie.dispose()\r\n      this.zombies.delete(id)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply damage to a zombie\r\n   * \r\n   * @param id - Zombie ID\r\n   * @param damage - Damage amount\r\n   * @param hitPoint - Optional hit location\r\n   */\r\n  damageZombie(id: string, damage: number, hitPoint?: Vector3): void {\r\n    const zombie = this.zombies.get(id)\r\n    if (zombie) {\r\n      zombie.takeDamage(damage, hitPoint)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get zombie by ID\r\n   */\r\n  getZombie(id: string): Zombie | undefined {\r\n    return this.zombies.get(id)\r\n  }\r\n\r\n  /**\r\n   * Get all active zombies\r\n   */\r\n  getAllZombies(): Zombie[] {\r\n    return Array.from(this.zombies.values())\r\n  }\r\n\r\n  /**\r\n   * Get zombies within range of a position\r\n   */\r\n  getZombiesInRange(position: Vector3, range: number): Zombie[] {\r\n    return this.getAllZombies().filter((zombie) => {\r\n      return zombie.distanceTo(position) <= range && !zombie.isDead()\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Get the closest zombie to a position\r\n   */\r\n  getClosestZombie(position: Vector3): Zombie | null {\r\n    let closest: Zombie | null = null\r\n    let closestDistance = Infinity\r\n    \r\n    for (const zombie of this.zombies.values()) {\r\n      if (zombie.isDead()) continue\r\n      \r\n      const distance = zombie.distanceTo(position)\r\n      if (distance < closestDistance) {\r\n        closestDistance = distance\r\n        closest = zombie\r\n      }\r\n    }\r\n    \r\n    return closest\r\n  }\r\n\r\n  /**\r\n   * Perform raycast hit detection against zombies\r\n   * \r\n   * @param raycaster - Three.js raycaster\r\n   * @returns Hit zombie and intersection point, or null\r\n   */\r\n  raycastZombies(raycaster: THREE.Raycaster): { zombie: Zombie; point: Vector3 } | null {\r\n    const meshes: THREE.Object3D[] = []\r\n    const meshToZombie: Map<THREE.Object3D, Zombie> = new Map()\r\n    \r\n    for (const zombie of this.zombies.values()) {\r\n      if (zombie.isDead()) continue\r\n      \r\n      const mesh = zombie.getMesh()\r\n      if (mesh) {\r\n        meshes.push(mesh)\r\n        meshToZombie.set(mesh, zombie)\r\n      }\r\n    }\r\n    \r\n    const intersects = raycaster.intersectObjects(meshes, true)\r\n    \r\n    if (intersects.length > 0) {\r\n      // Find the root mesh (zombie group)\r\n      let hitObject = intersects[0].object\r\n      while (hitObject.parent && !meshToZombie.has(hitObject)) {\r\n        hitObject = hitObject.parent\r\n      }\r\n      \r\n      const zombie = meshToZombie.get(hitObject)\r\n      if (zombie) {\r\n        const point = intersects[0].point\r\n        return {\r\n          zombie,\r\n          point: { x: point.x, y: point.y, z: point.z },\r\n        }\r\n      }\r\n    }\r\n    \r\n    return null\r\n  }\r\n\r\n  // ==================== Statistics ====================\r\n\r\n  /**\r\n   * Get count of active (alive) zombies\r\n   */\r\n  getActiveCount(): number {\r\n    let count = 0\r\n    for (const zombie of this.zombies.values()) {\r\n      if (!zombie.isDead()) count++\r\n    }\r\n    return count\r\n  }\r\n\r\n  /**\r\n   * Get total zombie count (including dying)\r\n   */\r\n  getTotalCount(): number {\r\n    return this.zombies.size\r\n  }\r\n\r\n  /**\r\n   * Get total zombies killed\r\n   */\r\n  getTotalKilled(): number {\r\n    return this.totalKilled\r\n  }\r\n\r\n  /**\r\n   * Reset kill counter\r\n   */\r\n  resetKillCount(): void {\r\n    this.totalKilled = 0\r\n  }\r\n\r\n  // ==================== Serialization ====================\r\n\r\n  /**\r\n   * Export all zombie states for saving\r\n   */\r\n  toState(): ZombieState[] {\r\n    return this.getAllZombies().map((zombie) => zombie.toState())\r\n  }\r\n\r\n  /**\r\n   * Restore zombies from saved state\r\n   */\r\n  fromState(states: ZombieState[]): void {\r\n    // Clear existing zombies\r\n    this.clear()\r\n    \r\n    // Recreate zombies from state\r\n    for (const state of states) {\r\n      const zombie = Zombie.fromState(state)\r\n      \r\n      // Setup events\r\n      this.setupZombieEvents(zombie)\r\n      \r\n      // Create visuals and mesh\r\n      const visuals = this.createZombieVisuals(zombie.variant)\r\n      const mesh = visuals.getMesh()\r\n      zombie.setMesh(mesh)\r\n      this.scene.add(mesh)\r\n      \r\n      // Store visuals\r\n      this.zombieVisuals.set(zombie.id, visuals)\r\n      \r\n      // Add to collection\r\n      this.zombies.set(zombie.id, zombie)\r\n      \r\n      // Update next ID counter\r\n      const idNum = parseInt(zombie.id.replace('zombie_', ''), 10)\r\n      if (!isNaN(idNum) && idNum >= this.nextZombieId) {\r\n        this.nextZombieId = idNum + 1\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear all zombies\r\n   */\r\n  clear(): void {\r\n    for (const [id, zombie] of this.zombies) {\r\n      const mesh = zombie.getMesh()\r\n      if (mesh) {\r\n        this.scene.remove(mesh)\r\n      }\r\n      \r\n      // Cleanup visuals\r\n      const visuals = this.zombieVisuals.get(id)\r\n      if (visuals) {\r\n        visuals.dispose()\r\n      }\r\n      \r\n      zombie.dispose()\r\n    }\r\n    this.zombies.clear()\r\n    this.zombieVisuals.clear()\r\n  }\r\n\r\n  // ==================== Event System ====================\r\n\r\n  on(event: string, callback: EventCallback): void {\r\n    if (!this.eventListeners.has(event)) {\r\n      this.eventListeners.set(event, new Set())\r\n    }\r\n    this.eventListeners.get(event)!.add(callback)\r\n  }\r\n\r\n  off(event: string, callback: EventCallback): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.delete(callback)\r\n    }\r\n  }\r\n\r\n  private emit(event: string, data?: unknown): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.forEach((callback) => callback(data))\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Cleanup all resources\r\n   */\r\n  dispose(): void {\r\n    this.clear()\r\n    this.eventListeners.clear()\r\n  }\r\n}\r\n","import type { EventCallback } from '../types'\r\n\r\n/**\r\n * Game over reason enumeration\r\n */\r\nexport enum GameOverReason {\r\n  PLAYER_DEATH = 'playerDeath',\r\n  QUIT = 'quit',\r\n  TIMEOUT = 'timeout',\r\n}\r\n\r\n/**\r\n * Game over statistics\r\n */\r\nexport interface GameOverStats {\r\n  finalScore: number\r\n  waveReached: number\r\n  totalZombiesKilled: number\r\n  playTime: number\r\n  reason: GameOverReason\r\n}\r\n\r\n/**\r\n * Final score display data for UI rendering\r\n * Requirements: 4.5\r\n */\r\nexport interface FinalScoreDisplay {\r\n  score: string\r\n  waveReached: number\r\n  zombiesKilled: number\r\n  playTime: string\r\n  message: string\r\n  isHighScore: boolean\r\n}\r\n\r\n/**\r\n * Game over events\r\n */\r\nexport enum GameOverEvent {\r\n  GAME_OVER = 'gameOver:triggered',\r\n  STATS_READY = 'gameOver:statsReady',\r\n  RESTART = 'gameOver:restart',\r\n  SCORE_DISPLAY_READY = 'gameOver:scoreDisplayReady',\r\n}\r\n\r\n/**\r\n * GameOverManager - Handles game over state and final score display\r\n * Requirements: 4.5\r\n */\r\nexport class GameOverManager {\r\n  private _isGameOver: boolean = false\r\n  private _stats: GameOverStats | null = null\r\n  private _highScore: number = 0\r\n  private eventListeners: Map<string, Set<EventCallback>> = new Map()\r\n\r\n  /**\r\n   * Check if game is over\r\n   */\r\n  get isGameOver(): boolean {\r\n    return this._isGameOver\r\n  }\r\n\r\n  /**\r\n   * Get game over statistics\r\n   */\r\n  get stats(): GameOverStats | null {\r\n    return this._stats\r\n  }\r\n\r\n  /**\r\n   * Get the final score\r\n   * Requirements: 4.5\r\n   */\r\n  get finalScore(): number {\r\n    return this._stats?.finalScore ?? 0\r\n  }\r\n\r\n  /**\r\n   * Get the wave reached\r\n   */\r\n  get waveReached(): number {\r\n    return this._stats?.waveReached ?? 0\r\n  }\r\n\r\n  /**\r\n   * Get total zombies killed\r\n   */\r\n  get totalZombiesKilled(): number {\r\n    return this._stats?.totalZombiesKilled ?? 0\r\n  }\r\n\r\n  /**\r\n   * Set high score for comparison\r\n   */\r\n  setHighScore(score: number): void {\r\n    this._highScore = score\r\n  }\r\n\r\n  /**\r\n   * Check if current score is a high score\r\n   */\r\n  isNewHighScore(): boolean {\r\n    if (!this._stats) return false\r\n    return this._stats.finalScore > this._highScore\r\n  }\r\n\r\n  /**\r\n   * Trigger game over\r\n   * Requirements: 4.5\r\n   * \r\n   * @param reason - Why the game ended\r\n   * @param finalScore - Final score achieved\r\n   * @param waveReached - Highest wave reached\r\n   * @param totalZombiesKilled - Total zombies killed\r\n   * @param playTime - Total play time in seconds\r\n   */\r\n  triggerGameOver(\r\n    reason: GameOverReason,\r\n    finalScore: number,\r\n    waveReached: number,\r\n    totalZombiesKilled: number,\r\n    playTime: number\r\n  ): void {\r\n    if (this._isGameOver) return\r\n\r\n    this._isGameOver = true\r\n    this._stats = {\r\n      finalScore,\r\n      waveReached,\r\n      totalZombiesKilled,\r\n      playTime,\r\n      reason,\r\n    }\r\n\r\n    this.emit(GameOverEvent.GAME_OVER, this._stats)\r\n    this.emit(GameOverEvent.STATS_READY, this._stats)\r\n    \r\n    // Emit score display ready event with formatted data\r\n    const displayData = this.getFinalScoreDisplay()\r\n    this.emit(GameOverEvent.SCORE_DISPLAY_READY, displayData)\r\n  }\r\n\r\n  /**\r\n   * Check if player should trigger game over\r\n   * Requirements: 4.5\r\n   * \r\n   * @param playerHealth - Current player health\r\n   * @returns true if game should end\r\n   */\r\n  shouldTriggerGameOver(playerHealth: number): boolean {\r\n    return playerHealth <= 0 && !this._isGameOver\r\n  }\r\n\r\n  /**\r\n   * Get formatted final score string\r\n   * Requirements: 4.5\r\n   */\r\n  getFormattedScore(): string {\r\n    if (!this._stats) return '0'\r\n    return this._stats.finalScore.toLocaleString()\r\n  }\r\n\r\n  /**\r\n   * Get formatted play time string (MM:SS)\r\n   */\r\n  getFormattedPlayTime(): string {\r\n    if (!this._stats) return '00:00'\r\n    \r\n    const totalSeconds = Math.floor(this._stats.playTime)\r\n    const minutes = Math.floor(totalSeconds / 60)\r\n    const seconds = totalSeconds % 60\r\n    \r\n    return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`\r\n  }\r\n\r\n  /**\r\n   * Get formatted play time string with hours (HH:MM:SS)\r\n   */\r\n  getFormattedPlayTimeLong(): string {\r\n    if (!this._stats) return '00:00:00'\r\n    \r\n    const totalSeconds = Math.floor(this._stats.playTime)\r\n    const hours = Math.floor(totalSeconds / 3600)\r\n    const minutes = Math.floor((totalSeconds % 3600) / 60)\r\n    const seconds = totalSeconds % 60\r\n    \r\n    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`\r\n  }\r\n\r\n  /**\r\n   * Get game over message based on reason\r\n   * Requirements: 4.5\r\n   */\r\n  getGameOverMessage(): string {\r\n    if (!this._stats) return 'Game Over'\r\n    \r\n    switch (this._stats.reason) {\r\n      case GameOverReason.PLAYER_DEATH:\r\n        return 'You have been overwhelmed by the zombie horde!'\r\n      case GameOverReason.QUIT:\r\n        return 'You abandoned the fight...'\r\n      case GameOverReason.TIMEOUT:\r\n        return 'Time has run out!'\r\n      default:\r\n        return 'Game Over'\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get complete final score display data for UI\r\n   * Requirements: 4.5\r\n   */\r\n  getFinalScoreDisplay(): FinalScoreDisplay {\r\n    return {\r\n      score: this.getFormattedScore(),\r\n      waveReached: this._stats?.waveReached ?? 0,\r\n      zombiesKilled: this._stats?.totalZombiesKilled ?? 0,\r\n      playTime: this.getFormattedPlayTime(),\r\n      message: this.getGameOverMessage(),\r\n      isHighScore: this.isNewHighScore(),\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get summary text for the game over screen\r\n   * Requirements: 4.5\r\n   */\r\n  getSummaryText(): string {\r\n    if (!this._stats) return 'No game data available'\r\n    \r\n    const lines = [\r\n      `Final Score: ${this.getFormattedScore()}`,\r\n      `Wave Reached: ${this._stats.waveReached}`,\r\n      `Zombies Killed: ${this._stats.totalZombiesKilled}`,\r\n      `Time Survived: ${this.getFormattedPlayTime()}`,\r\n    ]\r\n    \r\n    if (this.isNewHighScore()) {\r\n      lines.unshift(' NEW HIGH SCORE! ')\r\n    }\r\n    \r\n    return lines.join('\\n')\r\n  }\r\n\r\n  /**\r\n   * Request restart\r\n   */\r\n  requestRestart(): void {\r\n    this.emit(GameOverEvent.RESTART, {})\r\n  }\r\n\r\n  /**\r\n   * Reset the game over state\r\n   */\r\n  reset(): void {\r\n    this._isGameOver = false\r\n    this._stats = null\r\n  }\r\n\r\n  // ==================== Event System ====================\r\n\r\n  on(event: string, callback: EventCallback): void {\r\n    if (!this.eventListeners.has(event)) {\r\n      this.eventListeners.set(event, new Set())\r\n    }\r\n    this.eventListeners.get(event)!.add(callback)\r\n  }\r\n\r\n  off(event: string, callback: EventCallback): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.delete(callback)\r\n    }\r\n  }\r\n\r\n  private emit(event: string, data?: unknown): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.forEach((callback) => callback(data))\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Cleanup resources\r\n   */\r\n  dispose(): void {\r\n    this.eventListeners.clear()\r\n    this._stats = null\r\n  }\r\n}\r\n","import type { Vector3, EventCallback, WaveState } from '../types'\r\nimport { GameEvent, ZombieVariant } from '../types'\r\nimport type { ZombieManager } from '../zombies/ZombieManager'\r\nimport type { Player } from '../Player'\r\nimport { GameOverManager, GameOverReason } from './GameOverManager'\r\n\r\n/**\r\n * Wave configuration constants\r\n */\r\nexport const WaveConfig = {\r\n  // Spawn formula: wave * 5 + 10\r\n  BASE_ZOMBIES: 10,\r\n  ZOMBIES_PER_WAVE: 5,\r\n  \r\n  // Preparation phase duration in seconds\r\n  PREPARATION_TIME: 30,\r\n  \r\n  // Score formula: zombies * 100 * wave\r\n  SCORE_PER_KILL: 100,\r\n  \r\n  // Wave completion bonus multiplier\r\n  WAVE_COMPLETION_BONUS: 500,\r\n  \r\n  // Spawn settings\r\n  SPAWN_INTERVAL: 0.5,  // Seconds between spawns\r\n  MIN_SPAWN_DISTANCE: 20,  // Minimum distance from player\r\n  MAX_SPAWN_DISTANCE: 40,  // Maximum distance from player\r\n}\r\n\r\n/**\r\n * Wave events\r\n */\r\nexport enum WaveEvent {\r\n  WAVE_START = 'wave:start',\r\n  WAVE_END = 'wave:end',\r\n  PREPARATION_START = 'wave:preparationStart',\r\n  PREPARATION_END = 'wave:preparationEnd',\r\n  ZOMBIE_KILLED = 'wave:zombieKilled',\r\n  SCORE_CHANGED = 'wave:scoreChanged',\r\n  GAME_OVER = 'wave:gameOver',\r\n}\r\n\r\n/**\r\n * WaveManager - Manages wave-based survival gameplay\r\n * Handles zombie spawning, wave progression, scoring, and game over logic\r\n * Requirements: 4.1, 4.2, 4.3, 4.4, 4.5\r\n */\r\nexport class WaveManager {\r\n  // Wave state\r\n  private _currentWave: number = 0\r\n  private _zombiesKilled: number = 0\r\n  private _totalZombiesInWave: number = 0\r\n  private _zombiesSpawned: number = 0\r\n  private _isPreparationPhase: boolean = true\r\n  private _preparationTimeLeft: number = WaveConfig.PREPARATION_TIME\r\n  \r\n  // Score\r\n  private _score: number = 0\r\n  private _waveScore: number = 0\r\n  \r\n  // Game state\r\n  private _isGameOver: boolean = false\r\n  private _gameOverReason: GameOverReason | null = null\r\n  private _finalScore: number = 0\r\n  \r\n  // Spawning\r\n  private spawnTimer: number = 0\r\n  private spawnPoints: Vector3[] = []\r\n  \r\n  // References\r\n  private zombieManager: ZombieManager | null = null\r\n  private player: Player | null = null\r\n  private gameOverManager: GameOverManager\r\n  \r\n  // Play time tracking\r\n  private _playTime: number = 0\r\n  \r\n  // Event listeners\r\n  private eventListeners: Map<string, Set<EventCallback>> = new Map()\r\n\r\n  constructor() {\r\n    // Initialize with default spawn points (can be overridden)\r\n    this.spawnPoints = this.generateDefaultSpawnPoints()\r\n    // Initialize game over manager\r\n    this.gameOverManager = new GameOverManager()\r\n  }\r\n\r\n  /**\r\n   * Initialize the wave manager with required references\r\n   */\r\n  init(zombieManager: ZombieManager, player: Player): void {\r\n    this.zombieManager = zombieManager\r\n    this.player = player\r\n    \r\n    // Listen for zombie deaths\r\n    this.zombieManager.on(GameEvent.ZOMBIE_DEATH, () => {\r\n      this.onZombieKilled()\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Get the game over manager instance\r\n   */\r\n  getGameOverManager(): GameOverManager {\r\n    return this.gameOverManager\r\n  }\r\n\r\n\r\n  /**\r\n   * Generate default spawn points around the origin\r\n   */\r\n  private generateDefaultSpawnPoints(): Vector3[] {\r\n    const points: Vector3[] = []\r\n    const numPoints = 8\r\n    const radius = 30\r\n    \r\n    for (let i = 0; i < numPoints; i++) {\r\n      const angle = (i / numPoints) * Math.PI * 2\r\n      points.push({\r\n        x: Math.cos(angle) * radius,\r\n        y: 0,\r\n        z: Math.sin(angle) * radius,\r\n      })\r\n    }\r\n    \r\n    return points\r\n  }\r\n\r\n  /**\r\n   * Set custom spawn points\r\n   */\r\n  setSpawnPoints(points: Vector3[]): void {\r\n    this.spawnPoints = points\r\n  }\r\n\r\n  // ==================== Wave Control ====================\r\n\r\n  /**\r\n   * Start the game (begins with preparation phase for wave 1)\r\n   */\r\n  startGame(): void {\r\n    this._currentWave = 0\r\n    this._score = 0\r\n    this._isGameOver = false\r\n    this._gameOverReason = null\r\n    this._playTime = 0\r\n    \r\n    // Reset game over manager\r\n    this.gameOverManager.reset()\r\n    \r\n    // Start preparation for wave 1\r\n    this.startPreparationPhase()\r\n  }\r\n\r\n  /**\r\n   * Start preparation phase before a wave\r\n   * Requirements: 4.2, 4.3\r\n   */\r\n  startPreparationPhase(): void {\r\n    this._currentWave++\r\n    this._isPreparationPhase = true\r\n    this._preparationTimeLeft = WaveConfig.PREPARATION_TIME\r\n    this._zombiesKilled = 0\r\n    this._zombiesSpawned = 0\r\n    this._waveScore = 0\r\n    this._totalZombiesInWave = this.calculateZombieCount(this._currentWave)\r\n    \r\n    this.emit(WaveEvent.PREPARATION_START, {\r\n      wave: this._currentWave,\r\n      preparationTime: WaveConfig.PREPARATION_TIME,\r\n      totalZombies: this._totalZombiesInWave,\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Start the current wave (spawn zombies)\r\n   * Requirements: 4.1\r\n   */\r\n  startWave(): void {\r\n    this._isPreparationPhase = false\r\n    this.spawnTimer = 0\r\n    \r\n    this.emit(WaveEvent.WAVE_START, {\r\n      wave: this._currentWave,\r\n      totalZombies: this._totalZombiesInWave,\r\n    })\r\n    this.emit(GameEvent.WAVE_START, {\r\n      wave: this._currentWave,\r\n      totalZombies: this._totalZombiesInWave,\r\n    })\r\n  }\r\n\r\n  /**\r\n   * End the current wave\r\n   * Requirements: 4.2\r\n   */\r\n  endWave(): void {\r\n    // Calculate wave completion bonus\r\n    const waveBonus = this._currentWave * WaveConfig.WAVE_COMPLETION_BONUS\r\n    this._score += waveBonus\r\n    \r\n    this.emit(WaveEvent.WAVE_END, {\r\n      wave: this._currentWave,\r\n      zombiesKilled: this._zombiesKilled,\r\n      waveScore: this._waveScore,\r\n      bonus: waveBonus,\r\n      totalScore: this._score,\r\n    })\r\n    this.emit(GameEvent.WAVE_END, {\r\n      wave: this._currentWave,\r\n      score: this._score,\r\n    })\r\n    \r\n    // Start preparation for next wave\r\n    this.startPreparationPhase()\r\n  }\r\n\r\n  /**\r\n   * Calculate number of zombies for a wave\r\n   * Formula: wave * 5 + 10\r\n   * Requirements: 4.1\r\n   */\r\n  calculateZombieCount(waveNumber: number): number {\r\n    return waveNumber * WaveConfig.ZOMBIES_PER_WAVE + WaveConfig.BASE_ZOMBIES\r\n  }\r\n\r\n  /**\r\n   * Calculate score for killing zombies\r\n   * Formula: zombies * 100 * wave\r\n   * Requirements: 4.4\r\n   */\r\n  calculateScore(zombiesKilled: number, waveNumber: number): number {\r\n    return zombiesKilled * WaveConfig.SCORE_PER_KILL * waveNumber\r\n  }\r\n\r\n  // ==================== Update ====================\r\n\r\n  /**\r\n   * Update wave manager each frame\r\n   * \r\n   * @param deltaTime - Time elapsed since last frame in seconds\r\n   */\r\n  update(deltaTime: number): void {\r\n    if (this._isGameOver) return\r\n    \r\n    // Track play time\r\n    this._playTime += deltaTime\r\n    \r\n    // Check for player death\r\n    this.checkPlayerDeath()\r\n    if (this._isGameOver) return\r\n    \r\n    if (this._isPreparationPhase) {\r\n      this.updatePreparationPhase(deltaTime)\r\n    } else {\r\n      this.updateWavePhase(deltaTime)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update during preparation phase\r\n   */\r\n  private updatePreparationPhase(deltaTime: number): void {\r\n    this._preparationTimeLeft -= deltaTime\r\n    \r\n    if (this._preparationTimeLeft <= 0) {\r\n      this._preparationTimeLeft = 0\r\n      this.emit(WaveEvent.PREPARATION_END, { wave: this._currentWave })\r\n      this.startWave()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update during active wave\r\n   */\r\n  private updateWavePhase(deltaTime: number): void {\r\n    // Spawn zombies gradually\r\n    if (this._zombiesSpawned < this._totalZombiesInWave) {\r\n      this.spawnTimer += deltaTime\r\n      \r\n      if (this.spawnTimer >= WaveConfig.SPAWN_INTERVAL) {\r\n        this.spawnTimer = 0\r\n        this.spawnZombie()\r\n      }\r\n    }\r\n    \r\n    // Check if wave is complete\r\n    if (this._zombiesKilled >= this._totalZombiesInWave) {\r\n      this.endWave()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Spawn a single zombie\r\n   */\r\n  private spawnZombie(): void {\r\n    if (!this.zombieManager || this._zombiesSpawned >= this._totalZombiesInWave) return\r\n    \r\n    const spawnPoint = this.getSpawnPoint()\r\n    const variant = this.getZombieVariantForWave()\r\n    \r\n    this.zombieManager.spawnZombie(spawnPoint, variant)\r\n    this._zombiesSpawned++\r\n  }\r\n\r\n  /**\r\n   * Get a spawn point (preferably away from player)\r\n   */\r\n  private getSpawnPoint(): Vector3 {\r\n    if (this.spawnPoints.length === 0) {\r\n      return { x: 0, y: 0, z: 30 }\r\n    }\r\n    \r\n    // If we have player position, try to spawn away from them\r\n    if (this.player) {\r\n      const playerPos = this.player.position\r\n      \r\n      // Filter spawn points that are far enough from player\r\n      const validPoints = this.spawnPoints.filter(point => {\r\n        const dx = point.x - playerPos.x\r\n        const dz = point.z - playerPos.z\r\n        const distance = Math.sqrt(dx * dx + dz * dz)\r\n        return distance >= WaveConfig.MIN_SPAWN_DISTANCE\r\n      })\r\n      \r\n      if (validPoints.length > 0) {\r\n        return validPoints[Math.floor(Math.random() * validPoints.length)]\r\n      }\r\n    }\r\n    \r\n    // Fallback to random spawn point\r\n    return this.spawnPoints[Math.floor(Math.random() * this.spawnPoints.length)]\r\n  }\r\n\r\n  /**\r\n   * Get zombie variant based on wave difficulty\r\n   */\r\n  private getZombieVariantForWave(): ZombieVariant {\r\n    const wave = this._currentWave\r\n    const roll = Math.random()\r\n    \r\n    // Higher waves have more dangerous variants\r\n    if (wave >= 10) {\r\n      // Wave 10+: 30% Walker, 30% Runner, 20% Crawler, 20% Brute\r\n      if (roll < 0.3) return ZombieVariant.WALKER\r\n      if (roll < 0.6) return ZombieVariant.RUNNER\r\n      if (roll < 0.8) return ZombieVariant.CRAWLER\r\n      return ZombieVariant.BRUTE\r\n    } else if (wave >= 5) {\r\n      // Wave 5-9: 40% Walker, 30% Runner, 20% Crawler, 10% Brute\r\n      if (roll < 0.4) return ZombieVariant.WALKER\r\n      if (roll < 0.7) return ZombieVariant.RUNNER\r\n      if (roll < 0.9) return ZombieVariant.CRAWLER\r\n      return ZombieVariant.BRUTE\r\n    } else {\r\n      // Wave 1-4: 60% Walker, 25% Runner, 10% Crawler, 5% Brute\r\n      if (roll < 0.6) return ZombieVariant.WALKER\r\n      if (roll < 0.85) return ZombieVariant.RUNNER\r\n      if (roll < 0.95) return ZombieVariant.CRAWLER\r\n      return ZombieVariant.BRUTE\r\n    }\r\n  }\r\n\r\n\r\n  // ==================== Zombie Kill Handling ====================\r\n\r\n  /**\r\n   * Handle zombie death event\r\n   * Requirements: 4.4\r\n   */\r\n  onZombieKilled(): void {\r\n    if (this._isGameOver || this._isPreparationPhase) return\r\n    \r\n    this._zombiesKilled++\r\n    \r\n    // Calculate score for this kill\r\n    const killScore = this.calculateScore(1, this._currentWave)\r\n    this._waveScore += killScore\r\n    this._score += killScore\r\n    \r\n    this.emit(WaveEvent.ZOMBIE_KILLED, {\r\n      zombiesKilled: this._zombiesKilled,\r\n      totalZombies: this._totalZombiesInWave,\r\n      killScore,\r\n      totalScore: this._score,\r\n    })\r\n    \r\n    this.emit(WaveEvent.SCORE_CHANGED, {\r\n      score: this._score,\r\n      waveScore: this._waveScore,\r\n    })\r\n  }\r\n\r\n  // ==================== Game Over ====================\r\n\r\n  /**\r\n   * Check if player has died\r\n   * Requirements: 4.5\r\n   */\r\n  private checkPlayerDeath(): void {\r\n    if (!this.player || this._isGameOver) return\r\n    \r\n    if (this.player.isDead()) {\r\n      this.triggerGameOver(GameOverReason.PLAYER_DEATH)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Trigger game over\r\n   * Requirements: 4.5\r\n   */\r\n  triggerGameOver(reason: GameOverReason): void {\r\n    if (this._isGameOver) return\r\n    \r\n    this._isGameOver = true\r\n    this._gameOverReason = reason\r\n    this._finalScore = this._score\r\n    \r\n    const totalZombiesKilled = this.getTotalZombiesKilled()\r\n    \r\n    // Trigger game over in the GameOverManager for final score display\r\n    this.gameOverManager.triggerGameOver(\r\n      reason,\r\n      this._finalScore,\r\n      this._currentWave,\r\n      totalZombiesKilled,\r\n      this._playTime\r\n    )\r\n    \r\n    this.emit(WaveEvent.GAME_OVER, {\r\n      reason,\r\n      finalScore: this._finalScore,\r\n      waveReached: this._currentWave,\r\n      totalZombiesKilled,\r\n      playTime: this._playTime,\r\n    })\r\n    \r\n    this.emit(GameEvent.GAME_OVER, {\r\n      reason,\r\n      score: this._finalScore,\r\n      wave: this._currentWave,\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Get total zombies killed across all waves\r\n   */\r\n  private getTotalZombiesKilled(): number {\r\n    return this.zombieManager?.getTotalKilled() ?? 0\r\n  }\r\n\r\n  // ==================== State Queries ====================\r\n\r\n  get currentWave(): number {\r\n    return this._currentWave\r\n  }\r\n\r\n  get zombiesKilled(): number {\r\n    return this._zombiesKilled\r\n  }\r\n\r\n  get totalZombiesInWave(): number {\r\n    return this._totalZombiesInWave\r\n  }\r\n\r\n  get zombiesRemaining(): number {\r\n    return this._totalZombiesInWave - this._zombiesKilled\r\n  }\r\n\r\n  get isPreparationPhase(): boolean {\r\n    return this._isPreparationPhase\r\n  }\r\n\r\n  get preparationTimeLeft(): number {\r\n    return this._preparationTimeLeft\r\n  }\r\n\r\n  get score(): number {\r\n    return this._score\r\n  }\r\n\r\n  get waveScore(): number {\r\n    return this._waveScore\r\n  }\r\n\r\n  get isGameOver(): boolean {\r\n    return this._isGameOver\r\n  }\r\n\r\n  get gameOverReason(): GameOverReason | null {\r\n    return this._gameOverReason\r\n  }\r\n\r\n  get finalScore(): number {\r\n    return this._finalScore\r\n  }\r\n\r\n  get playTime(): number {\r\n    return this._playTime\r\n  }\r\n\r\n  /**\r\n   * Get final score display data from GameOverManager\r\n   * Requirements: 4.5\r\n   */\r\n  getFinalScoreDisplay() {\r\n    return this.gameOverManager.getFinalScoreDisplay()\r\n  }\r\n\r\n  /**\r\n   * Get game over summary text\r\n   * Requirements: 4.5\r\n   */\r\n  getGameOverSummary(): string {\r\n    return this.gameOverManager.getSummaryText()\r\n  }\r\n\r\n  // ==================== Serialization ====================\r\n\r\n  /**\r\n   * Export wave state for saving\r\n   */\r\n  toState(): WaveState {\r\n    return {\r\n      currentWave: this._currentWave,\r\n      zombiesKilled: this._zombiesKilled,\r\n      totalZombiesInWave: this._totalZombiesInWave,\r\n      isPreparationPhase: this._isPreparationPhase,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get full game state for saving\r\n   */\r\n  getGameState(): {\r\n    wave: WaveState\r\n    score: number\r\n    isGameOver: boolean\r\n  } {\r\n    return {\r\n      wave: this.toState(),\r\n      score: this._score,\r\n      isGameOver: this._isGameOver,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Restore wave state from save\r\n   */\r\n  fromState(state: WaveState, score: number = 0): void {\r\n    this._currentWave = state.currentWave\r\n    this._zombiesKilled = state.zombiesKilled\r\n    this._totalZombiesInWave = state.totalZombiesInWave\r\n    this._isPreparationPhase = state.isPreparationPhase\r\n    this._score = score\r\n    this._zombiesSpawned = state.zombiesKilled // Assume killed zombies were spawned\r\n    this._isGameOver = false\r\n    this._gameOverReason = null\r\n    \r\n    if (this._isPreparationPhase) {\r\n      this._preparationTimeLeft = WaveConfig.PREPARATION_TIME\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Reset the wave manager\r\n   */\r\n  reset(): void {\r\n    this._currentWave = 0\r\n    this._zombiesKilled = 0\r\n    this._totalZombiesInWave = 0\r\n    this._zombiesSpawned = 0\r\n    this._isPreparationPhase = true\r\n    this._preparationTimeLeft = WaveConfig.PREPARATION_TIME\r\n    this._score = 0\r\n    this._waveScore = 0\r\n    this._isGameOver = false\r\n    this._gameOverReason = null\r\n    this._finalScore = 0\r\n    this._playTime = 0\r\n    this.spawnTimer = 0\r\n    \r\n    // Reset game over manager\r\n    this.gameOverManager.reset()\r\n    \r\n    // Reset zombie manager kill count\r\n    this.zombieManager?.resetKillCount()\r\n  }\r\n\r\n  // ==================== Event System ====================\r\n\r\n  on(event: string, callback: EventCallback): void {\r\n    if (!this.eventListeners.has(event)) {\r\n      this.eventListeners.set(event, new Set())\r\n    }\r\n    this.eventListeners.get(event)!.add(callback)\r\n  }\r\n\r\n  off(event: string, callback: EventCallback): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.delete(callback)\r\n    }\r\n  }\r\n\r\n  private emit(event: string, data?: unknown): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.forEach((callback) => callback(data))\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Cleanup resources\r\n   */\r\n  dispose(): void {\r\n    this.eventListeners.clear()\r\n    this.gameOverManager.dispose()\r\n    this.zombieManager = null\r\n    this.player = null\r\n  }\r\n}\r\n","import * as THREE from 'three'\r\nimport type { Vector3, EventCallback } from '../types'\r\n\r\n/**\r\n * Audio configuration constants\r\n */\r\nexport const AudioConfig = {\r\n  // Master volume settings\r\n  MASTER_VOLUME: 1.0,\r\n  MUSIC_VOLUME: 0.5,\r\n  SFX_VOLUME: 0.8,\r\n  AMBIENT_VOLUME: 0.6,\r\n  \r\n  // Pause volume reduction (50% as per Requirements 10.5)\r\n  PAUSE_VOLUME_MULTIPLIER: 0.5,\r\n  \r\n  // 3D audio settings\r\n  REF_DISTANCE: 1,        // Reference distance for volume falloff\r\n  MAX_DISTANCE: 100,      // Maximum distance for audio\r\n  ROLLOFF_FACTOR: 1,      // How quickly volume decreases with distance\r\n  \r\n  // Crossfade settings\r\n  CROSSFADE_DURATION: 2.0, // Seconds for music crossfade\r\n}\r\n\r\n/**\r\n * Audio events\r\n */\r\nexport enum AudioEvent {\r\n  VOLUME_CHANGED = 'audio:volumeChanged',\r\n  MUSIC_CHANGED = 'audio:musicChanged',\r\n  SOUND_PLAYED = 'audio:soundPlayed',\r\n  LOADED = 'audio:loaded',\r\n  ERROR = 'audio:error',\r\n}\r\n\r\n/**\r\n * Sound types for categorization\r\n */\r\nexport enum SoundType {\r\n  SFX = 'sfx',\r\n  MUSIC = 'music',\r\n  AMBIENT = 'ambient',\r\n  UI = 'ui',\r\n}\r\n\r\n/**\r\n * Music track identifiers\r\n */\r\nexport enum MusicTrack {\r\n  MENU = 'menu',\r\n  AMBIENT = 'ambient',\r\n  COMBAT = 'combat',\r\n  TENSE = 'tense',\r\n  GAME_OVER = 'gameOver',\r\n}\r\n\r\n/**\r\n * Sound effect identifiers\r\n */\r\nexport enum SoundEffect {\r\n  // Weapon sounds\r\n  PISTOL_FIRE = 'pistolFire',\r\n  RIFLE_FIRE = 'rifleFire',\r\n  SHOTGUN_FIRE = 'shotgunFire',\r\n  MELEE_SWING = 'meleeSwing',\r\n  RELOAD = 'reload',\r\n  EMPTY_CLICK = 'emptyClick',\r\n  \r\n  // Zombie sounds\r\n  ZOMBIE_GROWL = 'zombieGrowl',\r\n  ZOMBIE_ATTACK = 'zombieAttack',\r\n  ZOMBIE_DEATH = 'zombieDeath',\r\n  ZOMBIE_HIT = 'zombieHit',\r\n  \r\n  // Player sounds\r\n  PLAYER_HURT = 'playerHurt',\r\n  PLAYER_DEATH = 'playerDeath',\r\n  FOOTSTEP = 'footstep',\r\n  JUMP = 'jump',\r\n  LAND = 'land',\r\n  \r\n  // UI sounds\r\n  BUTTON_CLICK = 'buttonClick',\r\n  MENU_OPEN = 'menuOpen',\r\n  MENU_CLOSE = 'menuClose',\r\n  \r\n  // Wave sounds\r\n  WAVE_START = 'waveStart',\r\n  WAVE_COMPLETE = 'waveComplete',\r\n  PREPARATION_TICK = 'preparationTick',\r\n}\r\n\r\n/**\r\n * Cached sound data\r\n */\r\ninterface CachedSound {\r\n  buffer: AudioBuffer\r\n  type: SoundType\r\n}\r\n\r\n/**\r\n * Active sound instance\r\n */\r\ninterface ActiveSound {\r\n  source: AudioBufferSourceNode\r\n  gainNode: GainNode\r\n  pannerNode?: PannerNode\r\n  type: SoundType\r\n  startTime: number\r\n}\r\n\r\n\r\n/**\r\n * AudioManager - Manages all game audio including 3D spatial sound, music, and effects\r\n * Uses Web Audio API for 3D positional audio\r\n * Requirements: 10.1, 10.2, 10.3, 10.4, 10.5\r\n */\r\nexport class AudioManager {\r\n  // Audio context\r\n  private audioContext: AudioContext | null = null\r\n  private listener: THREE.AudioListener | null = null\r\n  \r\n  // Volume controls\r\n  private _masterVolume: number = AudioConfig.MASTER_VOLUME\r\n  private _musicVolume: number = AudioConfig.MUSIC_VOLUME\r\n  private _sfxVolume: number = AudioConfig.SFX_VOLUME\r\n  private _ambientVolume: number = AudioConfig.AMBIENT_VOLUME\r\n  \r\n  // Pause state\r\n  private _isPaused: boolean = false\r\n  private prePauseVolumes: { master: number; music: number; sfx: number; ambient: number } | null = null\r\n  \r\n  // Sound cache\r\n  private soundCache: Map<string, CachedSound> = new Map()\r\n  private loadingPromises: Map<string, Promise<AudioBuffer>> = new Map()\r\n  \r\n  // Active sounds\r\n  private activeSounds: Map<string, ActiveSound> = new Map()\r\n  private soundIdCounter: number = 0\r\n  \r\n  // Music state\r\n  private currentMusicTrack: MusicTrack | null = null\r\n  private currentMusicSource: AudioBufferSourceNode | null = null\r\n  private currentMusicGain: GainNode | null = null\r\n  private nextMusicSource: AudioBufferSourceNode | null = null\r\n  private nextMusicGain: GainNode | null = null\r\n  private isCrossfading: boolean = false\r\n  \r\n  // Gain nodes for volume control\r\n  private masterGain: GainNode | null = null\r\n  private musicGain: GainNode | null = null\r\n  private sfxGain: GainNode | null = null\r\n  private ambientGain: GainNode | null = null\r\n  \r\n  // Event listeners\r\n  private eventListeners: Map<string, Set<EventCallback>> = new Map()\r\n  \r\n  // Three.js camera reference for listener position\r\n  private camera: THREE.Camera | null = null\r\n\r\n  constructor() {\r\n    // Audio context will be created on first user interaction\r\n  }\r\n\r\n  /**\r\n   * Initialize the audio manager\r\n   * Must be called after user interaction due to browser autoplay policies\r\n   */\r\n  async init(camera?: THREE.Camera): Promise<void> {\r\n    try {\r\n      // Create audio context\r\n      this.audioContext = new (window.AudioContext || (window as unknown as { webkitAudioContext: typeof AudioContext }).webkitAudioContext)()\r\n      \r\n      // Resume context if suspended (browser autoplay policy)\r\n      if (this.audioContext.state === 'suspended') {\r\n        await this.audioContext.resume()\r\n      }\r\n      \r\n      // Create gain nodes for volume control\r\n      this.masterGain = this.audioContext.createGain()\r\n      this.musicGain = this.audioContext.createGain()\r\n      this.sfxGain = this.audioContext.createGain()\r\n      this.ambientGain = this.audioContext.createGain()\r\n      \r\n      // Connect gain nodes: category -> master -> destination\r\n      this.musicGain.connect(this.masterGain)\r\n      this.sfxGain.connect(this.masterGain)\r\n      this.ambientGain.connect(this.masterGain)\r\n      this.masterGain.connect(this.audioContext.destination)\r\n      \r\n      // Set initial volumes\r\n      this.masterGain.gain.value = this._masterVolume\r\n      this.musicGain.gain.value = this._musicVolume\r\n      this.sfxGain.gain.value = this._sfxVolume\r\n      this.ambientGain.gain.value = this._ambientVolume\r\n      \r\n      // Create Three.js audio listener for 3D audio\r\n      this.listener = new THREE.AudioListener()\r\n      \r\n      // Attach listener to camera if provided\r\n      if (camera) {\r\n        this.setCamera(camera)\r\n      }\r\n      \r\n      this.emit(AudioEvent.LOADED)\r\n    } catch (error) {\r\n      console.error('Failed to initialize AudioManager:', error)\r\n      this.emit(AudioEvent.ERROR, { error })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the camera for 3D audio listener positioning\r\n   */\r\n  setCamera(camera: THREE.Camera): void {\r\n    this.camera = camera\r\n    if (this.listener && camera) {\r\n      camera.add(this.listener)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the Three.js audio listener\r\n   */\r\n  getListener(): THREE.AudioListener | null {\r\n    return this.listener\r\n  }\r\n\r\n  // ==================== Sound Loading ====================\r\n\r\n  /**\r\n   * Load a sound file and cache it\r\n   * @param id - Unique identifier for the sound\r\n   * @param url - URL to the audio file\r\n   * @param type - Type of sound (sfx, music, ambient, ui)\r\n   */\r\n  async loadSound(id: string, url: string, type: SoundType = SoundType.SFX): Promise<void> {\r\n    if (this.soundCache.has(id)) return\r\n    \r\n    // Check if already loading\r\n    if (this.loadingPromises.has(id)) {\r\n      await this.loadingPromises.get(id)\r\n      return\r\n    }\r\n    \r\n    const loadPromise = this.loadAudioBuffer(url)\r\n    this.loadingPromises.set(id, loadPromise)\r\n    \r\n    try {\r\n      const buffer = await loadPromise\r\n      this.soundCache.set(id, { buffer, type })\r\n    } finally {\r\n      this.loadingPromises.delete(id)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load audio buffer from URL\r\n   */\r\n  private async loadAudioBuffer(url: string): Promise<AudioBuffer> {\r\n    if (!this.audioContext) {\r\n      throw new Error('AudioContext not initialized')\r\n    }\r\n    \r\n    const response = await fetch(url)\r\n    const arrayBuffer = await response.arrayBuffer()\r\n    return await this.audioContext.decodeAudioData(arrayBuffer)\r\n  }\r\n\r\n  /**\r\n   * Preload multiple sounds\r\n   */\r\n  async preloadSounds(sounds: Array<{ id: string; url: string; type: SoundType }>): Promise<void> {\r\n    await Promise.all(sounds.map(s => this.loadSound(s.id, s.url, s.type)))\r\n  }\r\n\r\n  /**\r\n   * Check if a sound is loaded\r\n   */\r\n  isSoundLoaded(id: string): boolean {\r\n    return this.soundCache.has(id)\r\n  }\r\n\r\n\r\n  // ==================== Sound Playback ====================\r\n\r\n  /**\r\n   * Play a 2D sound effect (non-positional)\r\n   * @param id - Sound identifier\r\n   * @param options - Playback options\r\n   * @returns Sound instance ID for later control\r\n   */\r\n  play(id: string, options: {\r\n    volume?: number\r\n    loop?: boolean\r\n    playbackRate?: number\r\n  } = {}): string | null {\r\n    const cached = this.soundCache.get(id)\r\n    if (!cached || !this.audioContext) return null\r\n    \r\n    const { volume = 1.0, loop = false, playbackRate = 1.0 } = options\r\n    \r\n    // Create source\r\n    const source = this.audioContext.createBufferSource()\r\n    source.buffer = cached.buffer\r\n    source.loop = loop\r\n    source.playbackRate.value = playbackRate\r\n    \r\n    // Create gain node for this sound\r\n    const gainNode = this.audioContext.createGain()\r\n    gainNode.gain.value = volume\r\n    \r\n    // Connect to appropriate category gain\r\n    const categoryGain = this.getCategoryGain(cached.type)\r\n    source.connect(gainNode)\r\n    gainNode.connect(categoryGain)\r\n    \r\n    // Generate unique ID\r\n    const soundId = `sound_${this.soundIdCounter++}`\r\n    \r\n    // Track active sound\r\n    this.activeSounds.set(soundId, {\r\n      source,\r\n      gainNode,\r\n      type: cached.type,\r\n      startTime: this.audioContext.currentTime,\r\n    })\r\n    \r\n    // Clean up when sound ends\r\n    source.onended = () => {\r\n      this.activeSounds.delete(soundId)\r\n    }\r\n    \r\n    // Start playback\r\n    source.start()\r\n    \r\n    this.emit(AudioEvent.SOUND_PLAYED, { id, soundId, type: cached.type })\r\n    \r\n    return soundId\r\n  }\r\n\r\n  /**\r\n   * Play a 3D positional sound\r\n   * Requirements: 10.1, 10.2\r\n   * @param id - Sound identifier\r\n   * @param position - 3D position of the sound source\r\n   * @param options - Playback options\r\n   * @returns Sound instance ID for later control\r\n   */\r\n  play3D(id: string, position: Vector3, options: {\r\n    volume?: number\r\n    loop?: boolean\r\n    playbackRate?: number\r\n    refDistance?: number\r\n    maxDistance?: number\r\n    rolloffFactor?: number\r\n  } = {}): string | null {\r\n    const cached = this.soundCache.get(id)\r\n    if (!cached || !this.audioContext) return null\r\n    \r\n    const {\r\n      volume = 1.0,\r\n      loop = false,\r\n      playbackRate = 1.0,\r\n      refDistance = AudioConfig.REF_DISTANCE,\r\n      maxDistance = AudioConfig.MAX_DISTANCE,\r\n      rolloffFactor = AudioConfig.ROLLOFF_FACTOR,\r\n    } = options\r\n    \r\n    // Create source\r\n    const source = this.audioContext.createBufferSource()\r\n    source.buffer = cached.buffer\r\n    source.loop = loop\r\n    source.playbackRate.value = playbackRate\r\n    \r\n    // Create panner for 3D positioning\r\n    const pannerNode = this.audioContext.createPanner()\r\n    pannerNode.panningModel = 'HRTF'\r\n    pannerNode.distanceModel = 'inverse'\r\n    pannerNode.refDistance = refDistance\r\n    pannerNode.maxDistance = maxDistance\r\n    pannerNode.rolloffFactor = rolloffFactor\r\n    pannerNode.setPosition(position.x, position.y, position.z)\r\n    \r\n    // Create gain node for this sound\r\n    const gainNode = this.audioContext.createGain()\r\n    gainNode.gain.value = volume\r\n    \r\n    // Connect: source -> panner -> gain -> category gain\r\n    const categoryGain = this.getCategoryGain(cached.type)\r\n    source.connect(pannerNode)\r\n    pannerNode.connect(gainNode)\r\n    gainNode.connect(categoryGain)\r\n    \r\n    // Generate unique ID\r\n    const soundId = `sound_${this.soundIdCounter++}`\r\n    \r\n    // Track active sound\r\n    this.activeSounds.set(soundId, {\r\n      source,\r\n      gainNode,\r\n      pannerNode,\r\n      type: cached.type,\r\n      startTime: this.audioContext.currentTime,\r\n    })\r\n    \r\n    // Clean up when sound ends\r\n    source.onended = () => {\r\n      this.activeSounds.delete(soundId)\r\n    }\r\n    \r\n    // Start playback\r\n    source.start()\r\n    \r\n    this.emit(AudioEvent.SOUND_PLAYED, { id, soundId, type: cached.type, position })\r\n    \r\n    return soundId\r\n  }\r\n\r\n  /**\r\n   * Update position of a 3D sound\r\n   * @param soundId - Sound instance ID\r\n   * @param position - New position\r\n   */\r\n  updateSoundPosition(soundId: string, position: Vector3): void {\r\n    const sound = this.activeSounds.get(soundId)\r\n    if (sound?.pannerNode) {\r\n      sound.pannerNode.setPosition(position.x, position.y, position.z)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop a specific sound\r\n   * @param soundId - Sound instance ID\r\n   */\r\n  stopSound(soundId: string): void {\r\n    const sound = this.activeSounds.get(soundId)\r\n    if (sound) {\r\n      try {\r\n        sound.source.stop()\r\n      } catch {\r\n        // Sound may have already ended\r\n      }\r\n      this.activeSounds.delete(soundId)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop all sounds of a specific type\r\n   */\r\n  stopAllSounds(type?: SoundType): void {\r\n    this.activeSounds.forEach((sound, id) => {\r\n      if (!type || sound.type === type) {\r\n        try {\r\n          sound.source.stop()\r\n        } catch {\r\n          // Sound may have already ended\r\n        }\r\n        this.activeSounds.delete(id)\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Get the appropriate gain node for a sound type\r\n   */\r\n  private getCategoryGain(type: SoundType): GainNode {\r\n    switch (type) {\r\n      case SoundType.MUSIC:\r\n        return this.musicGain!\r\n      case SoundType.AMBIENT:\r\n        return this.ambientGain!\r\n      case SoundType.SFX:\r\n      case SoundType.UI:\r\n      default:\r\n        return this.sfxGain!\r\n    }\r\n  }\r\n\r\n\r\n  // ==================== Music System ====================\r\n\r\n  /**\r\n   * Play background music with optional crossfade\r\n   * Requirements: 10.3, 10.4\r\n   * @param track - Music track identifier\r\n   * @param crossfade - Whether to crossfade from current track\r\n   */\r\n  async playMusic(track: MusicTrack, crossfade: boolean = true): Promise<void> {\r\n    if (!this.audioContext || !this.musicGain) return\r\n    \r\n    const cached = this.soundCache.get(track)\r\n    if (!cached) {\r\n      console.warn(`Music track not loaded: ${track}`)\r\n      return\r\n    }\r\n    \r\n    // If same track is already playing, do nothing\r\n    if (this.currentMusicTrack === track && this.currentMusicSource) return\r\n    \r\n    if (crossfade && this.currentMusicSource && !this.isCrossfading) {\r\n      await this.crossfadeToTrack(track, cached.buffer)\r\n    } else {\r\n      this.playMusicImmediate(track, cached.buffer)\r\n    }\r\n    \r\n    this.currentMusicTrack = track\r\n    this.emit(AudioEvent.MUSIC_CHANGED, { track })\r\n  }\r\n\r\n  /**\r\n   * Play music immediately without crossfade\r\n   */\r\n  private playMusicImmediate(track: MusicTrack, buffer: AudioBuffer): void {\r\n    if (!this.audioContext || !this.musicGain) return\r\n    \r\n    // Stop current music\r\n    this.stopMusic()\r\n    \r\n    // Create new source\r\n    this.currentMusicSource = this.audioContext.createBufferSource()\r\n    this.currentMusicSource.buffer = buffer\r\n    this.currentMusicSource.loop = true\r\n    \r\n    // Create gain for this track\r\n    this.currentMusicGain = this.audioContext.createGain()\r\n    this.currentMusicGain.gain.value = 1.0\r\n    \r\n    // Connect\r\n    this.currentMusicSource.connect(this.currentMusicGain)\r\n    this.currentMusicGain.connect(this.musicGain)\r\n    \r\n    // Start\r\n    this.currentMusicSource.start()\r\n    this.currentMusicTrack = track\r\n  }\r\n\r\n  /**\r\n   * Crossfade to a new music track\r\n   * Requirements: 10.4\r\n   */\r\n  private async crossfadeToTrack(track: MusicTrack, buffer: AudioBuffer): Promise<void> {\r\n    if (!this.audioContext || !this.musicGain) return\r\n    \r\n    this.isCrossfading = true\r\n    \r\n    // Create new source\r\n    this.nextMusicSource = this.audioContext.createBufferSource()\r\n    this.nextMusicSource.buffer = buffer\r\n    this.nextMusicSource.loop = true\r\n    \r\n    // Create gain for new track (start at 0)\r\n    this.nextMusicGain = this.audioContext.createGain()\r\n    this.nextMusicGain.gain.value = 0\r\n    \r\n    // Connect\r\n    this.nextMusicSource.connect(this.nextMusicGain)\r\n    this.nextMusicGain.connect(this.musicGain)\r\n    \r\n    // Start new track\r\n    this.nextMusicSource.start()\r\n    \r\n    // Crossfade\r\n    const duration = AudioConfig.CROSSFADE_DURATION\r\n    const currentTime = this.audioContext.currentTime\r\n    \r\n    // Fade out current\r\n    if (this.currentMusicGain) {\r\n      this.currentMusicGain.gain.linearRampToValueAtTime(0, currentTime + duration)\r\n    }\r\n    \r\n    // Fade in new\r\n    this.nextMusicGain.gain.linearRampToValueAtTime(1, currentTime + duration)\r\n    \r\n    // Wait for crossfade to complete\r\n    await new Promise(resolve => setTimeout(resolve, duration * 1000))\r\n    \r\n    // Stop old track\r\n    if (this.currentMusicSource) {\r\n      try {\r\n        this.currentMusicSource.stop()\r\n      } catch {\r\n        // May have already stopped\r\n      }\r\n    }\r\n    \r\n    // Swap references\r\n    this.currentMusicSource = this.nextMusicSource\r\n    this.currentMusicGain = this.nextMusicGain\r\n    this.nextMusicSource = null\r\n    this.nextMusicGain = null\r\n    this.currentMusicTrack = track\r\n    \r\n    this.isCrossfading = false\r\n  }\r\n\r\n  /**\r\n   * Stop current music\r\n   */\r\n  stopMusic(): void {\r\n    if (this.currentMusicSource) {\r\n      try {\r\n        this.currentMusicSource.stop()\r\n      } catch {\r\n        // May have already stopped\r\n      }\r\n      this.currentMusicSource = null\r\n    }\r\n    this.currentMusicGain = null\r\n    this.currentMusicTrack = null\r\n  }\r\n\r\n  /**\r\n   * Get current music track\r\n   */\r\n  getCurrentMusicTrack(): MusicTrack | null {\r\n    return this.currentMusicTrack\r\n  }\r\n\r\n  // ==================== Volume Control ====================\r\n\r\n  /**\r\n   * Set master volume\r\n   */\r\n  setMasterVolume(volume: number): void {\r\n    this._masterVolume = Math.max(0, Math.min(1, volume))\r\n    if (this.masterGain) {\r\n      this.masterGain.gain.value = this._masterVolume\r\n    }\r\n    this.emit(AudioEvent.VOLUME_CHANGED, { type: 'master', volume: this._masterVolume })\r\n  }\r\n\r\n  /**\r\n   * Set music volume\r\n   */\r\n  setMusicVolume(volume: number): void {\r\n    this._musicVolume = Math.max(0, Math.min(1, volume))\r\n    if (this.musicGain) {\r\n      this.musicGain.gain.value = this._musicVolume\r\n    }\r\n    this.emit(AudioEvent.VOLUME_CHANGED, { type: 'music', volume: this._musicVolume })\r\n  }\r\n\r\n  /**\r\n   * Set SFX volume\r\n   */\r\n  setSfxVolume(volume: number): void {\r\n    this._sfxVolume = Math.max(0, Math.min(1, volume))\r\n    if (this.sfxGain) {\r\n      this.sfxGain.gain.value = this._sfxVolume\r\n    }\r\n    this.emit(AudioEvent.VOLUME_CHANGED, { type: 'sfx', volume: this._sfxVolume })\r\n  }\r\n\r\n  /**\r\n   * Set ambient volume\r\n   */\r\n  setAmbientVolume(volume: number): void {\r\n    this._ambientVolume = Math.max(0, Math.min(1, volume))\r\n    if (this.ambientGain) {\r\n      this.ambientGain.gain.value = this._ambientVolume\r\n    }\r\n    this.emit(AudioEvent.VOLUME_CHANGED, { type: 'ambient', volume: this._ambientVolume })\r\n  }\r\n\r\n  // Volume getters\r\n  get masterVolume(): number { return this._masterVolume }\r\n  get musicVolume(): number { return this._musicVolume }\r\n  get sfxVolume(): number { return this._sfxVolume }\r\n  get ambientVolume(): number { return this._ambientVolume }\r\n\r\n\r\n  // ==================== Pause Handling ====================\r\n\r\n  /**\r\n   * Pause audio - reduces all volume by 50%\r\n   * Requirements: 10.5\r\n   */\r\n  pause(): void {\r\n    if (this._isPaused) return\r\n    \r\n    this._isPaused = true\r\n    \r\n    // Store current volumes\r\n    this.prePauseVolumes = {\r\n      master: this._masterVolume,\r\n      music: this._musicVolume,\r\n      sfx: this._sfxVolume,\r\n      ambient: this._ambientVolume,\r\n    }\r\n    \r\n    // Reduce all volumes by 50%\r\n    const multiplier = AudioConfig.PAUSE_VOLUME_MULTIPLIER\r\n    \r\n    if (this.masterGain) {\r\n      this.masterGain.gain.value = this._masterVolume * multiplier\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resume audio - restores original volume\r\n   * Requirements: 10.5\r\n   */\r\n  resume(): void {\r\n    if (!this._isPaused) return\r\n    \r\n    this._isPaused = false\r\n    \r\n    // Restore volumes\r\n    if (this.prePauseVolumes) {\r\n      if (this.masterGain) {\r\n        this.masterGain.gain.value = this.prePauseVolumes.master\r\n      }\r\n      this.prePauseVolumes = null\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if audio is paused\r\n   */\r\n  get isPaused(): boolean {\r\n    return this._isPaused\r\n  }\r\n\r\n  // ==================== Listener Position ====================\r\n\r\n  /**\r\n   * Update listener position (call each frame)\r\n   * The listener position is automatically updated if attached to camera\r\n   * This method is for manual position updates if needed\r\n   */\r\n  updateListenerPosition(position: Vector3, forward: Vector3, up: Vector3 = { x: 0, y: 1, z: 0 }): void {\r\n    if (!this.audioContext) return\r\n    \r\n    const listener = this.audioContext.listener\r\n    \r\n    if (listener.positionX) {\r\n      // Modern API\r\n      listener.positionX.value = position.x\r\n      listener.positionY.value = position.y\r\n      listener.positionZ.value = position.z\r\n      listener.forwardX.value = forward.x\r\n      listener.forwardY.value = forward.y\r\n      listener.forwardZ.value = forward.z\r\n      listener.upX.value = up.x\r\n      listener.upY.value = up.y\r\n      listener.upZ.value = up.z\r\n    } else {\r\n      // Legacy API\r\n      listener.setPosition(position.x, position.y, position.z)\r\n      listener.setOrientation(forward.x, forward.y, forward.z, up.x, up.y, up.z)\r\n    }\r\n  }\r\n\r\n  // ==================== Event System ====================\r\n\r\n  on(event: string, callback: EventCallback): void {\r\n    if (!this.eventListeners.has(event)) {\r\n      this.eventListeners.set(event, new Set())\r\n    }\r\n    this.eventListeners.get(event)!.add(callback)\r\n  }\r\n\r\n  off(event: string, callback: EventCallback): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.delete(callback)\r\n    }\r\n  }\r\n\r\n  private emit(event: string, data?: unknown): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.forEach((callback) => callback(data))\r\n    }\r\n  }\r\n\r\n  // ==================== Cleanup ====================\r\n\r\n  /**\r\n   * Dispose of all audio resources\r\n   */\r\n  dispose(): void {\r\n    // Stop all sounds\r\n    this.stopAllSounds()\r\n    this.stopMusic()\r\n    \r\n    // Clear cache\r\n    this.soundCache.clear()\r\n    this.loadingPromises.clear()\r\n    this.activeSounds.clear()\r\n    \r\n    // Remove listener from camera\r\n    if (this.listener && this.camera) {\r\n      this.camera.remove(this.listener)\r\n    }\r\n    \r\n    // Close audio context\r\n    if (this.audioContext) {\r\n      this.audioContext.close()\r\n      this.audioContext = null\r\n    }\r\n    \r\n    // Clear references\r\n    this.listener = null\r\n    this.camera = null\r\n    this.masterGain = null\r\n    this.musicGain = null\r\n    this.sfxGain = null\r\n    this.ambientGain = null\r\n    \r\n    // Clear event listeners\r\n    this.eventListeners.clear()\r\n  }\r\n\r\n  /**\r\n   * Check if audio context is initialized\r\n   */\r\n  isInitialized(): boolean {\r\n    return this.audioContext !== null && this.audioContext.state !== 'closed'\r\n  }\r\n\r\n  /**\r\n   * Get audio context state\r\n   */\r\n  getContextState(): AudioContextState | null {\r\n    return this.audioContext?.state ?? null\r\n  }\r\n}\r\n","import type { Vector3, EventCallback } from '../types'\r\nimport { ZombieStateType } from '../types'\r\nimport { AudioManager, SoundEffect, SoundType, MusicTrack, AudioConfig } from './AudioManager'\r\n\r\n/**\r\n * Sound URLs - In a real game, these would point to actual audio files\r\n * For now, we define the structure for when audio assets are added\r\n */\r\nexport const SoundUrls = {\r\n  // Weapon sounds\r\n  [SoundEffect.PISTOL_FIRE]: '/audio/weapons/pistol_fire.mp3',\r\n  [SoundEffect.RIFLE_FIRE]: '/audio/weapons/rifle_fire.mp3',\r\n  [SoundEffect.SHOTGUN_FIRE]: '/audio/weapons/shotgun_fire.mp3',\r\n  [SoundEffect.MELEE_SWING]: '/audio/weapons/melee_swing.mp3',\r\n  [SoundEffect.RELOAD]: '/audio/weapons/reload.mp3',\r\n  [SoundEffect.EMPTY_CLICK]: '/audio/weapons/empty_click.mp3',\r\n  \r\n  // Zombie sounds\r\n  [SoundEffect.ZOMBIE_GROWL]: '/audio/zombies/growl.mp3',\r\n  [SoundEffect.ZOMBIE_ATTACK]: '/audio/zombies/attack.mp3',\r\n  [SoundEffect.ZOMBIE_DEATH]: '/audio/zombies/death.mp3',\r\n  [SoundEffect.ZOMBIE_HIT]: '/audio/zombies/hit.mp3',\r\n  \r\n  // Player sounds\r\n  [SoundEffect.PLAYER_HURT]: '/audio/player/hurt.mp3',\r\n  [SoundEffect.PLAYER_DEATH]: '/audio/player/death.mp3',\r\n  [SoundEffect.FOOTSTEP]: '/audio/player/footstep.mp3',\r\n  [SoundEffect.JUMP]: '/audio/player/jump.mp3',\r\n  [SoundEffect.LAND]: '/audio/player/land.mp3',\r\n  \r\n  // UI sounds\r\n  [SoundEffect.BUTTON_CLICK]: '/audio/ui/click.mp3',\r\n  [SoundEffect.MENU_OPEN]: '/audio/ui/menu_open.mp3',\r\n  [SoundEffect.MENU_CLOSE]: '/audio/ui/menu_close.mp3',\r\n  \r\n  // Wave sounds\r\n  [SoundEffect.WAVE_START]: '/audio/waves/wave_start.mp3',\r\n  [SoundEffect.WAVE_COMPLETE]: '/audio/waves/wave_complete.mp3',\r\n  [SoundEffect.PREPARATION_TICK]: '/audio/waves/tick.mp3',\r\n  \r\n  // Music tracks\r\n  [MusicTrack.MENU]: '/audio/music/menu.mp3',\r\n  [MusicTrack.AMBIENT]: '/audio/music/ambient.mp3',\r\n  [MusicTrack.COMBAT]: '/audio/music/combat.mp3',\r\n  [MusicTrack.TENSE]: '/audio/music/tense.mp3',\r\n  [MusicTrack.GAME_OVER]: '/audio/music/game_over.mp3',\r\n}\r\n\r\n/**\r\n * Zombie ambient sound configuration\r\n */\r\ninterface ZombieAmbientSound {\r\n  soundId: string | null\r\n  lastPlayTime: number\r\n  interval: number\r\n}\r\n\r\n/**\r\n * GameAudioController - Integrates AudioManager with game systems\r\n * Handles weapon sounds, zombie sounds, and ambient audio\r\n * Requirements: 10.1, 10.2\r\n */\r\nexport class GameAudioController {\r\n  private audioManager: AudioManager\r\n  private isInitialized: boolean = false\r\n  \r\n  // Zombie ambient sounds tracking\r\n  private zombieAmbientSounds: Map<string, ZombieAmbientSound> = new Map()\r\n  private zombieGrowlMinInterval: number = 3.0  // Minimum seconds between growls\r\n  private zombieGrowlMaxInterval: number = 8.0  // Maximum seconds between growls\r\n  \r\n  // Player position for 3D audio\r\n  private playerPosition: Vector3 = { x: 0, y: 0, z: 0 }\r\n  \r\n  // Active looping sounds\r\n  private activeLoopingSounds: Map<string, string> = new Map()\r\n  \r\n  // Event listeners\r\n  private eventListeners: Map<string, Set<EventCallback>> = new Map()\r\n\r\n  constructor(audioManager: AudioManager) {\r\n    this.audioManager = audioManager\r\n  }\r\n\r\n  /**\r\n   * Initialize the game audio controller\r\n   * Preloads all game sounds\r\n   */\r\n  async init(): Promise<void> {\r\n    if (this.isInitialized) return\r\n    \r\n    // Preload all sounds (in a real game, handle missing files gracefully)\r\n    const soundsToLoad: Array<{ id: string; url: string; type: SoundType }> = []\r\n    \r\n    // Add weapon sounds\r\n    soundsToLoad.push(\r\n      { id: SoundEffect.PISTOL_FIRE, url: SoundUrls[SoundEffect.PISTOL_FIRE], type: SoundType.SFX },\r\n      { id: SoundEffect.RIFLE_FIRE, url: SoundUrls[SoundEffect.RIFLE_FIRE], type: SoundType.SFX },\r\n      { id: SoundEffect.SHOTGUN_FIRE, url: SoundUrls[SoundEffect.SHOTGUN_FIRE], type: SoundType.SFX },\r\n      { id: SoundEffect.MELEE_SWING, url: SoundUrls[SoundEffect.MELEE_SWING], type: SoundType.SFX },\r\n      { id: SoundEffect.RELOAD, url: SoundUrls[SoundEffect.RELOAD], type: SoundType.SFX },\r\n      { id: SoundEffect.EMPTY_CLICK, url: SoundUrls[SoundEffect.EMPTY_CLICK], type: SoundType.SFX },\r\n    )\r\n    \r\n    // Add zombie sounds\r\n    soundsToLoad.push(\r\n      { id: SoundEffect.ZOMBIE_GROWL, url: SoundUrls[SoundEffect.ZOMBIE_GROWL], type: SoundType.AMBIENT },\r\n      { id: SoundEffect.ZOMBIE_ATTACK, url: SoundUrls[SoundEffect.ZOMBIE_ATTACK], type: SoundType.SFX },\r\n      { id: SoundEffect.ZOMBIE_DEATH, url: SoundUrls[SoundEffect.ZOMBIE_DEATH], type: SoundType.SFX },\r\n      { id: SoundEffect.ZOMBIE_HIT, url: SoundUrls[SoundEffect.ZOMBIE_HIT], type: SoundType.SFX },\r\n    )\r\n    \r\n    // Add player sounds\r\n    soundsToLoad.push(\r\n      { id: SoundEffect.PLAYER_HURT, url: SoundUrls[SoundEffect.PLAYER_HURT], type: SoundType.SFX },\r\n      { id: SoundEffect.PLAYER_DEATH, url: SoundUrls[SoundEffect.PLAYER_DEATH], type: SoundType.SFX },\r\n      { id: SoundEffect.FOOTSTEP, url: SoundUrls[SoundEffect.FOOTSTEP], type: SoundType.SFX },\r\n      { id: SoundEffect.JUMP, url: SoundUrls[SoundEffect.JUMP], type: SoundType.SFX },\r\n      { id: SoundEffect.LAND, url: SoundUrls[SoundEffect.LAND], type: SoundType.SFX },\r\n    )\r\n    \r\n    // Add wave sounds\r\n    soundsToLoad.push(\r\n      { id: SoundEffect.WAVE_START, url: SoundUrls[SoundEffect.WAVE_START], type: SoundType.SFX },\r\n      { id: SoundEffect.WAVE_COMPLETE, url: SoundUrls[SoundEffect.WAVE_COMPLETE], type: SoundType.SFX },\r\n      { id: SoundEffect.PREPARATION_TICK, url: SoundUrls[SoundEffect.PREPARATION_TICK], type: SoundType.UI },\r\n    )\r\n    \r\n    // Add music tracks\r\n    soundsToLoad.push(\r\n      { id: MusicTrack.MENU, url: SoundUrls[MusicTrack.MENU], type: SoundType.MUSIC },\r\n      { id: MusicTrack.AMBIENT, url: SoundUrls[MusicTrack.AMBIENT], type: SoundType.MUSIC },\r\n      { id: MusicTrack.COMBAT, url: SoundUrls[MusicTrack.COMBAT], type: SoundType.MUSIC },\r\n      { id: MusicTrack.TENSE, url: SoundUrls[MusicTrack.TENSE], type: SoundType.MUSIC },\r\n      { id: MusicTrack.GAME_OVER, url: SoundUrls[MusicTrack.GAME_OVER], type: SoundType.MUSIC },\r\n    )\r\n    \r\n    // Try to load sounds, but don't fail if files don't exist\r\n    for (const sound of soundsToLoad) {\r\n      try {\r\n        await this.audioManager.loadSound(sound.id, sound.url, sound.type)\r\n      } catch (error) {\r\n        // Sound file not found - this is expected until audio assets are added\r\n        console.debug(`Audio file not found: ${sound.url}`)\r\n      }\r\n    }\r\n    \r\n    this.isInitialized = true\r\n  }\r\n\r\n\r\n  // ==================== Weapon Sounds ====================\r\n\r\n  /**\r\n   * Play weapon fire sound with 3D positioning\r\n   * Requirements: 10.1\r\n   * @param weaponType - Type of weapon being fired\r\n   * @param position - Position of the weapon\r\n   */\r\n  playWeaponFire(weaponType: string, position: Vector3): void {\r\n    let soundId: SoundEffect\r\n    \r\n    switch (weaponType.toLowerCase()) {\r\n      case 'pistol':\r\n        soundId = SoundEffect.PISTOL_FIRE\r\n        break\r\n      case 'rifle':\r\n        soundId = SoundEffect.RIFLE_FIRE\r\n        break\r\n      case 'shotgun':\r\n        soundId = SoundEffect.SHOTGUN_FIRE\r\n        break\r\n      case 'melee':\r\n        soundId = SoundEffect.MELEE_SWING\r\n        break\r\n      default:\r\n        soundId = SoundEffect.PISTOL_FIRE\r\n    }\r\n    \r\n    // Play as 3D sound at weapon position\r\n    this.audioManager.play3D(soundId, position, {\r\n      volume: 1.0,\r\n      refDistance: 5,\r\n      maxDistance: 50,\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Play reload sound\r\n   */\r\n  playReload(position: Vector3): void {\r\n    this.audioManager.play3D(SoundEffect.RELOAD, position, {\r\n      volume: 0.8,\r\n      refDistance: 2,\r\n      maxDistance: 20,\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Play empty magazine click\r\n   */\r\n  playEmptyClick(position: Vector3): void {\r\n    this.audioManager.play3D(SoundEffect.EMPTY_CLICK, position, {\r\n      volume: 0.6,\r\n      refDistance: 1,\r\n      maxDistance: 10,\r\n    })\r\n  }\r\n\r\n  // ==================== Zombie Sounds ====================\r\n\r\n  /**\r\n   * Play zombie growl with 3D positioning\r\n   * Requirements: 10.2\r\n   * @param position - Position of the zombie\r\n   */\r\n  playZombieGrowl(position: Vector3): void {\r\n    this.audioManager.play3D(SoundEffect.ZOMBIE_GROWL, position, {\r\n      volume: 0.7,\r\n      refDistance: 5,\r\n      maxDistance: AudioConfig.MAX_DISTANCE,\r\n      rolloffFactor: 1.5,\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Play zombie attack sound\r\n   * @param position - Position of the zombie\r\n   */\r\n  playZombieAttack(position: Vector3): void {\r\n    this.audioManager.play3D(SoundEffect.ZOMBIE_ATTACK, position, {\r\n      volume: 0.9,\r\n      refDistance: 3,\r\n      maxDistance: 30,\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Play zombie death sound\r\n   * @param position - Position of the zombie\r\n   */\r\n  playZombieDeath(position: Vector3): void {\r\n    this.audioManager.play3D(SoundEffect.ZOMBIE_DEATH, position, {\r\n      volume: 0.8,\r\n      refDistance: 5,\r\n      maxDistance: 40,\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Play zombie hit sound\r\n   * @param position - Position of the zombie\r\n   */\r\n  playZombieHit(position: Vector3): void {\r\n    this.audioManager.play3D(SoundEffect.ZOMBIE_HIT, position, {\r\n      volume: 0.7,\r\n      refDistance: 3,\r\n      maxDistance: 30,\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Register a zombie for ambient sounds\r\n   * @param zombieId - Unique zombie identifier\r\n   */\r\n  registerZombie(zombieId: string): void {\r\n    if (!this.zombieAmbientSounds.has(zombieId)) {\r\n      this.zombieAmbientSounds.set(zombieId, {\r\n        soundId: null,\r\n        lastPlayTime: 0,\r\n        interval: this.getRandomGrowlInterval(),\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unregister a zombie from ambient sounds\r\n   * @param zombieId - Unique zombie identifier\r\n   */\r\n  unregisterZombie(zombieId: string): void {\r\n    const ambient = this.zombieAmbientSounds.get(zombieId)\r\n    if (ambient?.soundId) {\r\n      this.audioManager.stopSound(ambient.soundId)\r\n    }\r\n    this.zombieAmbientSounds.delete(zombieId)\r\n  }\r\n\r\n  /**\r\n   * Update zombie ambient sounds\r\n   * Requirements: 10.2\r\n   * @param _deltaTime - Time since last update (unused, timing based on performance.now)\r\n   * @param zombies - Array of zombie data with id and position\r\n   */\r\n  updateZombieAmbientSounds(\r\n    _deltaTime: number,\r\n    zombies: Array<{ id: string; position: Vector3; state: ZombieStateType }>\r\n  ): void {\r\n    const currentTime = performance.now() / 1000\r\n    \r\n    for (const zombie of zombies) {\r\n      // Skip dying zombies\r\n      if (zombie.state === ZombieStateType.DYING) continue\r\n      \r\n      let ambient = this.zombieAmbientSounds.get(zombie.id)\r\n      \r\n      if (!ambient) {\r\n        this.registerZombie(zombie.id)\r\n        ambient = this.zombieAmbientSounds.get(zombie.id)!\r\n      }\r\n      \r\n      // Check if it's time for a new growl\r\n      if (currentTime - ambient.lastPlayTime >= ambient.interval) {\r\n        // Calculate distance to player for volume adjustment\r\n        const distance = this.calculateDistance(zombie.position, this.playerPosition)\r\n        \r\n        // Only play if within hearing range\r\n        if (distance < AudioConfig.MAX_DISTANCE) {\r\n          this.playZombieGrowl(zombie.position)\r\n          ambient.lastPlayTime = currentTime\r\n          ambient.interval = this.getRandomGrowlInterval()\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get random interval for zombie growls\r\n   */\r\n  private getRandomGrowlInterval(): number {\r\n    return this.zombieGrowlMinInterval + \r\n      Math.random() * (this.zombieGrowlMaxInterval - this.zombieGrowlMinInterval)\r\n  }\r\n\r\n  /**\r\n   * Calculate distance between two positions\r\n   */\r\n  private calculateDistance(pos1: Vector3, pos2: Vector3): number {\r\n    const dx = pos1.x - pos2.x\r\n    const dy = pos1.y - pos2.y\r\n    const dz = pos1.z - pos2.z\r\n    return Math.sqrt(dx * dx + dy * dy + dz * dz)\r\n  }\r\n\r\n\r\n  // ==================== Player Sounds ====================\r\n\r\n  /**\r\n   * Play player hurt sound\r\n   */\r\n  playPlayerHurt(): void {\r\n    this.audioManager.play(SoundEffect.PLAYER_HURT, { volume: 1.0 })\r\n  }\r\n\r\n  /**\r\n   * Play player death sound\r\n   */\r\n  playPlayerDeath(): void {\r\n    this.audioManager.play(SoundEffect.PLAYER_DEATH, { volume: 1.0 })\r\n  }\r\n\r\n  /**\r\n   * Play footstep sound\r\n   * @param position - Player position\r\n   */\r\n  playFootstep(position: Vector3): void {\r\n    // Slight random pitch variation for variety\r\n    const pitchVariation = 0.9 + Math.random() * 0.2\r\n    this.audioManager.play3D(SoundEffect.FOOTSTEP, position, {\r\n      volume: 0.4,\r\n      playbackRate: pitchVariation,\r\n      refDistance: 1,\r\n      maxDistance: 15,\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Play jump sound\r\n   */\r\n  playJump(): void {\r\n    this.audioManager.play(SoundEffect.JUMP, { volume: 0.6 })\r\n  }\r\n\r\n  /**\r\n   * Play land sound\r\n   */\r\n  playLand(): void {\r\n    this.audioManager.play(SoundEffect.LAND, { volume: 0.5 })\r\n  }\r\n\r\n  // ==================== Wave Sounds ====================\r\n\r\n  /**\r\n   * Play wave start alert sound\r\n   * Requirements: 10.3\r\n   */\r\n  playWaveStart(): void {\r\n    this.audioManager.play(SoundEffect.WAVE_START, { volume: 1.0 })\r\n  }\r\n\r\n  /**\r\n   * Play wave complete sound\r\n   */\r\n  playWaveComplete(): void {\r\n    this.audioManager.play(SoundEffect.WAVE_COMPLETE, { volume: 1.0 })\r\n  }\r\n\r\n  /**\r\n   * Play preparation countdown tick\r\n   */\r\n  playPreparationTick(): void {\r\n    this.audioManager.play(SoundEffect.PREPARATION_TICK, { volume: 0.5 })\r\n  }\r\n\r\n  // ==================== Music Control ====================\r\n\r\n  /**\r\n   * Play menu music\r\n   */\r\n  playMenuMusic(): void {\r\n    this.audioManager.playMusic(MusicTrack.MENU, true)\r\n  }\r\n\r\n  /**\r\n   * Play ambient/exploration music\r\n   */\r\n  playAmbientMusic(): void {\r\n    this.audioManager.playMusic(MusicTrack.AMBIENT, true)\r\n  }\r\n\r\n  /**\r\n   * Play combat music\r\n   * Requirements: 10.3\r\n   */\r\n  playCombatMusic(): void {\r\n    this.audioManager.playMusic(MusicTrack.COMBAT, true)\r\n  }\r\n\r\n  /**\r\n   * Play tense/danger music\r\n   * Requirements: 10.4\r\n   */\r\n  playTenseMusic(): void {\r\n    this.audioManager.playMusic(MusicTrack.TENSE, true)\r\n  }\r\n\r\n  /**\r\n   * Play game over music\r\n   */\r\n  playGameOverMusic(): void {\r\n    this.audioManager.playMusic(MusicTrack.GAME_OVER, true)\r\n  }\r\n\r\n  /**\r\n   * Stop all music\r\n   */\r\n  stopMusic(): void {\r\n    this.audioManager.stopMusic()\r\n  }\r\n\r\n  // ==================== UI Sounds ====================\r\n\r\n  /**\r\n   * Play button click sound\r\n   */\r\n  playButtonClick(): void {\r\n    this.audioManager.play(SoundEffect.BUTTON_CLICK, { volume: 0.5 })\r\n  }\r\n\r\n  /**\r\n   * Play menu open sound\r\n   */\r\n  playMenuOpen(): void {\r\n    this.audioManager.play(SoundEffect.MENU_OPEN, { volume: 0.6 })\r\n  }\r\n\r\n  /**\r\n   * Play menu close sound\r\n   */\r\n  playMenuClose(): void {\r\n    this.audioManager.play(SoundEffect.MENU_CLOSE, { volume: 0.6 })\r\n  }\r\n\r\n  // ==================== State Management ====================\r\n\r\n  /**\r\n   * Update player position for distance calculations\r\n   * @param position - Current player position\r\n   */\r\n  setPlayerPosition(position: Vector3): void {\r\n    this.playerPosition = { ...position }\r\n  }\r\n\r\n  /**\r\n   * Update audio based on game state\r\n   * Call this each frame\r\n   * @param _deltaTime - Time since last update (unused, reserved for future use)\r\n   */\r\n  update(_deltaTime: number): void {\r\n    // Update listener position if camera is set\r\n    // This is handled automatically by Three.js AudioListener attached to camera\r\n  }\r\n\r\n  /**\r\n   * Handle game pause\r\n   * Requirements: 10.5\r\n   */\r\n  onGamePause(): void {\r\n    this.audioManager.pause()\r\n  }\r\n\r\n  /**\r\n   * Handle game resume\r\n   * Requirements: 10.5\r\n   */\r\n  onGameResume(): void {\r\n    this.audioManager.resume()\r\n  }\r\n\r\n  // ==================== Event System ====================\r\n\r\n  on(event: string, callback: EventCallback): void {\r\n    if (!this.eventListeners.has(event)) {\r\n      this.eventListeners.set(event, new Set())\r\n    }\r\n    this.eventListeners.get(event)!.add(callback)\r\n  }\r\n\r\n  off(event: string, callback: EventCallback): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.delete(callback)\r\n    }\r\n  }\r\n\r\n  private emit(event: string, data?: unknown): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.forEach((callback) => callback(data))\r\n    }\r\n  }\r\n\r\n  // ==================== Cleanup ====================\r\n\r\n  /**\r\n   * Dispose of all resources\r\n   */\r\n  dispose(): void {\r\n    // Stop all zombie ambient sounds\r\n    this.zombieAmbientSounds.forEach((ambient) => {\r\n      if (ambient.soundId) {\r\n        this.audioManager.stopSound(ambient.soundId)\r\n      }\r\n    })\r\n    this.zombieAmbientSounds.clear()\r\n    \r\n    // Clear active looping sounds\r\n    this.activeLoopingSounds.forEach((soundId) => {\r\n      this.audioManager.stopSound(soundId)\r\n    })\r\n    this.activeLoopingSounds.clear()\r\n    \r\n    // Clear event listeners\r\n    this.eventListeners.clear()\r\n  }\r\n\r\n  /**\r\n   * Get the underlying AudioManager\r\n   */\r\n  getAudioManager(): AudioManager {\r\n    return this.audioManager\r\n  }\r\n}\r\n","import * as THREE from 'three'\r\nimport { Player, PlayerConfig } from './Player'\r\nimport type { EventCallback } from './types'\r\n\r\n/**\r\n * Camera configuration\r\n */\r\nexport const CameraConfig = {\r\n  DEFAULT_SENSITIVITY: 0.002,\r\n  MIN_SENSITIVITY: 0.0001,\r\n  MAX_SENSITIVITY: 0.01,\r\n  FOV: 75,\r\n  NEAR: 0.1,\r\n  FAR: 1000,\r\n}\r\n\r\n/**\r\n * Camera events\r\n */\r\nexport enum CameraEvent {\r\n  SENSITIVITY_CHANGED = 'camera:sensitivityChanged',\r\n}\r\n\r\n/**\r\n * FirstPersonCamera - Handles first-person camera control\r\n * Requirements: 1.2 - Mouse view control with configurable sensitivity\r\n */\r\nexport class FirstPersonCamera {\r\n  private camera: THREE.PerspectiveCamera\r\n  private player: Player | null = null\r\n  private sensitivity: number = CameraConfig.DEFAULT_SENSITIVITY\r\n  \r\n  // Event listeners\r\n  private eventListeners: Map<string, Set<EventCallback>> = new Map()\r\n\r\n  constructor(aspect: number = 16 / 9) {\r\n    this.camera = new THREE.PerspectiveCamera(\r\n      CameraConfig.FOV,\r\n      aspect,\r\n      CameraConfig.NEAR,\r\n      CameraConfig.FAR\r\n    )\r\n    \r\n    // Set initial position at eye height\r\n    this.camera.position.set(0, PlayerConfig.EYE_HEIGHT, 0)\r\n    \r\n    // Use YXZ order for FPS-style rotation (yaw then pitch)\r\n    this.camera.rotation.order = 'YXZ'\r\n  }\r\n\r\n  /**\r\n   * Attach camera to a player\r\n   */\r\n  attachToPlayer(player: Player): void {\r\n    this.player = player\r\n    player.attachCamera(this.camera)\r\n  }\r\n\r\n  /**\r\n   * Detach camera from player\r\n   */\r\n  detachFromPlayer(): void {\r\n    this.player = null\r\n  }\r\n\r\n  /**\r\n   * Handle mouse movement for camera rotation\r\n   * Requirements: 1.2 - Camera rotation proportional to (delta * sensitivity)\r\n   * \r\n   * @param movementX - Raw mouse X movement\r\n   * @param movementY - Raw mouse Y movement\r\n   */\r\n  handleMouseMove(movementX: number, movementY: number): void {\r\n    if (!this.player) return\r\n    \r\n    // Apply sensitivity to mouse movement\r\n    const deltaX = movementX * this.sensitivity\r\n    const deltaY = movementY * this.sensitivity\r\n    \r\n    // Delegate rotation to player (which updates camera)\r\n    this.player.rotate(deltaX, deltaY)\r\n  }\r\n\r\n  /**\r\n   * Update camera aspect ratio (call on window resize)\r\n   */\r\n  updateAspect(aspect: number): void {\r\n    this.camera.aspect = aspect\r\n    this.camera.updateProjectionMatrix()\r\n  }\r\n\r\n  /**\r\n   * Set mouse sensitivity\r\n   * Requirements: 1.2 - Configurable sensitivity\r\n   */\r\n  setSensitivity(sensitivity: number): void {\r\n    const oldSensitivity = this.sensitivity\r\n    this.sensitivity = Math.max(\r\n      CameraConfig.MIN_SENSITIVITY,\r\n      Math.min(CameraConfig.MAX_SENSITIVITY, sensitivity)\r\n    )\r\n    \r\n    if (oldSensitivity !== this.sensitivity) {\r\n      this.emit(CameraEvent.SENSITIVITY_CHANGED, {\r\n        previous: oldSensitivity,\r\n        current: this.sensitivity,\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get current mouse sensitivity\r\n   */\r\n  getSensitivity(): number {\r\n    return this.sensitivity\r\n  }\r\n\r\n  /**\r\n   * Get the Three.js camera\r\n   */\r\n  getCamera(): THREE.PerspectiveCamera {\r\n    return this.camera\r\n  }\r\n\r\n  /**\r\n   * Get camera position\r\n   */\r\n  getPosition(): THREE.Vector3 {\r\n    return this.camera.position.clone()\r\n  }\r\n\r\n  /**\r\n   * Get camera forward direction\r\n   */\r\n  getForwardDirection(): THREE.Vector3 {\r\n    const direction = new THREE.Vector3(0, 0, -1)\r\n    direction.applyQuaternion(this.camera.quaternion)\r\n    return direction\r\n  }\r\n\r\n  /**\r\n   * Get camera right direction\r\n   */\r\n  getRightDirection(): THREE.Vector3 {\r\n    const direction = new THREE.Vector3(1, 0, 0)\r\n    direction.applyQuaternion(this.camera.quaternion)\r\n    return direction\r\n  }\r\n\r\n  // ==================== Event System ====================\r\n\r\n  on(event: string, callback: EventCallback): void {\r\n    if (!this.eventListeners.has(event)) {\r\n      this.eventListeners.set(event, new Set())\r\n    }\r\n    this.eventListeners.get(event)!.add(callback)\r\n  }\r\n\r\n  off(event: string, callback: EventCallback): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.delete(callback)\r\n    }\r\n  }\r\n\r\n  private emit(event: string, data?: unknown): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.forEach((callback) => callback(data))\r\n    }\r\n  }\r\n}\r\n","import * as THREE from 'three'\r\nimport type { EventCallback } from '../types'\r\n\r\n/**\r\n * LOD level configuration\r\n */\r\nexport interface LODLevel {\r\n  distance: number\r\n  detail: 'high' | 'medium' | 'low' | 'billboard'\r\n}\r\n\r\n/**\r\n * Performance metrics\r\n */\r\nexport interface PerformanceMetrics {\r\n  fps: number\r\n  frameTime: number\r\n  drawCalls: number\r\n  triangles: number\r\n  visibleObjects: number\r\n  culledObjects: number\r\n}\r\n\r\n/**\r\n * LOD events\r\n */\r\nexport enum LODEvent {\r\n  QUALITY_CHANGED = 'lod:qualityChanged',\r\n  PERFORMANCE_WARNING = 'lod:performanceWarning',\r\n}\r\n\r\n/**\r\n * LODManager - Handles Level of Detail and performance optimization\r\n * Requirements: 5.3\r\n */\r\nexport class LODManager {\r\n  private scene: THREE.Scene\r\n  private camera: THREE.PerspectiveCamera\r\n  private renderer: THREE.WebGLRenderer\r\n\r\n  // LOD objects tracking\r\n  private lodObjects: Map<string, THREE.LOD> = new Map()\r\n\r\n  // Frustum culling\r\n  private frustum: THREE.Frustum = new THREE.Frustum()\r\n  private projScreenMatrix: THREE.Matrix4 = new THREE.Matrix4()\r\n\r\n  // Performance monitoring\r\n  private frameCount: number = 0\r\n  private lastFPSUpdate: number = 0\r\n  private currentFPS: number = 60\r\n  private targetFPS: number = 60\r\n  private frameTimes: number[] = []\r\n\r\n  // Adaptive quality\r\n  private adaptiveQualityEnabled: boolean = true\r\n  private currentQualityLevel: number = 1 // 0-2 (low, medium, high)\r\n  private qualityAdjustCooldown: number = 0\r\n\r\n  // Object pools for reuse\r\n  private geometryPool: Map<string, THREE.BufferGeometry[]> = new Map()\r\n\r\n  // Event system\r\n  private eventListeners: Map<string, Set<EventCallback>> = new Map()\r\n\r\n  // Culling stats\r\n  private visibleCount: number = 0\r\n  private culledCount: number = 0\r\n\r\n\r\n  constructor(scene: THREE.Scene, camera: THREE.PerspectiveCamera, renderer: THREE.WebGLRenderer) {\r\n    this.scene = scene\r\n    this.camera = camera\r\n    this.renderer = renderer\r\n  }\r\n\r\n  /**\r\n   * Update LOD system - call every frame\r\n   */\r\n  update(deltaTime: number): void {\r\n    // Update performance metrics\r\n    this.updatePerformanceMetrics(deltaTime)\r\n\r\n    // Update frustum for culling\r\n    this.updateFrustum()\r\n\r\n    // Perform frustum culling\r\n    this.performFrustumCulling()\r\n\r\n    // Update LOD levels based on camera distance\r\n    this.updateLODLevels()\r\n\r\n    // Adaptive quality adjustment\r\n    if (this.adaptiveQualityEnabled) {\r\n      this.adjustQuality(deltaTime)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update performance metrics\r\n   */\r\n  private updatePerformanceMetrics(deltaTime: number): void {\r\n    this.frameCount++\r\n    this.frameTimes.push(deltaTime * 1000)\r\n\r\n    // Keep only last 60 frame times\r\n    if (this.frameTimes.length > 60) {\r\n      this.frameTimes.shift()\r\n    }\r\n\r\n    // Update FPS every second\r\n    const now = performance.now()\r\n    if (now - this.lastFPSUpdate >= 1000) {\r\n      this.currentFPS = this.frameCount\r\n      this.frameCount = 0\r\n      this.lastFPSUpdate = now\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update frustum matrix for culling\r\n   */\r\n  private updateFrustum(): void {\r\n    this.projScreenMatrix.multiplyMatrices(\r\n      this.camera.projectionMatrix,\r\n      this.camera.matrixWorldInverse\r\n    )\r\n    this.frustum.setFromProjectionMatrix(this.projScreenMatrix)\r\n  }\r\n\r\n  /**\r\n   * Perform frustum culling on scene objects\r\n   */\r\n  private performFrustumCulling(): void {\r\n    this.visibleCount = 0\r\n    this.culledCount = 0\r\n\r\n    this.scene.traverse((object) => {\r\n      // Skip non-mesh objects and always-visible objects\r\n      if (!(object instanceof THREE.Mesh) || object.userData.noCull) {\r\n        return\r\n      }\r\n\r\n      // Skip objects without geometry bounds\r\n      if (!object.geometry.boundingSphere) {\r\n        object.geometry.computeBoundingSphere()\r\n      }\r\n\r\n      // Get world position for culling check\r\n      const worldPosition = new THREE.Vector3()\r\n      object.getWorldPosition(worldPosition)\r\n\r\n      // Create bounding sphere in world space\r\n      const boundingSphere = object.geometry.boundingSphere!.clone()\r\n      boundingSphere.center.copy(worldPosition)\r\n\r\n      // Apply scale to radius\r\n      const scale = object.scale\r\n      const maxScale = Math.max(scale.x, scale.y, scale.z)\r\n      boundingSphere.radius *= maxScale\r\n\r\n      // Check if in frustum\r\n      const isVisible = this.frustum.intersectsSphere(boundingSphere)\r\n      object.visible = isVisible\r\n\r\n      if (isVisible) {\r\n        this.visibleCount++\r\n      } else {\r\n        this.culledCount++\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Update LOD levels for all LOD objects\r\n   */\r\n  private updateLODLevels(): void {\r\n    this.lodObjects.forEach((lod) => {\r\n      lod.update(this.camera)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Adjust quality based on performance\r\n   */\r\n  private adjustQuality(deltaTime: number): void {\r\n    // Cooldown to prevent rapid quality changes\r\n    if (this.qualityAdjustCooldown > 0) {\r\n      this.qualityAdjustCooldown -= deltaTime\r\n      return\r\n    }\r\n\r\n    const avgFrameTime = this.frameTimes.reduce((a, b) => a + b, 0) / this.frameTimes.length\r\n\r\n    // Target frame time for 60 FPS is ~16.67ms\r\n    const targetFrameTime = 1000 / this.targetFPS\r\n\r\n    if (avgFrameTime > targetFrameTime * 1.5 && this.currentQualityLevel > 0) {\r\n      // Performance is poor, reduce quality\r\n      this.currentQualityLevel--\r\n      this.applyQualityLevel()\r\n      this.qualityAdjustCooldown = 3 // Wait 3 seconds before next adjustment\r\n      this.emit(LODEvent.PERFORMANCE_WARNING, { fps: this.currentFPS, quality: this.currentQualityLevel })\r\n    } else if (avgFrameTime < targetFrameTime * 0.7 && this.currentQualityLevel < 2) {\r\n      // Performance is good, increase quality\r\n      this.currentQualityLevel++\r\n      this.applyQualityLevel()\r\n      this.qualityAdjustCooldown = 5 // Wait 5 seconds before next adjustment\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply current quality level settings\r\n   */\r\n  private applyQualityLevel(): void {\r\n    switch (this.currentQualityLevel) {\r\n      case 0: // Low\r\n        this.renderer.setPixelRatio(1)\r\n        this.setLODDistances(20, 40, 80)\r\n        break\r\n      case 1: // Medium\r\n        this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5))\r\n        this.setLODDistances(30, 60, 120)\r\n        break\r\n      case 2: // High\r\n        this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2))\r\n        this.setLODDistances(50, 100, 200)\r\n        break\r\n    }\r\n\r\n    this.emit(LODEvent.QUALITY_CHANGED, { level: this.currentQualityLevel })\r\n  }\r\n\r\n  /**\r\n   * Set LOD distances for all LOD objects\r\n   */\r\n  private setLODDistances(near: number, mid: number, far: number): void {\r\n    this.lodObjects.forEach((lod) => {\r\n      const levels = lod.levels\r\n      if (levels.length >= 3) {\r\n        levels[0].distance = 0\r\n        levels[1].distance = near\r\n        levels[2].distance = mid\r\n        if (levels.length >= 4) {\r\n          levels[3].distance = far\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n\r\n  // ==================== LOD Object Creation ====================\r\n\r\n  /**\r\n   * Create a LOD object with multiple detail levels\r\n   */\r\n  createLODObject(\r\n    id: string,\r\n    highDetail: THREE.Object3D,\r\n    mediumDetail?: THREE.Object3D,\r\n    lowDetail?: THREE.Object3D,\r\n    billboard?: THREE.Object3D\r\n  ): THREE.LOD {\r\n    const lod = new THREE.LOD()\r\n\r\n    // Add high detail (closest)\r\n    lod.addLevel(highDetail, 0)\r\n\r\n    // Add medium detail\r\n    if (mediumDetail) {\r\n      lod.addLevel(mediumDetail, 30)\r\n    }\r\n\r\n    // Add low detail\r\n    if (lowDetail) {\r\n      lod.addLevel(lowDetail, 60)\r\n    }\r\n\r\n    // Add billboard (furthest)\r\n    if (billboard) {\r\n      lod.addLevel(billboard, 120)\r\n    }\r\n\r\n    this.lodObjects.set(id, lod)\r\n    return lod\r\n  }\r\n\r\n  /**\r\n   * Create simplified geometry for LOD\r\n   */\r\n  createSimplifiedGeometry(\r\n    geometry: THREE.BufferGeometry,\r\n    targetRatio: number\r\n  ): THREE.BufferGeometry {\r\n    // Simple vertex reduction by sampling\r\n    const positions = geometry.getAttribute('position')\r\n    if (!positions) return geometry.clone()\r\n\r\n    const vertexCount = positions.count\r\n    const targetCount = Math.floor(vertexCount * targetRatio)\r\n\r\n    if (targetCount >= vertexCount) return geometry.clone()\r\n\r\n    // Create simplified geometry\r\n    const simplified = new THREE.BufferGeometry()\r\n    const newPositions: number[] = []\r\n    const step = Math.ceil(vertexCount / targetCount)\r\n\r\n    for (let i = 0; i < vertexCount; i += step) {\r\n      newPositions.push(\r\n        positions.getX(i),\r\n        positions.getY(i),\r\n        positions.getZ(i)\r\n      )\r\n    }\r\n\r\n    simplified.setAttribute(\r\n      'position',\r\n      new THREE.Float32BufferAttribute(newPositions, 3)\r\n    )\r\n\r\n    // Copy normals if present\r\n    const normals = geometry.getAttribute('normal')\r\n    if (normals) {\r\n      const newNormals: number[] = []\r\n      for (let i = 0; i < vertexCount; i += step) {\r\n        newNormals.push(\r\n          normals.getX(i),\r\n          normals.getY(i),\r\n          normals.getZ(i)\r\n        )\r\n      }\r\n      simplified.setAttribute(\r\n        'normal',\r\n        new THREE.Float32BufferAttribute(newNormals, 3)\r\n      )\r\n    }\r\n\r\n    simplified.computeBoundingSphere()\r\n    return simplified\r\n  }\r\n\r\n  /**\r\n   * Create a billboard sprite for distant objects\r\n   */\r\n  createBillboard(\r\n    texture: THREE.Texture | null,\r\n    color: number = 0x888888,\r\n    size: number = 10\r\n  ): THREE.Sprite {\r\n    const material = new THREE.SpriteMaterial({\r\n      map: texture,\r\n      color: color,\r\n      transparent: true,\r\n      opacity: 0.8,\r\n    })\r\n    const sprite = new THREE.Sprite(material)\r\n    sprite.scale.set(size, size, 1)\r\n    return sprite\r\n  }\r\n\r\n  /**\r\n   * Remove a LOD object\r\n   */\r\n  removeLODObject(id: string): void {\r\n    const lod = this.lodObjects.get(id)\r\n    if (lod) {\r\n      this.scene.remove(lod)\r\n      this.lodObjects.delete(id)\r\n    }\r\n  }\r\n\r\n  // ==================== Object Pooling ====================\r\n\r\n  /**\r\n   * Get geometry from pool or create new\r\n   */\r\n  getPooledGeometry(type: string, createFn: () => THREE.BufferGeometry): THREE.BufferGeometry {\r\n    const pool = this.geometryPool.get(type)\r\n    if (pool && pool.length > 0) {\r\n      return pool.pop()!\r\n    }\r\n    return createFn()\r\n  }\r\n\r\n  /**\r\n   * Return geometry to pool\r\n   */\r\n  returnToPool(type: string, geometry: THREE.BufferGeometry): void {\r\n    if (!this.geometryPool.has(type)) {\r\n      this.geometryPool.set(type, [])\r\n    }\r\n    const pool = this.geometryPool.get(type)!\r\n    if (pool.length < 50) { // Max pool size\r\n      pool.push(geometry)\r\n    } else {\r\n      geometry.dispose()\r\n    }\r\n  }\r\n\r\n  // ==================== Performance Getters ====================\r\n\r\n  /**\r\n   * Get current performance metrics\r\n   */\r\n  getPerformanceMetrics(): PerformanceMetrics {\r\n    const info = this.renderer.info\r\n    const avgFrameTime = this.frameTimes.length > 0\r\n      ? this.frameTimes.reduce((a, b) => a + b, 0) / this.frameTimes.length\r\n      : 16.67\r\n\r\n    return {\r\n      fps: this.currentFPS,\r\n      frameTime: avgFrameTime,\r\n      drawCalls: info.render.calls,\r\n      triangles: info.render.triangles,\r\n      visibleObjects: this.visibleCount,\r\n      culledObjects: this.culledCount,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get current FPS\r\n   */\r\n  getFPS(): number {\r\n    return this.currentFPS\r\n  }\r\n\r\n  /**\r\n   * Get current quality level (0-2)\r\n   */\r\n  getQualityLevel(): number {\r\n    return this.currentQualityLevel\r\n  }\r\n\r\n  /**\r\n   * Set quality level manually\r\n   */\r\n  setQualityLevel(level: number): void {\r\n    this.currentQualityLevel = Math.max(0, Math.min(2, level))\r\n    this.applyQualityLevel()\r\n  }\r\n\r\n  /**\r\n   * Enable/disable adaptive quality\r\n   */\r\n  setAdaptiveQuality(enabled: boolean): void {\r\n    this.adaptiveQualityEnabled = enabled\r\n  }\r\n\r\n  /**\r\n   * Set target FPS\r\n   */\r\n  setTargetFPS(fps: number): void {\r\n    this.targetFPS = Math.max(30, Math.min(144, fps))\r\n  }\r\n\r\n  // ==================== Event System ====================\r\n\r\n  on(event: string, callback: EventCallback): void {\r\n    if (!this.eventListeners.has(event)) {\r\n      this.eventListeners.set(event, new Set())\r\n    }\r\n    this.eventListeners.get(event)!.add(callback)\r\n  }\r\n\r\n  off(event: string, callback: EventCallback): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.delete(callback)\r\n    }\r\n  }\r\n\r\n  private emit(event: string, data?: unknown): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.forEach(callback => callback(data))\r\n    }\r\n  }\r\n\r\n  // ==================== Cleanup ====================\r\n\r\n  dispose(): void {\r\n    // Clear LOD objects\r\n    this.lodObjects.forEach((lod) => {\r\n      lod.traverse((object) => {\r\n        if (object instanceof THREE.Mesh) {\r\n          object.geometry.dispose()\r\n          if (Array.isArray(object.material)) {\r\n            object.material.forEach(m => m.dispose())\r\n          } else {\r\n            object.material.dispose()\r\n          }\r\n        }\r\n      })\r\n    })\r\n    this.lodObjects.clear()\r\n\r\n    // Clear geometry pools\r\n    this.geometryPool.forEach((pool) => {\r\n      pool.forEach(geometry => geometry.dispose())\r\n    })\r\n    this.geometryPool.clear()\r\n\r\n    // Clear event listeners\r\n    this.eventListeners.clear()\r\n  }\r\n}\r\n","import * as THREE from 'three'\r\nimport type { EventCallback } from '../types'\r\n\r\n/**\r\n * Performance metrics interface\r\n */\r\nexport interface PerformanceMetrics {\r\n  fps: number\r\n  frameTime: number\r\n  avgFrameTime: number\r\n  minFrameTime: number\r\n  maxFrameTime: number\r\n  drawCalls: number\r\n  triangles: number\r\n  geometries: number\r\n  textures: number\r\n  memoryUsed: number\r\n  zombieCount: number\r\n  visibleObjects: number\r\n}\r\n\r\n/**\r\n * Performance events\r\n */\r\nexport enum PerformanceEvent {\r\n  FPS_DROP = 'performance:fpsDrop',\r\n  FPS_RECOVER = 'performance:fpsRecover',\r\n  MEMORY_WARNING = 'performance:memoryWarning',\r\n}\r\n\r\n/**\r\n * PerformanceMonitor - Tracks and reports game performance metrics\r\n * Requirements: 5.3 - Performance optimization and 60 FPS target\r\n */\r\nexport class PerformanceMonitor {\r\n  private renderer: THREE.WebGLRenderer | null = null\r\n  \r\n  // Frame timing\r\n  private frameCount: number = 0\r\n  private lastFPSUpdate: number = 0\r\n  private currentFPS: number = 60\r\n  private frameTimes: number[] = []\r\n  private maxFrameTimeSamples: number = 120\r\n  \r\n  // Performance thresholds\r\n  private targetFPS: number = 60\r\n  private lowFPSThreshold: number = 45\r\n  private criticalFPSThreshold: number = 30\r\n  \r\n  // State tracking\r\n  private isLowFPS: boolean = false\r\n  private consecutiveLowFrames: number = 0\r\n  private lowFrameThreshold: number = 30 // Frames before triggering warning\r\n  \r\n  // Memory tracking\r\n  private lastMemoryCheck: number = 0\r\n  private memoryCheckInterval: number = 5000 // Check every 5 seconds\r\n  \r\n  // External counts\r\n  private zombieCount: number = 0\r\n  private visibleObjectCount: number = 0\r\n  \r\n  // Event system\r\n  private eventListeners: Map<string, Set<EventCallback>> = new Map()\r\n\r\n  constructor() {\r\n    this.lastFPSUpdate = performance.now()\r\n    this.lastMemoryCheck = performance.now()\r\n  }\r\n\r\n  /**\r\n   * Set the renderer for accessing render info\r\n   */\r\n  setRenderer(renderer: THREE.WebGLRenderer): void {\r\n    this.renderer = renderer\r\n  }\r\n\r\n  /**\r\n   * Set target FPS\r\n   */\r\n  setTargetFPS(fps: number): void {\r\n    this.targetFPS = Math.max(30, Math.min(144, fps))\r\n    this.lowFPSThreshold = this.targetFPS * 0.75\r\n    this.criticalFPSThreshold = this.targetFPS * 0.5\r\n  }\r\n\r\n\r\n  /**\r\n   * Update performance metrics - call every frame\r\n   */\r\n  update(deltaTime: number): void {\r\n    const frameTimeMs = deltaTime * 1000\r\n    \r\n    // Track frame times\r\n    this.frameTimes.push(frameTimeMs)\r\n    if (this.frameTimes.length > this.maxFrameTimeSamples) {\r\n      this.frameTimes.shift()\r\n    }\r\n    \r\n    this.frameCount++\r\n    \r\n    // Update FPS every second\r\n    const now = performance.now()\r\n    if (now - this.lastFPSUpdate >= 1000) {\r\n      this.currentFPS = this.frameCount\r\n      this.frameCount = 0\r\n      this.lastFPSUpdate = now\r\n      \r\n      // Check for FPS issues\r\n      this.checkFPSHealth()\r\n    }\r\n    \r\n    // Periodic memory check\r\n    if (now - this.lastMemoryCheck >= this.memoryCheckInterval) {\r\n      this.checkMemory()\r\n      this.lastMemoryCheck = now\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check FPS health and emit events if needed\r\n   */\r\n  private checkFPSHealth(): void {\r\n    if (this.currentFPS < this.lowFPSThreshold) {\r\n      this.consecutiveLowFrames++\r\n      \r\n      if (!this.isLowFPS && this.consecutiveLowFrames >= this.lowFrameThreshold / 60) {\r\n        this.isLowFPS = true\r\n        this.emit(PerformanceEvent.FPS_DROP, {\r\n          fps: this.currentFPS,\r\n          target: this.targetFPS,\r\n          isCritical: this.currentFPS < this.criticalFPSThreshold,\r\n        })\r\n      }\r\n    } else {\r\n      if (this.isLowFPS) {\r\n        this.isLowFPS = false\r\n        this.emit(PerformanceEvent.FPS_RECOVER, {\r\n          fps: this.currentFPS,\r\n          target: this.targetFPS,\r\n        })\r\n      }\r\n      this.consecutiveLowFrames = 0\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check memory usage\r\n   */\r\n  private checkMemory(): void {\r\n    // Check if performance.memory is available (Chrome only)\r\n    const perf = performance as Performance & {\r\n      memory?: { usedJSHeapSize: number; jsHeapSizeLimit: number }\r\n    }\r\n    \r\n    if (perf.memory) {\r\n      const usedMB = perf.memory.usedJSHeapSize / (1024 * 1024)\r\n      const limitMB = perf.memory.jsHeapSizeLimit / (1024 * 1024)\r\n      const usagePercent = (usedMB / limitMB) * 100\r\n      \r\n      if (usagePercent > 80) {\r\n        this.emit(PerformanceEvent.MEMORY_WARNING, {\r\n          usedMB: Math.round(usedMB),\r\n          limitMB: Math.round(limitMB),\r\n          usagePercent: Math.round(usagePercent),\r\n        })\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set external zombie count for metrics\r\n   */\r\n  setZombieCount(count: number): void {\r\n    this.zombieCount = count\r\n  }\r\n\r\n  /**\r\n   * Set visible object count for metrics\r\n   */\r\n  setVisibleObjectCount(count: number): void {\r\n    this.visibleObjectCount = count\r\n  }\r\n\r\n  /**\r\n   * Get current performance metrics\r\n   */\r\n  getMetrics(): PerformanceMetrics {\r\n    const avgFrameTime = this.frameTimes.length > 0\r\n      ? this.frameTimes.reduce((a, b) => a + b, 0) / this.frameTimes.length\r\n      : 16.67\r\n    \r\n    const minFrameTime = this.frameTimes.length > 0\r\n      ? Math.min(...this.frameTimes)\r\n      : 16.67\r\n    \r\n    const maxFrameTime = this.frameTimes.length > 0\r\n      ? Math.max(...this.frameTimes)\r\n      : 16.67\r\n    \r\n    let drawCalls = 0\r\n    let triangles = 0\r\n    let geometries = 0\r\n    let textures = 0\r\n    \r\n    if (this.renderer) {\r\n      const info = this.renderer.info\r\n      drawCalls = info.render.calls\r\n      triangles = info.render.triangles\r\n      geometries = info.memory.geometries\r\n      textures = info.memory.textures\r\n    }\r\n    \r\n    // Get memory usage if available\r\n    let memoryUsed = 0\r\n    const perf = performance as Performance & {\r\n      memory?: { usedJSHeapSize: number }\r\n    }\r\n    if (perf.memory) {\r\n      memoryUsed = Math.round(perf.memory.usedJSHeapSize / (1024 * 1024))\r\n    }\r\n    \r\n    return {\r\n      fps: this.currentFPS,\r\n      frameTime: this.frameTimes[this.frameTimes.length - 1] ?? 16.67,\r\n      avgFrameTime,\r\n      minFrameTime,\r\n      maxFrameTime,\r\n      drawCalls,\r\n      triangles,\r\n      geometries,\r\n      textures,\r\n      memoryUsed,\r\n      zombieCount: this.zombieCount,\r\n      visibleObjects: this.visibleObjectCount,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get current FPS\r\n   */\r\n  getFPS(): number {\r\n    return this.currentFPS\r\n  }\r\n\r\n  /**\r\n   * Check if performance is currently degraded\r\n   */\r\n  isPerformanceDegraded(): boolean {\r\n    return this.isLowFPS\r\n  }\r\n\r\n  // ==================== Event System ====================\r\n\r\n  on(event: string, callback: EventCallback): void {\r\n    if (!this.eventListeners.has(event)) {\r\n      this.eventListeners.set(event, new Set())\r\n    }\r\n    this.eventListeners.get(event)!.add(callback)\r\n  }\r\n\r\n  off(event: string, callback: EventCallback): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.delete(callback)\r\n    }\r\n  }\r\n\r\n  private emit(event: string, data?: unknown): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.forEach((callback) => callback(data))\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Reset all metrics\r\n   */\r\n  reset(): void {\r\n    this.frameCount = 0\r\n    this.currentFPS = 60\r\n    this.frameTimes = []\r\n    this.isLowFPS = false\r\n    this.consecutiveLowFrames = 0\r\n  }\r\n\r\n  /**\r\n   * Dispose resources\r\n   */\r\n  dispose(): void {\r\n    this.eventListeners.clear()\r\n    this.frameTimes = []\r\n    this.renderer = null\r\n  }\r\n}\r\n","import * as THREE from 'three'\r\nimport type { GameState, EventCallback, Vector3 } from './types'\r\nimport { GameEvent, ZombieStateType } from './types'\r\nimport { Player, PlayerEvent } from './Player'\r\nimport { WeaponManager, WeaponManagerEvent } from './weapons/WeaponManager'\r\nimport { ZombieManager } from './zombies/ZombieManager'\r\nimport { WaveManager, WaveEvent } from './waves/WaveManager'\r\nimport { GameOverReason } from './waves/GameOverManager'\r\nimport { AudioManager } from './audio/AudioManager'\r\nimport { GameAudioController } from './audio/GameAudioController'\r\nimport { FirstPersonCamera } from './FirstPersonCamera'\r\nimport { SceneManager } from './SceneManager'\r\nimport { InputManager } from './InputManager'\r\nimport { LODManager } from './scene/LODManager'\r\nimport { PerformanceMonitor, PerformanceEvent } from './performance/PerformanceMonitor'\r\nimport type { PerformanceMetrics } from './performance/PerformanceMonitor'\r\n\r\n/**\r\n * GameController events\r\n */\r\nexport enum GameControllerEvent {\r\n  STATE_CHANGED = 'gameController:stateChanged',\r\n  SCORE_UPDATED = 'gameController:scoreUpdated',\r\n  WAVE_STARTED = 'gameController:waveStarted',\r\n  WAVE_ENDED = 'gameController:waveEnded',\r\n  GAME_OVER = 'gameController:gameOver',\r\n  PLAYER_DAMAGED = 'gameController:playerDamaged',\r\n}\r\n\r\n/**\r\n * Game configuration interface\r\n */\r\nexport interface GameConfig {\r\n  mouseSensitivity: number\r\n  masterVolume: number\r\n  musicVolume: number\r\n  sfxVolume: number\r\n}\r\n\r\n/**\r\n * Default game configuration\r\n */\r\nexport const DEFAULT_GAME_CONFIG: GameConfig = {\r\n  mouseSensitivity: 50,\r\n  masterVolume: 80,\r\n  musicVolume: 70,\r\n  sfxVolume: 90,\r\n}\r\n\r\n\r\n/**\r\n * GameController - Orchestrates all game systems\r\n * Integrates Player, Weapons, Zombies, Waves, and Audio\r\n * Requirements: All - System Integration\r\n */\r\nexport class GameController {\r\n  // Core managers\r\n  private sceneManager: SceneManager\r\n  private inputManager: InputManager\r\n  private player: Player\r\n  private weaponManager: WeaponManager\r\n  private zombieManager: ZombieManager\r\n  private waveManager: WaveManager\r\n  private audioManager: AudioManager\r\n  private audioController: GameAudioController\r\n  private firstPersonCamera: FirstPersonCamera\r\n\r\n  // Performance managers\r\n  private lodManager: LODManager\r\n  private performanceMonitor: PerformanceMonitor\r\n\r\n  // Game state\r\n  private _isInitialized: boolean = false\r\n  private _isRunning: boolean = false\r\n  private _isPaused: boolean = false\r\n  private _score: number = 0\r\n  private _playTime: number = 0\r\n\r\n  // Configuration\r\n  private config: GameConfig = { ...DEFAULT_GAME_CONFIG }\r\n\r\n  // Event listeners\r\n  private eventListeners: Map<string, Set<EventCallback>> = new Map()\r\n\r\n  // Cached objects for performance (avoid allocations in update loop)\r\n  private _cachedPlayerPos: THREE.Vector3 = new THREE.Vector3()\r\n  private _cachedDirection: THREE.Vector3 = new THREE.Vector3()\r\n\r\n  constructor(sceneManager: SceneManager, inputManager: InputManager) {\r\n    this.sceneManager = sceneManager\r\n    this.inputManager = inputManager\r\n\r\n    // Initialize player at spawn position\r\n    this.player = new Player({ x: 0, y: 0, z: 0 })\r\n\r\n    // Initialize weapon manager\r\n    this.weaponManager = new WeaponManager()\r\n\r\n    // Initialize zombie manager with scene\r\n    this.zombieManager = new ZombieManager(this.sceneManager.getScene())\r\n\r\n    // Initialize wave manager\r\n    this.waveManager = new WaveManager()\r\n\r\n    // Initialize audio system\r\n    this.audioManager = new AudioManager()\r\n    this.audioController = new GameAudioController(this.audioManager)\r\n\r\n    // Initialize first person camera\r\n    const camera = this.sceneManager.getCamera()\r\n    this.firstPersonCamera = new FirstPersonCamera(camera.aspect)\r\n    this.firstPersonCamera.setSensitivity(this.config.mouseSensitivity / 50 * 0.002)\r\n\r\n    // Initialize performance systems\r\n    this.lodManager = new LODManager(\r\n      this.sceneManager.getScene(),\r\n      this.sceneManager.getCamera(),\r\n      this.sceneManager.getRenderer()\r\n    )\r\n    this.performanceMonitor = new PerformanceMonitor()\r\n    this.performanceMonitor.setRenderer(this.sceneManager.getRenderer())\r\n  }\r\n\r\n\r\n  /**\r\n   * Initialize all game systems\r\n   */\r\n  async init(): Promise<void> {\r\n    if (this._isInitialized) return\r\n\r\n    // Attach camera to player\r\n    this.player.attachCamera(this.sceneManager.getCamera())\r\n\r\n    // Initialize wave manager with dependencies\r\n    this.waveManager.init(this.zombieManager, this.player)\r\n\r\n    // Initialize audio\r\n    await this.audioController.init()\r\n\r\n    // Setup event listeners between systems\r\n    this.setupEventListeners()\r\n\r\n    // Setup performance event listeners\r\n    this.setupPerformanceListeners()\r\n\r\n    // Load configuration from localStorage\r\n    this.loadConfig()\r\n\r\n    this._isInitialized = true\r\n  }\r\n\r\n  /**\r\n   * Setup performance monitoring event listeners\r\n   */\r\n  private setupPerformanceListeners(): void {\r\n    this.performanceMonitor.on(PerformanceEvent.FPS_DROP, (data) => {\r\n      const fpsData = data as { fps: number; isCritical: boolean }\r\n      console.warn(`Performance warning: FPS dropped to ${fpsData.fps}`)\r\n      \r\n      // Auto-reduce quality if critical\r\n      if (fpsData.isCritical) {\r\n        const currentQuality = this.lodManager.getQualityLevel()\r\n        if (currentQuality > 0) {\r\n          this.lodManager.setQualityLevel(currentQuality - 1)\r\n        }\r\n      }\r\n    })\r\n\r\n    this.performanceMonitor.on(PerformanceEvent.FPS_RECOVER, () => {\r\n      // Performance recovered, could increase quality\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Setup event listeners between game systems\r\n   */\r\n  private setupEventListeners(): void {\r\n    // Player events\r\n    this.player.on(PlayerEvent.HEALTH_CHANGED, (data) => {\r\n      const healthData = data as { current: number; damage?: number }\r\n      if (healthData.damage && healthData.damage > 0) {\r\n        this.audioController.playPlayerHurt()\r\n        this.emit(GameControllerEvent.PLAYER_DAMAGED, healthData)\r\n      }\r\n      this.emitStateChanged()\r\n    })\r\n\r\n    this.player.on(PlayerEvent.DEATH, () => {\r\n      this.audioController.playPlayerDeath()\r\n      this.waveManager.triggerGameOver(GameOverReason.PLAYER_DEATH)\r\n    })\r\n\r\n    this.player.on(PlayerEvent.JUMP, () => {\r\n      this.audioController.playJump()\r\n    })\r\n\r\n    this.player.on(PlayerEvent.LAND, () => {\r\n      this.audioController.playLand()\r\n    })\r\n\r\n\r\n    // Weapon events\r\n    this.weaponManager.on(WeaponManagerEvent.WEAPON_FIRED, (data) => {\r\n      const weaponData = data as { weapon: { type: string } }\r\n      this.audioController.playWeaponFire(\r\n        weaponData.weapon.type,\r\n        this.player.position\r\n      )\r\n    })\r\n\r\n    this.weaponManager.on(WeaponManagerEvent.WEAPON_RELOAD_START, () => {\r\n      this.audioController.playReload(this.player.position)\r\n    })\r\n\r\n    this.weaponManager.on(WeaponManagerEvent.WEAPON_EMPTY, () => {\r\n      this.audioController.playEmptyClick(this.player.position)\r\n    })\r\n\r\n    this.weaponManager.on(WeaponManagerEvent.WEAPON_SWITCHED, () => {\r\n      this.emitStateChanged()\r\n    })\r\n\r\n    this.weaponManager.on(WeaponManagerEvent.AMMO_CHANGED, () => {\r\n      this.emitStateChanged()\r\n    })\r\n\r\n    // Wave events\r\n    this.waveManager.on(WaveEvent.WAVE_START, () => {\r\n      this.audioController.playWaveStart()\r\n      this.audioController.playCombatMusic()\r\n      this.emit(GameControllerEvent.WAVE_STARTED, {\r\n        wave: this.waveManager.currentWave,\r\n        totalZombies: this.waveManager.totalZombiesInWave,\r\n      })\r\n    })\r\n\r\n    this.waveManager.on(WaveEvent.WAVE_END, () => {\r\n      this.audioController.playWaveComplete()\r\n      this.audioController.playAmbientMusic()\r\n      this.emit(GameControllerEvent.WAVE_ENDED, {\r\n        wave: this.waveManager.currentWave,\r\n        score: this.waveManager.score,\r\n      })\r\n    })\r\n\r\n\r\n    this.waveManager.on(WaveEvent.PREPARATION_START, () => {\r\n      this.audioController.playAmbientMusic()\r\n    })\r\n\r\n    this.waveManager.on(WaveEvent.SCORE_CHANGED, (data) => {\r\n      const scoreData = data as { score: number }\r\n      this._score = scoreData.score\r\n      this.emit(GameControllerEvent.SCORE_UPDATED, { score: this._score })\r\n    })\r\n\r\n    this.waveManager.on(WaveEvent.GAME_OVER, (data) => {\r\n      this.audioController.playGameOverMusic()\r\n      this.emit(GameControllerEvent.GAME_OVER, data)\r\n    })\r\n\r\n    // Zombie events\r\n    this.zombieManager.on(GameEvent.ZOMBIE_DEATH, (data) => {\r\n      const zombieData = data as { position?: Vector3 }\r\n      if (zombieData.position) {\r\n        this.audioController.playZombieDeath(zombieData.position)\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Start a new game\r\n   */\r\n  startNewGame(): void {\r\n    // Reset all systems\r\n    this.player = new Player({ x: 0, y: 0, z: 0 })\r\n    this.player.attachCamera(this.sceneManager.getCamera())\r\n    this.setupEventListeners()\r\n\r\n    this.zombieManager.clear()\r\n    this.waveManager.reset()\r\n    this.waveManager.init(this.zombieManager, this.player)\r\n\r\n    this._score = 0\r\n    this._playTime = 0\r\n    this._isRunning = true\r\n    this._isPaused = false\r\n\r\n    // Start the game\r\n    this.waveManager.startGame()\r\n    this.audioController.playAmbientMusic()\r\n\r\n    this.emit(GameEvent.GAME_START)\r\n  }\r\n\r\n\r\n  /**\r\n   * Load game from saved state\r\n   */\r\n  loadGame(state: GameState): void {\r\n    // Restore player state\r\n    this.player.fromState({\r\n      position: state.player.position,\r\n      rotation: state.player.rotation,\r\n      health: state.player.health,\r\n      stamina: state.player.stamina,\r\n    })\r\n\r\n    // Restore weapon state\r\n    this.weaponManager.fromState({\r\n      weapons: state.player.weapons,\r\n      currentWeaponIndex: state.player.currentWeaponIndex,\r\n    })\r\n\r\n    // Restore wave state\r\n    this.waveManager.fromState(state.wave, state.score)\r\n\r\n    // Restore zombies\r\n    this.zombieManager.fromState(state.zombies)\r\n\r\n    this._score = state.score\r\n    this._playTime = state.playTime\r\n    this._isRunning = true\r\n    this._isPaused = false\r\n\r\n    this.emit(GameEvent.GAME_START)\r\n  }\r\n\r\n  /**\r\n   * Get current game state for saving\r\n   */\r\n  getGameState(): GameState {\r\n    const weaponState = this.weaponManager.toState()\r\n\r\n    return {\r\n      player: {\r\n        position: this.player.position,\r\n        rotation: this.player.rotation,\r\n        health: this.player.health,\r\n        stamina: this.player.stamina,\r\n        weapons: weaponState.weapons,\r\n        currentWeaponIndex: weaponState.currentWeaponIndex,\r\n      },\r\n      wave: this.waveManager.toState(),\r\n      zombies: this.zombieManager.toState(),\r\n      score: this._score,\r\n      playTime: this._playTime,\r\n      timestamp: Date.now(),\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * Update game logic each frame\r\n   */\r\n  update(deltaTime: number): void {\r\n    if (!this._isRunning || this._isPaused) return\r\n\r\n    this._playTime += deltaTime\r\n\r\n    // Update performance monitoring\r\n    this.performanceMonitor.update(deltaTime)\r\n    this.performanceMonitor.setZombieCount(this.zombieManager.getActiveCount())\r\n\r\n    // Update player\r\n    this.player.update(deltaTime)\r\n\r\n    // Update zombies with player position\r\n    this.zombieManager.update(deltaTime, this.player.position)\r\n\r\n    // Update wave manager\r\n    this.waveManager.update(deltaTime)\r\n\r\n    // Update audio\r\n    this.audioController.setPlayerPosition(this.player.position)\r\n    this.audioController.update(deltaTime)\r\n\r\n    // Update zombie ambient sounds (throttled for performance)\r\n    this.updateZombieAmbientSoundsThrottled(deltaTime)\r\n\r\n    // Check for zombie attacks on player\r\n    this.checkZombieAttacks()\r\n\r\n    // Update lighting based on player position (use cached vector)\r\n    this._cachedPlayerPos.set(\r\n      this.player.position.x,\r\n      this.player.position.y,\r\n      this.player.position.z\r\n    )\r\n    this.sceneManager.updateLighting(this._cachedPlayerPos)\r\n\r\n    // Update LOD system\r\n    this.lodManager.update(deltaTime)\r\n  }\r\n\r\n  // Throttle zombie ambient sound updates\r\n  private _lastZombieAudioUpdate: number = 0\r\n  private _zombieAudioUpdateInterval: number = 0.1 // 100ms\r\n\r\n  /**\r\n   * Update zombie ambient sounds with throttling for performance\r\n   */\r\n  private updateZombieAmbientSoundsThrottled(deltaTime: number): void {\r\n    this._lastZombieAudioUpdate += deltaTime\r\n    if (this._lastZombieAudioUpdate >= this._zombieAudioUpdateInterval) {\r\n      this._lastZombieAudioUpdate = 0\r\n      \r\n      const zombies = this.zombieManager.getAllZombies().map((z) => ({\r\n        id: z.id,\r\n        position: z.position,\r\n        state: z.state as ZombieStateType,\r\n      }))\r\n      this.audioController.updateZombieAmbientSounds(deltaTime, zombies)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check for zombie attacks on player\r\n   */\r\n  private checkZombieAttacks(): void {\r\n    const zombiesInRange = this.zombieManager.getZombiesInRange(\r\n      this.player.position,\r\n      2.0 // Attack range\r\n    )\r\n\r\n    for (const zombie of zombiesInRange) {\r\n      if (zombie.canAttack()) {\r\n        const damage = zombie.getDamage()\r\n        this.player.takeDamage(damage)\r\n        this.audioController.playZombieAttack(zombie.position)\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * Process player input\r\n   */\r\n  processInput(deltaTime: number): void {\r\n    if (!this._isRunning || this._isPaused) return\r\n\r\n    // Get movement input\r\n    const movement = this.inputManager.getMovementInput()\r\n    const mouseMovement = this.inputManager.getMouseMovement()\r\n\r\n    // Apply movement\r\n    this.player.move(movement.x, movement.z, deltaTime)\r\n\r\n    // Apply camera rotation\r\n    const sensitivity = this.config.mouseSensitivity / 50\r\n    this.player.rotate(\r\n      mouseMovement.x * sensitivity * 0.002,\r\n      mouseMovement.y * sensitivity * 0.002\r\n    )\r\n\r\n    // Handle sprint\r\n    this.player.sprint(this.inputManager.wantsToSprint())\r\n\r\n    // Handle jump\r\n    if (this.inputManager.wantsToJump()) {\r\n      this.player.jump()\r\n    }\r\n\r\n    // Handle weapon actions\r\n    if (this.inputManager.wantsToFire()) {\r\n      this.fireWeapon()\r\n    }\r\n\r\n    if (this.inputManager.wantsToReload()) {\r\n      this.weaponManager.reload()\r\n    }\r\n\r\n    // Handle weapon switching\r\n    const wheelDirection = this.inputManager.getMouseWheelDirection()\r\n    if (wheelDirection > 0) {\r\n      this.weaponManager.cycleNext()\r\n    } else if (wheelDirection < 0) {\r\n      this.weaponManager.cyclePrevious()\r\n    }\r\n\r\n    const weaponSlot = this.inputManager.getWeaponSlotPressed()\r\n    if (weaponSlot >= 0) {\r\n      this.weaponManager.switchToSlot(weaponSlot)\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * Fire the current weapon\r\n   */\r\n  private fireWeapon(): void {\r\n    const camera = this.sceneManager.getCamera()\r\n    const origin = camera.position.clone()\r\n    const direction = new THREE.Vector3()\r\n    camera.getWorldDirection(direction)\r\n\r\n    const result = this.weaponManager.fire(\r\n      origin,\r\n      direction,\r\n      this.sceneManager.getScene()\r\n    )\r\n\r\n    if (result.success && result.hits) {\r\n      // Process hits on zombies\r\n      for (const hit of result.hits) {\r\n        if (hit.zombieId) {\r\n          this.zombieManager.damageZombie(\r\n            hit.zombieId,\r\n            result.damage,\r\n            hit.point\r\n          )\r\n          this.audioController.playZombieHit(hit.point)\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Pause the game\r\n   */\r\n  pause(): void {\r\n    if (!this._isRunning || this._isPaused) return\r\n    this._isPaused = true\r\n    this.audioController.onGamePause()\r\n    this.emit(GameEvent.GAME_PAUSE)\r\n  }\r\n\r\n  /**\r\n   * Resume the game\r\n   */\r\n  resume(): void {\r\n    if (!this._isRunning || !this._isPaused) return\r\n    this._isPaused = false\r\n    this.audioController.onGameResume()\r\n    this.emit(GameEvent.GAME_RESUME)\r\n  }\r\n\r\n  /**\r\n   * Stop the game\r\n   */\r\n  stop(): void {\r\n    this._isRunning = false\r\n    this._isPaused = false\r\n    this.audioController.stopMusic()\r\n    this.emit(GameEvent.GAME_STOP)\r\n  }\r\n\r\n\r\n  // ==================== Configuration ====================\r\n\r\n  /**\r\n   * Apply game configuration\r\n   */\r\n  applyConfig(config: Partial<GameConfig>): void {\r\n    this.config = { ...this.config, ...config }\r\n\r\n    // Apply mouse sensitivity\r\n    if (config.mouseSensitivity !== undefined) {\r\n      this.firstPersonCamera.setSensitivity(config.mouseSensitivity / 50)\r\n    }\r\n\r\n    // Apply audio settings\r\n    if (config.masterVolume !== undefined) {\r\n      this.audioManager.setMasterVolume(config.masterVolume / 100)\r\n    }\r\n    if (config.musicVolume !== undefined) {\r\n      this.audioManager.setMusicVolume(config.musicVolume / 100)\r\n    }\r\n    if (config.sfxVolume !== undefined) {\r\n      this.audioManager.setSfxVolume(config.sfxVolume / 100)\r\n    }\r\n\r\n    // Save to localStorage\r\n    this.saveConfig()\r\n  }\r\n\r\n  /**\r\n   * Save configuration to localStorage\r\n   */\r\n  private saveConfig(): void {\r\n    localStorage.setItem('gameSettings', JSON.stringify(this.config))\r\n  }\r\n\r\n  /**\r\n   * Load configuration from localStorage\r\n   */\r\n  private loadConfig(): void {\r\n    const stored = localStorage.getItem('zww_settings')\r\n    if (stored) {\r\n      try {\r\n        const parsed = JSON.parse(stored)\r\n        this.config = { \r\n          ...DEFAULT_GAME_CONFIG, \r\n          mouseSensitivity: parsed.mouseSensitivity ?? DEFAULT_GAME_CONFIG.mouseSensitivity,\r\n          masterVolume: parsed.masterVolume ?? DEFAULT_GAME_CONFIG.masterVolume,\r\n          musicVolume: parsed.musicVolume ?? DEFAULT_GAME_CONFIG.musicVolume,\r\n          sfxVolume: parsed.sfxVolume ?? DEFAULT_GAME_CONFIG.sfxVolume,\r\n        }\r\n        this.applyConfig(this.config)\r\n      } catch {\r\n        // Use defaults\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get current configuration\r\n   */\r\n  getConfig(): GameConfig {\r\n    return { ...this.config }\r\n  }\r\n\r\n\r\n  // ==================== Getters ====================\r\n\r\n  get isInitialized(): boolean {\r\n    return this._isInitialized\r\n  }\r\n\r\n  get isRunning(): boolean {\r\n    return this._isRunning\r\n  }\r\n\r\n  get isPaused(): boolean {\r\n    return this._isPaused\r\n  }\r\n\r\n  get score(): number {\r\n    return this._score\r\n  }\r\n\r\n  get playTime(): number {\r\n    return this._playTime\r\n  }\r\n\r\n  getPlayer(): Player {\r\n    return this.player\r\n  }\r\n\r\n  getWeaponManager(): WeaponManager {\r\n    return this.weaponManager\r\n  }\r\n\r\n  getZombieManager(): ZombieManager {\r\n    return this.zombieManager\r\n  }\r\n\r\n  getWaveManager(): WaveManager {\r\n    return this.waveManager\r\n  }\r\n\r\n  getAudioController(): GameAudioController {\r\n    return this.audioController\r\n  }\r\n\r\n  getLODManager(): LODManager {\r\n    return this.lodManager\r\n  }\r\n\r\n  getPerformanceMonitor(): PerformanceMonitor {\r\n    return this.performanceMonitor\r\n  }\r\n\r\n  /**\r\n   * Get current performance metrics\r\n   */\r\n  getPerformanceMetrics(): PerformanceMetrics {\r\n    return this.performanceMonitor.getMetrics()\r\n  }\r\n\r\n  /**\r\n   * Get HUD state for UI display\r\n   */\r\n  getHUDState() {\r\n    const weapon = this.weaponManager.getCurrentWeapon()\r\n    return {\r\n      health: this.player.health,\r\n      maxHealth: this.player.maxHealth,\r\n      stamina: this.player.stamina,\r\n      maxStamina: this.player.maxStamina,\r\n      currentWeaponName: weapon?.name ?? 'None',\r\n      currentWeaponSlot: this.weaponManager.getCurrentWeaponIndex(),\r\n      currentAmmo: weapon?.currentAmmo ?? 0,\r\n      reserveAmmo: weapon?.reserveAmmo ?? 0,\r\n      magazineSize: weapon?.magazineSize ?? 0,\r\n      isReloading: this.weaponManager.isReloading(),\r\n      currentWave: this.waveManager.currentWave,\r\n      zombiesKilled: this.waveManager.zombiesKilled,\r\n      totalZombiesInWave: this.waveManager.totalZombiesInWave,\r\n      isPreparationPhase: this.waveManager.isPreparationPhase,\r\n      preparationTimeLeft: this.waveManager.preparationTimeLeft,\r\n      score: this._score,\r\n    }\r\n  }\r\n\r\n\r\n  // ==================== Event System ====================\r\n\r\n  on(event: string, callback: EventCallback): void {\r\n    if (!this.eventListeners.has(event)) {\r\n      this.eventListeners.set(event, new Set())\r\n    }\r\n    this.eventListeners.get(event)!.add(callback)\r\n  }\r\n\r\n  off(event: string, callback: EventCallback): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.delete(callback)\r\n    }\r\n  }\r\n\r\n  private emit(event: string, data?: unknown): void {\r\n    const listeners = this.eventListeners.get(event)\r\n    if (listeners) {\r\n      listeners.forEach((callback) => callback(data))\r\n    }\r\n  }\r\n\r\n  private emitStateChanged(): void {\r\n    this.emit(GameControllerEvent.STATE_CHANGED, this.getHUDState())\r\n  }\r\n\r\n  // ==================== Cleanup ====================\r\n\r\n  /**\r\n   * Dispose all resources\r\n   */\r\n  dispose(): void {\r\n    this.stop()\r\n    this.zombieManager.dispose()\r\n    this.waveManager.dispose()\r\n    this.audioController.dispose()\r\n    this.audioManager.dispose()\r\n    this.lodManager.dispose()\r\n    this.performanceMonitor.dispose()\r\n    this.eventListeners.clear()\r\n  }\r\n}\r\n","<script setup lang=\"ts\">\r\nimport { computed } from 'vue'\r\n\r\n/**\r\n * GameHUD Component - Displays in-game HUD elements\r\n * Requirements: 9.1 - Display health bar, ammo count, current weapon, and wave number\r\n */\r\n\r\n// Props for HUD data\r\ninterface Props {\r\n  // Player stats\r\n  health: number\r\n  maxHealth: number\r\n  stamina: number\r\n  maxStamina: number\r\n  \r\n  // Weapon info\r\n  currentWeaponName: string\r\n  currentWeaponSlot: number\r\n  currentAmmo: number\r\n  reserveAmmo: number\r\n  magazineSize: number\r\n  isReloading: boolean\r\n  \r\n  // Wave info\r\n  currentWave: number\r\n  zombiesKilled: number\r\n  totalZombiesInWave: number\r\n  isPreparationPhase: boolean\r\n  preparationTimeLeft: number\r\n  \r\n  // Score\r\n  score: number\r\n}\r\n\r\nconst props = withDefaults(defineProps<Props>(), {\r\n  health: 100,\r\n  maxHealth: 100,\r\n  stamina: 100,\r\n  maxStamina: 100,\r\n  currentWeaponName: 'Pistol',\r\n  currentWeaponSlot: 0,\r\n  currentAmmo: 15,\r\n  reserveAmmo: 60,\r\n  magazineSize: 15,\r\n  isReloading: false,\r\n  currentWave: 1,\r\n  zombiesKilled: 0,\r\n  totalZombiesInWave: 15,\r\n  isPreparationPhase: false,\r\n  preparationTimeLeft: 30,\r\n  score: 0,\r\n})\r\n\r\n// Computed values\r\nconst healthPercent = computed(() => (props.health / props.maxHealth) * 100)\r\nconst staminaPercent = computed(() => (props.stamina / props.maxStamina) * 100)\r\nconst zombiesRemaining = computed(() => props.totalZombiesInWave - props.zombiesKilled)\r\n\r\n// Health bar color based on health percentage\r\nconst healthBarColor = computed(() => {\r\n  if (healthPercent.value > 50) return '#4ade80' // Green\r\n  if (healthPercent.value > 25) return '#fbbf24' // Yellow\r\n  return '#ef4444' // Red\r\n})\r\n\r\n// Format preparation time as MM:SS\r\nconst formattedPrepTime = computed(() => {\r\n  const seconds = Math.ceil(props.preparationTimeLeft)\r\n  const mins = Math.floor(seconds / 60)\r\n  const secs = seconds % 60\r\n  return `${mins}:${secs.toString().padStart(2, '0')}`\r\n})\r\n\r\n// Format score with commas\r\nconst formattedScore = computed(() => {\r\n  return props.score.toLocaleString()\r\n})\r\n\r\n// Weapon slot display (1-indexed for user)\r\nconst weaponSlotDisplay = computed(() => props.currentWeaponSlot + 1)\r\n\r\n// Ammo display text\r\nconst ammoDisplay = computed(() => {\r\n  if (props.isReloading) return 'RELOADING...'\r\n  return `${props.currentAmmo} / ${props.reserveAmmo}`\r\n})\r\n\r\n// Check if ammo is low (less than 25% of magazine)\r\nconst isAmmoLow = computed(() => props.currentAmmo <= props.magazineSize * 0.25 && props.currentAmmo > 0)\r\nconst isAmmoEmpty = computed(() => props.currentAmmo === 0)\r\n</script>\r\n\r\n<template>\r\n  <div class=\"game-hud\">\r\n    <!-- Top Left: Wave Info -->\r\n    <div class=\"hud-section top-left\">\r\n      <div class=\"wave-info\">\r\n        <div class=\"wave-number\">\r\n          <span class=\"label\">WAVE</span>\r\n          <span class=\"value\">{{ currentWave }}</span>\r\n        </div>\r\n        <div v-if=\"isPreparationPhase\" class=\"preparation-phase\">\r\n          <span class=\"prep-label\">NEXT WAVE IN</span>\r\n          <span class=\"prep-time\">{{ formattedPrepTime }}</span>\r\n        </div>\r\n        <div v-else class=\"zombie-count\">\r\n          <span class=\"label\">ZOMBIES</span>\r\n          <span class=\"value\">{{ zombiesRemaining }}</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Top Right: Score -->\r\n    <div class=\"hud-section top-right\">\r\n      <div class=\"score-display\">\r\n        <span class=\"label\">SCORE</span>\r\n        <span class=\"value\">{{ formattedScore }}</span>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Bottom Left: Health & Stamina -->\r\n    <div class=\"hud-section bottom-left\">\r\n      <div class=\"player-stats\">\r\n        <!-- Health Bar -->\r\n        <div class=\"stat-bar health-bar\">\r\n          <div class=\"bar-label\">\r\n            <span class=\"icon\"></span>\r\n            <span class=\"text\">HEALTH</span>\r\n          </div>\r\n          <div class=\"bar-container\">\r\n            <div \r\n              class=\"bar-fill\" \r\n              :style=\"{ \r\n                width: `${healthPercent}%`,\r\n                backgroundColor: healthBarColor \r\n              }\"\r\n            ></div>\r\n            <span class=\"bar-value\">{{ Math.ceil(health) }} / {{ maxHealth }}</span>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Stamina Bar -->\r\n        <div class=\"stat-bar stamina-bar\">\r\n          <div class=\"bar-label\">\r\n            <span class=\"icon\"></span>\r\n            <span class=\"text\">STAMINA</span>\r\n          </div>\r\n          <div class=\"bar-container\">\r\n            <div \r\n              class=\"bar-fill stamina-fill\" \r\n              :style=\"{ width: `${staminaPercent}%` }\"\r\n            ></div>\r\n            <span class=\"bar-value\">{{ Math.ceil(stamina) }}%</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Bottom Right: Weapon & Ammo -->\r\n    <div class=\"hud-section bottom-right\">\r\n      <div class=\"weapon-info\">\r\n        <!-- Weapon Name & Slot -->\r\n        <div class=\"weapon-name\">\r\n          <span class=\"slot-indicator\">[{{ weaponSlotDisplay }}]</span>\r\n          <span class=\"name\">{{ currentWeaponName }}</span>\r\n        </div>\r\n\r\n        <!-- Ammo Display -->\r\n        <div \r\n          class=\"ammo-display\"\r\n          :class=\"{ \r\n            'low-ammo': isAmmoLow, \r\n            'empty-ammo': isAmmoEmpty,\r\n            'reloading': isReloading \r\n          }\"\r\n        >\r\n          <span class=\"ammo-icon\"></span>\r\n          <span class=\"ammo-text\">{{ ammoDisplay }}</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Center: Crosshair -->\r\n    <div class=\"crosshair\">\r\n      <div class=\"crosshair-dot\"></div>\r\n      <div class=\"crosshair-line top\"></div>\r\n      <div class=\"crosshair-line bottom\"></div>\r\n      <div class=\"crosshair-line left\"></div>\r\n      <div class=\"crosshair-line right\"></div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n\r\n<style scoped>\r\n.game-hud {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  pointer-events: none;\r\n  z-index: 100;\r\n  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\r\n}\r\n\r\n/* HUD Sections */\r\n.hud-section {\r\n  position: absolute;\r\n  padding: 1rem;\r\n}\r\n\r\n.top-left {\r\n  top: 0;\r\n  left: 0;\r\n}\r\n\r\n.top-right {\r\n  top: 0;\r\n  right: 0;\r\n}\r\n\r\n.bottom-left {\r\n  bottom: 0;\r\n  left: 0;\r\n}\r\n\r\n.bottom-right {\r\n  bottom: 0;\r\n  right: 0;\r\n}\r\n\r\n/* Wave Info */\r\n.wave-info {\r\n  background: rgba(0, 0, 0, 0.6);\r\n  border: 2px solid rgba(233, 69, 96, 0.5);\r\n  border-radius: 8px;\r\n  padding: 0.75rem 1.25rem;\r\n  min-width: 150px;\r\n}\r\n\r\n.wave-number {\r\n  display: flex;\r\n  align-items: baseline;\r\n  gap: 0.5rem;\r\n  margin-bottom: 0.25rem;\r\n}\r\n\r\n.wave-number .label {\r\n  color: #a0a0a0;\r\n  font-size: 0.75rem;\r\n  font-weight: 600;\r\n  letter-spacing: 1px;\r\n}\r\n\r\n.wave-number .value {\r\n  color: #e94560;\r\n  font-size: 2rem;\r\n  font-weight: bold;\r\n  text-shadow: 0 0 10px rgba(233, 69, 96, 0.5);\r\n}\r\n\r\n.preparation-phase {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: flex-start;\r\n  margin-top: 0.5rem;\r\n  padding-top: 0.5rem;\r\n  border-top: 1px solid rgba(255, 255, 255, 0.1);\r\n}\r\n\r\n.prep-label {\r\n  color: #fbbf24;\r\n  font-size: 0.65rem;\r\n  font-weight: 600;\r\n  letter-spacing: 1px;\r\n}\r\n\r\n.prep-time {\r\n  color: #fbbf24;\r\n  font-size: 1.5rem;\r\n  font-weight: bold;\r\n  animation: pulse 1s ease-in-out infinite;\r\n}\r\n\r\n@keyframes pulse {\r\n  0%, 100% { opacity: 1; }\r\n  50% { opacity: 0.7; }\r\n}\r\n\r\n.zombie-count {\r\n  display: flex;\r\n  align-items: baseline;\r\n  gap: 0.5rem;\r\n}\r\n\r\n.zombie-count .label {\r\n  color: #a0a0a0;\r\n  font-size: 0.65rem;\r\n  font-weight: 600;\r\n  letter-spacing: 1px;\r\n}\r\n\r\n.zombie-count .value {\r\n  color: #ffffff;\r\n  font-size: 1.25rem;\r\n  font-weight: bold;\r\n}\r\n\r\n/* Score Display */\r\n.score-display {\r\n  background: rgba(0, 0, 0, 0.6);\r\n  border: 2px solid rgba(233, 69, 96, 0.5);\r\n  border-radius: 8px;\r\n  padding: 0.75rem 1.25rem;\r\n  text-align: right;\r\n}\r\n\r\n.score-display .label {\r\n  display: block;\r\n  color: #a0a0a0;\r\n  font-size: 0.65rem;\r\n  font-weight: 600;\r\n  letter-spacing: 1px;\r\n  margin-bottom: 0.25rem;\r\n}\r\n\r\n.score-display .value {\r\n  color: #fbbf24;\r\n  font-size: 1.75rem;\r\n  font-weight: bold;\r\n  text-shadow: 0 0 10px rgba(251, 191, 36, 0.5);\r\n}\r\n\r\n/* Player Stats */\r\n.player-stats {\r\n  background: rgba(0, 0, 0, 0.6);\r\n  border: 2px solid rgba(233, 69, 96, 0.5);\r\n  border-radius: 8px;\r\n  padding: 0.75rem 1rem;\r\n  min-width: 220px;\r\n}\r\n\r\n.stat-bar {\r\n  margin-bottom: 0.5rem;\r\n}\r\n\r\n.stat-bar:last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n.bar-label {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.35rem;\r\n  margin-bottom: 0.25rem;\r\n}\r\n\r\n.bar-label .icon {\r\n  font-size: 0.9rem;\r\n}\r\n\r\n.bar-label .text {\r\n  color: #a0a0a0;\r\n  font-size: 0.65rem;\r\n  font-weight: 600;\r\n  letter-spacing: 1px;\r\n}\r\n\r\n.bar-container {\r\n  position: relative;\r\n  height: 20px;\r\n  background: rgba(255, 255, 255, 0.1);\r\n  border-radius: 4px;\r\n  overflow: hidden;\r\n}\r\n\r\n.bar-fill {\r\n  height: 100%;\r\n  transition: width 0.3s ease, background-color 0.3s ease;\r\n  border-radius: 4px;\r\n}\r\n\r\n.stamina-fill {\r\n  background: linear-gradient(90deg, #3b82f6, #60a5fa);\r\n}\r\n\r\n.bar-value {\r\n  position: absolute;\r\n  top: 50%;\r\n  left: 50%;\r\n  transform: translate(-50%, -50%);\r\n  color: #ffffff;\r\n  font-size: 0.75rem;\r\n  font-weight: bold;\r\n  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);\r\n}\r\n\r\n/* Weapon Info */\r\n.weapon-info {\r\n  background: rgba(0, 0, 0, 0.6);\r\n  border: 2px solid rgba(233, 69, 96, 0.5);\r\n  border-radius: 8px;\r\n  padding: 0.75rem 1.25rem;\r\n  text-align: right;\r\n  min-width: 180px;\r\n}\r\n\r\n.weapon-name {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: flex-end;\r\n  gap: 0.5rem;\r\n  margin-bottom: 0.5rem;\r\n}\r\n\r\n.slot-indicator {\r\n  color: #a0a0a0;\r\n  font-size: 0.9rem;\r\n  font-weight: 600;\r\n}\r\n\r\n.weapon-name .name {\r\n  color: #ffffff;\r\n  font-size: 1.1rem;\r\n  font-weight: bold;\r\n  text-transform: uppercase;\r\n}\r\n\r\n.ammo-display {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: flex-end;\r\n  gap: 0.5rem;\r\n}\r\n\r\n.ammo-icon {\r\n  font-size: 1.25rem;\r\n}\r\n\r\n.ammo-text {\r\n  color: #ffffff;\r\n  font-size: 1.5rem;\r\n  font-weight: bold;\r\n  font-family: 'Courier New', monospace;\r\n}\r\n\r\n.ammo-display.low-ammo .ammo-text {\r\n  color: #fbbf24;\r\n  animation: pulse 0.5s ease-in-out infinite;\r\n}\r\n\r\n.ammo-display.empty-ammo .ammo-text {\r\n  color: #ef4444;\r\n}\r\n\r\n.ammo-display.reloading .ammo-text {\r\n  color: #60a5fa;\r\n  font-size: 1rem;\r\n  animation: pulse 0.5s ease-in-out infinite;\r\n}\r\n\r\n/* Crosshair */\r\n.crosshair {\r\n  position: absolute;\r\n  top: 50%;\r\n  left: 50%;\r\n  transform: translate(-50%, -50%);\r\n}\r\n\r\n.crosshair-dot {\r\n  width: 4px;\r\n  height: 4px;\r\n  background: rgba(255, 255, 255, 0.9);\r\n  border-radius: 50%;\r\n  position: absolute;\r\n  top: 50%;\r\n  left: 50%;\r\n  transform: translate(-50%, -50%);\r\n}\r\n\r\n.crosshair-line {\r\n  position: absolute;\r\n  background: rgba(255, 255, 255, 0.7);\r\n}\r\n\r\n.crosshair-line.top,\r\n.crosshair-line.bottom {\r\n  width: 2px;\r\n  height: 10px;\r\n  left: 50%;\r\n  transform: translateX(-50%);\r\n}\r\n\r\n.crosshair-line.top {\r\n  bottom: 8px;\r\n}\r\n\r\n.crosshair-line.bottom {\r\n  top: 8px;\r\n}\r\n\r\n.crosshair-line.left,\r\n.crosshair-line.right {\r\n  width: 10px;\r\n  height: 2px;\r\n  top: 50%;\r\n  transform: translateY(-50%);\r\n}\r\n\r\n.crosshair-line.left {\r\n  right: 8px;\r\n}\r\n\r\n.crosshair-line.right {\r\n  left: 8px;\r\n}\r\n</style>\r\n","<script setup lang=\"ts\">\r\nimport { computed, ref, watch } from 'vue'\r\n\r\n/**\r\n * DamageOverlay Component - Visual feedback for damage and low health\r\n * Requirements: 9.4 - Red vignette effect proportional to damage received\r\n * Requirements: 9.5 - Pulsing low health warning indicator when health < 25%\r\n */\r\n\r\ninterface Props {\r\n  health: number\r\n  maxHealth: number\r\n  lastDamage: number  // Amount of last damage taken (triggers flash)\r\n  damageTimestamp: number  // Timestamp of last damage (for triggering animation)\r\n}\r\n\r\nconst props = withDefaults(defineProps<Props>(), {\r\n  health: 100,\r\n  maxHealth: 100,\r\n  lastDamage: 0,\r\n  damageTimestamp: 0,\r\n})\r\n\r\n// Track damage flash state\r\nconst isDamageFlashing = ref(false)\r\nconst damageIntensity = ref(0)\r\n\r\n// Computed: Health percentage\r\nconst healthPercent = computed(() => (props.health / props.maxHealth) * 100)\r\n\r\n// Computed: Is low health (< 25%)\r\nconst isLowHealth = computed(() => healthPercent.value < 25 && healthPercent.value > 0)\r\n\r\n// Computed: Is critical health (< 10%)\r\nconst isCriticalHealth = computed(() => healthPercent.value < 10 && healthPercent.value > 0)\r\n\r\n// Computed: Low health vignette intensity (increases as health decreases)\r\nconst lowHealthIntensity = computed(() => {\r\n  if (!isLowHealth.value) return 0\r\n  // Scale from 0 at 25% to 0.6 at 0%\r\n  return Math.min(0.6, (25 - healthPercent.value) / 25 * 0.6)\r\n})\r\n\r\n// Watch for damage events\r\nwatch(() => props.damageTimestamp, () => {\r\n  if (props.lastDamage > 0) {\r\n    triggerDamageFlash(props.lastDamage)\r\n  }\r\n})\r\n\r\n// Trigger damage flash effect\r\nfunction triggerDamageFlash(damage: number) {\r\n  // Calculate intensity based on damage (max at 50 damage)\r\n  damageIntensity.value = Math.min(0.8, damage / 50 * 0.8)\r\n  isDamageFlashing.value = true\r\n  \r\n  // Reset flash after animation\r\n  setTimeout(() => {\r\n    isDamageFlashing.value = false\r\n    damageIntensity.value = 0\r\n  }, 300)\r\n}\r\n\r\n// Computed: Combined vignette opacity\r\nconst vignetteOpacity = computed(() => {\r\n  if (isDamageFlashing.value) {\r\n    return damageIntensity.value\r\n  }\r\n  return lowHealthIntensity.value\r\n})\r\n</script>\r\n\r\n<template>\r\n  <div class=\"damage-overlay\">\r\n    <!-- Damage Flash Vignette -->\r\n    <div \r\n      class=\"vignette damage-vignette\"\r\n      :class=\"{ 'flash-active': isDamageFlashing }\"\r\n      :style=\"{ opacity: isDamageFlashing ? damageIntensity : 0 }\"\r\n    ></div>\r\n\r\n    <!-- Low Health Vignette (persistent) -->\r\n    <div \r\n      v-if=\"isLowHealth\"\r\n      class=\"vignette low-health-vignette\"\r\n      :class=\"{ 'critical': isCriticalHealth }\"\r\n      :style=\"{ opacity: lowHealthIntensity }\"\r\n    ></div>\r\n\r\n    <!-- Low Health Warning Indicator -->\r\n    <div \r\n      v-if=\"isLowHealth\"\r\n      class=\"low-health-warning\"\r\n      :class=\"{ 'critical': isCriticalHealth }\"\r\n    >\r\n      <div class=\"warning-icon\"></div>\r\n      <div class=\"warning-text\">LOW HEALTH</div>\r\n      <div class=\"health-value\">{{ Math.ceil(props.health) }}</div>\r\n    </div>\r\n\r\n    <!-- Heartbeat Effect for Critical Health -->\r\n    <div \r\n      v-if=\"isCriticalHealth\"\r\n      class=\"heartbeat-overlay\"\r\n    ></div>\r\n  </div>\r\n</template>\r\n\r\n<style scoped>\r\n.damage-overlay {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  pointer-events: none;\r\n  z-index: 99;\r\n}\r\n\r\n/* Base Vignette Style */\r\n.vignette {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  pointer-events: none;\r\n  transition: opacity 0.15s ease-out;\r\n}\r\n\r\n/* Damage Flash Vignette */\r\n.damage-vignette {\r\n  background: radial-gradient(\r\n    ellipse at center,\r\n    transparent 30%,\r\n    rgba(255, 0, 0, 0.3) 60%,\r\n    rgba(200, 0, 0, 0.7) 100%\r\n  );\r\n}\r\n\r\n.damage-vignette.flash-active {\r\n  animation: damageFlash 0.3s ease-out;\r\n}\r\n\r\n@keyframes damageFlash {\r\n  0% {\r\n    opacity: 0;\r\n  }\r\n  20% {\r\n    opacity: 1;\r\n  }\r\n  100% {\r\n    opacity: 0;\r\n  }\r\n}\r\n\r\n/* Low Health Vignette */\r\n.low-health-vignette {\r\n  background: radial-gradient(\r\n    ellipse at center,\r\n    transparent 40%,\r\n    rgba(180, 0, 0, 0.2) 70%,\r\n    rgba(120, 0, 0, 0.5) 100%\r\n  );\r\n  animation: lowHealthPulse 1.5s ease-in-out infinite;\r\n}\r\n\r\n.low-health-vignette.critical {\r\n  background: radial-gradient(\r\n    ellipse at center,\r\n    transparent 30%,\r\n    rgba(200, 0, 0, 0.3) 60%,\r\n    rgba(150, 0, 0, 0.6) 100%\r\n  );\r\n  animation: criticalHealthPulse 0.8s ease-in-out infinite;\r\n}\r\n\r\n@keyframes lowHealthPulse {\r\n  0%, 100% {\r\n    opacity: 0.3;\r\n  }\r\n  50% {\r\n    opacity: 0.6;\r\n  }\r\n}\r\n\r\n@keyframes criticalHealthPulse {\r\n  0%, 100% {\r\n    opacity: 0.4;\r\n  }\r\n  50% {\r\n    opacity: 0.8;\r\n  }\r\n}\r\n\r\n/* Low Health Warning Indicator */\r\n.low-health-warning {\r\n  position: absolute;\r\n  top: 50%;\r\n  left: 50%;\r\n  transform: translate(-50%, -50%);\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  gap: 0.25rem;\r\n  padding: 1rem 2rem;\r\n  background: rgba(0, 0, 0, 0.5);\r\n  border: 2px solid rgba(255, 0, 0, 0.5);\r\n  border-radius: 8px;\r\n  animation: warningPulse 1.5s ease-in-out infinite;\r\n  opacity: 0.8;\r\n}\r\n\r\n.low-health-warning.critical {\r\n  border-color: rgba(255, 0, 0, 0.8);\r\n  animation: criticalWarningPulse 0.8s ease-in-out infinite;\r\n}\r\n\r\n@keyframes warningPulse {\r\n  0%, 100% {\r\n    opacity: 0.6;\r\n    transform: translate(-50%, -50%) scale(1);\r\n  }\r\n  50% {\r\n    opacity: 0.9;\r\n    transform: translate(-50%, -50%) scale(1.02);\r\n  }\r\n}\r\n\r\n@keyframes criticalWarningPulse {\r\n  0%, 100% {\r\n    opacity: 0.7;\r\n    transform: translate(-50%, -50%) scale(1);\r\n  }\r\n  50% {\r\n    opacity: 1;\r\n    transform: translate(-50%, -50%) scale(1.05);\r\n  }\r\n}\r\n\r\n.warning-icon {\r\n  font-size: 2rem;\r\n  color: #ef4444;\r\n  animation: iconPulse 0.8s ease-in-out infinite;\r\n}\r\n\r\n@keyframes iconPulse {\r\n  0%, 100% {\r\n    transform: scale(1);\r\n  }\r\n  50% {\r\n    transform: scale(1.1);\r\n  }\r\n}\r\n\r\n.warning-text {\r\n  color: #ef4444;\r\n  font-size: 0.9rem;\r\n  font-weight: bold;\r\n  letter-spacing: 2px;\r\n  text-shadow: 0 0 10px rgba(239, 68, 68, 0.5);\r\n}\r\n\r\n.health-value {\r\n  color: #ffffff;\r\n  font-size: 1.5rem;\r\n  font-weight: bold;\r\n  text-shadow: 0 0 10px rgba(239, 68, 68, 0.5);\r\n}\r\n\r\n/* Heartbeat Overlay for Critical Health */\r\n.heartbeat-overlay {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  border: 4px solid transparent;\r\n  box-sizing: border-box;\r\n  animation: heartbeat 0.8s ease-in-out infinite;\r\n}\r\n\r\n@keyframes heartbeat {\r\n  0%, 100% {\r\n    border-color: transparent;\r\n  }\r\n  25% {\r\n    border-color: rgba(255, 0, 0, 0.3);\r\n  }\r\n  50% {\r\n    border-color: transparent;\r\n  }\r\n  75% {\r\n    border-color: rgba(255, 0, 0, 0.2);\r\n  }\r\n}\r\n</style>\r\n","<script setup lang=\"ts\">\r\nimport { ref, computed } from 'vue'\r\nimport { useRouter } from 'vue-router'\r\nimport { useAuthStore, useGameStore } from '@/stores'\r\nimport { gameApi } from '@/api/game'\r\nimport type { GameState } from '@engine/types'\r\n\r\n/**\r\n * PauseMenu Component - In-game pause menu with options\r\n * Requirements: 9.2 - Display pause menu with resume, save, settings, and quit options\r\n */\r\n\r\n// Props\r\ninterface Props {\r\n  gameState: GameState | null\r\n}\r\n\r\nconst props = defineProps<Props>()\r\n\r\n// Emits\r\nconst emit = defineEmits<{\r\n  (e: 'resume'): void\r\n  (e: 'quit'): void\r\n  (e: 'settingsChanged', settings: GameSettings): void\r\n}>()\r\n\r\n// Types\r\ninterface GameSettings {\r\n  mouseSensitivity: number\r\n  masterVolume: number\r\n  musicVolume: number\r\n  sfxVolume: number\r\n}\r\n\r\nconst router = useRouter()\r\nconst authStore = useAuthStore()\r\nconst gameStore = useGameStore()\r\n\r\n// Menu state\r\nconst currentView = ref<'main' | 'settings' | 'confirm-quit'>('main')\r\nconst isSaving = ref(false)\r\nconst saveMessage = ref<string | null>(null)\r\nconst saveError = ref<string | null>(null)\r\n\r\n// Settings state\r\nconst settings = ref<GameSettings>({\r\n  mouseSensitivity: 50,\r\n  masterVolume: 80,\r\n  musicVolume: 70,\r\n  sfxVolume: 90,\r\n})\r\n\r\n// Computed\r\nconst isAuthenticated = computed(() => authStore.isAuthenticated)\r\nconst canSave = computed(() => isAuthenticated.value && props.gameState !== null)\r\n\r\n// Load settings from localStorage\r\nfunction loadSettings() {\r\n  const stored = localStorage.getItem('gameSettings')\r\n  if (stored) {\r\n    try {\r\n      const parsed = JSON.parse(stored)\r\n      settings.value = { ...settings.value, ...parsed }\r\n    } catch {\r\n      // Ignore parse errors\r\n    }\r\n  }\r\n}\r\n\r\n// Initialize settings\r\nloadSettings()\r\n\r\n// Resume game\r\nfunction resumeGame() {\r\n  emit('resume')\r\n}\r\n\r\n// Save game\r\nasync function saveGame() {\r\n  if (!canSave.value || !props.gameState) return\r\n  \r\n  isSaving.value = true\r\n  saveMessage.value = null\r\n  saveError.value = null\r\n  \r\n  try {\r\n    const response = await gameApi.saveGame(props.gameState)\r\n    gameStore.setCurrentSaveId(response.saveId)\r\n    gameStore.updateLastSaveTime()\r\n    saveMessage.value = '!'\r\n    \r\n    // Clear message after 2 seconds\r\n    setTimeout(() => {\r\n      saveMessage.value = null\r\n    }, 2000)\r\n  } catch (error) {\r\n    saveError.value = error instanceof Error ? error.message : ''\r\n  } finally {\r\n    isSaving.value = false\r\n  }\r\n}\r\n\r\n// Open settings\r\nfunction openSettings() {\r\n  currentView.value = 'settings'\r\n}\r\n\r\n// Close settings\r\nfunction closeSettings() {\r\n  currentView.value = 'main'\r\n}\r\n\r\n// Save settings\r\nfunction saveSettings() {\r\n  localStorage.setItem('gameSettings', JSON.stringify(settings.value))\r\n  emit('settingsChanged', settings.value)\r\n  currentView.value = 'main'\r\n}\r\n\r\n// Show quit confirmation\r\nfunction showQuitConfirm() {\r\n  currentView.value = 'confirm-quit'\r\n}\r\n\r\n// Cancel quit\r\nfunction cancelQuit() {\r\n  currentView.value = 'main'\r\n}\r\n\r\n// Confirm quit - go to main menu\r\nfunction confirmQuit() {\r\n  emit('quit')\r\n  router.push('/')\r\n}\r\n</script>\r\n\r\n<template>\r\n  <div class=\"pause-menu-overlay\">\r\n    <div class=\"pause-menu\">\r\n      <!-- Main Pause Menu -->\r\n      <div v-if=\"currentView === 'main'\" class=\"menu-content\">\r\n        <h2 class=\"menu-title\"></h2>\r\n        \r\n        <!-- Save status messages -->\r\n        <div v-if=\"saveMessage\" class=\"save-message success\">\r\n          {{ saveMessage }}\r\n        </div>\r\n        <div v-if=\"saveError\" class=\"save-message error\">\r\n          {{ saveError }}\r\n        </div>\r\n        \r\n        <div class=\"menu-buttons\">\r\n          <button class=\"menu-btn primary\" @click=\"resumeGame\">\r\n            <span class=\"btn-icon\"></span>\r\n            <span class=\"btn-text\"></span>\r\n          </button>\r\n          \r\n          <button \r\n            class=\"menu-btn\" \r\n            @click=\"saveGame\"\r\n            :disabled=\"!canSave || isSaving\"\r\n            :class=\"{ disabled: !canSave || isSaving }\"\r\n          >\r\n            <span class=\"btn-icon\"></span>\r\n            <span class=\"btn-text\">{{ isSaving ? '...' : '' }}</span>\r\n          </button>\r\n          \r\n          <button class=\"menu-btn\" @click=\"openSettings\">\r\n            <span class=\"btn-icon\"></span>\r\n            <span class=\"btn-text\"></span>\r\n          </button>\r\n          \r\n          <button class=\"menu-btn danger\" @click=\"showQuitConfirm\">\r\n            <span class=\"btn-icon\"></span>\r\n            <span class=\"btn-text\"></span>\r\n          </button>\r\n        </div>\r\n        \r\n        <p v-if=\"!isAuthenticated\" class=\"login-hint\">\r\n          \r\n        </p>\r\n      </div>\r\n\r\n      <!-- Settings View -->\r\n      <div v-if=\"currentView === 'settings'\" class=\"menu-content settings-view\">\r\n        <h2 class=\"menu-title\"></h2>\r\n        \r\n        <div class=\"settings-list\">\r\n          <div class=\"setting-item\">\r\n            <label></label>\r\n            <div class=\"slider-container\">\r\n              <input \r\n                type=\"range\" \r\n                v-model.number=\"settings.mouseSensitivity\" \r\n                min=\"1\" \r\n                max=\"100\"\r\n                class=\"slider\"\r\n              />\r\n              <span class=\"slider-value\">{{ settings.mouseSensitivity }}</span>\r\n            </div>\r\n          </div>\r\n          \r\n          <div class=\"setting-item\">\r\n            <label></label>\r\n            <div class=\"slider-container\">\r\n              <input \r\n                type=\"range\" \r\n                v-model.number=\"settings.masterVolume\" \r\n                min=\"0\" \r\n                max=\"100\"\r\n                class=\"slider\"\r\n              />\r\n              <span class=\"slider-value\">{{ settings.masterVolume }}%</span>\r\n            </div>\r\n          </div>\r\n          \r\n          <div class=\"setting-item\">\r\n            <label></label>\r\n            <div class=\"slider-container\">\r\n              <input \r\n                type=\"range\" \r\n                v-model.number=\"settings.musicVolume\" \r\n                min=\"0\" \r\n                max=\"100\"\r\n                class=\"slider\"\r\n              />\r\n              <span class=\"slider-value\">{{ settings.musicVolume }}%</span>\r\n            </div>\r\n          </div>\r\n          \r\n          <div class=\"setting-item\">\r\n            <label></label>\r\n            <div class=\"slider-container\">\r\n              <input \r\n                type=\"range\" \r\n                v-model.number=\"settings.sfxVolume\" \r\n                min=\"0\" \r\n                max=\"100\"\r\n                class=\"slider\"\r\n              />\r\n              <span class=\"slider-value\">{{ settings.sfxVolume }}%</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"menu-buttons horizontal\">\r\n          <button class=\"menu-btn\" @click=\"saveSettings\"></button>\r\n          <button class=\"menu-btn secondary\" @click=\"closeSettings\"></button>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Quit Confirmation -->\r\n      <div v-if=\"currentView === 'confirm-quit'\" class=\"menu-content confirm-view\">\r\n        <h2 class=\"menu-title\"></h2>\r\n        <p class=\"confirm-text\"></p>\r\n        \r\n        <div class=\"menu-buttons horizontal\">\r\n          <button class=\"menu-btn danger\" @click=\"confirmQuit\"></button>\r\n          <button class=\"menu-btn secondary\" @click=\"cancelQuit\"></button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n\r\n<style scoped>\r\n.pause-menu-overlay {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  background: rgba(0, 0, 0, 0.8);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  z-index: 1000;\r\n  backdrop-filter: blur(4px);\r\n}\r\n\r\n.pause-menu {\r\n  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);\r\n  border: 2px solid rgba(233, 69, 96, 0.5);\r\n  border-radius: 16px;\r\n  padding: 2rem;\r\n  min-width: 350px;\r\n  max-width: 450px;\r\n  box-shadow: 0 0 40px rgba(233, 69, 96, 0.3);\r\n}\r\n\r\n.menu-content {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n}\r\n\r\n.menu-title {\r\n  color: #e94560;\r\n  font-size: 2rem;\r\n  margin-bottom: 1.5rem;\r\n  text-shadow: 0 0 10px rgba(233, 69, 96, 0.5);\r\n  text-align: center;\r\n}\r\n\r\n/* Save Messages */\r\n.save-message {\r\n  padding: 0.75rem 1.5rem;\r\n  border-radius: 4px;\r\n  margin-bottom: 1rem;\r\n  text-align: center;\r\n  width: 100%;\r\n}\r\n\r\n.save-message.success {\r\n  background: rgba(74, 222, 128, 0.2);\r\n  border: 1px solid #4ade80;\r\n  color: #4ade80;\r\n}\r\n\r\n.save-message.error {\r\n  background: rgba(239, 68, 68, 0.2);\r\n  border: 1px solid #ef4444;\r\n  color: #ef4444;\r\n}\r\n\r\n/* Menu Buttons */\r\n.menu-buttons {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 0.75rem;\r\n  width: 100%;\r\n}\r\n\r\n.menu-buttons.horizontal {\r\n  flex-direction: row;\r\n  gap: 1rem;\r\n}\r\n\r\n.menu-btn {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 0.75rem;\r\n  padding: 1rem 1.5rem;\r\n  font-size: 1rem;\r\n  background: rgba(233, 69, 96, 0.2);\r\n  border: 2px solid #e94560;\r\n  color: #ffffff;\r\n  cursor: pointer;\r\n  transition: all 0.3s ease;\r\n  border-radius: 8px;\r\n  flex: 1;\r\n}\r\n\r\n.menu-btn:hover:not(.disabled) {\r\n  background: #e94560;\r\n  transform: translateY(-2px);\r\n}\r\n\r\n.menu-btn.primary {\r\n  background: rgba(233, 69, 96, 0.4);\r\n  font-weight: bold;\r\n}\r\n\r\n.menu-btn.secondary {\r\n  background: rgba(100, 100, 100, 0.2);\r\n  border-color: #666;\r\n}\r\n\r\n.menu-btn.secondary:hover {\r\n  background: #666;\r\n}\r\n\r\n.menu-btn.danger {\r\n  background: rgba(239, 68, 68, 0.2);\r\n  border-color: #ef4444;\r\n}\r\n\r\n.menu-btn.danger:hover {\r\n  background: #ef4444;\r\n}\r\n\r\n.menu-btn.disabled {\r\n  opacity: 0.5;\r\n  cursor: not-allowed;\r\n}\r\n\r\n.btn-icon {\r\n  font-size: 1.25rem;\r\n}\r\n\r\n.btn-text {\r\n  flex: 1;\r\n  text-align: left;\r\n}\r\n\r\n.menu-buttons.horizontal .btn-text {\r\n  text-align: center;\r\n}\r\n\r\n/* Login Hint */\r\n.login-hint {\r\n  color: #666;\r\n  font-size: 0.85rem;\r\n  margin-top: 1rem;\r\n  text-align: center;\r\n}\r\n\r\n/* Settings View */\r\n.settings-view {\r\n  width: 100%;\r\n}\r\n\r\n.settings-list {\r\n  width: 100%;\r\n  margin-bottom: 1.5rem;\r\n}\r\n\r\n.setting-item {\r\n  margin-bottom: 1.25rem;\r\n}\r\n\r\n.setting-item label {\r\n  display: block;\r\n  color: #a0a0a0;\r\n  font-size: 0.9rem;\r\n  margin-bottom: 0.5rem;\r\n}\r\n\r\n.slider-container {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 1rem;\r\n}\r\n\r\n.slider {\r\n  flex: 1;\r\n  height: 8px;\r\n  -webkit-appearance: none;\r\n  appearance: none;\r\n  background: rgba(255, 255, 255, 0.1);\r\n  border-radius: 4px;\r\n  outline: none;\r\n}\r\n\r\n.slider::-webkit-slider-thumb {\r\n  -webkit-appearance: none;\r\n  appearance: none;\r\n  width: 20px;\r\n  height: 20px;\r\n  background: #e94560;\r\n  border-radius: 50%;\r\n  cursor: pointer;\r\n  transition: transform 0.2s;\r\n}\r\n\r\n.slider::-webkit-slider-thumb:hover {\r\n  transform: scale(1.2);\r\n}\r\n\r\n.slider::-moz-range-thumb {\r\n  width: 20px;\r\n  height: 20px;\r\n  background: #e94560;\r\n  border-radius: 50%;\r\n  cursor: pointer;\r\n  border: none;\r\n}\r\n\r\n.slider-value {\r\n  color: #ffffff;\r\n  font-size: 0.9rem;\r\n  min-width: 50px;\r\n  text-align: right;\r\n}\r\n\r\n/* Confirm View */\r\n.confirm-view {\r\n  text-align: center;\r\n}\r\n\r\n.confirm-text {\r\n  color: #a0a0a0;\r\n  font-size: 1rem;\r\n  margin-bottom: 1.5rem;\r\n  line-height: 1.5;\r\n}\r\n\r\n/* Responsive */\r\n@media (max-width: 500px) {\r\n  .pause-menu {\r\n    min-width: 90%;\r\n    padding: 1.5rem;\r\n  }\r\n  \r\n  .menu-title {\r\n    font-size: 1.5rem;\r\n  }\r\n  \r\n  .menu-buttons.horizontal {\r\n    flex-direction: column;\r\n  }\r\n}\r\n</style>\r\n","<script setup lang=\"ts\">\r\nimport { ref, onMounted, onUnmounted, computed } from 'vue'\r\nimport type { PerformanceMetrics } from '@engine/performance/PerformanceMonitor'\r\n\r\nconst props = defineProps<{\r\n  metrics: PerformanceMetrics | null\r\n  visible?: boolean\r\n}>()\r\n\r\n// FPS color based on performance\r\nconst fpsColor = computed(() => {\r\n  if (!props.metrics) return '#ffffff'\r\n  const fps = props.metrics.fps\r\n  if (fps >= 55) return '#4ade80' // Green\r\n  if (fps >= 40) return '#fbbf24' // Yellow\r\n  return '#ef4444' // Red\r\n})\r\n\r\n// Format memory\r\nconst formatMemory = (mb: number): string => {\r\n  return `${mb} MB`\r\n}\r\n\r\n// Format number with K suffix\r\nconst formatNumber = (num: number): string => {\r\n  if (num >= 1000000) return `${(num / 1000000).toFixed(1)}M`\r\n  if (num >= 1000) return `${(num / 1000).toFixed(1)}K`\r\n  return num.toString()\r\n}\r\n</script>\r\n\r\n<template>\r\n  <div v-if=\"visible && metrics\" class=\"performance-stats\">\r\n    <div class=\"stat-row\">\r\n      <span class=\"stat-label\">FPS:</span>\r\n      <span class=\"stat-value\" :style=\"{ color: fpsColor }\">{{ metrics.fps }}</span>\r\n    </div>\r\n    <div class=\"stat-row\">\r\n      <span class=\"stat-label\">Frame:</span>\r\n      <span class=\"stat-value\">{{ metrics.avgFrameTime.toFixed(1) }}ms</span>\r\n    </div>\r\n    <div class=\"stat-row\">\r\n      <span class=\"stat-label\">Draw:</span>\r\n      <span class=\"stat-value\">{{ metrics.drawCalls }}</span>\r\n    </div>\r\n    <div class=\"stat-row\">\r\n      <span class=\"stat-label\">Tris:</span>\r\n      <span class=\"stat-value\">{{ formatNumber(metrics.triangles) }}</span>\r\n    </div>\r\n    <div class=\"stat-row\">\r\n      <span class=\"stat-label\">Zombies:</span>\r\n      <span class=\"stat-value\">{{ metrics.zombieCount }}</span>\r\n    </div>\r\n    <div v-if=\"metrics.memoryUsed > 0\" class=\"stat-row\">\r\n      <span class=\"stat-label\">Mem:</span>\r\n      <span class=\"stat-value\">{{ formatMemory(metrics.memoryUsed) }}</span>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style scoped>\r\n.performance-stats {\r\n  position: fixed;\r\n  top: 10px;\r\n  right: 10px;\r\n  background: rgba(0, 0, 0, 0.7);\r\n  border: 1px solid rgba(255, 255, 255, 0.2);\r\n  border-radius: 4px;\r\n  padding: 8px 12px;\r\n  font-family: 'Consolas', 'Monaco', monospace;\r\n  font-size: 12px;\r\n  color: #ffffff;\r\n  z-index: 9999;\r\n  pointer-events: none;\r\n}\r\n\r\n.stat-row {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  gap: 12px;\r\n  line-height: 1.4;\r\n}\r\n\r\n.stat-label {\r\n  color: #a0a0a0;\r\n}\r\n\r\n.stat-value {\r\n  font-weight: bold;\r\n  text-align: right;\r\n  min-width: 50px;\r\n}\r\n</style>\r\n","<script setup lang=\"ts\">\r\nimport { onMounted, onUnmounted, ref, reactive, computed } from 'vue'\r\nimport { useRouter, useRoute } from 'vue-router'\r\nimport { GameEngine } from '@engine/GameEngine'\r\nimport { GameController, GameControllerEvent } from '@engine/GameController'\r\nimport { GameEvent } from '@engine/types'\r\nimport { useAuthStore, useGameStore } from '@/stores'\r\nimport { gameApi } from '@/api/game'\r\nimport { leaderboardApi } from '@/api/leaderboard'\r\nimport GameHUD from '@/components/GameHUD.vue'\r\nimport DamageOverlay from '@/components/DamageOverlay.vue'\r\nimport PauseMenu from '@/components/PauseMenu.vue'\r\nimport PerformanceStats from '@/components/PerformanceStats.vue'\r\nimport type { PerformanceMetrics } from '@engine/performance/PerformanceMonitor'\r\n\r\nconst router = useRouter()\r\nconst route = useRoute()\r\nconst authStore = useAuthStore()\r\nconst gameStore = useGameStore()\r\n\r\nconst gameContainer = ref<HTMLDivElement | null>(null)\r\nlet gameEngine: GameEngine | null = null\r\nlet gameController: GameController | null = null\r\n\r\n// Game state\r\nconst isPaused = ref(false)\r\nconst isGameOver = ref(false)\r\nconst isLoading = ref(true)\r\nconst loadError = ref<string | null>(null)\r\n\r\n// Performance stats\r\nconst showPerformanceStats = ref(false)\r\nconst performanceMetrics = ref<PerformanceMetrics | null>(null)\r\n\r\n// Game over state\r\nconst gameOverData = reactive({\r\n  score: 0,\r\n  waveReached: 0,\r\n  zombiesKilled: 0,\r\n  playTime: 0,\r\n  isTopTen: false,\r\n})\r\n\r\n// HUD state - reactive object for all HUD data\r\nconst hudState = reactive({\r\n  health: 100,\r\n  maxHealth: 100,\r\n  stamina: 100,\r\n  maxStamina: 100,\r\n  currentWeaponName: 'Pistol',\r\n  currentWeaponSlot: 0,\r\n  currentAmmo: 15,\r\n  reserveAmmo: 60,\r\n  magazineSize: 15,\r\n  isReloading: false,\r\n  currentWave: 1,\r\n  zombiesKilled: 0,\r\n  totalZombiesInWave: 15,\r\n  isPreparationPhase: true,\r\n  preparationTimeLeft: 30,\r\n  score: 0,\r\n  lastDamage: 0,\r\n  damageTimestamp: 0,\r\n})\r\n\r\n// Computed\r\nconst isAuthenticated = computed(() => authStore.isAuthenticated)\r\n\r\n\r\n// Update HUD from game controller\r\nfunction updateHUDFromController() {\r\n  if (!gameController) return\r\n  const state = gameController.getHUDState()\r\n  Object.assign(hudState, state)\r\n  \r\n  // Update performance metrics\r\n  if (showPerformanceStats.value) {\r\n    performanceMetrics.value = gameController.getPerformanceMetrics()\r\n  }\r\n}\r\n\r\n// Toggle performance stats display (F3 key)\r\nfunction handleKeyDown(event: KeyboardEvent) {\r\n  if (event.code === 'F3') {\r\n    event.preventDefault()\r\n    showPerformanceStats.value = !showPerformanceStats.value\r\n  }\r\n}\r\n\r\n// Handle state changed event\r\nfunction onStateChanged(data: unknown) {\r\n  const state = data as typeof hudState\r\n  Object.assign(hudState, state)\r\n}\r\n\r\n// Handle player damage event\r\nfunction onPlayerDamaged(data: unknown) {\r\n  const damageData = data as { damage: number }\r\n  hudState.lastDamage = damageData.damage\r\n  hudState.damageTimestamp = Date.now()\r\n}\r\n\r\n// Handle game over event\r\nasync function onGameOver(data: unknown) {\r\n  const overData = data as {\r\n    finalScore: number\r\n    waveReached: number\r\n    totalZombiesKilled: number\r\n    playTime: number\r\n  }\r\n  \r\n  isGameOver.value = true\r\n  gameOverData.score = overData.finalScore\r\n  gameOverData.waveReached = overData.waveReached\r\n  gameOverData.zombiesKilled = overData.totalZombiesKilled\r\n  gameOverData.playTime = overData.playTime\r\n  \r\n  // Submit score to leaderboard if authenticated\r\n  if (isAuthenticated.value) {\r\n    try {\r\n      const response = await leaderboardApi.submitScore({\r\n        score: overData.finalScore,\r\n        waveReached: overData.waveReached,\r\n        zombiesKilled: overData.totalZombiesKilled,\r\n        playTimeSeconds: Math.floor(overData.playTime),\r\n      })\r\n      gameOverData.isTopTen = response.isTopTen\r\n    } catch (error) {\r\n      console.error('Failed to submit score:', error)\r\n    }\r\n  }\r\n}\r\n\r\n// Handle game pause event\r\nfunction onGamePause() {\r\n  isPaused.value = true\r\n}\r\n\r\n// Handle game resume event\r\nfunction onGameResume() {\r\n  isPaused.value = false\r\n}\r\n\r\n\r\n// Resume game from pause menu\r\nfunction resumeGame() {\r\n  if (gameController) {\r\n    gameController.resume()\r\n  }\r\n}\r\n\r\n// Save game from pause menu\r\nasync function saveGame() {\r\n  if (!gameController || !isAuthenticated.value) return\r\n  \r\n  try {\r\n    const state = gameController.getGameState()\r\n    const response = await gameApi.saveGame(state)\r\n    gameStore.setCurrentSaveId(response.saveId)\r\n    gameStore.updateLastSaveTime()\r\n    return { success: true, message: '!' }\r\n  } catch (error) {\r\n    const message = error instanceof Error ? error.message : ''\r\n    return { success: false, message }\r\n  }\r\n}\r\n\r\n// Quit game from pause menu\r\nfunction quitGame() {\r\n  if (gameController) {\r\n    gameController.stop()\r\n  }\r\n  if (gameEngine) {\r\n    gameEngine.stop()\r\n  }\r\n  router.push('/')\r\n}\r\n\r\n// Handle settings changed from pause menu\r\nfunction onSettingsChanged(settings: { mouseSensitivity: number; masterVolume?: number; musicVolume?: number; sfxVolume?: number }) {\r\n  if (gameController) {\r\n    gameController.applyConfig(settings)\r\n  }\r\n}\r\n\r\n// Get current game state for pause menu\r\nfunction getCurrentGameState() {\r\n  return gameController?.getGameState() ?? null\r\n}\r\n\r\n// Restart game after game over\r\nfunction restartGame() {\r\n  isGameOver.value = false\r\n  if (gameController) {\r\n    gameController.startNewGame()\r\n  }\r\n}\r\n\r\n// Return to main menu after game over\r\nfunction returnToMenu() {\r\n  quitGame()\r\n}\r\n\r\n\r\n// Initialize game\r\nasync function initGame() {\r\n  if (!gameContainer.value) return\r\n  \r\n  isLoading.value = true\r\n  loadError.value = null\r\n  \r\n  try {\r\n    // Create game engine\r\n    gameEngine = new GameEngine(gameContainer.value)\r\n    await gameEngine.init()\r\n    \r\n    // Create game controller\r\n    gameController = new GameController(\r\n      gameEngine.getSceneManager(),\r\n      gameEngine.getInputManager()\r\n    )\r\n    await gameController.init()\r\n    \r\n    // Subscribe to game controller events\r\n    gameController.on(GameControllerEvent.STATE_CHANGED, onStateChanged)\r\n    gameController.on(GameControllerEvent.PLAYER_DAMAGED, onPlayerDamaged)\r\n    gameController.on(GameControllerEvent.GAME_OVER, onGameOver)\r\n    gameController.on(GameEvent.GAME_PAUSE, onGamePause)\r\n    gameController.on(GameEvent.GAME_RESUME, onGameResume)\r\n    \r\n    // Check if we're loading a saved game\r\n    const savedState = gameStore.gameState\r\n    if (savedState) {\r\n      gameController.loadGame(savedState)\r\n      gameStore.clearGameState() // Clear after loading\r\n    } else {\r\n      gameController.startNewGame()\r\n    }\r\n    \r\n    // Start the game engine loop\r\n    gameEngine.start()\r\n    \r\n    // Setup game loop integration\r\n    setupGameLoop()\r\n    \r\n    isLoading.value = false\r\n  } catch (error) {\r\n    loadError.value = error instanceof Error ? error.message : ''\r\n    isLoading.value = false\r\n  }\r\n}\r\n\r\n// Setup game loop to integrate controller with engine\r\nfunction setupGameLoop() {\r\n  if (!gameEngine || !gameController) return\r\n  \r\n  // Override the engine's fixedUpdate to use our controller\r\n  const originalFixedUpdate = gameEngine['fixedUpdate'].bind(gameEngine)\r\n  gameEngine['fixedUpdate'] = (deltaTime: number) => {\r\n    originalFixedUpdate(deltaTime)\r\n    if (gameController && !isPaused.value && !isGameOver.value) {\r\n      gameController.processInput(deltaTime)\r\n      gameController.update(deltaTime)\r\n      updateHUDFromController()\r\n    }\r\n  }\r\n}\r\n\r\n\r\n// Format play time for display\r\nfunction formatPlayTime(seconds: number): string {\r\n  const mins = Math.floor(seconds / 60)\r\n  const secs = Math.floor(seconds % 60)\r\n  return `${mins}:${secs.toString().padStart(2, '0')}`\r\n}\r\n\r\nonMounted(async () => {\r\n  // Add keyboard listener for performance stats toggle\r\n  window.addEventListener('keydown', handleKeyDown)\r\n  await initGame()\r\n})\r\n\r\nonUnmounted(() => {\r\n  // Remove keyboard listener\r\n  window.removeEventListener('keydown', handleKeyDown)\r\n  \r\n  if (gameController) {\r\n    gameController.off(GameControllerEvent.STATE_CHANGED, onStateChanged)\r\n    gameController.off(GameControllerEvent.PLAYER_DAMAGED, onPlayerDamaged)\r\n    gameController.off(GameControllerEvent.GAME_OVER, onGameOver)\r\n    gameController.off(GameEvent.GAME_PAUSE, onGamePause)\r\n    gameController.off(GameEvent.GAME_RESUME, onGameResume)\r\n    gameController.dispose()\r\n    gameController = null\r\n  }\r\n  \r\n  if (gameEngine) {\r\n    gameEngine.stop()\r\n    gameEngine = null\r\n  }\r\n})\r\n</script>\r\n\r\n<template>\r\n  <div class=\"game-view\">\r\n    <!-- Loading Screen -->\r\n    <div v-if=\"isLoading\" class=\"loading-screen\">\r\n      <div class=\"loading-content\">\r\n        <h2>...</h2>\r\n        <div class=\"loading-spinner\"></div>\r\n      </div>\r\n    </div>\r\n    \r\n    <!-- Error Screen -->\r\n    <div v-else-if=\"loadError\" class=\"error-screen\">\r\n      <div class=\"error-content\">\r\n        <h2></h2>\r\n        <p>{{ loadError }}</p>\r\n        <button class=\"menu-btn\" @click=\"router.push('/')\"></button>\r\n      </div>\r\n    </div>\r\n    \r\n    <!-- Game Container -->\r\n    <template v-else>\r\n      <div ref=\"gameContainer\" class=\"game-container\"></div>\r\n      \r\n      <!-- Game HUD Overlay -->\r\n      <GameHUD\r\n        :health=\"hudState.health\"\r\n        :max-health=\"hudState.maxHealth\"\r\n        :stamina=\"hudState.stamina\"\r\n        :max-stamina=\"hudState.maxStamina\"\r\n        :current-weapon-name=\"hudState.currentWeaponName\"\r\n        :current-weapon-slot=\"hudState.currentWeaponSlot\"\r\n        :current-ammo=\"hudState.currentAmmo\"\r\n        :reserve-ammo=\"hudState.reserveAmmo\"\r\n        :magazine-size=\"hudState.magazineSize\"\r\n        :is-reloading=\"hudState.isReloading\"\r\n        :current-wave=\"hudState.currentWave\"\r\n        :zombies-killed=\"hudState.zombiesKilled\"\r\n        :total-zombies-in-wave=\"hudState.totalZombiesInWave\"\r\n        :is-preparation-phase=\"hudState.isPreparationPhase\"\r\n        :preparation-time-left=\"hudState.preparationTimeLeft\"\r\n        :score=\"hudState.score\"\r\n      />\r\n\r\n      \r\n      <!-- Damage and Low Health Overlay -->\r\n      <DamageOverlay\r\n        :health=\"hudState.health\"\r\n        :max-health=\"hudState.maxHealth\"\r\n        :last-damage=\"hudState.lastDamage\"\r\n        :damage-timestamp=\"hudState.damageTimestamp\"\r\n      />\r\n      \r\n      <!-- Performance Stats (F3 to toggle) -->\r\n      <PerformanceStats\r\n        :metrics=\"performanceMetrics\"\r\n        :visible=\"showPerformanceStats\"\r\n      />\r\n      \r\n      <!-- Pause Menu -->\r\n      <PauseMenu\r\n        v-if=\"isPaused && !isGameOver\"\r\n        :game-state=\"getCurrentGameState()\"\r\n        @resume=\"resumeGame\"\r\n        @quit=\"quitGame\"\r\n        @settings-changed=\"onSettingsChanged\"\r\n      />\r\n      \r\n      <!-- Game Over Screen -->\r\n      <div v-if=\"isGameOver\" class=\"game-over-overlay\">\r\n        <div class=\"game-over-content\">\r\n          <h1 class=\"game-over-title\"></h1>\r\n          \r\n          <div v-if=\"gameOverData.isTopTen\" class=\"top-ten-badge\">\r\n             10!\r\n          </div>\r\n          \r\n          <div class=\"game-over-stats\">\r\n            <div class=\"stat-item\">\r\n              <span class=\"stat-label\"></span>\r\n              <span class=\"stat-value score\">{{ gameOverData.score.toLocaleString() }}</span>\r\n            </div>\r\n            <div class=\"stat-item\">\r\n              <span class=\"stat-label\"></span>\r\n              <span class=\"stat-value\">{{ gameOverData.waveReached }}</span>\r\n            </div>\r\n            <div class=\"stat-item\">\r\n              <span class=\"stat-label\"></span>\r\n              <span class=\"stat-value\">{{ gameOverData.zombiesKilled }}</span>\r\n            </div>\r\n            <div class=\"stat-item\">\r\n              <span class=\"stat-label\"></span>\r\n              <span class=\"stat-value\">{{ formatPlayTime(gameOverData.playTime) }}</span>\r\n            </div>\r\n          </div>\r\n          \r\n          <div class=\"game-over-buttons\">\r\n            <button class=\"menu-btn primary\" @click=\"restartGame\"></button>\r\n            <button class=\"menu-btn\" @click=\"router.push('/leaderboard')\"></button>\r\n            <button class=\"menu-btn secondary\" @click=\"returnToMenu\"></button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </template>\r\n  </div>\r\n</template>\r\n\r\n\r\n<style scoped>\r\n.game-view {\r\n  width: 100%;\r\n  height: 100%;\r\n  position: relative;\r\n}\r\n\r\n.game-container {\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n/* Loading Screen */\r\n.loading-screen,\r\n.error-screen {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  z-index: 1000;\r\n}\r\n\r\n.loading-content,\r\n.error-content {\r\n  text-align: center;\r\n  color: #ffffff;\r\n}\r\n\r\n.loading-content h2,\r\n.error-content h2 {\r\n  font-size: 2rem;\r\n  color: #e94560;\r\n  margin-bottom: 1.5rem;\r\n}\r\n\r\n.loading-spinner {\r\n  width: 50px;\r\n  height: 50px;\r\n  border: 4px solid rgba(233, 69, 96, 0.3);\r\n  border-top-color: #e94560;\r\n  border-radius: 50%;\r\n  animation: spin 1s linear infinite;\r\n  margin: 0 auto;\r\n}\r\n\r\n@keyframes spin {\r\n  to { transform: rotate(360deg); }\r\n}\r\n\r\n.error-content p {\r\n  color: #a0a0a0;\r\n  margin-bottom: 1.5rem;\r\n}\r\n\r\n/* Game Over Screen */\r\n.game-over-overlay {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  background: rgba(0, 0, 0, 0.9);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  z-index: 1000;\r\n}\r\n\r\n\r\n.game-over-content {\r\n  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);\r\n  border: 2px solid rgba(233, 69, 96, 0.5);\r\n  border-radius: 16px;\r\n  padding: 2.5rem;\r\n  text-align: center;\r\n  min-width: 400px;\r\n  box-shadow: 0 0 40px rgba(233, 69, 96, 0.3);\r\n}\r\n\r\n.game-over-title {\r\n  font-size: 3rem;\r\n  color: #e94560;\r\n  text-shadow: 0 0 20px rgba(233, 69, 96, 0.5);\r\n  margin-bottom: 1rem;\r\n}\r\n\r\n.top-ten-badge {\r\n  background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);\r\n  color: #1a1a2e;\r\n  padding: 0.5rem 1.5rem;\r\n  border-radius: 20px;\r\n  font-weight: bold;\r\n  font-size: 1.1rem;\r\n  display: inline-block;\r\n  margin-bottom: 1.5rem;\r\n  animation: pulse 2s ease-in-out infinite;\r\n}\r\n\r\n@keyframes pulse {\r\n  0%, 100% { transform: scale(1); }\r\n  50% { transform: scale(1.05); }\r\n}\r\n\r\n.game-over-stats {\r\n  display: grid;\r\n  grid-template-columns: repeat(2, 1fr);\r\n  gap: 1rem;\r\n  margin-bottom: 2rem;\r\n}\r\n\r\n.stat-item {\r\n  background: rgba(255, 255, 255, 0.05);\r\n  border: 1px solid rgba(255, 255, 255, 0.1);\r\n  border-radius: 8px;\r\n  padding: 1rem;\r\n}\r\n\r\n.stat-label {\r\n  display: block;\r\n  color: #a0a0a0;\r\n  font-size: 0.85rem;\r\n  margin-bottom: 0.25rem;\r\n}\r\n\r\n.stat-value {\r\n  display: block;\r\n  color: #ffffff;\r\n  font-size: 1.5rem;\r\n  font-weight: bold;\r\n}\r\n\r\n.stat-value.score {\r\n  color: #fbbf24;\r\n  font-size: 2rem;\r\n}\r\n\r\n\r\n.game-over-buttons {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 0.75rem;\r\n}\r\n\r\n/* Menu Buttons */\r\n.menu-btn {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 0.75rem;\r\n  padding: 1rem 2rem;\r\n  font-size: 1.1rem;\r\n  background: rgba(233, 69, 96, 0.2);\r\n  border: 2px solid #e94560;\r\n  color: #ffffff;\r\n  cursor: pointer;\r\n  transition: all 0.3s ease;\r\n  border-radius: 8px;\r\n}\r\n\r\n.menu-btn:hover {\r\n  background: #e94560;\r\n  transform: translateY(-2px);\r\n}\r\n\r\n.menu-btn.primary {\r\n  background: rgba(233, 69, 96, 0.4);\r\n  font-weight: bold;\r\n}\r\n\r\n.menu-btn.secondary {\r\n  background: rgba(100, 100, 100, 0.2);\r\n  border-color: #666;\r\n}\r\n\r\n.menu-btn.secondary:hover {\r\n  background: #666;\r\n}\r\n\r\n/* Responsive */\r\n@media (max-width: 500px) {\r\n  .game-over-content {\r\n    min-width: 90%;\r\n    padding: 1.5rem;\r\n  }\r\n  \r\n  .game-over-title {\r\n    font-size: 2rem;\r\n  }\r\n  \r\n  .game-over-stats {\r\n    grid-template-columns: 1fr;\r\n  }\r\n}\r\n</style>\r\n"],"names":["InputKey","InputEvent","InputManager","element","event","key","code","direction","button","sensitivity","callback","listeners","data","x","z","length","CitySceneBuilder","scene","THREE.Group","THREE.MeshStandardMaterial","streetMaterial","sidewalkMaterial","mainStreet","crossStreet","leftSidewalk","rightSidewalk","width","material","geometry","THREE.PlaneGeometry","mesh","THREE.Mesh","THREE.BoxGeometry","leftBuildings","THREE.Vector3","rightBuildings","config","index","building","materialKey","bodyGeometry","body","floorHeight","windowGeometry","floor","windowsPerFloor","startX","w","isLit","frontWindow","backWindow","holeMaterial","THREE.MeshBasicMaterial","numHoles","i","holeWidth","holeHeight","holeGeometry","hole","side","metalMaterial","acGeometry","ac","tankGeometry","THREE.CylinderGeometry","tank","pos","car","barrier","debris","crateGroup","bodyMaterial","cabinGeometry","cabin","wheelGeometry","wheel","legGeometry","leftLeg","rightLeg","concreteMaterial","numPieces","size","piece","stack","woodMaterial","crateSize","crateGeometry","bottomCount","crate","topCrate","leftLight","rightLight","barrel","light","poleGeometry","pole","armGeometry","arm","fixtureGeometry","fixtureMaterial","fixture","pointLight","THREE.PointLight","barrelGeometry","barrelMesh","fireLight","glowGeometry","THREE.SphereGeometry","glowMaterial","glow","trashMaterial","trash","spawnPoints","distances","angles","dist","angle","disposeGroup","group","object","LightingPresets","SceneManager","container","THREE.Scene","THREE.Color","THREE.Fog","THREE.PerspectiveCamera","THREE.WebGLRenderer","THREE.PCFSoftShadowMap","THREE.SRGBColorSpace","THREE.ACESFilmicToneMapping","THREE.AmbientLight","THREE.DirectionalLight","THREE.HemisphereLight","THREE.Raycaster","groundGeometry","groundMaterial","ground","sceneName","objectsToRemove","THREE.Light","obj","presetName","preset","playerPosition","targetPreset","position","hit","id","origin","maxDistance","THREE.Vector2","height","objectsToDispose","mat","GameEngine","GameEvent","currentTime","frameTime","iterations","maxIterations","alpha","deltaTime","_deltaTime","_alpha","playerPos","movement","mouseMovement","wheelDirection","weaponSlot","state","fps","PlayerConfig","PlayerEvent","Player","rotation","THREE.Euler","camera","inputX","inputZ","speed","forward","right","yRotation","moveDirection","deltaX","deltaY","jumpVelocity","active","amount","previousHealth","previousStamina","groundY","rot","onGround","wasOnGround","WeaponEvent","Weapon","timeSinceLastFire","fireInterval","resolve","ammoNeeded","ammoToTransfer","currentAmmo","reserveAmmo","DEFAULT_PISTOL_CONFIG","WeaponType","Pistol","intersects","DEFAULT_RIFLE_CONFIG","Rifle","DEFAULT_SHOTGUN_CONFIG","Shotgun","totalDamage","closestHit","closestDistance","spreadDirection","spreadAngle","spreadAngle2","spreadQuat","THREE.Quaternion","DEFAULT_MELEE_CONFIG","MeleeWeapon","now","WeaponManagerEvent","MAX_WEAPON_SLOTS","WeaponManager","weapon","slot","currentWeapon","previousIndex","startIndex","nextIndex","prevIndex","weaponId","weaponState","ZombieConfig","ZombieVariant","ZombieEvent","Zombie","ZombieStateType","variant","variantConfig","newState","distanceToPlayer","_playerPosition","_distanceToPlayer","newPosition","hitPoint","zombie","ZOMBIE_VISUAL_CONFIGS","ZombieVisuals","bodyColor","skinColor","eyeColor","skinMaterial","eyeMaterial","torsoHeight","torsoGeometry","headRadius","headGeometry","eyeGeometry","leftEye","rightEye","armLength","armMesh","handGeometry","hand","leg","legLength","legMesh","footGeometry","foot","newAnimation","sway","walkCycle","armSwing","legSwing","runCycle","attackPhase","windUp","strike","recovery","originalColor","child","m","ZombieManager","zombieVariant","visuals","count","radius","spawned","spawnPoint","distance","roll","toRemove","error","damage","range","closest","raycaster","meshes","meshToZombie","hitObject","point","states","idNum","GameOverReason","GameOverManager","score","reason","finalScore","waveReached","totalZombiesKilled","playTime","displayData","playerHealth","totalSeconds","minutes","seconds","hours","lines","WaveConfig","WaveEvent","WaveManager","zombieManager","player","points","waveBonus","waveNumber","zombiesKilled","validPoints","dx","dz","wave","killScore","AudioConfig","SoundType","MusicTrack","SoundEffect","AudioManager","THREE.AudioListener","url","type","loadPromise","buffer","arrayBuffer","sounds","s","options","cached","volume","loop","playbackRate","source","gainNode","categoryGain","soundId","refDistance","rolloffFactor","pannerNode","sound","track","crossfade","duration","multiplier","up","listener","SoundUrls","GameAudioController","audioManager","soundsToLoad","weaponType","zombieId","ambient","zombies","pos1","pos2","dy","pitchVariation","CameraConfig","FirstPersonCamera","aspect","movementX","movementY","oldSensitivity","LODManager","THREE.Frustum","THREE.Matrix4","renderer","worldPosition","boundingSphere","scale","maxScale","isVisible","lod","avgFrameTime","a","b","targetFrameTime","near","mid","far","levels","highDetail","mediumDetail","lowDetail","billboard","THREE.LOD","targetRatio","positions","vertexCount","targetCount","simplified","THREE.BufferGeometry","newPositions","step","THREE.Float32BufferAttribute","normals","newNormals","texture","color","THREE.SpriteMaterial","sprite","THREE.Sprite","createFn","pool","info","level","enabled","PerformanceEvent","PerformanceMonitor","frameTimeMs","perf","usedMB","limitMB","usagePercent","minFrameTime","maxFrameTime","drawCalls","triangles","geometries","textures","memoryUsed","GameControllerEvent","DEFAULT_GAME_CONFIG","GameController","sceneManager","inputManager","fpsData","currentQuality","healthData","weaponData","scoreData","zombieData","zombiesInRange","result","stored","parsed","props","__props","healthPercent","computed","staminaPercent","zombiesRemaining","healthBarColor","formattedPrepTime","mins","secs","formattedScore","weaponSlotDisplay","ammoDisplay","isAmmoLow","isAmmoEmpty","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","_cache","_hoisted_5","_toDisplayString","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","_normalizeStyle","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","isDamageFlashing","ref","damageIntensity","isLowHealth","isCriticalHealth","lowHealthIntensity","watch","triggerDamageFlash","_normalizeClass","emit","__emit","router","useRouter","authStore","useAuthStore","gameStore","useGameStore","currentView","isSaving","saveMessage","saveError","settings","isAuthenticated","canSave","loadSettings","resumeGame","saveGame","response","gameApi","openSettings","closeSettings","saveSettings","showQuitConfirm","cancelQuit","confirmQuit","$event","fpsColor","formatMemory","mb","formatNumber","num","useRoute","gameContainer","gameEngine","gameController","isPaused","isGameOver","isLoading","loadError","showPerformanceStats","performanceMetrics","gameOverData","reactive","hudState","updateHUDFromController","handleKeyDown","onStateChanged","onPlayerDamaged","damageData","onGameOver","overData","leaderboardApi","onGamePause","onGameResume","quitGame","onSettingsChanged","getCurrentGameState","restartGame","returnToMenu","initGame","savedState","setupGameLoop","originalFixedUpdate","formatPlayTime","onMounted","onUnmounted","_unref","_Fragment","_createVNode","GameHUD","DamageOverlay","PerformanceStats","_createBlock","PauseMenu"],"mappings":"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"}