import{B as w}from"./vue-vendor-CeuWReVY.js";import{a as s}from"./client-CIWp8brx.js";var d=(e=>(e.PISTOL="pistol",e.RIFLE="rifle",e.SHOTGUN="shotgun",e.MELEE="melee",e))(d||{}),p=(e=>(e.WALKER="walker",e.RUNNER="runner",e.BRUTE="brute",e.CRAWLER="crawler",e))(p||{}),c=(e=>(e.IDLE="idle",e.WANDERING="wandering",e.CHASING="chasing",e.ATTACKING="attacking",e.DYING="dying",e))(c||{}),y=(e=>(e.GAME_START="game:start",e.GAME_PAUSE="game:pause",e.GAME_RESUME="game:resume",e.GAME_STOP="game:stop",e.GAME_OVER="game:over",e.WAVE_START="wave:start",e.WAVE_END="wave:end",e.PLAYER_DAMAGE="player:damage",e.PLAYER_DEATH="player:death",e.ZOMBIE_SPAWN="zombie:spawn",e.ZOMBIE_DEATH="zombie:death",e))(y||{});class t extends Error{field;details;constructor(r,a){super(`Deserialization error at field '${r}': ${a}`),this.name="DeserializationError",this.field=r,this.details=a}}function n(e){return Math.round(e*1e3)/1e3}function m(e){return{x:n(e.x),y:n(e.y),z:n(e.z)}}function l(e,r){if(typeof e!="object"||e===null)throw new t(r,"Expected an object");const a=e;if(typeof a.x!="number")throw new t(`${r}.x`,"Expected a number");if(typeof a.y!="number")throw new t(`${r}.y`,"Expected a number");if(typeof a.z!="number")throw new t(`${r}.z`,"Expected a number");return{x:n(a.x),y:n(a.y),z:n(a.z)}}function v(e,r){if(typeof e!="object"||e===null)throw new t(r,"Expected an object");const a=e;if(typeof a.id!="string")throw new t(`${r}.id`,"Expected a string");if(typeof a.currentAmmo!="number")throw new t(`${r}.currentAmmo`,"Expected a number");if(typeof a.reserveAmmo!="number")throw new t(`${r}.reserveAmmo`,"Expected a number");return{id:a.id,currentAmmo:a.currentAmmo,reserveAmmo:a.reserveAmmo}}function b(e,r){if(typeof e!="object"||e===null)throw new t(r,"Expected an object");const a=e;if(typeof a.health!="number")throw new t(`${r}.health`,"Expected a number");if(typeof a.stamina!="number")throw new t(`${r}.stamina`,"Expected a number");if(typeof a.currentWeaponIndex!="number")throw new t(`${r}.currentWeaponIndex`,"Expected a number");if(!Array.isArray(a.weapons))throw new t(`${r}.weapons`,"Expected an array");return{position:l(a.position,`${r}.position`),rotation:l(a.rotation,`${r}.rotation`),health:a.health,stamina:a.stamina,weapons:a.weapons.map((o,i)=>v(o,`${r}.weapons[${i}]`)),currentWeaponIndex:a.currentWeaponIndex}}function f(e,r){if(typeof e!="object"||e===null)throw new t(r,"Expected an object");const a=e;if(typeof a.currentWave!="number")throw new t(`${r}.currentWave`,"Expected a number");if(typeof a.zombiesKilled!="number")throw new t(`${r}.zombiesKilled`,"Expected a number");if(typeof a.totalZombiesInWave!="number")throw new t(`${r}.totalZombiesInWave`,"Expected a number");if(typeof a.isPreparationPhase!="boolean")throw new t(`${r}.isPreparationPhase`,"Expected a boolean");return{currentWave:a.currentWave,zombiesKilled:a.zombiesKilled,totalZombiesInWave:a.totalZombiesInWave,isPreparationPhase:a.isPreparationPhase}}function g(e){return Object.values(p).includes(e)}function E(e){return Object.values(c).includes(e)}function S(e,r){if(typeof e!="object"||e===null)throw new t(r,"Expected an object");const a=e;if(typeof a.id!="string")throw new t(`${r}.id`,"Expected a string");if(typeof a.health!="number")throw new t(`${r}.health`,"Expected a number");if(!g(a.variant))throw new t(`${r}.variant`,`Expected one of: ${Object.values(p).join(", ")}`);if(!E(a.state))throw new t(`${r}.state`,`Expected one of: ${Object.values(c).join(", ")}`);return{id:a.id,position:l(a.position,`${r}.position`),health:a.health,variant:a.variant,state:a.state}}class u{static serialize(r){const a={player:{position:m(r.player.position),rotation:m(r.player.rotation),health:r.player.health,stamina:r.player.stamina,weapons:r.player.weapons.map(o=>({id:o.id,currentAmmo:o.currentAmmo,reserveAmmo:o.reserveAmmo})),currentWeaponIndex:r.player.currentWeaponIndex},wave:{currentWave:r.wave.currentWave,zombiesKilled:r.wave.zombiesKilled,totalZombiesInWave:r.wave.totalZombiesInWave,isPreparationPhase:r.wave.isPreparationPhase},zombies:r.zombies.map(o=>({id:o.id,position:m(o.position),health:o.health,variant:o.variant,state:o.state})),score:r.score,playTime:r.playTime,timestamp:r.timestamp};return JSON.stringify(a)}static deserialize(r){let a;try{a=JSON.parse(r)}catch{throw new t("root","Invalid JSON format")}if(typeof a!="object"||a===null)throw new t("root","Expected an object");const o=a;if(typeof o.score!="number")throw new t("score","Expected a number");if(typeof o.playTime!="number")throw new t("playTime","Expected a number");if(typeof o.timestamp!="number")throw new t("timestamp","Expected a number");if(!Array.isArray(o.zombies))throw new t("zombies","Expected an array");return{player:b(o.player,"player"),wave:f(o.wave,"wave"),zombies:o.zombies.map((i,h)=>S(i,`zombies[${h}]`)),score:o.score,playTime:o.playTime,timestamp:o.timestamp}}}const I=w("game",{state:()=>({gameState:null,saves:[],currentSaveId:null,isLoading:!1,isSaving:!1,error:null,lastSaveTime:null}),getters:{currentWave:e=>e.gameState?.wave.currentWave??0,playerHealth:e=>e.gameState?.player.health??0,score:e=>e.gameState?.score??0,playTime:e=>e.gameState?.playTime??0,hasGameState:e=>e.gameState!==null,hasSaves:e=>e.saves.length>0,serializedState:e=>e.gameState?u.serialize(e.gameState):null},actions:{setGameState(e){this.gameState=e,this.error=null},setGameStateFromJson(e){try{this.gameState=u.deserialize(e),this.error=null}catch(r){const a=r instanceof Error?r.message:"Failed to deserialize game state";throw this.error=a,r}},clearGameState(){this.gameState=null,this.currentSaveId=null},setLoading(e){this.isLoading=e},setSaving(e){this.isSaving=e},setError(e){this.error=e},setSaves(e){this.saves=e},setCurrentSaveId(e){this.currentSaveId=e},updateLastSaveTime(){this.lastSaveTime=Date.now()},addSave(e){this.saves.unshift(e)},removeSave(e){this.saves=this.saves.filter(r=>r.id!==e),this.currentSaveId===e&&(this.currentSaveId=null)},clearAll(){this.gameState=null,this.saves=[],this.currentSaveId=null,this.isLoading=!1,this.isSaving=!1,this.error=null,this.lastSaveTime=null}}});function x(e){return{player:{position:{x:e.player.position.x,y:e.player.position.y,z:e.player.position.z},rotation:{x:e.player.rotation.x,y:e.player.rotation.y,z:e.player.rotation.z},health:e.player.health,stamina:e.player.stamina,weapons:e.player.weapons.map(r=>({id:r.id,currentAmmo:r.currentAmmo,reserveAmmo:r.reserveAmmo})),currentWeaponIndex:e.player.currentWeaponIndex},wave:{currentWave:e.wave.currentWave,zombiesKilled:e.wave.zombiesKilled,totalZombiesInWave:e.wave.totalZombiesInWave,isPreparationPhase:e.wave.isPreparationPhase},zombies:e.zombies.map(r=>({id:r.id,position:{x:r.position.x,y:r.position.y,z:r.position.z},health:r.health,variant:r.variant,state:r.state})),score:e.score,playTime:e.playTime,timestamp:e.timestamp}}const W={async saveGame(e){try{const r=x(e);return(await s.post("/game/save",r)).data}catch(r){const a=r instanceof Error?r.message:"Failed to save game";throw new Error(`Save failed: ${a}`)}},async loadGame(e){try{const a=(await s.get(`/game/load/${e}`)).data;return{player:{position:a.player.position,rotation:a.player.rotation,health:a.player.health,stamina:a.player.stamina,weapons:a.player.weapons,currentWeaponIndex:a.player.currentWeaponIndex},wave:a.wave,zombies:a.zombies.map(o=>({id:o.id,position:o.position,health:o.health,variant:o.variant,state:o.state})),score:a.score,playTime:a.playTime,timestamp:a.timestamp}}catch(r){const a=r instanceof Error?r.message:"Failed to load game";throw new Error(`Load failed: ${a}`)}},async listSaves(){try{return(await s.get("/game/saves")).data}catch(e){const r=e instanceof Error?e.message:"Failed to list saves";throw new Error(`List saves failed: ${r}`)}},async deleteSave(e){try{await s.delete(`/game/save/${e}`)}catch(r){const a=r instanceof Error?r.message:"Failed to delete save";throw new Error(`Delete save failed: ${a}`)}}};export{y as G,d as W,c as Z,p as a,W as g,I as u};
//# sourceMappingURL=game-DfiOVufx.js.map
